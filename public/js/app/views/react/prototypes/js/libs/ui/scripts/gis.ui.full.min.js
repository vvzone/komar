/*! TacticMapClient.UI - v0.5.13 - 2014-04-15
* Copyright (c) SSS 2014 
 jQuery.UI included */
!function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(jQuery),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;i>h;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(c[e]=a.isPlainObject(f)?a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,this.each(h?function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}:function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),d===b)return f[c]===b?null:f[c];f[c]=d}else{if(d===b)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow?"":b.element.css("overflow-x"),d=b.isWindow?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]);return{element:c,isWindow:d,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:0>d?"left":c>0?"right":"center",vertical:0>f?"top":e>0?"bottom":"middle"};l>n&&h(c+d)<n&&(i.horizontal="center"),m>p&&h(e+f)<p&&(i.vertical="middle"),i.important=g(h(c),h(d))>g(h(e),h(f))?"horizontal":"vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&0>=j?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):a.left=j>0&&0>=i?e:i>j?e+f-b.collisionWidth:e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&0>=j?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):a.top=j>0&&0>=i?e:i>j?e+f-b.collisionHeight:e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];0>k?(c=a.left+m+n+o+b.collisionWidth-g-f,(0>c||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];0>k?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(0>d||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&11>e,b.innerHTML="",c.removeChild(b)}()}(jQuery),function(a){var b,c,d,e,f="ui-button ui-widget ui-state-default ui-corner-all",g="ui-state-hover ui-state-active ",h="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",i=function(){var b=a(this).find(":ui-button");setTimeout(function(){b.button("refresh")},1)},j=function(b){var c=b.name,d=b.form,e=a([]);return c&&(c=c.replace(/'/g,"\\'"),e=d?a(d).find("[name='"+c+"']"):a("[name='"+c+"']",b.ownerDocument).filter(function(){return!this.form})),e};a.widget("ui.button",{version:"1.10.2",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,i),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var g=this,h=this.options,k="checkbox"===this.type||"radio"===this.type,l=k?"":"ui-state-active",m="ui-state-focus";null===h.label&&(h.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(f).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){h.disabled||this===b&&a(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){h.disabled||a(this).removeClass(l)}).bind("click"+this.eventNamespace,function(a){h.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){g.buttonElement.addClass(m)}).bind("blur"+this.eventNamespace,function(){g.buttonElement.removeClass(m)}),k&&(this.element.bind("change"+this.eventNamespace,function(){e||g.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(a){h.disabled||(e=!1,c=a.pageX,d=a.pageY)}).bind("mouseup"+this.eventNamespace,function(a){h.disabled||(c!==a.pageX||d!==a.pageY)&&(e=!0)})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return h.disabled||e?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(h.disabled||e)return!1;a(this).addClass("ui-state-active"),g.buttonElement.attr("aria-pressed","true");var b=g.element[0];j(b).not(b).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return h.disabled?!1:(a(this).addClass("ui-state-active"),b=this,void g.document.one("mouseup",function(){b=null}))}).bind("mouseup"+this.eventNamespace,function(){return h.disabled?!1:void a(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(b){return h.disabled?!1:void((b.keyCode===a.ui.keyCode.SPACE||b.keyCode===a.ui.keyCode.ENTER)&&a(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",h.disabled),this._resetButton()},_determineButtonType:function(){var a,b,c;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(a=this.element.parents().last(),b="label[for='"+this.element.attr("id")+"']",this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible"),c=this.element.is(":checked"),c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",c)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(f+" "+g+" "+h).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(a,b){return this._super(a,b),"disabled"===a?void(b?this.element.prop("disabled",!0):this.element.prop("disabled",!1)):void this._resetButton()},refresh:function(){var b=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");b!==this.options.disabled&&this._setOption("disabled",b),"radio"===this.type?j(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var b=this.buttonElement.removeClass(h),c=a("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),d=this.options.icons,e=d.primary&&d.secondary,f=[];d.primary||d.secondary?(this.options.text&&f.push("ui-button-text-icon"+(e?"s":d.primary?"-primary":"-secondary")),d.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||(f.push(e?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",a.trim(c)))):f.push("ui-button-text-only"),b.addClass(f.join(" "))}}),a.widget("ui.buttonset",{version:"1.10.2",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,b){"disabled"===a&&this.buttons.button("option",a,b),this._super(a,b)},refresh:function(){var b="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{version:"1.10.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.draggable",a.ui.mouse,{version:"1.10.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),c.containment&&this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c,d=this,e=!1,f=!1;for(a.ui.ddmanager&&!this.options.dropBehaviour&&(f=a.ui.ddmanager.drop(this,b)),this.dropped&&(f=this.dropped,this.dropped=!1),c=this.element[0];c&&(c=c.parentNode);)c===document&&(e=!0);return e||"original"!==this.options.helper?("invalid"===this.options.revert&&!f||"valid"===this.options.revert&&f||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,f)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){d._trigger("stop",b)!==!1&&d._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1):!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}
},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;if("parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=["document"===e.containment?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"===e.containment?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"===e.containment?0:a(window).scrollLeft())+a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"===e.containment?0:a(window).scrollTop())+(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor===Array)e.containment.constructor===Array&&(this.containment=e.containment);else{if(c=a(e.containment),d=c[0],!d)return;b="hidden"!==a(d).css("overflow"),this.containment=[(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0),(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderRightWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderBottomWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e,f,g=this.options,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName),j=b.pageX,k=b.pageY;return this.originalPosition&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,b.pageX-this.offset.click.left<c[0]&&(j=c[0]+this.offset.click.left),b.pageY-this.offset.click.top<c[1]&&(k=c[1]+this.offset.click.top),b.pageX-this.offset.click.left>c[2]&&(j=c[2]+this.offset.click.left),b.pageY-this.offset.click.top>c[3]&&(k=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((k-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,k=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((j-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,j=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f)),{top:k-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:j-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"ui-sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("ui-draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("ui-draggable"),e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("ui-draggable").options;b.css("cursor")&&(c._cursor=b.css("cursor")),b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("ui-draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("ui-draggable");b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName&&(b.overflowOffset=b.scrollParent.offset())},drag:function(b){var c=a(this).data("ui-draggable"),d=c.options,e=!1;c.scrollParent[0]!==document&&"HTML"!==c.scrollParent[0].tagName?(d.axis&&"x"===d.axis||(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-c.overflowOffset.top<d.scrollSensitivity&&(c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed)),d.axis&&"y"===d.axis||(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-c.overflowOffset.left<d.scrollSensitivity&&(c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed))):(d.axis&&"x"===d.axis||(b.pageY-a(document).scrollTop()<d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed))),d.axis&&"y"===d.axis||(b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)))),e!==!1&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}}),a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("ui-draggable"),c=b.options;b.snapElements=[],a(c.snap.constructor!==String?c.snap.items||":data(ui-draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!==b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("ui-draggable"),o=n.options,p=o.snapTolerance,q=c.offset.left,r=q+n.helperProportions.width,s=c.offset.top,t=s+n.helperProportions.height;for(l=n.snapElements.length-1;l>=0;l--)h=n.snapElements[l].left,i=h+n.snapElements[l].width,j=n.snapElements[l].top,k=j+n.snapElements[l].height,q>h-p&&i+p>q&&s>j-p&&k+p>s||q>h-p&&i+p>q&&t>j-p&&k+p>t||r>h-p&&i+p>r&&s>j-p&&k+p>s||r>h-p&&i+p>r&&t>j-p&&k+p>t?("inner"!==o.snapMode&&(d=Math.abs(j-t)<=p,e=Math.abs(k-s)<=p,f=Math.abs(h-r)<=p,g=Math.abs(i-q)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j-n.helperProportions.height,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i}).left-n.margins.left)),m=d||e||f||g,"outer"!==o.snapMode&&(d=Math.abs(j-s)<=p,e=Math.abs(k-t)<=p,f=Math.abs(h-q)<=p,g=Math.abs(i-r)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k-n.helperProportions.height,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[l].snapping&&(d||e||f||g||m)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=d||e||f||g||m):(n.snapElements[l].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=!1)}}),a.ui.plugin.add("draggable","stack",{start:function(){var b,c=this.data("ui-draggable").options,d=a.makeArray(a(c.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});d.length&&(b=parseInt(a(d[0]).css("zIndex"),10)||0,a(d).each(function(c){a(this).css("zIndex",b+c)}),this.css("zIndex",b+d.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a){function b(b,c){var d=(b.attr("aria-describedby")||"").split(/\s+/);d.push(c),b.data("ui-tooltip-id",c).attr("aria-describedby",a.trim(d.join(" ")))}function c(b){var c=b.data("ui-tooltip-id"),d=(b.attr("aria-describedby")||"").split(/\s+/),e=a.inArray(c,d);-1!==e&&d.splice(e,1),b.removeData("ui-tooltip-id"),d=a.trim(d.join(" ")),d?b.attr("aria-describedby",d):b.removeAttr("aria-describedby")}var d=0;a.widget("ui.tooltip",{version:"1.10.2",options:{content:function(){var b=a(this).attr("title")||"";return a("<a>").text(b).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(b,c){var d=this;return"disabled"===b?(this[c?"_disable":"_enable"](),void(this.options[b]=c)):(this._super(b,c),void("content"===b&&a.each(this.tooltips,function(a,b){d._updateContent(b)})))},_disable:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d[0],b.close(e,!0)}),this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.is("[title]")&&b.data("ui-tooltip-title",b.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.data("ui-tooltip-title")&&b.attr("title",b.data("ui-tooltip-title"))})},open:function(b){var c=this,d=a(b?b.target:this.element).closest(this.options.items);d.length&&!d.data("ui-tooltip-id")&&(d.attr("title")&&d.data("ui-tooltip-title",d.attr("title")),d.data("ui-tooltip-open",!0),b&&"mouseover"===b.type&&d.parents().each(function(){var b,d=a(this);d.data("ui-tooltip-open")&&(b=a.Event("blur"),b.target=b.currentTarget=this,c.close(b,!0)),d.attr("title")&&(d.uniqueId(),c.parents[this.id]={element:this,title:d.attr("title")},d.attr("title",""))}),this._updateContent(d,b))},_updateContent:function(a,b){var c,d=this.options.content,e=this,f=b?b.type:null;return"string"==typeof d?this._open(b,a,d):(c=d.call(a[0],function(c){a.data("ui-tooltip-open")&&e._delay(function(){b&&(b.type=f),this._open(b,a,c)})}),void(c&&this._open(b,a,c)))},_open:function(c,d,e){function f(a){j.of=a,g.is(":hidden")||g.position(j)}var g,h,i,j=a.extend({},this.options.position);if(e){if(g=this._find(d),g.length)return void g.find(".ui-tooltip-content").html(e);d.is("[title]")&&(c&&"mouseover"===c.type?d.attr("title",""):d.removeAttr("title")),g=this._tooltip(d),b(d,g.attr("id")),g.find(".ui-tooltip-content").html(e),this.options.track&&c&&/^mouse/.test(c.type)?(this._on(this.document,{mousemove:f}),f(c)):g.position(a.extend({of:d},this.options.position)),a("img",g).on("load",function(){f.call(this,j.of)}),a(document.body).on("resize",function(){f.call(this,j.of)}),g.hide(),this._show(g,this.options.show),this.options.show&&this.options.show.delay&&(i=this.delayedShow=setInterval(function(){g.is(":visible")&&(f(j.of),clearInterval(i))},a.fx.interval)),this._trigger("open",c,{tooltip:g}),h={keyup:function(b){if(b.keyCode===a.ui.keyCode.ESCAPE){var c=a.Event(b);c.currentTarget=d[0],this.close(c,!0)}},remove:function(){this._removeTooltip(g)}},c&&"mouseover"!==c.type||(h.mouseleave="close"),c&&"focusin"!==c.type||(h.focusout="close"),this._on(!0,d,h)}},close:function(b){var d=this,e=a(b?b.currentTarget:this.element),f=this._find(e);this.closing||(clearInterval(this.delayedShow),e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title")),c(e),f.stop(!0),this._hide(f,this.options.hide,function(){d._removeTooltip(a(this))}),e.removeData("ui-tooltip-open"),this._off(e,"mouseleave focusout keyup"),e[0]!==this.element[0]&&this._off(e,"remove"),this._off(this.document,"mousemove"),b&&"mouseleave"===b.type&&a.each(this.parents,function(b,c){a(c.element).attr("title",c.title),delete d.parents[b]}),this.closing=!0,this._trigger("close",b,{tooltip:f}),this.closing=!1)},_tooltip:function(b){var c="ui-tooltip-"+d++,e=a("<div>").attr({id:c,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return a("<div>").addClass("ui-tooltip-content").appendTo(e),e.appendTo(this.document[0].body),this.tooltips[c]=b,e},_find:function(b){var c=b.data("ui-tooltip-id");return c?a("#"+c):a()},_removeTooltip:function(a){a.remove(),delete this.tooltips[a.attr("id")]},_destroy:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d[0],b.close(e,!0),a("#"+c).remove(),d.data("ui-tooltip-title")&&(d.attr("title",d.data("ui-tooltip-title")),d.removeData("ui-tooltip-title"))})}})}(jQuery),function(a){var b=5;a.widget("ui.slider",a.ui.mouse,{version:"1.10.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;c>b;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):this.range=a([])},_setupEvents:function(){var a=this.handles.add(this.range).filter("a");this._off(a),this._on(a,this._handleEvents),this._hoverable(a),this._focusable(a)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return l.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h===!1?!1:(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),0>d&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&d>c)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),void this._change(null,0)):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),void this._change(null,b);if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;e>d;d+=1)this._change(null,d);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=this._animateOff?!1:h.animate,k={};this.options.values&&this.options.values.length?this.handles.each(function(d){c=(i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())*100,k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?(d-e)/(f-e)*100:0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(c){var d,e,f,g,h=a(c.target).data("ui-slider-handle-index");switch(c.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(c.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(c.target).addClass("ui-state-active"),d=this._start(c,h),d===!1))return}switch(g=this.options.step,e=f=this.options.values&&this.options.values.length?this.values(h):this.value(),c.keyCode){case a.ui.keyCode.HOME:f=this._valueMin();break;case a.ui.keyCode.END:f=this._valueMax();break;case a.ui.keyCode.PAGE_UP:f=this._trimAlignValue(e+(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.PAGE_DOWN:f=this._trimAlignValue(e-(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(e===this._valueMax())return;f=this._trimAlignValue(e+g);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(e===this._valueMin())return;f=this._trimAlignValue(e-g)}this._slide(c,h,f)},click:function(a){a.preventDefault()},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}})}(jQuery),function(a){var b={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},c={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("ui.dialog",{version:"1.10.2",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(b){var c=a(this).css(b).offset().top;0>c&&a(this).css("top",b.top-c)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&a.fn.draggable&&this._makeDraggable(),this.options.resizable&&a.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var b=this.options.appendTo;return b&&(b.jquery||b.nodeType)?a(b):this.document.find(b||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),a=b.parent.children().eq(b.index),a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,close:function(b){var c=this;this._isOpen&&this._trigger("beforeClose",b)!==!1&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||a(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){c._trigger("close",b)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(a,b){var c=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return c&&!b&&this._trigger("focus",a),c},open:function(){var b=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=a(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable(),b._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var a=this.element.find("[autofocus]");a.length||(a=this.element.find(":tabbable")),a.length||(a=this.uiDialogButtonPane.find(":tabbable")),a.length||(a=this.uiDialogTitlebarClose.filter(":tabbable")),a.length||(a=this.uiDialog),a.eq(0).focus()},_keepFocus:function(b){function c(){var b=this.document[0].activeElement,c=this.uiDialog[0]===b||a.contains(this.uiDialog[0],b);c||this._focusTabbable()}b.preventDefault(),c.call(this),this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)return b.preventDefault(),void this.close(b);if(b.keyCode===a.ui.keyCode.TAB){var c=this.uiDialog.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==this.uiDialog[0]||b.shiftKey?b.target!==d[0]&&b.target!==this.uiDialog[0]||!b.shiftKey||(e.focus(1),b.preventDefault()):(d.focus(1),b.preventDefault())}},mousedown:function(a){this._moveToTop(a)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var b;this.uiDialogTitlebar=a("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=a("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(a){a.preventDefault(),this.close(a)
}}),b=a("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(b),this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title||a.html("&#160;"),a.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=a("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),a.isEmptyObject(c)||a.isArray(c)&&!c.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(a.each(c,function(c,d){var e,f;d=a.isFunction(d)?{click:d,text:c}:d,d=a.extend({type:"button"},d),e=d.click,d.click=function(){e.apply(b.element[0],arguments)},f={icons:d.icons,text:d.showText},delete d.icons,delete d.showText,a("<button></button>",d).button(f).appendTo(b.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,e){a(this).addClass("ui-dialog-dragging"),c._blockFrames(),c._trigger("dragStart",d,b(e))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(e,f){d.position=[f.position.left-c.document.scrollLeft(),f.position.top-c.document.scrollTop()],a(this).removeClass("ui-dialog-dragging"),c._unblockFrames(),c._trigger("dragStop",e,b(f))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,d=this.options,e=d.resizable,f=this.uiDialog.css("position"),g="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:this._minHeight(),handles:g,start:function(d,e){a(this).addClass("ui-dialog-resizing"),c._blockFrames(),c._trigger("resizeStart",d,b(e))},resize:function(a,d){c._trigger("resize",a,b(d))},stop:function(e,f){d.height=a(this).height(),d.width=a(this).width(),a(this).removeClass("ui-dialog-resizing"),c._unblockFrames(),c._trigger("resizeStop",e,b(f))}}).css("position",f)},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=this.uiDialog.is(":visible");a||this.uiDialog.show(),this.uiDialog.position(this.options.position),a||this.uiDialog.hide()},_setOptions:function(d){var e=this,f=!1,g={};a.each(d,function(a,d){e._setOption(a,d),a in b&&(f=!0),a in c&&(g[a]=d)}),f&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(a,b){var c,d,e=this.uiDialog;"dialogClass"===a&&e.removeClass(this.options.dialogClass).addClass(b),"disabled"!==a&&(this._super(a,b),"appendTo"===a&&this.uiDialog.appendTo(this._appendTo()),"buttons"===a&&this._createButtons(),"closeText"===a&&this.uiDialogTitlebarClose.button({label:""+b}),"draggable"===a&&(c=e.is(":data(ui-draggable)"),c&&!b&&e.draggable("destroy"),!c&&b&&this._makeDraggable()),"position"===a&&this._position(),"resizable"===a&&(d=e.is(":data(ui-resizable)"),d&&!b&&e.resizable("destroy"),d&&"string"==typeof b&&e.resizable("option","handles",b),d||b===!1||this._makeResizable()),"title"===a&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var a,b,c,d=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),d.minWidth>d.width&&(d.width=d.minWidth),a=this.uiDialog.css({height:"auto",width:d.width}).outerHeight(),b=Math.max(0,d.minHeight-a),c="number"==typeof d.maxHeight?Math.max(0,d.maxHeight-a):"none","auto"===d.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,d.height-a)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(b){return a(b.target).closest(".ui-dialog").length?!0:!!a(b.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var b=this,c=this.widgetFullName;a.ui.dialog.overlayInstances||this._delay(function(){a.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(d){b._allowInteraction(d)||(d.preventDefault(),a(".ui-dialog:visible:last .ui-dialog-content").data(c)._focusTabbable())})}),this.overlay=a("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),a.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(a.ui.dialog.overlayInstances--,a.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),a.ui.dialog.overlayInstances=0,a.uiBackCompat!==!1&&a.widget("ui.dialog",a.ui.dialog,{_position:function(){var b,c=this.options.position,d=[],e=[0,0];c?(("string"==typeof c||"object"==typeof c&&"0"in c)&&(d=c.split?c.split(" "):[c[0],c[1]],1===d.length&&(d[1]=d[0]),a.each(["left","top"],function(a,b){+d[a]===d[a]&&(e[a]=d[a],d[a]=b)}),c={my:d[0]+(e[0]<0?e[0]:"+"+e[0])+" "+d[1]+(e[1]<0?e[1]:"+"+e[1]),at:d.join(" ")}),c=a.extend({},a.ui.dialog.prototype.options.position,c)):c=a.ui.dialog.prototype.options.position,b=this.uiDialog.is(":visible"),b||this.uiDialog.show(),this.uiDialog.position(c),b||this.uiDialog.hide()}})}(jQuery),function(a){function b(){var a=document.createElement("input"),b="onpaste";return a.setAttribute(b,""),"function"==typeof a[b]?"paste":"input"}var c,d=b()+".mask",e=navigator.userAgent,f=/iphone/i.test(e),g=/android/i.test(e);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",replacement:"",placeholder:"_"},a.fn.extend({caret:function(a,b){var c;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(b,e){var h,i,j,k,l,m;return!b&&this.length>0?(h=a(this[0]),h.data(a.mask.dataName)()):(e=a.extend({placeholder:a.mask.placeholder,replacement:a.mask.replacement,completed:null},e),i=a.mask.definitions,j=[],k=m=b.length,l=null,a.each(b.split(""),function(a,b){"?"==b?(m--,k=a):i[b]?(j.push(new RegExp(i[b])),null===l&&(l=j.length-1)):j.push(null)}),this.trigger("unmask").each(function(){function h(a){for(;++a<m&&!j[a];);return a}function n(a){for(;--a>=0&&!j[a];);return a}function o(a,b){var c,d;if(!(0>a)){for(c=a,d=h(b);m>c;c++)if(j[c]){if(!(m>d&&j[c].test(w[d])))break;w[c]=w[d],w[d]=e.placeholder,d=h(d)}t(),v.caret(Math.max(l,a))}}function p(a){var b,c,d,f;for(b=a,c=e.placeholder;m>b;b++)if(j[b]){if(d=h(b),f=w[b],w[b]=c,!(m>d&&j[d].test(f)))break;c=f}}function q(a){var b,c,d,e=a.which;8===e||46===e||f&&127===e?(b=v.caret(),c=b.begin,d=b.end,d-c===0&&(c=46!==e?n(c):d=h(c-1),d=46===e?h(d):d),s(c,d),o(c,d-1),a.preventDefault()):27==e&&(v.val(x),v.caret(0,u()),a.preventDefault())}function r(b){var c,d,f,i=b.which,k=v.caret();b.ctrlKey||b.altKey||b.metaKey||32>i||i&&(k.end-k.begin!==0&&(s(k.begin,k.end),o(k.begin,k.end-1)),c=h(k.begin-1),m>c&&(d=String.fromCharCode(i),j[c].test(d)&&(p(c),w[c]=d,t(),f=h(c),g?setTimeout(a.proxy(a.fn.caret,v,f),0):v.caret(f),e.completed&&f>=m&&e.completed.call(v))),b.preventDefault())}function s(a,b){var c;for(c=a;b>c&&m>c;c++)j[c]&&(w[c]=e.placeholder)}function t(){v.val(w.join(""))}function u(a,b){var c,d,f=v.val(),g=-1;for(c=0,pos=0;m>c;c++)if(j[c]){for(w[c]=e.placeholder;pos++<f.length;)if(d=f.charAt(pos-1),j[c].test(d)){w[c]=d,g=c;break}if(pos>f.length)break}else w[c]===f.charAt(pos)&&c!==k&&(pos++,g=c);return a?t():b&&g>=0?(t(),v.val(v.val().replace(new RegExp(e.placeholder,"g"),e.replacement)),s(0,m)):k>g+1?(t(),v.val(""),s(0,m)):(t(),v.val(v.val().substring(0,g+1))),k?c:l}var v=a(this),w=a.map(b.split(""),function(a){return"?"!=a?i[a]?e.placeholder:a:void 0}),x=v.val();v.data(a.mask.dataName,function(){return a.map(w,function(a,b){return j[b]&&a!=e.placeholder?a:null}).join("")}),v.attr("readonly")||v.one("unmask",function(){v.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){clearTimeout(c);var a;x=v.val(),a=u(),c=setTimeout(function(){t(),a==b.length?v.caret(0,a):v.caret(a)},10)}).bind("blur.mask",function(){u(null,!0),v.val()!=x&&v.change()}).bind("keydown.mask",q).bind("keypress.mask",r).bind(d,function(){setTimeout(function(){var a=u(!0);v.caret(a),e.completed&&a==v.val().length&&e.completed.call(v)},0)}),u()}))}})}(jQuery),function(a){var b=window.EYE=function(){var b={init:[]};return{init:function(){a.each(b.init,function(a,b){b.call()})},extend:function(a){for(var b in a)void 0!=a[b]&&(this[b]=a[b])},register:function(a,c){b[c]||(b[c]=[]),b[c].push(a)}}}();a(b.init)}(jQuery),function(a){EYE.extend({getPosition:function(a,b){var c=0,d=0,e=a.style,f=!1;if(b&&"none"==jQuery.curCSS(a,"display")){var g=e.visibility,h=e.position;f=!0,e.visibility="hidden",e.display="block",e.position="absolute"}var i=a;if(i.getBoundingClientRect){var j=i.getBoundingClientRect();c=j.left+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)-2,d=j.top+Math.max(document.documentElement.scrollTop,document.body.scrollTop)-2}else{if(c=i.offsetLeft,d=i.offsetTop,i=i.offsetParent,a!=i)for(;i;)c+=i.offsetLeft,d+=i.offsetTop,i=i.offsetParent;for(jQuery.browser.safari&&"absolute"==jQuery.curCSS(a,"position")&&(c-=document.body.offsetLeft,d-=document.body.offsetTop),i=a.parentNode;i&&"BODY"!=i.tagName.toUpperCase()&&"HTML"!=i.tagName.toUpperCase();)"inline"!=jQuery.curCSS(i,"display")&&(c-=i.scrollLeft,d-=i.scrollTop),i=i.parentNode}return 1==f&&(e.display="none",e.position=h,e.visibility=g),{x:c,y:d}},getSize:function(a){var b=parseInt(jQuery.curCSS(a,"width"),10),c=parseInt(jQuery.curCSS(a,"height"),10),d=0,e=0;if("none"!=jQuery.curCSS(a,"display"))d=a.offsetWidth,e=a.offsetHeight;else{var f=a.style,g=f.visibility,h=f.position;f.visibility="hidden",f.display="block",f.position="absolute",d=a.offsetWidth,e=a.offsetHeight,f.display="none",f.position=h,f.visibility=g}return{w:b,h:c,wb:d,hb:e}},getClient:function(a){var b,c;if(a)c=a.clientWidth,b=a.clientHeight;else{var d=document.documentElement;c=window.innerWidth||self.innerWidth||d&&d.clientWidth||document.body.clientWidth,b=window.innerHeight||self.innerHeight||d&&d.clientHeight||document.body.clientHeight}return{w:c,h:b}},getScroll:function(a){var b=0,c=0,d=0,e=0,f=0,g=0;return a&&"body"!=a.nodeName.toLowerCase()?(b=a.scrollTop,c=a.scrollLeft,d=a.scrollWidth,e=a.scrollHeight):(document.documentElement?(b=document.documentElement.scrollTop,c=document.documentElement.scrollLeft,d=document.documentElement.scrollWidth,e=document.documentElement.scrollHeight):document.body&&(b=document.body.scrollTop,c=document.body.scrollLeft,d=document.body.scrollWidth,e=document.body.scrollHeight),"undefined"!=typeof pageYOffset&&(b=pageYOffset,c=pageXOffset),f=self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,g=self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0),{t:b,l:c,w:d,h:e,iw:f,ih:g}},getMargins:function(a,b){var c=jQuery.curCSS(a,"marginTop")||"",d=jQuery.curCSS(a,"marginRight")||"",e=jQuery.curCSS(a,"marginBottom")||"",f=jQuery.curCSS(a,"marginLeft")||"";return b?{t:parseInt(c,10)||0,r:parseInt(d,10)||0,b:parseInt(e,10)||0,l:parseInt(f,10)}:{t:c,r:d,b:e,l:f}},getPadding:function(a,b){var c=jQuery.curCSS(a,"paddingTop")||"",d=jQuery.curCSS(a,"paddingRight")||"",e=jQuery.curCSS(a,"paddingBottom")||"",f=jQuery.curCSS(a,"paddingLeft")||"";return b?{t:parseInt(c,10)||0,r:parseInt(d,10)||0,b:parseInt(e,10)||0,l:parseInt(f,10)}:{t:c,r:d,b:e,l:f}},getBorder:function(a,b){var c=jQuery.curCSS(a,"borderTopWidth")||"",d=jQuery.curCSS(a,"borderRightWidth")||"",e=jQuery.curCSS(a,"borderBottomWidth")||"",f=jQuery.curCSS(a,"borderLeftWidth")||"";return b?{t:parseInt(c,10)||0,r:parseInt(d,10)||0,b:parseInt(e,10)||0,l:parseInt(f,10)||0}:{t:c,r:d,b:e,l:f}},traverseDOM:function(a,b){for(b(a),a=a.firstChild;a;)EYE.traverseDOM(a,b),a=a.nextSibling},getInnerWidth:function(a,b){var c=a.offsetWidth;return b?Math.max(a.scrollWidth,c)-c+a.clientWidth:a.clientWidth},getInnerHeight:function(a,b){var c=a.offsetHeight;return b?Math.max(a.scrollHeight,c)-c+a.clientHeight:a.clientHeight},getExtraWidth:function(b){return a.boxModel?(parseInt(a.curCSS(b,"paddingLeft"))||0)+(parseInt(a.curCSS(b,"paddingRight"))||0)+(parseInt(a.curCSS(b,"borderLeftWidth"))||0)+(parseInt(a.curCSS(b,"borderRightWidth"))||0):0},getExtraHeight:function(b){return a.boxModel?(parseInt(a.curCSS(b,"paddingTop"))||0)+(parseInt(a.curCSS(b,"paddingBottom"))||0)+(parseInt(a.curCSS(b,"borderTopWidth"))||0)+(parseInt(a.curCSS(b,"borderBottomWidth"))||0):0},isChildOf:function(b,c,d){if(b==c)return!0;if(!c||!c.nodeType||1!=c.nodeType)return!1;if(b.contains&&!a.browser.safari)return b.contains(c);if(b.compareDocumentPosition)return!!(16&b.compareDocumentPosition(c));for(var e=c.parentNode;e&&e!=d;){if(e==b)return!0;e=e.parentNode}return!1},centerEl:function(b,c){var d=EYE.getScroll(),e=EYE.getSize(b);c&&"vertically"!=c||a(b).css({top:d.t+(Math.min(d.h,d.ih)-e.hb)/2+"px"}),c&&"horizontally"!=c||a(b).css({left:d.l+(Math.min(d.w,d.iw)-e.wb)/2+"px"})}}),a.easing.easeout||(a.easing.easeout=function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c})}(jQuery),function(a){var b=function(){var b=window.location.hash.replace("#",""),d=a("ul.navigationTabs a").bind("click",c).filter("a[rel="+b+"]");0==d.size()&&(d=a("ul.navigationTabs a:first")),c.apply(d.get(0)),a("#colorpickerHolder").ColorPicker({flat:!0}),a("#colorpickerHolder2").ColorPicker({flat:!0,color:"#00ff00",onSubmit:function(b,c){a("#colorSelector2 div").css("backgroundColor","#"+c)}}),a("#colorpickerHolder2>div").css("position","absolute");var e=!1;a("#colorSelector2").bind("click",function(){a("#colorpickerHolder2").stop().animate({height:e?0:173},500),e=!e}),a("#colorpickerField1, #colorpickerField2, #colorpickerField3").ColorPicker({onSubmit:function(b,c,d,e){a(e).val(c),a(e).ColorPickerHide()},onBeforeShow:function(){a(this).ColorPickerSetColor(this.value)}}).bind("keyup",function(){a(this).ColorPickerSetColor(this.value)}),a("#colorSelector").ColorPicker({color:"#0000ff",onShow:function(b){return a(b).fadeIn(500),!1},onHide:function(b){return a(b).fadeOut(500),!1},onChange:function(b,c){a("#colorSelector div").css("backgroundColor","#"+c)}})},c=function(){var b=a("ul.navigationTabs a").removeClass("active").index(this);a(this).addClass("active").blur(),a("div.tab").hide().eq(b).show()};EYE.register(b,"init")}(jQuery),function(a){var b=function(){var b=65,c='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',d={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},e=function(b,c){var d=L(b);a(c).data("colorpicker").fields.eq(1).val(d.r).end().eq(2).val(d.g).end().eq(3).val(d.b).end()},f=function(b,c){a(c).data("colorpicker").fields.eq(4).val(b.h).end().eq(5).val(b.s).end().eq(6).val(b.b).end()},g=function(b,c){a(c).data("colorpicker").fields.eq(0).val(N(b)).end()},h=function(b,c){a(c).data("colorpicker").selector.css("backgroundColor","#"+N({h:b.h,s:100,b:100})),a(c).data("colorpicker").selectorIndic.css({left:parseInt(150*b.s/100,10),top:parseInt(150*(100-b.b)/100,10)})},i=function(b,c){a(c).data("colorpicker").hue.css("top",parseInt(150-150*b.h/360,10))},j=function(b,c){a(c).data("colorpicker").currentColor.css("backgroundColor","#"+N(b))},k=function(b,c){a(c).data("colorpicker").newColor.css("backgroundColor","#"+N(b))},l=function(c){var d=c.charCode||c.keyCode||-1;if(d>b&&90>=d||32==d)return!1;var e=a(this).parent().parent();e.data("colorpicker").livePreview===!0&&m.apply(this)},m=function(b){var c,d=a(this).parent().parent();d.data("colorpicker").color=c=this.parentNode.className.indexOf("_hex")>0?J(H(this.value)):this.parentNode.className.indexOf("_hsb")>0?F({h:parseInt(d.data("colorpicker").fields.eq(4).val(),10),s:parseInt(d.data("colorpicker").fields.eq(5).val(),10),b:parseInt(d.data("colorpicker").fields.eq(6).val(),10)}):K(G({r:parseInt(d.data("colorpicker").fields.eq(1).val(),10),g:parseInt(d.data("colorpicker").fields.eq(2).val(),10),b:parseInt(d.data("colorpicker").fields.eq(3).val(),10)})),b&&(e(c,d.get(0)),g(c,d.get(0)),f(c,d.get(0))),h(c,d.get(0)),i(c,d.get(0)),k(c,d.get(0)),d.data("colorpicker")&&d.data("colorpicker").onChange.apply(d,[c,N(c),L(c)])},n=function(){var b=a(this).parent().parent();b.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},o=function(){b=this.parentNode.className.indexOf("_hex")>0?70:65,a(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),a(this).parent().addClass("colorpicker_focus")},p=function(b){var c=a(this).parent().find("input").focus(),d={el:a(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:b.pageY,field:c,val:parseInt(c.val(),10),preview:a(this).parent().parent().data("colorpicker").livePreview};a(document).bind("mouseup",d,r),a(document).bind("mousemove",d,q)},q=function(a){return a.data.field.val(Math.max(0,Math.min(a.data.max,parseInt(a.data.val+a.pageY-a.data.y,10)))),a.data.preview&&m.apply(a.data.field.get(0),[!0]),!1},r=function(b){return m.apply(b.data.field.get(0),[!0]),b.data.el.removeClass("colorpicker_slider").find("input").focus(),a(document).unbind("mouseup",r),a(document).unbind("mousemove",q),!1},s=function(){var b={cal:a(this).parent(),y:a(this).offset().top};b.preview=b.cal.data("colorpicker").livePreview,a(document).bind("mouseup",b,u),a(document).bind("mousemove",b,t)},t=function(a){return m.apply(a.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150,10)).get(0),[a.data.preview]),!1},u=function(b){return e(b.data.cal.data("colorpicker").color,b.data.cal.get(0)),g(b.data.cal.data("colorpicker").color,b.data.cal.get(0)),a(document).unbind("mouseup",u),a(document).unbind("mousemove",t),!1},v=function(){var b={cal:a(this).parent(),pos:a(this).offset()};b.preview=b.cal.data("colorpicker").livePreview,a(document).bind("mouseup",b,x),a(document).bind("mousemove",b,w)},w=function(a){return m.apply(a.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,a.pageY-a.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,a.pageX-a.data.pos.left))/150,10)).get(0),[a.data.preview]),!1},x=function(b){return e(b.data.cal.data("colorpicker").color,b.data.cal.get(0)),g(b.data.cal.data("colorpicker").color,b.data.cal.get(0)),a(document).unbind("mouseup",x),a(document).unbind("mousemove",w),!1},y=function(){a(this).addClass("colorpicker_focus")},z=function(){a(this).removeClass("colorpicker_focus")},A=function(){var b=a(this).parent(),c=b.data("colorpicker").color;b.data("colorpicker").origColor=c,j(c,b.get(0)),b.data("colorpicker")&&b.data("colorpicker").onSubmit(c,N(c),L(c),b.data("colorpicker").el)},B=function(){var b=a("#"+a(this).data("colorpickerId"));b.data("colorpicker")&&b.data("colorpicker").onBeforeShow.apply(this,[b.get(0)]);var c=a(this).offset(),d=E(),e=c.top+this.offsetHeight,f=c.left;return e+176>d.t+d.h&&(e-=this.offsetHeight+176),f+356>d.l+d.w&&(f-=356),b.css({left:f+"px",top:e+"px"}),0!=b.data("colorpicker").onShow.apply(this,[b.get(0)])&&b.show(),a(document).bind("mousedown",{cal:b},C),!1},C=function(b){D(b.data.cal.get(0),b.target,b.data.cal.get(0))||(b.data.cal.data("colorpicker")&&0!=b.data.cal.data("colorpicker").onHide.apply(this,[b.data.cal.get(0)])&&b.data.cal.hide(),a(document).unbind("mousedown",C))},D=function(a,b,c){if(a==b)return!0;if(a.contains)return a.contains(b);if(a.compareDocumentPosition)return!!(16&a.compareDocumentPosition(b));for(var d=b.parentNode;d&&d!=c;){if(d==a)return!0;d=d.parentNode}return!1},E=function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(a?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(a?document.documentElement.clientHeight:document.body.clientHeight)}},F=function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b))}},G=function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b))}},H=function(a){var b=6-a.length;if(b>0){for(var c=[],d=0;b>d;d++)c.push("0");c.push(a),a=c.join("")}return a},I=function(a){var a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(65280&a)>>8,b:255&a}},J=function(a){return K(I(a))},K=function(a){var b={h:0,s:0,b:0},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),e=d-c;return b.b=d,b.s=0!=d?255*e/d:0,b.h=0!=b.s?a.r==d?(a.g-a.b)/e:a.g==d?2+(a.b-a.r)/e:4+(a.r-a.g)/e:-1,b.h*=60,b.h<0&&(b.h+=360),b.s*=100/255,b.b*=100/255,b},L=function(a){var b={},c=Math.round(a.h),d=Math.round(255*a.s/100),e=Math.round(255*a.b/100);if(0==d)b.r=b.g=b.b=e;else{var f=e,g=(255-d)*e/255,h=(f-g)*(c%60)/60;360==c&&(c=0),60>c?(b.r=f,b.b=g,b.g=g+h):120>c?(b.g=f,b.b=g,b.r=f-h):180>c?(b.g=f,b.r=g,b.b=g+h):240>c?(b.b=f,b.r=g,b.g=f-h):300>c?(b.b=f,b.g=g,b.r=g+h):360>c?(b.r=f,b.g=g,b.b=f-h):(b.r=0,b.g=0,b.b=0)}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}},M=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];return a.each(c,function(a,b){1==b.length&&(c[a]="0"+b)}),c.join("")},N=function(a){return M(L(a))},O=function(){var b=a(this).parent(),c=b.data("colorpicker").origColor;b.data("colorpicker").color=c,e(c,b.get(0)),g(c,b.get(0)),f(c,b.get(0)),h(c,b.get(0)),i(c,b.get(0)),k(c,b.get(0))};return{init:function(b){if(b=a.extend({},d,b||{}),"string"==typeof b.color)b.color=J(b.color);else if(void 0!=b.color.r&&void 0!=b.color.g&&void 0!=b.color.b)b.color=K(b.color);else{if(void 0==b.color.h||void 0==b.color.s||void 0==b.color.b)return this;b.color=F(b.color)}return this.each(function(){if(!a(this).data("colorpickerId")){var d=a.extend({},b);d.origColor=b.color;var q="collorpicker_"+parseInt(1e3*Math.random());a(this).data("colorpickerId",q);var r=a(c).attr("id",q);d.flat?r.appendTo(this).show():r.appendTo(document.body),d.fields=r.find("input").bind("keyup",l).bind("change",m).bind("blur",n).bind("focus",o),r.find("span").bind("mousedown",p).end().find(">div.colorpicker_current_color").bind("click",O),d.selector=r.find("div.colorpicker_color").bind("mousedown",v),d.selectorIndic=d.selector.find("div div"),d.el=this,d.hue=r.find("div.colorpicker_hue div"),r.find("div.colorpicker_hue").bind("mousedown",s),d.newColor=r.find("div.colorpicker_new_color"),d.currentColor=r.find("div.colorpicker_current_color"),r.data("colorpicker",d),r.find("div.colorpicker_submit").bind("mouseenter",y).bind("mouseleave",z).bind("click",A),e(d.color,r.get(0)),f(d.color,r.get(0)),g(d.color,r.get(0)),i(d.color,r.get(0)),h(d.color,r.get(0)),j(d.color,r.get(0)),k(d.color,r.get(0)),d.flat?r.css({position:"relative",display:"block"}):a(this).bind(d.eventName,B)}})},showPicker:function(){return this.each(function(){a(this).data("colorpickerId")&&B.apply(this)})},hidePicker:function(){return this.each(function(){a(this).data("colorpickerId")&&a("#"+a(this).data("colorpickerId")).hide()})},destroy:function(){var b,c=this;return this.each(function(){a(this).data("colorpickerId")&&(b=a("#"+a(this).data("colorpickerId")),b.hide(),c.onShow=null,c.onBeforeShow=null,c.onHide=null,c.onChange=null,c.onSubmit=null,b.remove())})},setColor:function(b){if("string"==typeof b)b=J(b);else if(void 0!=b.r&&void 0!=b.g&&void 0!=b.b)b=K(b);else{if(void 0==b.h||void 0==b.s||void 0==b.b)return this;b=F(b)}return this.each(function(){if(a(this).data("colorpickerId")){var c=a("#"+a(this).data("colorpickerId"));c.data("colorpicker").color=b,c.data("colorpicker").origColor=b,e(b,c.get(0)),f(b,c.get(0)),g(b,c.get(0)),i(b,c.get(0)),h(b,c.get(0)),j(b,c.get(0)),k(b,c.get(0))}})}}}();a.fn.extend({ColorPicker:b.init,ColorPickerHide:b.hidePicker,ColorPickerShow:b.showPicker,ColorPickerSetColor:b.setColor,ColorPickerDestroy:b.destroy})}(jQuery),Gis.HTML={listView:function(a){function b(){this.style.display="none",Gis.HTML.addClass(this.parentNode.querySelector(s),u)}function c(){var a=document.querySelectorAll(".html-select-view"),b=document.querySelectorAll("."+s),c=0,d=b.length;if(a.length)for(c=0,d=a.length;d>c;c+=1)a[c].style.display="none";if(b.length)for(c=0,d=b.length;d>c;c+=1)Gis.HTML.addClass(b[c],u)}function d(){this.style.display="block",Gis.HTML.removeClass(this.parentNode.querySelectorAll("."+s),u)}function e(a,c,d){return function(){if(!Gis.HTML.hasClass(this,"html-list-title")&&!d||!d.call(c,this.getAttribute("data-value"))){var e=l.querySelector(".html-select-view-title");e.setAttribute("data-value",this.getAttribute("data-value")),j||(e.innerHTML=this.innerHTML),Gis.HTML.removeClass(l.querySelectorAll(".selected"),"selected"),Gis.HTML.addClass(this,"selected"),a&&a.call(c,this.getAttribute("data-value")),b.call(l.querySelector(".html-select-view"))}}}function f(a){var b=13;(a.keyCode===b||a.charCode===""+b)&&e.call(this,a)}function g(a){return v()&&Gis.HTML.hasClass(this,u)?(d.call(this.parentNode.querySelector(".html-select-view")),a.stopPropagation(),!1):void b.call(this.parentNode.querySelector(".html-select-view"))}function h(a,b,d){var h=(d||document).querySelectorAll(".html-select-view-row");Gis.HTML.addEventListener(h,"click",e(a,b,p)),Gis.HTML.addEventListener(h,"keypress",f),Gis.HTML.hasClass(document.body,"list-initialized")||(Gis.HTML.addClass(document.body,"list-initialized"),Gis.HTML.addEventListener(document.body,"click",c)),Gis.HTML.addEventListener((d||document).querySelector(".html-select-view-title-container"),"click",g)}function i(a,b,c,d,e){function f(a){var b=a.val,c=a.row,d=a.selected,e=a.childs,f=c.prefix||"";return"<li class='"+(e?"html-list-title ":"html-list-active ")+"html-select-view-row"+(d===f+b?" selected":"")+"' data-value='"+f+b+"'>"+c.name+(e||"")+"</li>"}var g,i,j=e.val,k=e&&e.name;return a&&a.forEach?(a.forEach(function(a){i="",g=a.val,Gis.Util.isArray(a.childs)&&(a.childs.forEach(function(a){i+=f({val:a.val,row:a,selected:j,childs:!1})}),i&&(i='<ul class="ui-list-childs">'+i+"</ul>")),r+=f({val:g,row:a,selected:j,childs:i})}),i="<div class='html-select-view-container'><div class='html-select-view-title-container "+u+"'><span class='html-select-view-title' data-value='"+j+"'>"+k+"</span><span class='"+t+" '></span></div><ul class='html-select-view' style='display: none'>"+r+"</ul></div>",b.innerHTML=i,h(c,d,b),b.querySelector(".html-select-view-container")):void 0}var j,k,l,m,n,o,p,q,r="",s="html-select-view-title-container",t="html-select-view-selector",u="closed";if(k=a.data,l=a.container,!l)return{setValueSelected:function(){},getValueSelected:function(){}};m=a.callback,p=a.onBeforeSelect,q=a.onBeforeOpen,n=a.context,j=a.noText,o=a.defaultValue||k&&k[0];var v=function(){return!q||q(l)};return function(a){return{setValueSelected:function(b){var c,d,e,f,g,h=!1;for(b+="",Gis.HTML.removeClass(a.querySelectorAll(".selected"),"selected"),c=a.querySelectorAll(".html-select-view-row"),g=a.querySelector(".html-select-view-title"),d=0,e=c.length;e>d;d+=1)f=c[d],f.getAttribute("data-value")===b&&(Gis.HTML.addClass(f,"selected"),g.setAttribute("data-value",b),h=!0,j||(g.innerHTML=f.innerHTML));h||(Gis.HTML.removeClass(c,"selected"),g.setAttribute("data-value",""),g.innerHTML="")},getValueSelected:function(){var b=a.querySelector(".html-select-view-title");return b?b.getAttribute("data-value"):void 0}}}(i(k,l,m,n,o))},hasClass:function(a,b){return a.className.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},addClass:function(a,b){a&&a.classList.add(b)},removeClass:function(a,b){var c;if(a)if(a.className)a.classList.remove(b);else if(a.length)for(c=a.length-1;c>=0;c-=1)a[c].classList.remove(b)},addEventListener:function(a,b,c){var d;if(a.addEventListener)a.addEventListener(b,c);else if(a[0]&&a[0].addEventListener)for(d in a)a.hasOwnProperty(d)&&a[d].addEventListener&&a[d].addEventListener(b,c)},removeEventListener:function(a,b,c){var d;if(a.removeEventListener)a.removeEventListener(b,c);else if(a[0]&&a[0].removeEventListener)for(d in a)a.hasOwnProperty(d)&&a[d].removeEventListener&&a[d].removeEventListener(b,c)}},Gis.UI=Gis.BaseClass.extend({_attached:!1,_widgetContainers:{},_containers:{},_widgets:{},_geoSystemConverter:void 0,options:{style:void 0,actionsEnabled:"ellipse marker measure move object path polygon sector select zoom",userSet:void 0},getStyle:function(a){return this.options.style[a]},getActionsActive:function(){var a="select zoom ellipse marker measure move object path polygon sector";switch(this.options.userSet){case Gis.UI.USERSET.FULL:return a;case Gis.UI.USERSET.VIEW_ONLY:return"select move zoom measure";default:return this.options.userSet&&this.options.userSet.length?this.options.userSet.reduce(function(b,c){return b+(a.indexOf(c)>=0?c+" ":"")},"").trim():this.options.actionsEnabled}},_initActions:function(){var a=this.getActionsActive(),b=Gis.Util.isArray(a)?a:a.split(" "),c=this;b.forEach(function(a){a&&Gis.UI.Action[a](c)})},initialize:function(a,b){var c=this;this._geoSystemConverter=new Gis.UI.CoordinateConverter,this._geoSystemConverter.on("skchanged",function(a){this.fire("skchanged",a)},this),Gis.BaseClass.prototype.initialize.call(this,b),this._initActions(),this.options.style=b&&b.style||Gis.UI.DEFAULT_STYLE,this._resizeFunction=function(){c._recalculateContainerStyles()},this._keyDown=function(a){c.keyDown(a)},this._mouseMove=function(a){c.mouseMove(a)},this._contextMenu=function(a){return a.preventDefault(),a.stopPropagation(),!1},this._mouseDown=function(a){c.mouseDown(a)},this._mouseUp=function(a){c.mouseUp(a)
},this._keyUp=function(a){c.keyUp(a)},a&&this.attachToMap(a)},getGeoConverter:function(){return this._geoSystemConverter},_setContainerStyle:function(){this._container.style.position="relative",this._container.className+=" gis-ui-container"},_addContainer:function(a){function b(a,b,c){void 0!==c&&(a.style[b]=c)}var c=document.createElement("div");return c.className+=" "+a.className+" ",c.style.position="absolute",b(c,"top",a.top),b(c,"left",a.left),b(c,"right",a.right),b(c,"bottom",a.bottom),this._container.appendChild(c),this._containers[a.className]=c,c},_createTopContainer:function(){this._addContainer({className:Gis.UI.POSITION.TOP,left:0,top:0})},_createBottomContainer:function(){this._addContainer({className:Gis.UI.POSITION.BOTTOM,left:0,bottom:0})},_createLeftContainer:function(){this._addContainer({className:Gis.UI.POSITION.LEFT,left:0,top:0})},_createRightContainer:function(){this._addContainer({className:Gis.UI.POSITION.RIGHT,right:0,top:0})},_createRightInnerContainer:function(){this._addContainer({className:Gis.UI.POSITION.RIGHT_INNER,right:0,top:0})},_createLeftInnerContainer:function(){this._addContainer({className:Gis.UI.POSITION.LEFT_INNER,left:0,top:0})},_recalculateContainerStyles:function(){var a=this._containers[Gis.UI.POSITION.TOP],b=this._containers[Gis.UI.POSITION.BOTTOM],c=this._containers[Gis.UI.POSITION.LEFT],d=this._containers[Gis.UI.POSITION.RIGHT],e=this._containers[Gis.UI.POSITION.RIGHT_INNER],f=this._containers[Gis.UI.POSITION.LEFT_INNER],g=$(b).is(":visible"),h=$(a).is(":visible"),i=h?$(a).outerHeight(!0):0,j=$(b).outerHeight(!0),k=$(this._container).width(),l=$(this._container).height(),m=$(c).outerWidth(!0),n=$(d).outerWidth(!0),o=(k-m-n)/2,p=l-i-j,q=50;$(c).css({paddingBottom:g?0:24}),c.style.top=i+"px",d.style.top=i+"px",e.style.top=i+"px",e.style.right=n+"px",e.style.width=($(e).width()||o)+"px",f.style.width=($(e).width()||o)+"px",f.style.top=i+"px",f.style.left=m+"px",f.style.zIndex=q,e.style.zIndex=q,d.style.zIndex=q,c.style.zIndex=q,a.style.zIndex=q+1,b.style.zIndex=q,$(e).data(Gis.UI.DATA_SELECTORS.AVAILABLE_WIDTH,o),$(f).data(Gis.UI.DATA_SELECTORS.AVAILABLE_WIDTH,o),$(e).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,p),$(f).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,p),$(c).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,p),$(d).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,p),this.fire("sizerecalculated")},getAvailableContainerBounds:function(a){var b,c,d;return d=Gis.UI.POSITION[a.toUpperCase()],this._containers[d]?(b=$(this._containers[d]),c=b.data(),{width:c[Gis.UI.DATA_SELECTORS.AVAILABLE_WIDTH]||b.width(),height:c[Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT]||b.height()}):void 0},_createWidgetContainers:function(){this.addContainer(Gis.Widget.container({position:"TOP"})),this.addContainer(Gis.Widget.container({position:"LEFT"})),this.addContainer(Gis.Widget.container({position:"RIGHT"})),this.addContainer(Gis.Widget.container({position:"LEFT_INNER"})),this.addContainer(Gis.Widget.container({position:"RIGHT_INNER"})),this.addContainer(Gis.Widget.container({position:"BOTTOM"}))},_createContainers:function(){this._createTopContainer(),this._createBottomContainer(),this._createLeftContainer(),this._createRightContainer(),this._createRightInnerContainer(),this._createLeftInnerContainer(),this._recalculateContainerStyles(),this._createWidgetContainers(),$(window).on("resize",this._resizeFunction)},_initializeHTML:function(){this._container=this._map.getMapContainer().parentNode,this._setContainerStyle(),this._createContainers()},_checkPredefinedState:function(){var a=this;switch(this.options.userSet){case Gis.UI.USERSET.FULL:this.addWidget(Gis.Widget.instruments()),this.addWidget(Gis.Widget.mapcontrol()),this.addWidget(Gis.Widget.scheme()),this.addWidget(Gis.Widget.sliderHorisontal()),this.addWidget(Gis.Widget.sliderVertical());break;case Gis.UI.USERSET.VIEW_ONLY:this.addWidget(Gis.Widget.instruments({instruments:"select move zoom measure"})),this.addWidget(Gis.Widget.mapcontrol()),this.addWidget(Gis.Widget.scheme()),this.addWidget(Gis.Widget.sliderHorisontal()),this.addWidget(Gis.Widget.sliderVertical());break;default:this.options.userSet&&this.options.userSet.length&&this.options.userSet.forEach(function(b){Gis.Widget[b]&&a.addWidget(Gis.Widget[b](a.options.userSet))})}},attachToMap:function(a){return this._map=a,this._attached||(a.setDraggableEnabled(!1),this._initializeHTML(),this._attached=!0,this.initKeyNavigation(),this.initMouseNavigation(),this._checkPredefinedState()),this},getMap:function(){return this._map},recalculateMaxSize:function(){var a,b,c,d,e=this._widgetContainers[Gis.UI.POSITION.TOP].getNeedSize(),f=this._widgetContainers[Gis.UI.POSITION.BOTTOM].getNeedSize(),g=this._widgetContainers[Gis.UI.POSITION.LEFT].getNeedSize(),h=this._widgetContainers[Gis.UI.POSITION.LEFT_INNER].getNeedSize(),i=this._widgetContainers[Gis.UI.POSITION.RIGHT].getNeedSize(),j=this._widgetContainers[Gis.UI.POSITION.RIGHT_INNER].getNeedSize();a=g[0]+h[0]+i[0]+j[0],c=e[1]+f[1],b=Math.max(c+j[1],c+h[1],c+g[1],c+i[1]),d=$("html, body, div#map, div#leaflet-map-gis"),d.css("minWidth",Math.max(e[0],f[0],a)),d.css("minHeight",Math.max(b))},addWidget:function(a){if(a.isControlAvailable(null,this._map)){var b=Gis.UI.POSITION[a.getPosition().toUpperCase()];this._widgetContainers[b].addChild(a),this.recalculateMaxSize()}return this._recalculateContainerStyles(),this},removeWidget:function(a){if(a){var b=Gis.UI.POSITION[a.getPosition().toUpperCase()];this._widgetContainers[b].removeChild(a),this.recalculateMaxSize()}return this},removeWidgetByType:function(a){if(a){var b,c=this._widgetContainers;for(b in c)c.hasOwnProperty(b)&&a&&c[b].removeWidgetByType(a)}return this},addContainer:function(a){var b=Gis.UI.POSITION[a.getPosition().toUpperCase()];this._widgetContainers[b]=a,a.onAdd(this),a.draw(this._containers[b],this.getAvailableContainerBounds(b)),this._recalculateContainerStyles()},_initZoom:function(a){var b;this._lastAction&&"zoom"===this._lastAction.getType()||(this._lastAction&&(this._lastAction.closeAction(),this._lastAction=void 0),b=Gis.UI.Action.zoom(this),b.isExecuted()||(this._lastAction=b,Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().pause(),b.setData({noUI:!0,zoomOut:a}),b.execute()))},_initMove:function(){var a;this._lastAction&&"move"===this._lastAction.getType()||(this._lastAction&&(this._lastAction.closeAction(),this._lastAction=void 0),a=Gis.UI.Action.move(this),a.isExecuted()||(Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().pause(),a.setData({noUI:!0}),a.execute(),this._lastAction=a))},keyDown:function(a){var b=32,c=18,d=17,e=!1,f=a.keyCode||parseInt(a.charCode,10),g=f===b,h=a.srcElement||a.target,i="text"!==h.type;(i&&g||this._lastAction&&(f===c||f===d))&&(a.ctrlKey?(a.altKey&&(e=!0),this._initZoom(e),a.preventDefault()):(this._initMove(),a.preventDefault()))},mouseDown:function(a){var b=2,c=0;a.originalEvent.button===b?(this._secondButton=!0,this._map.on("mouseup",this._mouseUp),this._map.on("mouseout",this._mouseUp)):this._secondButton&&a.originalEvent.button===c&&(this._secondButton=!1,this._zoomStarted=!0,this._oldDraggable=this._map.isDraggableEnabled(),this._map.setDraggableEnabled(!1),this._initZoom(),this._map.on("mousemove",this._mouseMove),a.originalEvent.preventDefault())},mouseUp:function(a){this._secondButton=!1,this._map.off("mouseup",this._mouseUp),this._map.off("mouseout",this._mouseUp),this._map.off("mousemove",this._mouseMove),this._zoomStarted===!0&&(this._lastAction&&(this._lastAction._onMouseUp(a),this._lastAction.closeAction(),this._lastAction=void 0),this._map.setDraggableEnabled(this._oldDraggable),Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().resume()),this._zoomStarted=!1},mouseMove:function(a){this._zoomStarted&&(this._map.off("mousemove",this._mouseMove),this._lastAction._onMouseDown(a))},keyUp:function(a){var b=32,c=17;this._lastAction&&a.keyCode===b?(this._lastAction.closeAction(),this._lastAction=void 0,Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().resume()):this._lastAction&&a.keyCode===c&&this._initMove()},initKeyNavigation:function(){document.body.addEventListener("keydown",this._keyDown),document.body.addEventListener("keyup",this._keyUp)},initMouseNavigation:function(){-1===navigator.userAgent.toLowerCase().indexOf("msie")&&(this._map.getMapContainer().addEventListener("contextmenu",this._contextMenu),this._map.on("mousedown",this._mouseDown))}}),Gis.UI.version="0.5.13",Gis.UI.POSITION={TOP:"gis-top-container",BOTTOM:"gis-bottom-container",LEFT:"gis-left-container",RIGHT:"gis-right-container",LEFT_INNER:"gis-left-inner-container",RIGHT_INNER:"gis-right-inner-container"},Gis.UI.DATA_SELECTORS={AVAILABLE_WIDTH:"availableWidth",AVAILABLE_HEIGHT:"availableHeight"},Gis.UI.USERSET={NONE:void 0,FULL:["instruments","mapcontrol","slidervertical","scheme","sliderhorisontal","controlmap","controlpostcenter","controlmapselector","controlobjectcenter","controlzoom","controlconnectionstate","controlmouseposition","zoom","move","select","measure","path","object","marker","polygon","ellipse","sector","schemesaveall","schemeload","schemeclear"],VIEW_ONLY:["instruments","mapcontrol","slidervertical","scheme","sliderhorisontal","controlpostcenter","controlmapselector","controlobjectcenter","controlzoom","controlconnectionstate","controlmouseposition","zoom","move","select","measure"]},function(a){function b(a,b){return"GAUSZONE"+a+(b?"LATLNG":"")}function c(a){var b={c:"N",в:"E",з:"W",ю:"S",cш:"N",вд:"E",зд:"W",юш:"S"};return b[a.toLowerCase().substr(0,1)]||a.toUpperCase()}function d(a){var b={n:"СШ",e:"ВД",w:"ЗД",s:"ЮШ"};return b[a.toLowerCase().substr(0,1)]||a.toUpperCase()}function e(a,b){return b>=60&&(a+=1,b=0),[a,b]}function f(a,b){var c,d,e="",f=(Math.floor(a)+"").length;if(b>f)for(d=0,c=b-f;c>d;d+=1)e+="0";return e+a}function g(a,b,c,d,e){return proj4.transform(new proj4.Proj(a),new proj4.Proj(b),new proj4.Point(c,d,e))}for(var h=1;61>h;h+=1)proj4.defs(b(h),"+proj=tmerc +lat_0=0 +lon_0="+(6*h-3)+" +k=1 +x_0="+h+"500000 +y_0=0 +ellps=krass +towgs84=24,-123,-94,-0.000000096963,0.000001212034,0.000000630258,1.0 +units=m +no_defs"),proj4.defs(b(h,!0),"+proj=longlat +ellps=krass +towgs84=23.9,-141.3,-80.9,0,-0.37,-0.85,-0.12");$.mask.definitions.X="[E|W]",$.mask.definitions.Y="[S|N]";var i=a.Util.toFixed,j=1,k=3,l=5,m={full:{isDirectional:!0,template:/([-]*[\d]+)[\u00B0]*\s(\d+)[']* (\d+[\.\d+]*)["]*(\s[SNEWСЮШВЗДsnewсюшвзд]+)*/,getTemplate:function(a){return(a?"99":"999")+"° 99' 99.9\""},fillTemplate:function(a,b,c,g,h){c=c||0,b=b||0,a=a||0;var k,l,m=parseFloat(b),n=parseFloat(c);return g||(g=parseFloat(a)>0?h?"E":"N":h?"W":"S"),l=parseFloat(i(a,9)),l=Math.abs(l),a=parseInt(l,10),b=parseInt(60*(l-a),10)+parseInt(m),c=i(parseFloat(60*(60*(l-a)+m-b))+n,j),k=e(b,c),b=k[0],c=f(k[1],2),k=e(a,b),a=f(k[0],h?3:2),b=f(k[1],2),a+String.fromCharCode("176")+" "+b+"' "+c+'" '+d(g)},fromBase:function(a,b){return this.fillTemplate(a,null,null,null,b)},toBase:function(a){var b,d,e=1;if(a+="",b=a.match(this.template),b&&b.length){if(b[4])switch(d=c(b[4].trim()).toLowerCase()){case"w":case"s":e=-1}return(parseFloat(b[1])+parseFloat(b[2])/60+parseFloat(b[3])/3600)*e}return 0}},middle:{isDirectional:!0,template:/([-]*[\d]+)[\u00B0]*\s(\d+[\.\d*]*)[']*(\s[SNEWСЮШВЗДsnewсюшвзд]+)*/,getTemplate:function(a){return(a?"99":"999")+"° 99.999'"},fillTemplate:function(a,b,c,g,h){var j,l;return c=parseFloat(c||0),b=parseFloat(b||0),a=parseFloat(a||0),g||(g=parseFloat(a)>0?h?"E":"N":h?"W":"S"),l=parseFloat(i(a,9)),l=Math.abs(l),a=parseInt(l,10),c&&(b+=c/60),b=i(60*(l-a)+parseFloat(b),k),j=e(a,b),a=f(j[0],h?3:2),b=f(j[1],2),a+String.fromCharCode("176")+" "+b+"' "+d(g)},fromBase:function(a,b){return this.fillTemplate(a,null,null,null,b)},toBase:function(a){var b,d,e=1;if(a+="",b=a.match(this.template),b&&b.length){if(b[3])switch(d=c(b[3].trim()).toLowerCase()){case"w":case"s":e=-1}return(parseFloat(b[1])+parseFloat(b[2])/60)*e}return 0}},"short":{isDirectional:!0,template:/([-]*[\d]+[\.]*[\d]*)[\u00B0]*(\s[SNEWСЮШВЗДsnewсюшвзд]+)*/,getTemplate:function(a){return(a?"99":"999")+".99999°"},fillTemplate:function(a,b,c,e,g){var h,j,k;return c=parseFloat(c||0),b=parseFloat(b||0),a=parseFloat(a||0),e||(e=parseFloat(a)>0?g?"E":"N":g?"W":"S"),a=Math.abs(a),c&&(b+=c/60),b&&(a+=b/60),h=parseFloat(i(a,l)),j=Math.floor(h),k=i(h-Math.floor(h)+"",l).replace(/0\./,""),j=f(j,g?3:2),j+"."+k+String.fromCharCode("176")+" "+d(e)},fromBase:function(a,b){return this.fillTemplate(a,null,null,null,b)},toBase:function(a){var b,d,e=1;if(a+="",b=a.match(this.template),b&&b.length){if(b[2])switch(d=c(b[2].trim()).toLowerCase()){case"w":case"s":e=-1}return parseFloat(b[1])*e}return parseFloat(a)}}};a.UI.Coordinate=a.BaseClass.extend({accuracy:9,initialize:function(b,c,d){a.Util.isArray(b)?(this.x=b[0],this.y=b[1],this.z=b[2]):b&&b.hasOwnProperty("x")?(this.x=b.x,this.y=b.y,this.z=b.z):b&&b.hasOwnProperty("lat")?(this.x=b.lng,this.y=b.lat,this.z=b.z):b&&b.hasOwnProperty("latitude")?(this.x=b.longitude,this.y=b.latitude,this.z=b.z):(this.x=b,this.y=c,this.z=d),this.x=void 0==this.x||"NaN"===this.x?"":this.x,this.y=void 0==this.y||"NaN"===this.y?"":this.y,this.z=void 0==this.z||"NaN"===this.z?"":this.z},getX:function(){return this.x},getY:function(){return this.y},getZ:function(){return this.z}}),a.UI.coordinate=function(b,c,d){return b&&b.getZ?b:new a.UI.Coordinate(b,c,d)},a.UI.CoordinateConverter=a.BaseClass.extend({_selectedTemplate:"full",_baseSystem:"wgs84",_selectedSystem:"wgs84",templates:{wgs84:["full","middle","short"],"sk-42":["full","middle","short"]},getDirectionNameInner:c,getDirectionNameOutter:d,_systemNames:{wgs84:"WGS-84","sk-42":"СК-42",gauss:"Гаусс-Крюгер",full:"ГМС","short":"Г",middle:"ГМ"},options:{availableSystems:["wgs84","sk-42","gauss"]},getZoneFromLongitude:function(b){var c=this.isInFixedZoneBounds(b),d=Math.floor(a.Projection.absLongitude(b)%360/6+1);return c?a.Util.isNumeric(this._autoZone)?this._autoZone:d:d},isInFixedZoneBounds:function(b){var c,d;return a.Util.isNumeric(this._autoZone)?(c=6*this._autoZone+1,d=c-8,b>=d&&d+1>=b||c>b&&b>=c-1):!1},getCurrentMask:function(a){return this.getSelectedTemplate()&&m[this.getSelectedTemplate()]&&m[this.getSelectedTemplate()].getTemplate(a)},isTemplateDirectional:function(a,b){return b=b||this.getSelectedTemplate(),this.isTemplatingAvailable(a)&&b&&m[b]&&m[b].isDirectional},initialize:function(){var c=this;this._systems={gauss:{fromBase:function(d,e,f){var h=g("WGS84",b(c.getZoneFromLongitude(d)),d,e,f);return a.UI.coordinate(i(h.y),i(h.x),i(h.z))},toBase:function(d,e,f){var h=""+parseInt(e,10),j=h.substr(0,h.length-6);j=j?j>60?j%60:0>j?60+j%60:j:null;var k=g(b(j||c._autoZone),"WGS84",(j?"":c._autoZone||1)+parseFloat(e),parseFloat(d),parseFloat(f));return a.UI.coordinate(parseFloat(i(k.x,8)),parseFloat(i(k.y,8)),parseFloat(i(k.z,8)))}},wgs84:{template:!0,fromBase:function(b,c,d){return a.UI.coordinate(b,c,d)},toBase:function(b,c,d){return a.UI.coordinate(parseFloat(b),parseFloat(c),parseFloat(d))}},"sk-42":{template:!0,fromBase:function(d,e,f){var h=g("WGS84",b(c.getZoneFromLongitude(d),!0),d,e,f);return a.UI.coordinate(i(h.x,8),i(h.y,8),i(h.z,8))},toBase:function(d,e,f){var h=g(b(c.getZoneFromLongitude(d),!0),"WGS84",d,e,f);return a.UI.coordinate(parseFloat(i(h.x,8)),parseFloat(i(h.y,8)),parseFloat(i(h.z,8)))}}},a.BaseClass.prototype.initialize.apply(this,arguments)},getAvailableTemplates:function(a){return this.templates[a]&&this.templates[a].slice(0)},getAvailableSystems:function(){return this.options.availableSystems.slice(0)},isMetric:function(a){var b=["gauss"];return a=a||this._selectedSystem,b.indexOf(a)>=0},getSystemName:function(a){return this._systemNames[a]||a},isNeedZone:function(a){var b=["gauss"];return b.indexOf(this.getSystemNameFromKey(a))>=0},getAutoZone:function(){return this._autoZone},setAutoZone:function(a){var b={oldSk:this._selectedSystem,oldTemplate:this._selectedTemplate,oldZone:this._autoZone};this._autoZone=a,this.fire("skchanged",b)},isCorrectZoneSelected:function(){return this.isCorrectZone(this._autoZone)},isCorrectZone:function(b){return a.Util.isNumeric(b)},setActiveSystem:function(b){var c={oldSk:this._selectedSystem,oldTemplate:this._selectedTemplate,oldZone:this._autoZone};return b.indexOf(a.UI.CoordinateConverter.DELIMETER)>=0?(b=b.split(a.UI.CoordinateConverter.DELIMETER),this._selectedSystem=b[0],this._selectedTemplate=b[1],this._autoZone=b[2]):this._selectedSystem=b,this.fire("skchanged",c),this},getSystemNameFromKey:function(b){return b.indexOf(a.UI.CoordinateConverter.DELIMETER)>=0?(b=b.split(a.UI.CoordinateConverter.DELIMETER),b[0]):b},getSelectedSystem:function(){return this._selectedSystem},getFullSystemKey:function(b,c,d){return b+a.UI.CoordinateConverter.DELIMETER+(this.isCorrectTemplateSelected(c,b)?c:"null")+a.UI.CoordinateConverter.DELIMETER+(this.isCorrectZone(d)?d:"null")},getFullSystemSelectedKey:function(){return this.getFullSystemKey(this._selectedSystem,this.getSelectedTemplate(),this.getAutoZone())},getFullSystemName:function(b){b=b||this.getFullSystemSelectedKey();var c=b.split(a.UI.CoordinateConverter.DELIMETER),d=c[0],e=c[1],f=c[2];return this.getSystemName(d)+(this.isNeedZone(d)?" ("+(a.Util.isNumeric(f)?f:"авто")+")":this.isTemplatingAvailable(d)?" ("+this.getSystemName(e)+")":"")},isTemplatingAvailable:function(a){a=a||this._selectedSystem;var b=!!this.templates[a];return!!b},getSelectedTemplate:function(){return this._selectedTemplate},isCorrectTemplateSelected:function(a,b){return this.isTemplatingAvailable(b||this._selectedSystem)&&this.templates[b||this._selectedSystem].indexOf(a||this._selectedTemplate)>=0},toTemplate:function(b,c){return this.isCorrectTemplateSelected(c)?a.UI.coordinate(m[this._selectedTemplate].fromBase(b.x,!0),m[this._selectedTemplate].fromBase(b.y)):b},coordinateFromTeplate:function(a,b){var c=this.isTemplatingAvailable(b)&&(this.getFormat(a)||m[this._selectedTemplate]);return void 0!=a&&c?c.toBase(a):""},fromTemplate:function(b,c){return this.isTemplatingAvailable(c)?a.UI.coordinate(this.coordinateFromTeplate(b.x,c),this.coordinateFromTeplate(b.y,c)):b},convert:function(b,c,d,e,f,g){var h,i,j;return j=a.UI.coordinate(d,e,f),void 0!=j.x&&""!==j.x&&(h=this.getFormatByName(b),i=this.getFormatByName(c),j=this.fromTemplate(a.UI.coordinate(d,e,f),b),h&&h.toBase&&i&&i.fromBase&&(j=h.toBase(j.x,j.y,j.z),j=i.fromBase(j.x,j.y,j.z),!g&&i.template&&(j=this.toTemplate(j)))),j},fromBase:function(a,b,c){return this.convert("wgs84",this._selectedSystem,a,b,c)},toBase:function(a,b,c){return this.convert(this._selectedSystem,"wgs84",a,b,c,!0)},getFormat:function(a){var b;a+="";for(b in m)if(m.hasOwnProperty(b)&&a.match(m[b].template))return m[b]},fromRandomTemplateToCurrent:function(b,d){function e(){alert("Не удалось выполнить преобразование."),a.Logger.log("Не удалось выполнить преобразование.",b)}function f(a){var b,c=[/([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+)['|\:]+[\s]*(\d+[\.\d+]*)["]*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/g,/([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+[\.\d*]*)[']*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/g];if(a)for(h=0,i=c.length;i>h;h+=1)if(b=a.match(c[h]))return b;return a}function g(b,d){for(h=0,i=n.length;i>h;h+=1)if(j=b.match(n[h])){var f=parseFloat(j[1]);if(k=b.match(/[SNEWСЮШВЗДsnewсюшвзд]+/))switch(k=c(k[0].trim()).toLowerCase()){case"w":case"s":o=-1}return void 0!=j[2]&&(j[2]=j[2].replace(",","."),f+=parseFloat(j[2])/60),void 0!=j[3]&&0===h&&(j[3]=j[3].replace(",","."),f+=parseFloat(j[3])/3600),p.isTemplatingAvailable()&&m[p._selectedTemplate]?m[p._selectedTemplate].fillTemplate(j[1].replace(",","."),j[2],0===h?j[3]:null,k,d):p.isMetric()?(e(),!1):parseFloat(a.Util.toFixed(f*o,8))}if(k=b.match(/[SNEWСЮШВЗДsnewсюшвзд]+/),p.isMetric()&&(b.match(/[\u00B0|\:]+/)||k))return e(),!1;if(k)switch(k=c(k[0].trim()).toLowerCase()){case"w":case"s":b=-1*parseFloat(b)}return p.isTemplatingAvailable()&&m[p._selectedTemplate]?m[p._selectedTemplate].fromBase(b,d):parseFloat(b)}b&&(b=b.replace(",","."));var h,i,j,k,l,n=[/^([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+)['|\:]+[\s]*(\d+[\.\d+]*)["]*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/,/^([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+[\.\d*]*)[']*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/],o=1,p=this;return b+="",b=f(b),a.Util.isArray(b)?(l=[],b.length>1?b.forEach(function(a,c){l[c]=g(b[c],1===c)}):l=g(b[0],d)):l=g(b,d),l},getFormatByName:function(a){return this._systems[a]}}),a.UI.CoordinateConverter.DELIMETER="_|_"}(Gis),function(a){"use strict";var b="40px",c="100%",d="gray";a.UI.CONTAINER_CLASSES={TOP:"gis-top-container",BOTTOM:"gis-bottom-container",LEFT:"gis-left-container",RIGHT:"gis-right-container",LEFT_INNER:"gis-left-inner-container",RIGHT_INNER:"gis-right-inner-container"};var e=window.GIS_RGBA_DISABLE?"white":"rgba(255, 255, 255, 0.8",f=window.GIS_RGBA_DISABLE?"rgb(75, 84, 255)":"rgba(75, 84, 255, 0.8)",g=window.GIS_RGBA_DISABLE?"rgb(175, 45, 81)":"rgba(175, 45, 81, 0.8)";a.UI.DEFAULT_STYLE={measure:{color:"black",border:e,thickness:2,icon:{width:10,type:"circle"}},path:{border:e,thickness:2,selectedBorder:f,icon:{type:"m",color:g}},polygon:{color:g,border:e,selectedBorder:f,thickness:2,icon:{type:"circle",color:g}},sector:{color:g,border:e,thickness:2,selectedBorder:f,angleLineColor:"#272727",angleLineBorder:e,angleLineThickness:2},ellipse:{color:g,border:e,thickness:2,selectedBorder:f},marker:{foreColor:"#ffffff",position:"centerright",drawPoint:!0},zoom:{fill:{color:"rgba(0, 16, 235, 0.3)"},line:{color:"rgba(0, 16, 235, 0.9)",thickness:2}},predefinedColors:window.GIS_RGBA_DISABLE?["rgb(255, 57, 17)","rgb(22, 50, 255)","rgb(128, 128, 128)","rgb(255, 216, 216)","rgb(0, 148, 255)"]:["rgba(255, 57, 17, 0.8)","rgba(22, 50, 255, 0.8)","rgba(128, 128, 128, 0.8)","rgba(255, 216, 216, 0.8)","rgba(0, 148, 255, 0.8)"]},a.UI.DEFAULT_STYLE[a.UI.CONTAINER_CLASSES.TOP]={width:c,height:b,background:d},a.UI.DEFAULT_STYLE[a.UI.CONTAINER_CLASSES.BOTTOM]={width:c,height:b,background:d},a.UI.DEFAULT_STYLE[a.UI.CONTAINER_CLASSES.LEFT]={width:"40px",height:b,background:d}}(Gis),function(a){"use strict";a.UI.Util={saveDataToFile:function(){var a="этот текст будет сохранен в файл",b=navigator.userAgent.toLowerCase();if(-1!=b.indexOf("msie")&&-1==b.indexOf("opera")&&-1==b.indexOf("webtv")){var c=window.open();c.document.write(a),c.document.execCommand("saveAs",!0,".xml")}else var c=window.open("data:application/download;charset=utf-8;base64,"+btoa(a))}},a.UI.uiUsersetInclude=function(b,c){return b?(a.Util.isArray(c)||(c=[c]),b.concat(c).unique()):b},a.UI.uiUsersetExclude=function(b,c){var d,e;return b?(a.Util.isArray(c)||(c=[c]),b=b.slice(),c.forEach(function(a){for(e=b.length,d=0;e>d;d+=1)if(b[d]===a){b.splice(d,1);break}}),b):b},Gis.UI.preventDefault=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},Gis.UI.disableTextSelection=function(a){Gis.HTML.addEventListener(a||window,"selectstart",Gis.UI.preventDefault)},Gis.UI.enableTextSelection=function(a){Gis.HTML.removeEventListener(a||window,"selectstart",Gis.UI.preventDefault)},Array.prototype.unique=function(){for(var a=this.slice(),b=0;b<a.length;++b)for(var c=b+1;c<a.length;++c)a[b]===a[c]&&a.splice(c--,1);return a}}(Gis),Gis.UI.Action=Gis.BaseClass.extend({_type:void 0,_selectType:void 0,_executed:!1,_buttonAtached:void 0,options:{dataBinded:void 0,noUI:!1},_isActionAvailable:function(a){var b=this._ui.getMap().getSetting("ui");return b&&b.indexOf(a.getType())>=0},_layerSelected:function(a){var b,c,d=a.layer;c=d.getParentId()||d.getId(),d=this._ui.getMap().getLayer(c),d.getType()!==this._selectType?(b=Gis.UI.ActionController.getAction(d.getType()),b&&!b.isExecuted()&&this._isActionAvailable(b)&&(b.setData({dataBinded:d}),this._disable(),b.execute())):this._widget.bindData(d)},getFirstSelection:function(){var a=this._ui.getMap().getSelected(),b=Object.keys(a);return b.length&&a[b[0]].getType()===this._selectType?a[b[0]]:void 0},_layerUnSelected:function(a){a.layer.getOriginalType()===this._selectType&&this._widget.isAttachedToUi()&&this._widget.bindData(void 0)},initialize:function(a,b){var c,d=Gis.UI.ActionController.getAction(this.getType());if(d)throw new Error("You can not use constructor direct");c=this,this._ui=a,Gis.BaseClass.prototype.initialize.call(this,b),this._executeFunction=function(){c._executed||(c.fire("newactionexecuted",{action:c}),c.execute())},Gis.UI.ActionController.pushAction(this)},getType:function(){return this._type},isExecuted:function(){return this._executed},attachToButton:function(a){this._buttonAtached||(a.addEventListener("click",this._executeFunction),this._buttonAtached=a)},execute:function(){Gis.UI.ActionController.pushExecuted(this),this.options.dataBinded=this.options.dataBinded||this.getFirstSelection(),this._executed=!0,this._oldDraggable=this._ui.getMap().isDraggableEnabled(),this._oldFilter=this._ui.getMap().getFilterSelect(),this._buttonAtached&&$(this._buttonAtached).addClass(Gis.UI.Action.SELECTED_CLASS_NAME),this.initEvents()},bindData:function(a){this.options.dataBinded=a},_disable:function(){this._executed=!1,this._ui.getMap().setDraggableEnabled(this._oldDraggable),this._buttonAtached&&$(this._buttonAtached).removeClass(Gis.UI.Action.SELECTED_CLASS_NAME),this.deInitEvents()},initEvents:function(){this._ui.getMap().on("layerselected",this._layerSelected,this),this._ui.getMap().on("layerunselected",this._layerUnSelected,this)},deInitEvents:function(){this._ui.getMap().off("layerselected",this._layerSelected,this),this._ui.getMap().off("layerunselected",this._layerUnSelected,this)},pause:function(){this.deInitEvents(),this._widget&&this._widget.deactivate()},resume:function(){this.initEvents(),this._widget&&this._widget.activate()},closeAction:function(){this._executed&&(this._disable(),this.options.noUI=!1,Gis.UI.ActionController.popLastExecuted())},getId:function(){return this._id=this._id||Gis.Util.generateGUID(),this._id}}),Gis.UI.Action.SELECTED_CLASS_NAME="selected",function(a){"use strict";a.UI.Action.Ellipse=a.UI.Action.extend({_type:"ellipse",_selectType:"ellipse",_classMapEllipse:"gis-map-ellipse",execute:function(){this._ui.getMap().clearSelectedOnClick(!1),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.UI.Action.Ellipse.type),a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),$(this._ui.getMap().getMapContainer()).addClass(this._classMapEllipse),this._widget=a.Widget.ellipseProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_update:function(){},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapEllipse),this.options.dataBinded=void 0}}),a.UI.Action.Ellipse.type="ellipse",a.UI.Action.ellipse=function(b,c){var d=a.UI.ActionController.getAction("ellipse");return d?(d.setData(c),d):new a.UI.Action.Ellipse(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Marker=a.UI.Action.extend({_type:"marker",_selectType:"text",_classMapMarker:"gis-map-marker",execute:function(){this._executed||(this._ui.getMap().filterSelect(a.UI.Action.Marker.type),a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),$(this._ui.getMap().getMapContainer()).addClass(this._classMapMarker),this._widget=a.Widget.markerProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget))},_disable:function(){this._executed&&(this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapMarker),this.options.dataBinded=void 0)}}),a.UI.Action.Marker.type="text",a.UI.Action.marker=function(b,c){var d=a.UI.ActionController.getAction("marker");return d?(d.setData(c),d):new a.UI.Action.Marker(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Measure=a.UI.Action.extend({_type:"measure",_ui:void 0,_zoomBounds:void 0,_selectType:"measurer",_classMapMeasure:"gis-map-measuring",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapMeasure),this._widget=a.Widget.measureProperty(),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapMeasure)}}),a.UI.Action.measure=function(b,c){var d=a.UI.ActionController.getAction("measure");return d?(d.setData(c),d):new a.UI.Action.Measure(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Move=a.UI.Action.extend({_type:"move",_classMapMove:"gis-map-moving",execute:function(){a.UI.Action.prototype.execute.call(this),this._oldClearOnClick=this._ui.getMap().isClearOnClick(),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!0),this._ui.getMap().filterSelect(a.ObjectController.FILTER_NOTHING,this.options.noUI),$(this._ui.getMap().getMapContainer()).addClass(this._classMapMove),this.options.noUI||(this._widget=a.Widget.moveProperty(),this._ui.addWidget(this._widget))},_update:function(){},_disable:function(){this.options.noUI||this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),this._ui.getMap().clearSelectedOnClick(this._oldClearOnClick),this._ui.getMap().filterSelect(void 0,this.options.noUI),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapMove)}}),a.UI.Action.move=function(b,c){var d=a.UI.ActionController.getAction("move");return d?(d.setData(c),d):new a.UI.Action.Move(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Object=a.UI.Action.extend({_type:"object",_selectType:"image",_classMapObject:"gis-map-object",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapObject),this._widget=a.Widget.objectProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapObject),this.options.dataBinded=void 0}}),a.UI.Action.object=function(b,c){var d=a.UI.ActionController.getAction("object");return d?(d.setData(c),d):new a.UI.Action.Object(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Path=a.UI.Action.extend({_type:"path",_selectType:"path",_ui:void 0,_zoomBounds:void 0,_classMapPath:"gis-map-path",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapPath),this._widget=a.Widget.pathProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapPath),this.options.dataBinded=void 0}}),a.UI.Action.path=function(b,c){var d=a.UI.ActionController.getAction("path");return d?(d.setData(c),d):new a.UI.Action.Path(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Polyton=a.UI.Action.extend({_type:"polygon",_selectType:"polygon",_ui:void 0,_zoomBounds:void 0,_classMapPolyton:"gis-map-polygon",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapPolyton),this._widget=a.Widget.polygonProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)
},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapPolyton),this.options.dataBinded=void 0}}),a.UI.Action.polygon=function(b,c){var d=a.UI.ActionController.getAction("polygon");return d?(d.setData(c),d):new a.UI.Action.Polyton(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Sector=a.UI.Action.extend({_type:"sector",_selectType:"sector",_classMapSector:"gis-map-sector",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().clearSelectedOnClick(!1),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.UI.Action.Sector.type),$(this._ui.getMap().getMapContainer()).addClass(this._classMapSector),this._widget=a.Widget.sectorProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapSector),this.options.dataBinded=void 0}}),a.UI.Action.Sector.type="sector",a.UI.Action.sector=function(b,c){var d=a.UI.ActionController.getAction("sector");return d?(d.setData(c),d):new a.UI.Action.Sector(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Select=a.UI.Action.extend({_type:"select",_classMapSelecting:"gis-map-selecting",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!0),this._ui.getMap().setDraggableEnabled(!0),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.ObjectController.FILTER_ALL,!0),$(this._ui.getMap().getMapContainer()).addClass(this._classMapSelecting)},_disable:function(){a.UI.Action.prototype._disable.call(this),this._ui.getMap().filterSelect(a.ObjectController.FILTER_NOTHING,!0),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapSelecting)}}),a.UI.Action.select=function(b,c){var d=a.UI.ActionController.getAction("select");return d?(d.setData(c),d):new a.UI.Action.Select(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Zoom=a.UI.Action.extend({_type:"zoom",_ui:void 0,options:{zoomOut:!1},_zoomOut:void 0,_zoomBounds:void 0,_classMapZoom:"gis-map-zooming",_classMapZoomOut:"gis-map-zooming-out",initialize:function(b){var c=this;a.UI.Action.prototype.initialize.call(this,b),this._onKeyPress=this._onKeyPress||function(a){var b=18;return a.keyCode===b||a.charCode===b+""?(c._InitZoomOut(),!1):void 0},this._onKeyUp=this._onKeyUp||function(){c._deInitZoomOut()}},execute:function(){this._executed||(a.UI.Action.prototype.execute.call(this),this._oldClearOnClick=this._ui.getMap().isClearOnClick(),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(a.ObjectController.FILTER_NOTHING,this.options.noUI),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapZoom),this.options.zoomOut&&this._InitZoomOut(),this.options.noUI||(this._widget=a.Widget.zoomProperty(),this._ui.addWidget(this._widget)))},initEvents:function(){a.UI.Action.prototype.initEvents.call(this);var b=this._ui.getMap();document.body.addEventListener("keydown",this._onKeyPress),document.body.addEventListener("keyup",this._onKeyUp),this._ui.getMap().getMapContainer().addEventListener("keydown",this._onKeyPress),this._ui.getMap().getMapContainer().addEventListener("keyup",this._onKeyUp),b.on("mousedown",this._onMouseDown,this)},deInitEvents:function(){a.UI.Action.prototype.deInitEvents.call(this);var b=this._ui.getMap();b.off("mousedown",this._onMouseDown,this),document.body.removeEventListener("keydown",this._onKeyPress),document.body.removeEventListener("keyup",this._onKeyUp),this._ui.getMap().getMapContainer().removeEventListener("keydown",this._onKeyPress),this._ui.getMap().getMapContainer().removeEventListener("keyup",this._onKeyUp)},_InitZoomOut:function(){this._zoomOut=!0,$(this._ui.getMap().getMapContainer()).addClass(this._classMapZoomOut)},_deInitZoomOut:function(){$(this._ui.getMap().getMapContainer()).removeClass(this._classMapZoomOut),this._zoomOut=!1},_onMouseMove:function(a){var b,c;if(this._mouseDown){if(c=a.originalEvent,!this._moved&&L.point(c.clientX,c.clientY).distanceTo(L.point(this._startEvent.clientX,this._startEvent.clientY))<5)return;b=this._ui.getStyle("zoom"),this._divZoom?(this._divZoom.style.width=Math.max(this._startEvent.clientX,c.clientX)-Math.min(this._startEvent.clientX,c.clientX)+"px",this._divZoom.style.height=Math.max(this._startEvent.clientY,c.clientY)-Math.min(this._startEvent.clientY,c.clientY)+"px",this._divZoom.style[Gis.DomUtil.prefixes("transform")]=Gis.DomUtil.isCssTransform3d()?"translate3d("+Math.min(this._startEvent.clientX,c.clientX)+"px, "+Math.min(this._startEvent.clientY,c.clientY)+"px,0)":"translate("+Math.min(this._startEvent.clientX,c.clientX)+"px, "+Math.min(this._startEvent.clientY,c.clientY)+"px)"):(this._divZoom=document.createElement("div"),this._divZoom.classList.add("gis-ui-zoom-div"),this._divZoom.style.backgroundColor=b.fill.color,this._divZoom.style.borderColor=b.line.color,this._ui.getMap().getMapContainer().appendChild(this._divZoom)),this._moved=!0}},_onMouseDown:function(a){var b=this._ui.getMap();b.on("mousemove",this._onMouseMove,this),b.on("mouseup",this._onMouseUp,this),b.on("mouseout",this._onMouseUp,this),this._ui.getMap().setDraggableEnabled(!1),this._latlngStart=a.latLng,this._startEvent=a.originalEvent,this._moved=!1,this._mouseDown=!0},_disableMove:function(){this._divZoom&&(this._ui.getMap().getMapContainer().removeChild(this._divZoom),delete this._divZoom),this._moved=!1,this._mouseDown=!1},_onMouseUp:function(b){var c,d;this._mouseDown&&(c=this._ui.getMap(),c.off("mousemove",this._onMouseMove,this),c.off("mouseup",this._onMouseUp,this),c.off("mouseout",this._onMouseUp,this),this._moved?c.setZoom(a.Objects.Polygon.generateSquareLatLng(this._latlngStart,b.latLng,null,!0)):(d=c.getZoom(),this._zoomOut||b.originalEvent.altKey?d-=1:d+=1,c.setZoomAround([b.latLng.latitude,b.latLng.longitude],d))),this._disableMove()},_disable:function(){this._executed&&(this._deInitZoomOut(),this.options.noUI||this._ui.removeWidget(this._widget),this._ui.getMap().clearSelectedOnClick(this._oldClearOnClick),a.UI.Action.prototype._disable.call(this),this._ui.getMap().filterSelect(void 0,this.options.noUI),this._disableMove(),this.options.zoomOut=!1,Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapZoom))}}),a.UI.Action.zoom=function(b,c){var d=a.UI.ActionController.getAction("zoom");return d?(d.setData(c),d):new a.UI.Action.Zoom(b,c)}}(Gis),function(a){"use strict";a.UI.ActionController={_list:{},_listExecuted:[],pushAction:function(a){var b=a.getType();this._list[b]||(this._list[b]=a)},_getByLayerType:function(a){var b;for(b in this._list)if(this._list.hasOwnProperty(b)&&this._list[b]._selectType===a)return this._list[b]},getAction:function(a){var b=this._list[a];return b||this._getByLayerType(a)},getFirstAction:function(){return this._list[Object.keys(this._list)[0]]},pushExecuted:function(a){this._listExecuted.push(a)},popLastExecuted:function(){return this._listExecuted.pop()},getLastExecuted:function(){return this._listExecuted[this._listExecuted.length-1]}}}(Gis),Gis.Widget=Gis.Widget||{},Gis.Widget.Base=Gis.BaseClass.extend({_dialogOptions:{dialogClass:"no-title-bar",autoOpen:!1,modal:!0,width:340,closeOnEscape:!0,minHeight:10,draggable:!0},_typePrefix:"",_type:void 0,options:{position:"TOP",enabled:!0},getNeedSize:function(){Gis.extendError()},_initDialogClose:function(a){var b,c,d,e;return c=a.id||"gis-remove-dialog",d=a.callback||function(){},e=a.context||this,b=$("#"+c),b.length||(b=$('<div id="'+c+'"/>'),b.appendTo($(document.body))),b.dialog($.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){d.call(e),$(this).dialog("close")}},{text:"Нет",click:function(){$(this).dialog("close")}}]})),b},_deleteLayerConfirm:function(a,b){(b||this.options.dataBinded)&&(this._$dialogRemove=this._initDialogClose(a),this._$dialogRemove.html(a.title||""),this._$dialogRemove.dialog("open"))},initialize:function(){var a=this;Gis.BaseClass.prototype.initialize.apply(this,arguments),this._pointDirectionClicked=function(){if(a.options.dataBinded&&a.isDataEditable&&(!a.isDataEditable()||!a.getValueFromData("isDraggable",!0)))return this;var b,c,d,e=["СШ ЮШ","ВД ЗД"],f=$(this),g=f.html();b=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,f.parent()).length?e[0]:e[1],b=b.split(" "),c=b.indexOf(g),d=b.length>c+1?b[c+1]:b[0],f.html(d),a.fire("change")},this._pointDirectionCopy=function(b){return b.originalEvent.clipboardData.setData("Text",a.getPointValue(a.getPointY($(this)))+" "+a.getPointValue(a.getPointX($(this)))),a.fire("change"),!1},this._pointDirectionPaste=function(b){var c=a._containerController.getUIAttached().getGeoConverter().fromRandomTemplateToCurrent(b.originalEvent.clipboardData.getData("Text"),$(this).hasClass(Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED));return c&&(Gis.Util.isArray(c)?(c.forEach(function(b){a.setHtmlPointValue($(this),b)}),c[0]&&a.setHtmlPointValue(a.getPointY($(this)),c[0]),c[1]&&a.setHtmlPointValue(a.getPointX($(this)),c[1])):a.setHtmlPointValue($(this),c),a.fire("change")),!1}},getModalPreloader:function(){var a=$(".modalPreloader");return a.length||(a=$('<div class="modalPreloader" style="display: none; text-align: center;"><div class="text"><h2 style="font-size: 16px;"></h2><div class="loader"></div></div></div>').appendTo(document.body)),a},showModalPreloader:function(a){var b=this.getModalPreloader();$("h2",b).html(a),b.show()},hideModalPreloader:function(){var a=this.getModalPreloader();a.hide()},getPointX:function(a){var b=a.parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED);return b.length||(b=a.parent().parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED)),b},getPointY:function(a){var b=a.parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED);return b.length||(b=a.parent().parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED)),b},isAttachedToUi:function(){return this._containerController&&this._containerController.getUIAttached()},templateToCoordinate:function(){var a=this._containerController.getUIAttached().getGeoConverter();return a.toBase.apply(a,arguments)},getCoordinateRowName:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=[{x:"X",y:"Y"},{y:"&phi;",x:"&lambda;"}];return c[b.isMetric()?0:1][a?"y":"x"]},_HTMLRowName:function(a){return"<span class='"+(a?"y":"x")+"-name'>"+this.getCoordinateRowName(a)+"</span>"},_HTMLRowInput:function(a,b,c,d){return"<input type='text' title='"+(d||"")+"' data-old-val='"+a+"' "+(b?"id='"+b+"'":"")+" class='"+(c||"")+"' value='"+a+"'/>"},_HTMLPointSelector:function(a,b,c,d){var e="",f=this._containerController.getUIAttached().getGeoConverter();return a&&a.match&&(e=a.match(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_FIND),e=e&&e.length?e[0]:""),a=a.replace(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE,"").trim(),!e&&f.isTemplateDirectional()&&(e=c.indexOf(Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED)>=0?"СШ":"ВД"),"<span class='gis-point-selector "+(f.isTemplateDirectional()?"gis-direction":"")+"'><input type='text' data-is-point='true' title='"+(d||"")+"' data-old-val=\""+a+'" '+(b?"id='"+b+"'":"")+" class='"+(c||"")+"' value=\""+a+"\"/><span class='point-direction' data-old-val='"+e+"'>"+e+"</span><span title='Используется фиксированная зона' class='point-attention'>!</span></span>"},_HTMLPointSelectorWidget:function(a){var b,c=a.tag||"span",d=a.xClass||"",e=a.yClass||"",f=a.x||"",g=a.y||"",h=a.tagClass||"",i=this._containerController.getUIAttached().getGeoConverter();return b=i.isMetric(i.getSelectedSystem()),b?"<"+c+" class='"+h+"'>"+this._HTMLRowName()+this._HTMLPointSelector(f,a.xID,d+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_X)+"</"+c+">\n<"+c+" class='"+h+"'>"+this._HTMLRowName(!0)+this._HTMLPointSelector(g,a.yID,e+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_Y)+"</"+c+">\n":"<"+c+" class='"+h+"'>"+this._HTMLRowName(!0)+this._HTMLPointSelector(g,a.yID,e+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_Y)+"</"+c+">\n<"+c+" class='"+h+"'>"+this._HTMLRowName()+this._HTMLPointSelector(f,a.xID,d+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_X)+"</"+c+">\n"},setHtmlPointSelectorWidgetData:function(a,b,c){if(b&&void 0!=b.x&&this.setHtmlPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a),b.x,c&&c.x),b&&void 0!=b.y){var d=this._containerController.getUIAttached().getGeoConverter(),e=b.x&&d.isNeedZone(d.getSelectedSystem())&&d.isInFixedZoneBounds(this.templateToCoordinate(b).x);this.setHtmlPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,a),b.y,c&&c.y,e)}},revertHtmlPointSelectorWidgetData:function(a){this.setHtmlPointSelectorWidgetData(a,this.getPointWidgetData(a,!0))},getPointWidgetData:function(a,b){return Gis.UI.coordinate(this.getPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a),b),this.getPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,a),b))},setHtmlPointValue:function(a,b,c,d){function e(){return a.hasClass(Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED)}function f(a){var b=k?e()?"СШ":"ВД":"";return a+="",a&&a.match&&k&&(b=a.match(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_FIND),b=b&&b.length?j.getDirectionNameOutter(b[0]):""),b}var g,h,i,j=this._containerController.getUIAttached().getGeoConverter(),k=j.isTemplateDirectional();return a=$(a),a.data("is-point",!0),g=a.parent(),g[k?"addClass":"removeClass"]("gis-direction"),b=void 0==b?"":b,d?$(".point-attention",a.parent()).addClass(Gis.Widget.Base.POSITION_VALUE_CLASS_FIXED_ZONE):$(".point-attention",a.parent()).removeClass(Gis.Widget.Base.POSITION_VALUE_CLASS_FIXED_ZONE),h=f(b),b+="",b=b.replace(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE,"").trim(),$(".point-direction",g).html(h),a.val(b),void 0!=c&&(i=f(c),c+="",c=c.replace(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE,"").trim(),$(".point-direction",g).data("old-val",i),a.data("old-val",c)),this},getPointValue:function(a,b,c,d){var e,f=this._containerController.getUIAttached().getGeoConverter().isTemplateDirectional(c,d);return b?(e=a.data("old-val"),""!==e?e+(f&&a.data("is-point")?" "+$(".point-direction",a.parent()).data("old-val"):""):""):(e=a.val(),""!==e?e+(f&&a.data("is-point")?" "+$(".point-direction",a.parent()).html():""):"")},coordinateToTemplate:function(a,b,c){Gis.Util.isArray(a)&&(a=Gis.UI.coordinate([a[1],a[0],a[2]]));var d=this._containerController.getUIAttached().getGeoConverter();return d.fromBase.call(d,a,b,c)},canFitTo:function(){return!0},onRemove:function(){this._deInitEvents(),this._$div.remove()},onAdd:function(a){this.container=a.getContainer(),this._containerController=a,this.initHTML()},isControlAvailable:function(a,b){var c=!b&&this._containerController.getUIAttached(),d=(b||c&&this._containerController.getUIAttached().getMap()).getSetting("ui"),e=d&&d.indexOf(a||this._typePrefix+this._type)>=0;return e},initHTML:function(){this._$div=$('<div class="'+Gis.Widget.Base.CLASS_NAME+'"/>')},getType:function(){return this._type},addTo:function(a){a.addChild(this)},getPosition:function(){return this.options.position},_deInitEvents:function(){this._containerController.getUIAttached().off("skchanged",this._skChanged,this),this._$div.off("click",".point-direction",this._pointDirectionClicked),this._$div.off("copy","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionCopy),this._$div.off("paste","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionPaste)},_initEvents:function(){this._containerController.getUIAttached().on("skchanged",this._skChanged,this),this._$div.on("click",".point-direction",this._pointDirectionClicked),this._$div.on("copy","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionCopy),this._$div.on("paste","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionPaste)},_skChanged:function(){var a=this._HTMLRowName(),b=this._HTMLRowName(!0);$(".x-name",this._$div).each(function(){$(this).replaceWith(a)}),$(".y-name",this._$div).each(function(){$(this).replaceWith(b)})},draw:function(){this.container.appendChild(this._$div[0]),this._initEvents()},getWidth:function(){return this._$div.width()},getHeight:function(){return this._$div.height()},isDataEditable:function(a){return a=a||this.options.dataBinded,!a||a.isEditableByUser()},afterUpdate:function(){this.fire("updated",{target:this})},removeLayerFromMap:function(a){a.isEditableByUser()?this._containerController.getUIAttached().getMap().removeLayer(a):this._containerController.getUIAttached().getMap().hideLayersByID(a.getId())}}),Gis.UI.DeleteActions={post:function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить ПОСТ?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"post-remove-dialog"},b)},source:function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить ИРИ?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"source-remove-dialog"},b)}},Gis.UI.DeleteActions[Gis.Objects.HeatMap.prototype.options.tacticObjectType]=function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить объект?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"heat_map-remove-dialog"},b)},Gis.Widget.Base.CLASS_NAME="gis-widget",Gis.Widget.Base.TITLE_CLASS="gis-widget-title",Gis.Widget.Base.REVERT_CLASS="gis-widget-revert",Gis.Widget.Base.GO_CLASS="gis-widget-go",Gis.Widget.TYPE={},Gis.Widget.Base.POSITION_VALUE_CLASS="position-value",Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED="position-value-x",Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED="position-value-y",Gis.Widget.Base.POSITION_VALUE_CLASS_FIXED_ZONE="zone-fixed",Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES="SNEWСЮШВЗДsnewсюшвзд",Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE=new RegExp("["+Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES+"]","g"),Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_FIND=new RegExp("["+Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES+"]+"),Gis.Widget.Base.POSITION_VALUE_CLASS_X=Gis.Widget.Base.POSITION_VALUE_CLASS+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,Gis.Widget.Base.POSITION_VALUE_CLASS_Y=Gis.Widget.Base.POSITION_VALUE_CLASS+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,Gis.Widget.Button=Gis.BaseClass.extend({required:["className","action"],options:{tag:"li",className:void 0,title:void 0,action:void 0},getButton:function(){var a;return this._node||(this._node=document.createElement(this.options.tag),a=document.createElement("span"),this.options.title&&(a.title=this.options.title),this._node.appendChild(a),this._node.className=Gis.Widget.Button.BUTTON_CLASS_NAME+" "+this.options.className,this.options.action.attachToButton(this._node)),this._node},getId:function(){return this._id=this._id||Gis.Util.generateGUID(),this._id},getAction:function(){return this.options.action}}),Gis.Widget.Button.BUTTON_CLASS_NAME="gis-instruments-button",function(a){"use strict";a.Widget.ContainerBehavior={child:null,addChild:function(a){a.isControlAvailable(null,this._ui.getMap())&&!this.containsChild(a)&&a.canFitTo(this)&&(this._$container.parent().show(),this.child.push(a),a.onAdd(this))},swapVisible:function(){this.child.length?this._$container.parent().show():this._$container.parent().hide()},removeChild:function(a){var b,c;for(b=0,c=this.child.length;c>b;b+=1)a===this.child[b]&&delete this.child[b];a.onRemove(),this.swapVisible()},removeWidgetByType:function(a){var b,c,d=this.child;for(b=0,c=d.length;c>b;b+=1)a===d[b].getType()&&this.removeChild(d[b])},containsChild:function(a){var b,c;for(b=0,c=this.child.length;c>b;b+=1)if(a===this.child[b])return!0;return!1}}}(Gis),Gis.Widget.TYPE.CONTAINER=1,Gis.Widget.Container=Gis.Widget.Base.extend({_className:"",includes:Gis.Widget.ContainerBehavior,_$container:null,_type:Gis.Widget.TYPE.CONTAINER,options:{width:null,height:null},getNeedSize:function(){var a,b=0,c=0;return this.child.forEach(function(d){a=d.getNeedSize(),b+=a[0],c+=a[1]}),[b+this._$container.outerWidth(!0)-this._$container.width(),c+this._$container.outerHeight(!0)-this._$container.height()]},initializeHTMLcontainer:function(){this._$container=$('<div style="position: relative;" class="'+Gis.Widget.Base.CLASS_NAME+" "+Gis.Widget.Container.CLASS_NAME+" "+this._className+'"/>')},initialize:function(a){Gis.Widget.Base.prototype.initialize.call(this,a),this.child=[],this.initializeHTMLcontainer()},onAdd:function(a){this._ui=a},getUIAttached:function(){return this._ui},draw:function(a){$(a).append(this._$container),this.swapVisible()},getContainer:function(){return this._$container[0]},getAvailableWidth:function(){var a=this.getWidth();this.child.forEach(function(b){a-=$(b).width()})},getAvailableHeight:function(){var a=this.getHeight();this.child.forEach(function(b){a-=$(b).height()})},getWidth:function(){return this._ui.getAvailableContainerBounds(this.options.position).width},getHeight:function(){return this._ui.getAvailableContainerBounds(this.options.position).height},addTo:function(a){a.addContainer(this)}}),Gis.Widget.Container.CLASS_NAME="gis-widget-container",Gis.Widget.container=function(a){return new Gis.Widget.Container(a)};var buttons;buttons={select:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-select",title:"Выбрать объект",action:Gis.UI.Action.select(a)})},move:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-move",title:"Переместить карту",action:Gis.UI.Action.move(a)})},zoom:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-zoom",title:"Масштабировать карту",action:Gis.UI.Action.zoom(a)})},measure:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-measure",title:"Измеритель",action:Gis.UI.Action.measure(a)})},marker:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-marker",title:"Добавить/редактировать маркер",action:Gis.UI.Action.marker(a)})},object:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-object",title:"Добавить/редактировать объект",action:Gis.UI.Action.object(a)})},path:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-path",title:"Добавить/редактировать путь",action:Gis.UI.Action.path(a)})},polygon:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-polygon",title:"Добавить/редактировать полигон",action:Gis.UI.Action.polygon(a)})},ellipse:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-ellipse",title:"Добавить/редактировать эллипс",action:Gis.UI.Action.ellipse(a)})},sector:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-sector",title:"Добавить/редактировать сектор",action:Gis.UI.Action.sector(a)})}},Gis.Widget.Instruments=Gis.Widget.Base.extend({_type:"instruments",_buttons:{},options:{instruments:"select move zoom measure separator marker object path polygon ellipse sector",position:"left",enabled:!0},_newActionExecuted:function(a){var b,c,d;c=a.action,d=c.getId();for(b in this._buttons)this._buttons.hasOwnProperty(b)&&this._buttons[b].getId()!==d&&this._buttons[b].getAction().closeAction()},getNeedSize:function(){var a=0;return $(">li",$(this._list)).each(function(){a+=$(this).outerHeight(!0)}),[$(this._list).outerWidth(!0),a+this._$div.outerHeight(!0)-this._$div.height()]},onAdd:function(a){var b,c,d,e,f,g;Gis.Widget.Base.prototype.onAdd.call(this,a),b=this,c=this.options.instruments.split(" "),d=buttons,c.forEach(function(a){b.isControlAvailable(a)&&d.hasOwnProperty(a)&&Gis.UI.ActionController.getAction(a)&&(f=d[a](b._containerController.getUIAttached()),f.getAction().on("newactionexecuted",b._newActionExecuted,b),b._list.appendChild(f.getButton()),b._buttons[f.getId()]=f,g=g||a),"separator"===a&&(e=document.createElement("li"),e.className=Gis.Widget.Button.BUTTON_CLASS_NAME+" gis-instruments-button-separator",b._list.appendChild(e))}),this.draw(),g=g||Gis.UI.ActionController.getFirstAction(),g&&Gis.UI.ActionController.getAction(g).execute(),this.afterUpdate()},_deInitEvents:function(){this._containerController.getUIAttached().off("sizerecalculated",this.setWidth,this),this._$div.tooltip("destroy")},_initEvents:function(){this._containerController.getUIAttached().on("sizerecalculated",this.setWidth,this),this._$div.tooltip({items:".gis-instruments-button > span[title]",track:!0})},setWidth:function(){this._$div.css({width:this._containerController.getWidth(),height:this._containerController.getHeight()})},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.Instruments.CLASS_NAME),this.setWidth(),this._list=document.createElement("ul"),this._list.className="instruments-list",this._$div[0].appendChild(this._list)},draw:function(){Gis.Widget.Base.prototype.draw.call(this)},afterUpdate:function(){Gis.Widget.Base.prototype.afterUpdate.call(this)}}),Gis.Widget.Instruments.CLASS_NAME="gis-widget-instruments",Gis.Widget.instruments=function(a){return new Gis.Widget.Instruments(a)},Gis.Widget.PointBehavior={_attachPointDataToRow:function(a,b,c){b?(!a.data("point")||c)&&a.data("point",Gis.pathPoint(b)):a.data("point",null)},_detachPointDataFromRow:function(a){this._attachPointDataToRow(a,null)},_detachPointDataFromAllRows:function(){var a=this;$("#points-selector li",this._$div).each(function(){a._detachPointDataFromRow($(this))})},_getPoint:function(a){return a.data("point")}},function(){var a=function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=a&&this.coordinateToTemplate(a.getCenter()),d=a.getName()||a.getTypeName(a.getType())||"Неизвестный объект",e=b.isMetric(b.getSelectedSystem()),f=c&&c.x&&c.y?e?c.x+", "+c.y:c.y+", "+c.x:"";return d+(f?"<span class='additional'>"+f+"</span>":"")},b=function(b){var c=a.call(this,b),d=b.getOptionsWithStyle().icon;return d&&(c=d.isPredefinedType()?"<div class='ico-preview' data-id='"+b.getId()+"' width='24' height='24'></div>"+c:"<image class='ico-preview' data-id='"+b.getId()+"' width='24' height='24'/>"+c),c};Gis.UI.TitleGenerators={post:b,source:b,_generateRowName:function(b){return this[b.getType()]?this[b.getType()].call(this,b):a.call(this,b)}}}(),function(a){"use strict";a.Widget.ZoomBehavior={getConvertedZoom:function(){return this._containerController.getUIAttached().getMap().getZoom()},_getZoomValues:function(){var a,b=[],c=this._containerController.getUIAttached().getMap(),d=c.getMinZoom(),e=c.getMaxZoom();for(a=e;a>=d;a-=1)b.push({val:a,name:a});return b}}}(Gis),Gis.Widget.MapControl=Gis.Widget.Base.extend({includes:Gis.Widget.ZoomBehavior,_type:"mapcontrol",_buttons:{},options:{position:"top"},initialize:function(a){var b=this;Gis.Widget.Base.prototype.initialize.call(this,a),this._centerObject=function(){var a;a=b._getFirstSelected(),b._objectCentered?b._deinitCenterOnObject():(a||b._lastSelected)&&b._initCenterOnObject(a||b._lastSelected)},this._centerPost=function(){b._postCentered?b._deinitCenterOnPost():b._lastPostSelected&&b._initCenterOnPost(b._lastPostSelected)},this._removeMap=function(){var a=b._containerController.getUIAttached().getMap(),c=Gis.TileMapService.decodeKey(a.getSelectedMapKey());if(c&&c[1]&&a.isMeOwnerOfTms(c[1])){var d=a.getTileLayerByKey(a.getSelectedMapKey());b.removeMapDialog(a.getLocalTMS()[0],c[1],d&&d.tile&&d.tile.getTitle())}},this._addMap=function(){b.showAddMapDialog()},this._zoomIn=function(){b._containerController.getUIAttached().getMap().zoomIn()},this._centerFromLayer=function(a){var c=b._lastSelected.getCenter(),d=a.rows&&(a.rows.indexOf("latitude")>=0||a.rows.indexOf("longitude")>=0||a.rows.indexOf("latitudes")>=0||a.rows.indexOf("longitudes")>=0);a&&(d||b._lastSelected&&"source"===b._lastSelected.getType())&&b._isLayerOutFromContainer(c)&&b._containerController.getUIAttached().getMap().setCenter(c)},this._centerFromPost=function(){var a=b._lastPostSelected.getCenter();b._isLayerOutFromContainer(a)&&this._containerController.getUIAttached().getMap().setCenter(a)},this._zoomOut=function(){b._containerController.getUIAttached().getMap().zoomOut()}},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a),this.draw()},_skChanged:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=$("#gis-widget-control-mouse-position",this._$div);this.updateDataPosition({latLng:b.convert(a.oldSk,"wgs84",Gis.UI.coordinate($(".value-x",c).html().trim(),$(".value-y",c).html().trim()))}),Gis.Widget.Base.prototype._skChanged.call(this)},setWidth:function(){this._$div.css({width:this._containerController.getWidth(),height:this._containerController.getHeight()})},_checkRemoveButtonAvailable:function(){var a=this._containerController.getUIAttached().getMap(),b=Gis.TileMapService.decodeKey(a.getSelectedMapKey());$(".gis-control-map-remove")[b&&b.length>1&&a.isMeOwnerOfTms(b[1])?"show":"hide"]()},_postCenterHtml:function(){return this.isControlAvailable("controlpostcenter")?"<li class='gis-control-element gis-post-center'><div class='gis-control-square-button' id='gis-post-center' title='Авто-центрирование по посту'><span></span></div><div class='post-list'></div></li>":""},_mapControlHtml:function(){var a,b=this._containerController.getUIAttached().getMap(),c="",d=Gis.TileMapService.decodeKey(b.getSelectedMapKey());return this.isControlAvailable("controlmap")&&b.getLocalTMS()&&(c="<li class='gis-control-element gis-control-map-add'><div class='gis-control-square-button' id='gis-add-map' title='Добавить карту'><span></span></div></li>",a=d&&d.length>1&&b.isMeOwnerOfTms(d[1])?"display: inline-block;":"display: none;",c+="<li class='gis-control-element gis-control-map-remove' style='"+a+"'><div class='gis-control-square-button' id='gis-remove-map' title='Удалить карту'><span></span></div></li>"),c},_mapSelectorContainer:function(){return this.isControlAvailable("controlmapselector")?"<li class='gis-control-element gis-map-selector'><div id='gis-maps-container'></div></li>":""},_objectCenterHtml:function(){return this.isControlAvailable("controlobjectcenter")?"<li class='gis-control-element gis-object-center'><div class='gis-control-square-button' id='gis-object-center'  title='Авто-центрирование по объекту'><span></span></div></li>":""},_zoomSelectorHtml:function(){return this.isControlAvailable("controlzoom")?"<li class='gis-control-element gis-zoom-selector'><div id='gis-widget-control-zoom-selector'></div><div class='gis-control-square-button' id='gis-control-zoom-in' title='Увеличить масштаб'><span></span></div><div class='gis-control-square-button' id='gis-control-zoom-out' title='Уменьшить масштаб'><span></span></div></li>":""},_connectionStateHtml:function(){return this.isControlAvailable("controlconnectionstate")?"<li class='gis-control-element gis-connection-status'><div id='gis-widget-control-status-connection' title='Статус соединения'></div></li>":""},_mousePositionHtml:function(){return this.isControlAvailable("controlmouseposition")?"<li class='gis-control-element gis-mouse-position'><div id='gis-widget-control-mouse-position' title='Текущая позиция указателя мыши'></div><div class='gis-sk-selector-container'><div class='gis-sk-title'></div><div id='gis-sk-selector'></div></div></li>":""},_generateControlsHtml:function(){var a="";
return a+=this._mapSelectorContainer(),a+=this._mapControlHtml(),a+=this._postCenterHtml(),a+=this._objectCenterHtml(),a+=this._zoomSelectorHtml(),a+=this._connectionStateHtml(),a+=this._mousePositionHtml(),a=a?"<ul class='gis-widget-control'>"+a+"</ul>":""},_isLayerOutFromContainer:function(a){return!this._containerController.getUIAttached().getMap().getMapBounds().pad(-.8).contains(a)},zoomSelected:function(a){this._containerController.getUIAttached().getMap().setZoom(parseFloat(a))},_createPostList:function(){this._listPost=Gis.HTML.listView({data:this._getPostValues(),container:$(".gis-post-center > div.post-list",this._$list)[0],callback:this.postSelected,context:this,defaultValue:{val:"",name:""},noText:!0})},_getSkValues:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=[];return a=a||b.getAvailableSystems(),a.forEach(function(a){var d=b.getAvailableTemplates(a);d?c=c.concat(d.map(function(c){return{val:b.getFullSystemKey(a,c),name:b.getFullSystemName(b.getFullSystemKey(a,c))}})):b.isNeedZone(a)?c=c.concat([{val:a+Gis.UI.CoordinateConverter.DELIMETER+"null"+Gis.UI.CoordinateConverter.DELIMETER+"null",name:b.getSystemName(a)+" (авто)"},{val:a+Gis.UI.CoordinateConverter.DELIMETER+"null"+Gis.UI.CoordinateConverter.DELIMETER+"fix",name:b.getSystemName(a)+" (фикс)"}]):c.push({val:a,name:b.getSystemName(a)})}),c},showActiveZoneDialog:function(a){var b=$(".dialogZone"),c=!1,d=this._containerController.getUIAttached().getGeoConverter(),e=this;b.length||(b=$('<div class="dialogZone" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Выбор спорной зоны</h2><label for="fixed" >Фиксированная зона <input name="fixed" type="text"></label></div>').appendTo(document.body)),this._$dialogZone=b.dialog(Gis.Util.extend(this._dialogOptions,{buttons:[{text:"Сохранить",click:function(){var b,f=$(this);c=!1,b=$('input[name="fixed"]',f),parseInt(b.val(),10)&&(c=!0,d.setActiveSystem(a.replace("fix",parseInt(b.val(),10))),e._createSkList()),c&&f.dialog("close")}}]})).on("dialogopen",function(){var a=d.getAutoZone();$('input[name="fixed"]',$(this)).val(Gis.Util.isNumeric(a)?a:"")}),this._$dialogZone.dialog("open")},getNeedSize:function(){var a=0;return $(">li",this._$list).each(function(){a+=$(this).outerWidth(!0)}),[a+this._$div.outerWidth(!0)-this._$div.width()+this._$list.outerWidth(!0)-this._$list.width(),this._$div.outerHeight(!0)]},showAddMapDialog:function(){function a(e){var f;switch(c.off("tilesendok tilesenderror",a),e.type){case"tilesendok":$(".load-error",b).remove(),b.dialog("close"),d.showMapLoadedDialog(c.getLocalTMS()[0],e.data.path,e.data.title);break;case"tilesenderror":f=$(".load-error",b),f.length?f.html("Не удалось активировать карту. Обратитесь к администратору."):$('<div class="load-error error">Не удалось активировать карту.</div>').appendTo(b)}d.hideModalPreloader()}var b=$(".dialogNewMap"),c=this._containerController.getUIAttached().getMap(),d=this;b.length||(b=$('<div class="dialogNewMap" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Добавление карты</h2><label for="file" >Файл <input name="file" id="map-file-name" type="text"></label><label for="name" >Название карты <input name="name" id="map-name" type="text"></label></div>').appendTo(document.body)),this._$dialogAddMap=b.dialog(Gis.Util.extend(this._dialogOptions,{width:305,buttons:[{text:"Отправить",click:function(){var b=$("#map-file-name",d._$dialogAddMap),e=$("#map-name",d._$dialogAddMap);b.val()&&e.val()&&(d.showModalPreloader("Выполняется обмен данными с сервером"),c.on("tilesendok tilesenderror",a),c.pushTileToServer(c.getLocalTMS()[0],{path:b.val(),title:e.val()}))}},{text:"Отмена",click:function(){c.off("tilesendok tilesenderror",a),$(".load-error",b).remove(),b.dialog("close")}}]})).on("dialogopen",function(){$("#map-file-name",d._$dialogAddMap).val(""),$("#map-name",d._$dialogAddMap).val("")}),this._$dialogAddMap.dialog("open")},showMapLoadedDialog:function(a,b,c){var d=$(".dialogMapLoaded"),e=this._containerController.getUIAttached().getMap();d.length||(d=$('<div class="dialogMapLoaded" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Карта успешно активирована</h2><div style="margin-top: 10px">Установить карту текущей?</div></div>').appendTo(document.body)),$("div",d).html('Установить карту "'+c+'" текущей?'),this._$dialogSetMap=d.dialog(Gis.Util.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){e.setMapType(Gis.TileMapService.encodeKey(a.getURL(),b),!0),d.dialog("close")}},{text:"Нет",click:function(){d.dialog("close")}}]})),this._$dialogSetMap.dialog("open")},removeMapDialog:function(a,b,c){var d=$(".dialogMapRemove"),e=this._containerController.getUIAttached().getMap();d.length||(d=$('<div class="dialogMapRemove" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Подтверждение удаления карты</h2><div style="margin-top: 10px">Вы действительно хотите удалить карту?</div></div>').appendTo(document.body)),$("div",d).html('Вы действительно хотите удалить карту "'+c+'"?'),this._$dialogRemoveMap=d.dialog(Gis.Util.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){e.removeMap(a,b),d.dialog("close")}},{text:"Нет",click:function(){d.dialog("close")}}]})),this._$dialogRemoveMap.dialog("open")},skSelected:function(a){return this._containerController.getUIAttached().getGeoConverter().isNeedZone(a)&&"fix"===a.split(Gis.UI.CoordinateConverter.DELIMETER)[2]?(this.showActiveZoneDialog(a),!0):(this._containerController.getUIAttached().getGeoConverter().setActiveSystem(a),!1)},_createSkList:function(){var a=this._containerController.getUIAttached().getGeoConverter();this._skPost=Gis.HTML.listView({data:this._getSkValues(),container:$("#gis-sk-selector",this._$list)[0],onBeforeSelect:this.skSelected,context:this,defaultValue:{val:a.getFullSystemSelectedKey().replace(/_\|_(\d+)/g,"_|_fix"),name:a.getFullSystemName()}})},_getMapValues:function(){var a=this._containerController.getUIAttached().getMap().getMapList();return a.sort(function(a,b){var c=b.title.toLowerCase(),d=a.title.toLowerCase();return d>c?1:c>d?-1:0}),a.map(function(a){return{val:a.key,name:a.title}})},_createMapsList:function(){var a=this._containerController.getUIAttached().getMap().getSelectedMapKey(),b=a&&this._containerController.getUIAttached().getMap().getSelectedMap(a),c=a||"",d=b&&b.getTitle()||"";this._listMaps=Gis.HTML.listView({data:this._getMapValues(),container:$("#gis-maps-container",this._$list)[0],callback:this.mapSelected,context:this,defaultValue:{val:c,name:d}})},_recalculatePost:function(a){a&&a.target&&"post"===a.target.getType()&&this._createPostList()},mapSelected:function(a){this._containerController.getUIAttached().getMap().setMapType(a,!0)},_createZoomList:function(){var a;a=this.getConvertedZoom(),this._listZoom=Gis.HTML.listView({data:this._getZoomValues(),container:$("#gis-widget-control-zoom-selector",this._$list)[0],callback:this.zoomSelected,context:this,defaultValue:{val:this._containerController.getUIAttached().getMap().getZoom(),name:a}})},_tileLayerChanged:function(){this._createZoomList(),this._checkRemoveButtonAvailable()},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.MapControl.CLASS_NAME),this.setWidth(),this._$list=$(this._generateControlsHtml()),this._$div.append(this._$list),this._$statusConnection=$("#gis-widget-control-status-connection",this._$list),this._createZoomList(),this._createPostList(),this._createMapsList(),this._createSkList(),this.updateStatusConnection(),this._setMousePosition(this._containerController.getUIAttached().getMap().getCenter())},postSelected:function(a){var b=this._containerController.getUIAttached().getMap().getLayer(a);this._deinitCenterOnObject(),this._initCenterOnPost(b)},_getPostValues:function(){var a=[],b=this._containerController.getUIAttached().getMap(),c=b.getLayerIDs();return c.forEach(function(c){var d=b.getLayer(c);"post"===d.getType()&&a.push({val:c,name:d.getName()||c})}),a},updateDataZoom:function(){this._listZoom.setValueSelected(this._containerController.getUIAttached().getMap().getZoom())},updateDataPosition:function(a){this._setMousePosition(a.latLng)},_setMousePosition:function(a){var b,c=this.coordinateToTemplate(a),d=this._containerController.getUIAttached().getGeoConverter(),e=d.isMetric(d.getSelectedSystem());b=e?"<span>"+this._HTMLRowName()+': <span class="value-x">'+c.x+" </span></span><span>"+this._HTMLRowName(!0)+': <span class="value-y">'+c.y+"</span></span>":"<span>"+this._HTMLRowName(!0)+': <span class="value-y">'+c.y+" </span></span><span>"+this._HTMLRowName()+': <span class="value-x">'+c.x+"</span></span>",$("#gis-widget-control-mouse-position",this._$div).html(b)},_deinitCenterOnPost:function(){this._lastPostSelected&&(this._lastPostSelected.off("change",this._centerFromPost,this),$("#gis-post-center",this._$div).removeClass("active"),this._postCentered=!1)},_initCenterOnPost:function(a){var b=a.getLatLng();b&&b[0]&&b[1]&&(this._deinitCenterOnPost(),this._deinitCenterOnObject(),this._listPost.setValueSelected(a.getId()),this._lastPostSelected=a,a.on("change",this._centerFromPost,this),this._containerController.getUIAttached().getMap().setCenter(b,!0),$("#gis-post-center",this._$div).addClass("active"),this._postCentered=!0)},_deinitCenterOnObject:function(){this._lastSelected&&(this._lastSelected.off("change",this._centerFromLayer,this),$("#gis-object-center",this._$div).removeClass("active"),this._objectCentered=!1)},_initCenterOnObject:function(a){this._deinitCenterOnObject(),this._deinitCenterOnPost(),this._lastSelected=a,a.on("change",this._centerFromLayer,this),this._containerController.getUIAttached().getMap().setCenter(a.getCenter()),$("#gis-object-center",this._$div).addClass("active"),this._objectCentered=!0},_recalculateMaps:function(){this._createMapsList()},_setSelected:function(a){switch(a.type){case"unselectlayer":this._layerSelected===a.layer&&(this._layerSelected=void 0);break;case"selectlayer":this._layerSelected=a.layer}},_deInitEvents:function(){var a=this._containerController.getUIAttached(),b=a.getMap();b.off("zoomend",this.updateDataZoom,this),b.off("mousemove",this.updateDataPosition,this),b.off("statuschanged",this.updateStatusConnection,this),this._$div.off("click","#gis-control-zoom-in",this._zoomIn),this._$div.off("click","#gis-control-zoom-out",this._zoomOut),this._$div.off("click","#gis-object-center",this._centerObject),a.off("sizerecalculated",this.setWidth,this),b.off("layerremoved layeradded",this._recalculatePost,this),b.off("maplistchanged tilelayerchanged",this._recalculateMaps,this),b.off("tilelayerchanged",this._tileLayerChanged,this),a.on("selectlayer unselectlayer",this._setSelected,this),this._$div.off("click","#gis-remove-map",this._removeMap),this._$div.off("click","#gis-add-map",this._addMap),this._deinitCenterOnObject(),this._$div.tooltip("destroy"),Gis.Widget.Base.prototype._deInitEvents.call(this)},_getFirstSelected:function(){if(this._layerSelected)return this._layerSelected;var a,b,c=this._containerController.getUIAttached().getMap();return b=c.getSelected(),a=Object.keys(b)[0],b=a&&b[a]},updateStatusConnection:function(a){var b=a&&a.target,c=b&&b.getStatus()||0;this._$statusConnection.html('<div class="server-status server-status-'+c+'"></div>');var c=Gis.Widget.MapControl.STATUS_TEXT[c]&&Gis.Widget.MapControl.STATUS_TEXT[c](b);this._$statusConnection.attr("title",(c||"")+". "+Gis.moduleName.ru+": "+Gis.version)},_initEvents:function(){var a=this._containerController.getUIAttached(),b=a.getMap();b.on("zoomend",this.updateDataZoom,this),b.on("mousemove",this.updateDataPosition,this),b.on("statuschanged",this.updateStatusConnection,this),this._$div.on("click","#gis-control-zoom-in",this._zoomIn),this._$div.on("click","#gis-control-zoom-out",this._zoomOut),this._lastSelected=this._getFirstSelected(),this._$div.on("click","#gis-object-center",this._centerObject),this._$div.on("click","#gis-post-center",this._centerPost),this._$div.on("click","#gis-remove-map",this._removeMap),this._$div.on("click","#gis-add-map",this._addMap),b.on("layerremoved layeradded",this._recalculatePost,this),a.on("selectlayer unselectlayer",this._setSelected,this),b.on("maplistchanged tilelayerchanged",this._recalculateMaps,this),b.on("tilelayerchanged",this._tileLayerChanged,this),a.on("sizerecalculated",this.setWidth,this),Gis.Widget.Base.prototype._initEvents.call(this),this._$div.tooltip({track:!0})},draw:function(){Gis.Widget.Base.prototype.draw.call(this)}}),Gis.Widget.MapControl.STATUS_TEXT={0:function(){return"Активное соединение отсутствует"},1:function(a){return"Соединение с сервером "+a.getDomain()+" установлено"},2:function(a){return"Выполняется соединение с сервером "+a.getDomain()}},Gis.Widget.MapControl.CLASS_NAME="gis-widget-mapcontrol",Gis.Widget.mapcontrol=function(a){return new Gis.Widget.MapControl(a)},function(){"use strict";function a(a,b){var c,d,e,f,g,h,i,j=$(a);if(a){var k,l=j.data("layer-id");k=this._containerController.getUIAttached().getMap().getLayer(l),this._containerController.getUIAttached().fire("selectlayer",{layer:k}),j[b?"addClass":"removeClass"]("selected"),b&&(i=a.getBoundingClientRect(),h=i.height,f=this._filteredList[0].getBoundingClientRect().top,c=this._filteredList.scrollTop(),e=this._filteredList.height(),d=i.top,(f>d||d+h>=f+e)&&(g=f+e/2-d-h/2,this._filteredList.scrollTop(c-g)))}}function b(a){var b=this;$(".gis-row-layer",this._$list).not($(a)).each(function(){var a,c=$(this).data("layer-id");a=b._containerController.getUIAttached().getMap().getLayer(c),b._containerController.getUIAttached().fire("unselectlayer",{layer:a})}),$(".gis-row-layer",this._$list).not($(a)).removeClass("selected")}Gis.Widget.Scheme=Gis.Widget.Base.extend({includes:Gis.Widget.ZoomBehavior,_type:"scheme",_buttons:{},options:{position:"right_inner",enabled:!0},selectRow:a,unSelectRows:b,getNeedSize:function(){return[this._$div.outerWidth(!0),200]},initialize:function(a){function b(a){var b,d,e,f,g,h,i,j=[];a=a||"data.json";var k=c._containerController.getUIAttached();b=k.getMap(),d=b.getLayerIDs(),d.forEach(function(a){e=b.getLayer(a),Gis.Widget.Scheme.TYPES.indexOf(e.getType())>-1&&!b.getRenderer().isLayerHided(e)&&j.push(e)}),h=JSON.stringify(j,null,"    "),i="text/plain;charset="+document.characterSet,window.WebKitBlobBuilder?(f=new WebKitBlobBuilder,f.append(h),g=f.getBlob(i)):g=new Blob([h],{type:i}),saveAs(g,a)}var c=this;Gis.Widget.Base.prototype.initialize.call(this,a),this._layerDblClicked=function(){var a,b,d=$(this).data("layer-id");return a=c._containerController.getUIAttached().getMap().getLayer(d),a&&(b=a.getCenter(),b&&c._containerController.getUIAttached().getMap().setCenter(b)),!1},this._layerClicked=function(){var a,b=$(this).data("layer-id");return a=c._containerController.getUIAttached().getMap().getLayer(b),a&&(c.unSelectRows(this),c.selectRow(this,!0),a.isSelectable()&&a.fire("select",{force:!0})),!1},this._actionClicked=function(a){var b,d=$(this).data(),e=$(this).parent().parent().data("layer-id");switch(b=c._containerController.getUIAttached().getMap().getLayer(e),d.action){case"delete":try{Gis.UI.DeleteActions[b.getType()]&&Gis.UI.DeleteActions[b.getType()].call(c,{srcElement:{}},b)}catch(a){Gis.Logger.log("Error delete",a.message,a.stack)}}return!1},this.isCollapsed=function(){return!c.$_middle.is(":visible")},this._collapse=function(){var a=c.isCollapsed()?"block":"none";c.$_middle.css({display:a}),c.$_header.css({display:a}),c.isCollapsed()?(Gis.Widget.Scheme.needHeight=function(){return c._$div.outerHeight(!0)},c.$_collapse.addClass("collapsed")):(Gis.Widget.Scheme.needHeight=Gis.Widget.Scheme.needHeightNormal,c.$_collapse.removeClass("collapsed")),c._containerController.getUIAttached()._recalculateContainerStyles()},this._saveAllClick=function(){var a=c._containerController.getUIAttached().getMap();if(!$(this).hasClass("disabled"))if(Gis.Util.isCellNet())try{var d,e,f=[];d=a.getLayerIDs(),d.forEach(function(b){e=a.getLayer(b),Gis.Widget.Scheme.TYPES.indexOf(e.getType())>-1&&!a.getRenderer().isLayerHided(e)&&f.push(e)}),cellnet.savejson(JSON.stringify(f,null,"    "))}catch(g){alert(g)}else{var h,i=$("#dialog-save-file-name");i.length||(i=$('<div id="dialog-save-file-name"><h3>Укажите имя файла для сохранения</h3><input id="file-name-user" type="text"/></div>'),i.appendTo($(document.body))),i.dialog({dialogClass:"no-title-bar",autoOpen:!1,modal:!0,width:280,closeOnEscape:!0,minHeight:10,draggable:!0,buttons:[{text:"Сохранить",click:function(){b($("input",$(this)).val()||"data.json"),$(this).dialog("close")}},{text:"Отменить",click:function(){$(this).dialog("close")}}]}),h=a.getLayerIDs(),h&&h.length&&($("input",i).val("data.json"),i.dialog("open"),$("input",i).select())}},this._fileChange=function(){var a,b,d=c._containerController.getUIAttached();a=d.getMap(),b=this.files[0],this.value="";var e=new FileReader;e.onload=function(a){return function(b){var c;try{c=JSON.parse(b.target.result),Gis.Util.fillMapFromObject(a,c)}catch(d){Gis.Logger.log("Некорректные данные в файле",b.target.result,d.stack)}}}(a),e.readAsText(b,"utf-8")},this._fileClick=function(){if(Gis.Util.isCellNet()){var a=c._containerController.getUIAttached().getMap(),b=cellnet.loadjson();return b&&a.fillObjects(b),!1}},this._typeClicked=function(){c._setTypeOpen($(this).parent().data("type-id"))},this.allClearClick=function(){$(this).hasClass("disabled")||c._deleteLayersConfirm()},this.filterTypeSelected=function(a){a=a||Gis.Widget.Scheme.TYPE_FILER_ALL,c._selectedType=a;var b=this._containerController.getUIAttached().getMap(),d=a===Gis.Widget.Scheme.TYPE_FILER_ALL?function(a){return Gis.Widget.Scheme.TYPES.indexOf(a.getType())>-1&&!b.getRenderer().isLayerHided(a)}:function(c){return c.getType()===a&&!b.getRenderer().isLayerHided(c)};c._fillList(d,a)},this.filterTypeClear=function(){c.filterTypeSelected(),c._listTypes.setValueSelected(Gis.Widget.Scheme.TYPE_FILER_ALL)}},_deleteLayersConfirm:function(){var a=$(".dialogMapClear"),b=this._containerController.getUIAttached().getMap();a.length||(a=$('<div class="dialogMapClear" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Подтверждение очистки карты</h2><div style="margin-top: 10px">Вы действительно хотите очистить карту?</div><div style="margin-top: 10px; padding-top: 5px; border-top: 1px solid #ffffff;"><input type="checkbox" style="margin-right: 10px;" name="delete-owner"  id="delete-owner" /><label for="delete-owner">Удалить созданные оператором объекты</label></div></div>').appendTo(document.body)),this._$dialogRemoveMap=a.dialog(Gis.Util.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){b.clearMap(function(a){return a.isEditableByUser()?!1:(a.isMetaData()&&a.clearMeta(),!a.isMetaData())},!0),$("#delete-owner",a).is(":checked")&&b.clearMap(function(a){return a.isEditableByUser()?(a.isMetaData()&&a.clearMeta(),!a.isMetaData()):!1}),a.dialog("close")}},{text:"Нет",click:function(){a.dialog("close")}}]})),this._$dialogRemoveMap.dialog("open")},removeFuncFilter:function(a){return a&&a.isEditableByUser()&&Gis.Widget.Scheme.TYPES.indexOf(a.getType())>-1},clearAll:function(){this._containerController.getUIAttached().getMap().clearMap(this.removeFuncFilter)},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a),this.draw(),this.setBounds()},_getFirstSelected:function(){var a,b,c=this._containerController.getUIAttached().getMap();return b=c.getSelected(),a=Object.keys(b)[0],b=a&&b[a]},_postCenterHtml:function(){return"<div class='gis-control-square-button' id='gis-post-center'><span></span></div><div class='post-list'></div>"},_footerHtml:function(){return'<div><div class="gis-widget-button" id="gis-collapse" title=\'Свернуть\'></div>'+(this.isControlAvailable("schemesaveall")?"<div class='gis-widget-button' id='gis-save-all' title='Сохранить всю топосхему'></div>":"")+(this.isControlAvailable("schemeload")?"<div class='gis-widget-button' id='gis-load-all' title='Загрузить топосхему из файла'><input type='file' title='' name='file'></div>":"")+(this.isControlAvailable("schemeclear")?"<div class='gis-widget-button' id='gis-clear-all' title='Очистить карту'></div>":"")+"</div>"},_contentHtml:function(){return"<ul id='gis-list-filtered'></ul>"},_headerHtml:function(){return"<div><div class='gis-widget-button' id='gis-show-all' title='Показать все'><span></span></div><div id='gis-show-filter'></div></div>"},_generateControlsHtml:function(){var a="<ul class='gis-widget-scheme'>";return a+="<li class='gis-scheme-element gis-map-header'>"+this._headerHtml()+"</li>",a+="<li class='gis-scheme-element gis-map-middle'>"+this._contentHtml()+"</li>",a+="<li class='gis-scheme-element gis-map-footer'>"+this._footerHtml()+"</li>",a+="</ul>"},_getTypeValues:function(){var a,b,c,d,e=[],f=[{val:Gis.Widget.Scheme.TYPE_FILER_ALL,name:"Все"}];return a=this._containerController.getUIAttached().getMap(),b=a.getLayerIDs(),b.forEach(function(b){d=a.getLayer(b),c=d.getType(),e.indexOf(c)<0&&Gis.Widget.Scheme.TYPES.indexOf(c)>=0&&!a.getRenderer().isLayerHided(d)&&(f.push({val:c,name:Gis.Widget.Scheme.TYPE_NAMES[c]}),e.push(c))}),-1===e.indexOf(this._openedType)&&(this._openedType=void 0),f},_getRowsFiltered:function(a){var b,c,d,e,f={};return b=this._containerController.getUIAttached().getMap(),c=b.getLayerIDs(),c.forEach(function(c){e=b.getLayer(c),d=e.getOriginalType(),d===e.getType()&&a(e)&&(f[d]=f[d]||[],f[d].push(e))}),f},_skChanged:function(){this.filterTypeSelected(this._selectedType),Gis.Widget.Base.prototype._skChanged.call(this)},drawIcon:function(a){var b,c,d,e,f=a.getOptionsWithStyle();if(a&&("source"===a.getType()||"post"===a.getType())&&(e=f.icon))if("div"===this.tagName.toLowerCase()){if(b=new Kinetic.Stage({container:this,width:24,height:24}),d=24,"source"===a.getType()&&f.bearingStyle){d=18;var g=f.bearingStyle.getDash(),h=new Kinetic.Layer,i=new Kinetic.Line({points:[0,24,24,0],stroke:f.bearingStyle.getColor(),shadowColor:f.bearingStyle.getBorder(),strokeWidth:f.bearingStyle.getThickness(),dash:g&&g.split(","),lineCap:"round",lineJoin:"round"});h.add(i),b.add(h)}c=new Kinetic.Layer({scale:d/24}),b.add(c),Gis.Additional.Icon[e.getType()](e.getOption("color")||"black",d,c.getCanvas()._canvas),$(c.getCanvas()._canvas).css({width:d,height:d,top:(24-d)/2,left:(24-d)/2})}else this.src=e.getImageUrl()},_drawIcons:function(){var a,b=this._containerController.getUIAttached().getMap(),c=this;$(".ico-preview",this._filteredList).each(function(){a=b.getLayer($(this).data("id")),c.drawIcon.call(this,a)})},getRowActions:function(a){return"<div class='actions'><div class='action delete  "+this._editableClass(a)+" gis-widget-button' title='Удалить' data-action='delete'></div></div>"},_selectedClass:function(a,b){return a&&a.getId()===b.getId()?"selected":""},_editableClass:function(a){return this.isDataEditable(a)&&a.isEditableByUser()?"":""},_generateRow:function(a){return"<li class='gis-row-layer "+this._selectedClass(this._getFirstSelected(),a)+"' data-layer-id='"+a.getId()+"'>"+this.getRowActions(a)+'<div class="row-name">'+this._generateRowName(a)+"</div></li>"},_fillList:function(a,b){var c,d,e,f,g="",h=this._getRowsFiltered(a),i=Gis.Widget.Scheme.TYPE_FILER_ALL!==b;for(c in h)if(h.hasOwnProperty(c)){var j=i?"":"<span>"+Gis.Widget.Scheme.TYPE_NAMES[c]+"</span>";for(g+="<li class='gis-type gis-type-"+c+" "+(this._openedType&&this._openedType===c?"selected":"")+"' data-type-id='"+c+"'>"+j+"<ul>",d=0,e=h[c].length;e>d;d+=1)f=h[c][d],g+=this._generateRow(f);g+="</ul></li>"}this._filteredList.html(g),this._drawIcons(),i&&this._openedType!==b&&this._setTypeOpen(b)},_getFilterSelected:function(a){var b,c;if(this._selectedType){for(a=a||this._getTypeValues(),b=0,c=a.length;c>b;b+=1)if(a[b].val===this._selectedType)return this._selectedType;this._selectedType=void 0}},_createTypeList:function(){var a=this._getTypeValues(),b=this._getFilterSelected(a)||Gis.Widget.Scheme.TYPE_FILER_ALL;this._listTypes=Gis.HTML.listView({data:a,container:$("#gis-show-filter",this._$list)[0],callback:this.filterTypeSelected,context:this,defaultValue:{val:b,name:Gis.Widget.Scheme.TYPE_NAMES[b]}})},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.Scheme.CLASS_NAME),this._$div.css({position:"absolute"}),this._$list=$(this._generateControlsHtml()),this._filteredList=$("#gis-list-filtered",this._$list),this._$div.append(this._$list),this._createTypeList(),this.$_middle=$(".gis-map-middle",this._$list),this.$_header=$(".gis-map-header",this._$list),this.$_footer=$(".gis-map-footer",this._$list),this.$_collapse=$("#gis-collapse",this.$_footer),this.$_save=$("#gis-save-all",this.$_footer),this.$_clean=$("#gis-clear-all",this.$_footer)},setBounds:function(){var a,b;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=this.isCollapsed()?this._$div.outerHeight(!0):Math.min(b/2,300),this.$_middle.css({height:a-this.$_header.outerHeight(!0)-this.$_footer.outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height()}),this._$div.css({top:b-a})},_setTypeOpen:function(a){a?($(".gis-type.selected",this._$list).not($(".gis-type-"+a,this._$list)).removeClass("selected"),this._openedType!==a?$(".gis-type-"+a,this._$list).addClass("selected"):($(".gis-type-"+a,this._$list).removeClass("selected"),a=void 0)):$(".gis-type.selected",this._$list).removeClass("selected"),this._openedType=a},_layerEvent:function(a){var b=this,c={layerunselected:function(a){var c;c=$(".gis-row-layer.selected",b._$list),c.data("layer-id")===a.layer.getId()&&b.selectRow(c,!1)},layerselected:function(a){var c=a.layer.getParentId()||a.layer.getId();$(".gis-row-layer.selected",this._$list).removeClass("selected"),$(".gis-row-layer",this._$list).each(function(){c===$(this).data("layer-id")&&Gis.Widget.Scheme.TYPES.indexOf(a.layer.getType())>=0&&(a.layer.getType()!==b._openedType&&b._setTypeOpen(a.layer.getType()),b.unSelectRows(this),b.selectRow(this,!0))})},layerchanged:function(a){if(!b._layerNotForScheme(a)){var c=$("[data-layer-id="+a.target.getId()+"]",b._$div),d=$(this._generateRow(a.target));if(c.replaceWith(d),d.length>0){var e=$(".ico-preview",d);e.length>0&&b.drawIcon.call(e[0],a.target)}}}};c[a.type]&&c[a.type].call(this,a)},_deInitEvents:function(){Gis.Widget.Base.prototype._deInitEvents.call(this);var a=this._containerController.getUIAttached().getMap();a.off("layerremoved layeradded",this._recalculateList,this),a.off("layerremoved layeradded",this._checkButtonsActive,this),a.getRenderer().off("layervisibilitychanged",this._recalculateList,this),a.getRenderer().off("layervisibilitychanged",this._checkButtonsActive,this),this._$list.off("dblclick",".gis-row-layer",this._layerDblClicked),this._$list.off("click",".gis-row-layer",this._layerClicked),this._$list.off("click",".gis-type > span",this._typeClicked),this.$_middle.off("click",".actions .action",this._actionClicked),this._$list.off("click","#gis-show-all",this.filterTypeClear),this._$list.off("click","#gis-collapse",this._collapse),this._$list.off("click","#gis-save-all",this._saveAllClick),this._$list.off("change","#gis-load-all > input",this._fileChange),this._$list.off("change","#gis-load-all > input",this._fileChange),this._$list.off("click","#gis-load-all > input",this._fileClick),this._$list.off("click","#gis-clear-all",this.allClearClick),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this),this._containerController.getUIAttached().getMap().off("layerselected layerunselected layerchanged",this._layerEvent,this),this._$div.tooltip("destroy")},_layerNotForScheme:function(a){return a&&a.target&&a.target.getType&&(-1===Gis.Widget.Scheme.TYPES.indexOf(a.target.getType())||!a.target.isControllableByServer())},_recalculateList:function(a){this._layerNotForScheme(a)||(this._createTypeList(),this.filterTypeSelected(this._selectedType),this.afterUpdate())},_checkButtonsActive:function(){var a=this._containerController.getUIAttached().getMap(),b=a.getLayerIDs(),c=b.filter(function(b){var c=a.getLayer(b);return!a.getRenderer().isLayerHided(c)&&Gis.Widget.Scheme.TYPES.indexOf(c.getType())>-1});0==c.length?(this.$_save.addClass("disabled"),this.$_clean.addClass("disabled")):(this.$_save.removeClass("disabled"),this.$_clean.removeClass("disabled"))},_initEvents:function(){Gis.Widget.Base.prototype._initEvents.call(this);var a=this._containerController.getUIAttached().getMap();a.on("layerremoved layeradded",this._recalculateList,this),a.on("layerremoved layeradded",this._checkButtonsActive,this),a.getRenderer().on("layervisibilitychanged",this._recalculateList,this),a.getRenderer().on("layervisibilitychanged",this._checkButtonsActive,this),this._$list.on("dblclick",".gis-row-layer",this._layerDblClicked),this._$list.on("click",".gis-row-layer",this._layerClicked),this.$_middle.on("click",".actions .action",this._actionClicked),this._$list.on("click",".gis-type > span",this._typeClicked),this._$list.on("click","#gis-save-all",this._saveAllClick),this._$list.on("click","#gis-collapse",this._collapse),this._$list.on("change","#gis-load-all > input",this._fileChange),this._$list.on("click","#gis-load-all > input",this._fileClick),this._$list.on("click","#gis-clear-all",this.allClearClick),this._$list.on("click","#gis-show-all",this.filterTypeClear),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this),this._containerController.getUIAttached().getMap().on("layerselected layerunselected layerchanged",this._layerEvent,this),this._$div.tooltip({items:".gis-row-layer",track:!0,content:function(){var b=$(this),c=a.getLayer(b.data("layer-id"));return c?c.getFormatedDescription():""}})},afterUpdate:function(){Gis.Widget.Base.prototype.afterUpdate.call(this)}}),Gis.Widget.Scheme.TYPE_FILER_ALL="-1",Gis.Widget.Scheme.TYPE_NAMES={overlay:"Оверлэй",source:"ИРИ",post:"Пост",ellipse:"Элипс",path:"Маршрут",polygon:"Полигон",sector:"Сектор",image:"Иконка",text:"Маркер"},Gis.Widget.Scheme.TYPE_NAMES[Gis.Objects.HeatMap.prototype.options.tacticObjectType]="Температурная карта",Gis.Widget.Scheme.TYPES=["overlay","source","post",Gis.Objects.HeatMap.prototype.options.tacticObjectType,"ellipse","path","polygon","sector","image","text"],Gis.Widget.Scheme.CLASS_NAME="gis-widget-scheme-container",Gis.Widget.Scheme.TYPE_NAMES[Gis.Widget.Scheme.TYPE_FILER_ALL]="Все",Gis.Widget.scheme=function(a){return new Gis.Widget.Scheme(a)},Gis.Widget.Scheme.needHeightNormal=function(a){return Math.min(a/2,300)},Gis.Widget.Scheme.needHeight=Gis.Widget.Scheme.needHeightNormal,Gis.Widget.Scheme.include(Gis.UI.TitleGenerators)}(this),Gis.Widget.SliderBase=Gis.Widget.Base.extend({_type:null,options:{step:.01,position:null,enabled:!0},getNeedSize:function(){return[50,this._$div.outerHeight(!0)]},initialize:function(a){var b=this;Gis.Widget.Base.prototype.initialize.call(this,a),this._decrease=function(){b._increase(1)}},_increase:function(){Gis.extendError()},getSliderValue:function(){return-parseFloat(this._slider.slider("value"))},getStep:function(){return parseFloat(this._slider.slider("option","step"))},getMapPixelBounds:function(){var a,b,c,d=this._containerController.getUIAttached().getMap(),e=d.getMapProvider();return a=d.getMaxBounds(),b=a&&a.getSouthWest()||Gis.latLng(-90,-180),c=a&&a.getNorthEast()||Gis.latLng(85,180),new Gis.Bounds(e.project(c),e.project(b))},getCalculatedStep:function(){Gis.extendError()},setBounds:function(){Gis.extendError()},_setValue:function(){Gis.extendError()},_setMaximum:function(){Gis.extendError()},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();a.off("moveend zoomend",this._setValue,this),a.off("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._$div.off("click",".gis-latitude-previous",this._increase),this._$div.off("click",".gis-latitude-next",this._decrease),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();
this._$div.on("click",".gis-latitude-previous",this._increase),this._$div.on("click",".gis-latitude-next",this._decrease),a.on("moveend zoomend",this._setValue,this),a.on("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this)}}),Gis.Widget.SliderVertical=Gis.Widget.SliderBase.extend({_type:"slidervertical",options:{step:.01,position:"right",enabled:!0},getNeedSize:function(){return[this._$div.outerWidth(!0),50]},initialize:function(a){var b=this;Gis.Widget.SliderBase.prototype.initialize.call(this,a),this._increase=function(a){a=Gis.Util.isNumeric(a)&&a||-1;var c,d,e=b._containerController.getUIAttached().getMap();c=e.getCenter(),d=e.getMapProvider(),e.setCenter(d.unproject(Gis.point(d.project(c).x,b.getSliderValue()+b.getStep()*a)))}},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a);var b,c=this._containerController.getUIAttached().getMap(),d=c.getMapProvider(),e=this;b=this.getMapPixelBounds(),this.draw(),this.setBounds(),this._slider=$("#scroll-bar",this._$div).slider({orientation:"vertical",step:this.getCalculatedStep(),start:function(){var a=c.getCenter();e._x=d.project(a).x,e._slided=!0},stop:function(){e._slided=!1,e._x=null},min:-b.getBottomLeft().y,max:-b.getTopRight().y,value:-d.project(c.getCenter()).y,slide:function(a,b){var f=c.getCenter();c.setCenter(d.unproject(Gis.point(e._x||d.project(f).x,-b.value)),!0)}}),this._init=!0},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.SliderVertical.CLASS_NAME),this._$div.append("<div><div class='gis-widget-button gis-latitude-previous'></div><div id='scroll-bar'></div><div class='gis-widget-button gis-latitude-next'></div></div>")},setBounds:function(){var a;a=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,this._$div.css({height:a}),$("#scroll-bar",this._$div).css({height:this._$div.height()-($(">div",this._$div).outerHeight(!0)-$(">div",this._$div).height())})},getCalculatedStep:function(){var a=this.getMapPixelBounds();return(a.getBottomLeft().y-a.getTopRight().y)/(100*this._containerController.getUIAttached().getMap().getZoom()+1)},_setValue:function(){if(!this._slided&&this._init){var a=this._containerController.getUIAttached().getMap(),b=a.getMapProvider();$("#scroll-bar",this._$div).slider("value",-b.project(a.getCenter()).y)}},_setMaximum:function(){var a,b=this._containerController.getUIAttached().getMap(),c=b.getMapProvider();a=this.getMapPixelBounds(),this._init&&$("#scroll-bar",this._$div).slider("option",{min:-a.getBottomLeft().y,max:-a.getTopRight().y,step:this.getCalculatedStep()||this.options.step,value:-c.project(b.getCenter()).y})}}),Gis.Widget.SliderVertical.CLASS_NAME="gis-widget-sliderVertical-container",Gis.Widget.sliderVertical=function(a){return new Gis.Widget.SliderVertical(a)},Gis.Widget.slidervertical=Gis.Widget.sliderVertical,Gis.Widget.SliderHorisontal=Gis.Widget.SliderBase.extend({_type:"sliderhorisontal",options:{step:.01,position:"bottom",enabled:!0},initialize:function(a){var b=this;Gis.Widget.SliderBase.prototype.initialize.call(this,a),this._increase=function(a){a=Gis.Util.isNumeric(a)&&a||-1;var c,d,e=b._containerController.getUIAttached().getMap();c=e.getCenter(),d=e.getMapProvider(),e.setCenter(d.unproject(Gis.point(b.getSliderValue()-b.getStep()*a,d.project(c).y)))}},getSliderValue:function(){return parseFloat(this._slider.slider("value"))},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a);var b,c=this._containerController.getUIAttached().getMap(),d=this,e=c.getMapProvider();b=this.getMapPixelBounds(),this.draw(),this.setBounds(),this._slider=$("#scroll-bar-h").slider({orientation:"horizontal",step:this.getCalculatedStep(),start:function(){var a=c.getCenter();d._y=e.project(a).y,d._slided=!0},stop:function(){d._slided=!1,d._y=null},min:b.getBottomLeft().x,max:b.getTopRight().x,value:e.project(c.getCenter()).x,slide:function(a,b){var f=c.getCenter();c.setCenter(e.unproject(Gis.point(b.value,d._y||e.project(f).y)),!0)}}),this._init=!0},getCalculatedStep:function(){var a=this.getMapPixelBounds();return(a.getTopRight().x-a.getBottomLeft().x)/(100*this._containerController.getUIAttached().getMap().getZoom()+1)},_setMaximum:function(){var a=this._containerController.getUIAttached().getMap(),b=a.getMapProvider(),c=this.getMapPixelBounds();this._init&&$("#scroll-bar-h",this._$div).slider("option",{min:c.getBottomLeft().x,max:c.getTopRight().x,value:b.project(a.getCenter()).x,step:this.getCalculatedStep()||this.options.step})},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.SliderHorisontal.CLASS_NAME),this._$div.append("<div><div class='gis-widget-button gis-longitude-previous'></div><div id='scroll-bar-h'></div><div class='gis-widget-button gis-longitude-next'></div></div>")},_setValue:function(){if(!this._slided&&this._init){var a=this._containerController.getUIAttached().getMap(),b=a.getMapProvider();$("#scroll-bar-h",this._$div).slider("value",b.project(a.getCenter()).x)}},setBounds:function(){var a;a=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).width,this._$div.css({width:a})},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();a.off("moveend zoomend",this._setValue,this),a.off("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._$div.off("click",".gis-longitude-previous",this._decrease),this._$div.off("click",".gis-longitude-next",this._increase),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();this._$div.on("click",".gis-longitude-previous",this._decrease),this._$div.on("click",".gis-longitude-next",this._increase),a.on("moveend zoomend",this._setValue,this),a.on("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this)}}),Gis.Widget.SliderHorisontal.CLASS_NAME="gis-widget-sliderHorisontal-container",Gis.Widget.sliderHorisontal=function(a){return new Gis.Widget.SliderHorisontal(a)},Gis.Widget.sliderhorisontal=Gis.Widget.sliderHorisontal,Gis.Widget.ListPoints={_skChanged:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;a&&(e=this._containerController.getUIAttached().getGeoConverter(),c=a.oldTemplate,b=a.oldSk,d=e.getSelectedSystem(),h=$("#points-selector li",this._$div),l=e.isMetric(d),k=e.isMetric(b)!==l,h.each(function(){var a,h,o=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,$(this)),p=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,$(this)),q=n._getPoint($(this));i=q&&q.getLatLng(),j=i&&n.coordinateToTemplate(i),k&&(m=p.parent().parent(),l?m.insertBefore(o.parent().parent()):m.insertAfter(o.parent().parent())),f=e.convert(b,d,n.getPointValue(p,null,b,c),n.getPointValue(o,null,b,c)),g=e.convert(b,d,n.getPointValue(p,!0,b,c),n.getPointValue(o,!0,b,c)),a=Gis.UI.coordinate(n._rowChanged(p)?f.x:j?j.x:f.x,n._rowChanged(o)?f.y:j?j.y:f.y),h=Gis.UI.coordinate(n._rowChanged(p)?g.x:j?j.x:g.x,n._rowChanged(o)?g.y:j?j.y:g.y),n.setHtmlPointSelectorWidgetData($(this),a,h)})),Gis.Widget.Propertys.prototype._skChanged.call(this)}},Gis.Widget.Propertys=Gis.Widget.Base.extend({_type:"propertys",_defaultColor:"#FFFFFF",_defaultStyle:{color:"#AF2D51",border:"white",selectedBorder:"rgb(75, 84, 255)",thickness:2,icon:{type:"circle",color:"#AF2D51"}},options:{position:"right_inner",enabled:!0,dataBinded:void 0},checkNumeric:function(a){var b=!1;return $.isNumeric(this.getPointValue(a))?a.removeClass("error"):(b=!0,a.addClass("error")),b},getNeedSize:function(){return[this._$div.outerWidth(!0),200]},checkCoordinate:function(a){var b=!1;return""!==a.val()&&$.isNumeric(this._containerController.getUIAttached().getGeoConverter().coordinateFromTeplate(this.getPointValue(a)))?a.removeClass("error"):(b=!0,a.addClass("error")),b},checkPoint:function(a){var b=!1,c=this.getPointWidgetData(a);return""===c.x?(b=!0,$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a).addClass("error")):""===c.y?(b=!0,$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,a).addClass("error")):$("."+Gis.Widget.Base.POSITION_VALUE_CLASS,a).removeClass("error"),b},_maskInput:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=b.getCurrentMask(),d=b.getCurrentMask(!0),e=function(){var a=$(this).parent().parent(),b=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a);b.length||(b=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a.parent())),b.focus()},f=function(){var a=$(this).parent().parent().parent(),b=a.next();b.length&&$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,b).focus()};!a&&c?$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,this._$div).each(function(){$(this).mask(c,{completed:f,replacement:"0"})}):$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,this._$div).unmask(),!a&&c?$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,this._$div).mask(d,{completed:e,replacement:"0"}):$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,this._$div).unmask()},_rowChanged:function(a){return a=$(a),this.getPointValue(a)!==this.getPointValue(a,!0)},_setValue:function(a,b,c){return a.data("is-point")?this.setHtmlPointValue(a,b,c):(a=$(a),b=void 0==b?"":b,a.val(b),void 0!=c&&a.data("old-val",c),this)},bindData:function(a){this.options.dataBinded!==a&&(this.options.dataBinded=a,this._update())},_hilightErrors:function(){},_generateKeyPressFunction:function(a,b){return function(c){(c.keyCode===a||c.charCode===a+"")&&b(),c.stopPropagation()}},generateEskeyFunction:function(a){var b=27;return this._generateKeyPressFunction(b,a)},generateEnteredFunction:function(a){var b=13;return this._generateKeyPressFunction(b,a)},_updateState:function(){this._updateButtonState(),this._updateCoordinatesState(),this._updateColorState(),this._updateTypeState(),this._updateParamsState(),this._hilightErrors()},isStyleChanged:function(){return this.getSelectedStyle()!=this.getValueFromData("getTag",null,"style")},getValueFromData:function(a,b){return this.options.dataBinded?this.options.dataBinded[a].apply(this.options.dataBinded,Array.prototype.slice.call(arguments,2,arguments.length)):b},initialize:function(a){var b=this;Gis.Widget.Base.prototype.initialize.call(this,a),this._paramClickFunction=this._paramClickFunction||function(){var a=$(this);!a.hasClass("selected")&&b.isDataEditable()&&($(".gis-param-selector.selected",a.parent()).not(a).removeClass("selected"),a.addClass("selected"),b.fire("change"))},this._CustomColorChanged=this._CustomColorChanged||function(a,c,d,e){var f=e&&$(e)||$(".gis-color-custom",b._$div),g="rgba("+d.r+", "+d.g+","+d.b+", 0.8)";$(".gis-param-selector.selected",f.parent()).not(f).removeClass("selected"),f.addClass("selected"),f.data("color",g),$("span",f).css("background",g),b.fire("change")}},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.Propertys.CLASS_NAME),this._$div.append(this.initDataBlock()),this._$div.append(this.initButtonsBlock())},onRemove:function(){Gis.Widget.Base.prototype.onRemove.call(this)},onAdd:function(a){this.options.hasOwnProperty("colors")&&(this.options.colors=this.options.colors||a.getUIAttached().getStyle("predefinedColors")),Gis.Widget.Base.prototype.onAdd.call(this,a),this.draw(),this.setBounds()},initDataBlock:function(){Gis.extendError()},initButtonsBlock:function(){Gis.extendError()},_mapClicked:function(){Gis.extendError()},updateData:function(){Gis.extendError()},_saveData:function(){Gis.extendError()},_setData:function(){Gis.extendError()},isButtonEnable:function(a){return!Gis.HTML.hasClass(a,"disabled")},switchButtonState:function(a,b){b?a.removeClass("disabled"):a.addClass("disabled")},switchInputState:function(a){var b=Array.prototype.slice.call(arguments,1);b.forEach(a?function(a){a.removeAttr("disabled")}:function(a){a.attr("disabled","disabled")})},_HTMLstyleSelector:function(a){var b,c="";return b=this._containerController.getUIAttached().getMap().getStylesByObjectType(this._type),this._typeSelector&&b&&b.length&&(c='<div><p class="data-title">'+(a||"Тип")+'</p><div id="gis-ui-style-selector"></div></div>'),c},styleSelected:function(){this._updateState()},onBeforeStyleOpen:function(a){return!$(">.disabled",a).length},getSelectedColor:function(){return $(".gis-color-button.selected",this._$div).data("color")},_updateParamsState:function(){},_updateColorState:function(){this.switchButtonState($(".gis-color-button",this._$div),this.isDataEditable())},_updateCoordinatesState:function(){this.switchButtonState($(".gis-color-button",this._$div),this.isDataEditable())},_updateTypeState:function(){this.switchButtonState($(".html-select-view-container",this._$div),this.isDataEditable())},_updateStyle:function(){this._styleList&&this._styleList.setValueSelected(this.options.dataBinded&&this.options.dataBinded.getTag("style")||"deffaultValue")},getSelectedStyle:function(){var a=this._styleList&&this._styleList.getValueSelected();return"deffaultValue"!==a?a:null},_getStyleValues:function(){var a,b=[],c=this._containerController.getUIAttached().getMap(),d=c.getStylesByObjectType(this._type),e=d.length;for(b.push({val:"deffaultValue",name:"Стиль"}),a=0;e>a;a+=1)b.push({val:d[a],name:c.getStyle(d[a]).getStyleName()});return b},_updateStyleList:function(){var a=this.options.dataBinded&&this.options.dataBinded.getStyle();this._styleList=Gis.HTML.listView({data:this._getStyleValues(),container:$("#gis-ui-style-selector",this._$div)[0],callback:this.styleSelected,onBeforeOpen:this.onBeforeStyleOpen,context:this,defaultValue:{val:a&&a.getStyleId()||"deffaultValue",name:a&&a.getStyleName()||"Стиль полигона"}})},_HTMLcolorSelector:function(a,b,c){var d,e=!1;return d="",b=b||this.options.dataBinded&&this.options.dataBinded.getBackColor&&this.options.dataBinded.getBackColor(),this.options.colors.forEach(function(c,f){e=e||c===b,d+="<li class='gis-propertys-button gis-color-button"+(a&&c===b||!b&&!f?" selected":"")+" gis-param-selector' data-color='"+c+"'><span style='background: "+c+";'></span></li>"}),a&&!e&&b?d+="<li class='gis-propertys-button gis-color-button gis-param-selector selected "+($(document.body).ColorPicker?"gis-color-custom":"")+"' data-color='"+b+"'><span style='background: "+b+";'></span></li>":!c&&$(document.body).ColorPicker&&(d+="<li class='gis-propertys-button gis-color-button gis-param-selector gis-color-custom' data-color='"+this._defaultColor+"' value='"+this._defaultColor+"'><span style='background: "+this._defaultColor+";'></span></li>"),"<ul class='gis-color-list '>"+d+"</ul>"},_HTMLtypeSelector:function(a,b){var c,d=!1;return c="",b=b||this.options.dataBinded&&this.options.dataBinded.getImageType&&this.options.dataBinded.getImageType(),this.options.types.forEach(function(e){d=d||e===b,c+="<li class='gis-propertys-button gis-image-type-button"+(a&&e===b?" selected":"")+" gis-param-selector gis-image-type-"+e+"' data-type='"+e+"'><span></span></li>"}),a&&!d&&b&&(c+="<li class='gis-propertys-button gis-image-type-button gis-param-selector selected' data-type='"+b+" gis-image-type-"+b+"' ><span></span></li>"),"<ul class='gis-image-type-list '>"+c+"</ul>"},_deleteKeyFire:function(){},_revertTextData:function(a){return a=$(a),a.data("is-point")?(this.setHtmlPointValue(a,this.getPointValue(a,!0)),this):(a.val(a.data("old-val")),this)},setBounds:function(){var a,b,c,d;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Math.min(b/2,300),c=$("#points-selector",this._$div),d=c.parent(),$(".gis-widget-propertys-wraper, .gis-widget-propertys-buttons-wraper",this._$div).not(d).each(function(){a-=$(this).outerHeight(!0)}),a-=c.outerHeight(!0)-c.height()+d.outerHeight(!0)-d.height()+$(".gis-widget-propertys-title",d).outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height(),c.css({maxHeight:Math.max(a,40)})},_initEvents:function(){var a=this;Gis.Widget.Base.prototype._initEvents.call(this),this._mapKeyUp=this._mapKeyUp||function(b){var c=8,d=46,e=b.keyCode||parseInt(b.charCode,10);(e===c||e===d)&&a._deleteKeyFire(b)},this._mapKeyPress=this._mapKeyPress||function(a){var b=8,c=a.keyCode||parseInt(a.charCode,10);return"text"!==(a.srcElement||a.target).type&&c===b?(a.preventDefault(),!1):void 0},this._containerController.getUIAttached().getMap().on("click",this._mapClicked,this),document.body.addEventListener("keydown",this._mapKeyPress),document.body.addEventListener("keyup",this._mapKeyUp),$(this._$div).on("click",".gis-param-selector",this._paramClickFunction),this.on("change",this._updateState,this),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this),this._activateColorPicker(),this._$div.tooltip({track:!0}),this._maskInput()},_destroyColorPicker:function(a){a=a||this._$div,$(document.body).ColorPickerDestroy&&$(".gis-color-custom",a).length&&$(".gis-color-custom",this._$div).ColorPickerDestroy({color:$(".gis-color-custom span",a).css("background")||this._defaultColor,onSubmit:this._CustomColorChanged,onChange:this._CustomColorChanged})},_activateColorPicker:function(a){a=a||this._$div,$(document.body).ColorPicker&&$(".gis-color-custom",a).length&&this.isDataEditable()&&$(".gis-color-custom",this._$div).ColorPicker({color:$(".gis-color-custom span",a).css("background")||this._defaultColor,onSubmit:this._CustomColorChanged,onChange:this._CustomColorChanged})},_updateColor:function(a){this._destroyColorPicker(),$(".gis-color-list",this._$div).replaceWith(a||this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor())),this._activateColorPicker()},_skChanged:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;a&&this._$Xrow&&this._$Yrow&&(e=this._containerController.getUIAttached().getGeoConverter(),b=a.oldSk,d=a.oldTemplate,l=e.getSelectedSystem(),e.isMetric(b)!==e.isMetric(l)&&(m=this._$Xrow.parent().parent(),e.isMetric(l)?m.insertBefore(this._$Yrow.parent().parent()):m.insertAfter(this._$Yrow.parent().parent())),c=l,h=this.options.dataBinded&&this.options.dataBinded.getLatLng(),i=h&&this.coordinateToTemplate(h),f=e.convert(b,c,this.getPointValue(this._$Xrow,null,b,d),this.getPointValue(this._$Yrow,null,b,d)),g=e.convert(b,c,this.getPointValue(this._$Xrow,!0,b,d),this.getPointValue(this._$Yrow,!0,b,d)),j=Gis.UI.coordinate(this._rowChanged(this._$Xrow)?f.x:i?i.x:f.x,this._rowChanged(this._$Yrow)?f.y:i?i.y:f.y),k=Gis.UI.coordinate(this._rowChanged(this._$Xrow)?g.x:i?i.x:g.x,this._rowChanged(this._$Yrow)?g.y:i?i.y:g.y),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,j,k)),Gis.Widget.Base.prototype._skChanged.call(this),this._maskInput()},_deInitEvents:function(){Gis.Widget.Base.prototype._deInitEvents.call(this),this.off("change",this._updateState,this),this._containerController.getUIAttached().getMap().off("click",this._mapClicked,this),document.body.removeEventListener("keydown",this._mapKeyPress),document.body.removeEventListener("keyup",this._mapKeyUp),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this),$(this._$div).off("click",".gis-param-selector",this._paramClickFunction);try{this._$div.tooltip("destroy")}catch(a){Gis.Logger.log(a.message)}this._destroyColorPicker(),this._maskInput(!0)},activate:function(){this._initEvents()},deactivate:function(){this._deInitEvents()},draw:function(){$(this.container).prepend(this._$div),this._initEvents()},_update:function(){Gis.extendError()},keyPressPreventDefault:function(a){a.stopPropagation()},_buttonHTML:function(a,b,c,d){return b=b||"",d=d||Gis.Widget.Propertys.titles[a]||"","<button title='"+d+"' class='"+Gis.Widget.Propertys.BUTTON_CLASS_NAME+" "+(c?"":"disabled")+" "+a+(b?" gis-button-with-text":"")+"'><span class='gis-button-icon'></span><span class='gis-button-text'>"+b+"</span></button>"}}),Gis.Widget.Propertys.CLASS_NAME="gis-widget-propertys",Gis.Widget.Propertys.DATA_WRAPER_CLASS="gis-widget-propertys-wraper",Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS="gis-widget-propertys-buttons-wraper",Gis.Widget.Propertys.DATA_BLOCK_CLASS="gis-widget-propertys-data",Gis.Widget.Propertys.DATA_TITLE_CLASS="gis-widget-propertys-title",Gis.Widget.Propertys.BUTTON_CLASS_NAME="gis-propertys-button",Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME="gis-propertys-button-delete",Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME="gis-propertys-button-deselect",Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME="gis-propertys-button-return",Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME="gis-propertys-button-revert",Gis.Widget.Propertys.titles={},Gis.Widget.Propertys.titles[Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME]="Удалить",Gis.Widget.Propertys.titles[Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME]="Снять выделение",Gis.Widget.Propertys.titles[Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME]="Отменить изменения",Gis.Widget.propertys=function(a){return new Gis.Widget.Propertys(a)},Gis.Widget.EllipseProperty=Gis.Widget.Propertys.extend({_typeSelector:!0,_type:"ellipse",_history:[],options:{types:void 0,colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.types=this.options.types||[],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){var a;this._isStateChanged()?(this._revertTextData(this._$Xrow),this._revertTextData(this._$Yrow),this._revertTextData(this._$R1row),this._revertTextData(this._$R2row),this._revertTextData(this._$AngleRow),this.options.dataBinded&&this._updateStyle()):(a=this._history.pop(),a&&this._setData(a.text,a.center,a.color)),this.updateData()},_setData:function(a,b){var c,d=this.getValueFromData("getAlpha",""),e=this.getValueFromData("getBetta",""),f=this.getValueFromData("getGamma",0);b=b||this.getValueFromData("getLatLng",null),c=this.options.dataBinded&&this.coordinateToTemplate(b)||Gis.UI.coordinate("",""),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,c,c),this._setValue(this._$R1row,d,d),this._setValue(this._$R2row,e,e),this._setValue(this._$AngleRow,f,f)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.getValueFromData("getColor","",!0)))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),a=a||this.checkNumeric(this._$R1row),a=a||this.checkNumeric(this._$R2row),a=a||this.checkNumeric(this._$AngleRow),$(".gis-color-button.selected",this._$div).data("color")||(a=!0),a},_updateCoordinatesState:function(){this.isDataEditable()&&this.getValueFromData("isDraggable",!0)?(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled")):(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled"))},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$R1row,this._$R2row,this._$AngleRow)},updateData:function(){this._setData(),this._pressed||this._updateColor(),this._updateState(),this.afterUpdate()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.EllipseProperty.CLASS_NAME),this._$Xrow=$("#ellipse-x",this._$div),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Yrow=$("#ellipse-y",this._$div),this._$R1row=$("#ellipse-r1",this._$div),this._$R2row=$("#ellipse-r2",this._$div),this._$AngleRow=$("#ellipse-angle",this._$div),this._updateStyleList()},initDataBlock:function(){var a=this.getValueFromData("getLatLng",null),b=this.getValueFromData("getAlpha",""),c=this.getValueFromData("getBetta",""),d=this.getValueFromData("getGamma",""),e=this.coordinateToTemplate(a),f=e.x||"",g=e.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Координаты</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:f,y:g,xID:"ellipse-x",yID:"ellipse-y",yClass:"ellipse-input",xClass:"ellipse-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row'><span>Радиус 1:</span>"+this._HTMLRowInput(b,"ellipse-r1","ellipse-input","Радиус по оси горизонтали")+"</li>\n<li class='data-row'><span>Радиус 2:</span>"+this._HTMLRowInput(c,"ellipse-r2","ellipse-input","Радиус по оси вертикали")+"</li>\n<li class='data-row'><span>Угол поворота:</span>"+this._HTMLRowInput(d,"ellipse-angle","ellipse-input","Угол поворота по часовой стрелке относительно вертикальной оси")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector("Предустановки")+"</div></div>\n</div>\n"},_onMouseDown:function(a){this._cleared=!0,this._pressed=!0,this.options.dataBinded&&(this._cleared=!1,this._containerController.getUIAttached().getMap().unselectLayer(this.options.dataBinded)),this._startPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude)},_drawFromDrag:function(a,b){var c,d;this._cleared&&this._currentPoint&&this._startPoint&&(c=this._startPoint.distanceTo(Gis.latLng(this._startPoint.lat,this._currentPoint.lng)),d=this._startPoint.distanceTo(Gis.latLng(this._currentPoint.lat,this._startPoint.lng)),a&&(c=d=Math.max(c,d)),this._saveData({x:this._startPoint.lng,y:this._startPoint.lat,r1:c,r2:d,angle:0,skipServerMessage:b}),this.updateData())},_onMouseMove:function(a){this._pressed&&this._cleared&&(this._moved=!0,this._currentPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude),this._drawFromDrag(a.originalEvent.shiftKey,!0))},_finishDrawFromDrag:function(){this._cleared=!1,this._startPoint=void 0,this._currentPoint=void 0},fireServerEvent:function(){this.options.dataBinded&&this.options.dataBinded.fire("change",{target:this.options.dataBinded,rows:["alpha","betta","gamma","latitude","longitude","fill"]})},_onMouseUp:function(){this._pressed&&this._cleared&&this.fireServerEvent(),this._moved=!1,this._pressed=!1,this._finishDrawFromDrag()},_onMouseOut:function(){this._moved=!1,this._pressed=!1,this._finishDrawFromDrag()},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новый",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$R1row)||this._rowChanged(this._$R2row)||this._rowChanged(this._$AngleRow)||this.options.dataBinded&&this.options.dataBinded.getColor(!0)!==this.getSelectedColor(),a=a||this.options.dataBinded&&this.getSelectedStyle()!==this.options.dataBinded.getTag("style")},_updateButtonState:function(){var a,b;this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),b=this._isStateChanged(),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b)},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_saveData:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||{},f=a.x||m.x,g=a.y||m.y,h=a.r1||this._$R1row.val(),i=a.r2||this._$R2row.val(),j=a.color||$(".gis-color-button.selected",this._$div).data("color")||this.options.dataBinded&&this.options.dataBinded.getColor(!0),k=void 0!==a.angle&&$.isNumeric(a.angle)?a.angle:this._$AngleRow.val(),d={color:this.getSelectedColor()},Gis.Util.isNumeric(f)&&Gis.Util.isNumeric(g)&&j&&Gis.Util.isNumeric(k)&&i&&h?(c={alpha:h,betta:i,gamma:k,latitude:g,longitude:f,fill:d,tags:{style:this.getSelectedStyle()}},!a.forceNew&&this.options.dataBinded?this.options.dataBinded.setData(c,null,a.skipServerMessage):(l=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("ellipse")),e={color:l.color,border:l.border,thickness:l.thickness},b=Gis.ellipse(Gis.Util.extend({},c,{draggable:!0,selectable:!0,line:e})),b.setSelectedStyle(Gis.Util.extend({},e,{border:l.selectedBorder})),b.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(b)),this._update()):this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions.ellipse.call(this,a)},_mapClicked:function(){},_deInitEvents:function(){var a;$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),a=this._containerController.getUIAttached().getMap(),a.off("mouseup",this._onMouseUp,this),a.off("mousedown",this._onMouseDown,this),a.off("mousemove",this._onMouseMove,this),a.off("mouseout",this._onMouseOut,this),a.off("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b,c=this;this._returnFunction=this._returnFunction||function(){c.isButtonEnable(this)&&c._saveData()},this._deleteFunction=this._deleteFunction||function(a){c.isButtonEnable(this)&&c._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){c.fire("change"),a.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){c.fire("change")},this._revertFunction=this._revertFunction||function(){c.isButtonEnable(this)&&c.back()},this._deselectFunction=this._deselectFunction||function(){c.isButtonEnable(this)&&c._containerController.getUIAttached().getMap().unselectLayer(c.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(c._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(c._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||a(c._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(c._revertFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),b=this._containerController.getUIAttached().getMap(),b.on("mouseup",this._onMouseUp,this),b.on("mousedown",this._onMouseDown,this),b.on("mousemove",this._onMouseMove,this),b.on("mouseout",this._onMouseOut,this),b.on("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._initEvents.call(this)
},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a||this._cleared||(this._cleared=!0),a!==this.options.dataBinded&&(this._newColor=void 0,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this._updateStyleList(),this.updateData())}}),Gis.UI.DeleteActions.ellipse=function(a,b){var c=this;"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить эллипс?",callback:function(){c.removeLayerFromMap(b||c.options.dataBinded)},context:this,id:"ellipse-remove-dialog"},b)},Gis.Widget.EllipseProperty.CLASS_NAME="gis-widget-propertys-ellipse",Gis.Widget.EllipseProperty.CENTER_CHANGED=1,Gis.Widget.EllipseProperty.TEXT_CHANGED=3,Gis.Widget.EllipseProperty.BOTH_CHANGED=2,Gis.Widget.EllipseProperty.NOT_CHANGED=0,Gis.Widget.ellipseProperty=function(a){return new Gis.Widget.EllipseProperty(a)},Gis.Widget.MarkerProperty=Gis.Widget.Propertys.extend({_history:[],_type:"marker",_defaultStyle:{foreColor:"#ffffff",position:"centerright",drawPoint:!0},options:{colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){var a,b;this._isStateChanged()?(b=this.getPointWidgetData(this._$CoordinateContainer,!0),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,b.x,b.y),this._$TEXTrow.val(this._$TEXTrow.data("old-val")),this.options.dataBinded&&(this._newColor=this.options.dataBinded.getBackColor()),this._updateStyle()):(a=this._history.pop(),a&&this._setData(a.text,a.center,a.color)),this.updateData()},_setData:function(a,b){var c;b=b||this.options.dataBinded&&this.options.dataBinded.getLatLng(),a=a||this.options.dataBinded&&this.options.dataBinded.getText()||"",c=this.coordinateToTemplate(b),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,c,c),this._setValue(this._$TEXTrow,a,a)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),""===this._$TEXTrow.val()?(a=!0,this._$TEXTrow.addClass("error")):this._$TEXTrow.removeClass("error"),a},_updateCoordinatesState:function(){this.isDataEditable()&&this.getValueFromData("isDraggable",!0)?(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled")):(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled"))},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$TEXTrow)},updateData:function(){this._setData(),this._updateColor(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&a[b[0]].getType()===Gis.UI.Action.Marker.type&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.MarkerProperty.CLASS_NAME),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Xrow=$("#marker-x",this._$div),this._$Yrow=$("#marker-y",this._$div),this._$TEXTrow=$("#marker-text",this._$div)},initDataBlock:function(){var a=this.options.dataBinded&&this.options.dataBinded.getLatLng()||"",b=this.options.dataBinded&&this.options.dataBinded.getText()||"",c=this.coordinateToTemplate(a),d=c.x||"",e=c.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Метка</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:d,y:e,xID:"marker-x",yID:"marker-y",yClass:"marker-input",xClass:"marker-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row data-title'><span>Текст:</span></li>\n<li class='data-row'><input type='text' data-old-val='"+b+"' id='marker-text' class='marker-input' value='"+b+"'/></li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0)+"</div>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$TEXTrow)||this.getSelectedColor()&&this.options.dataBinded&&this.options.dataBinded.getBackColor(!0)!==this.getSelectedColor()},_updateButtonState:function(){var a,b;this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),b=this._isStateChanged(),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новая",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b)},_initDialogClose:function(){var a,b=this;return a=$("#marker-remove-dialog"),a.length||(a=$('<div id="marker-remove-dialog"/>'),a.appendTo($(document.body))),a.dialog($.extend(this._dialogOptions,{buttons:[{text:"OK",click:function(){b.removeLayerFromMap(b.options.dataBinded),$(this).dialog("close")}},{text:"Отменить",click:function(){$(this).dialog("close")}}]})),a},_initDialogNew:function(){var a,b=this;return a=$("#marker-new-dialog"),a.length||(a=$('<div id="marker-new-dialog"/>'),a.append("<div><span class='dialog-label'>Цвет метки</span>"+this._HTMLcolorSelector(!1,null,!0)+"</div>"),a.append("<div><span class='dialog-label'>Текст метки</span><input type='text' id='dialog-new-marker-text'/></div>"),a.appendTo($(document.body)),$(a).on("click",".gis-color-button",function(){var b=$(this);b.hasClass("selected")||($(".gis-color-button.selected",a).removeClass("selected"),b.addClass("selected"))}),$(a).on("dialogclose",function(){var a=$(this);$(".gis-color-button.selected",a).removeClass("selected"),$("#dialog-new-marker-text",a).val("")})),a.dialog($.extend(this._dialogOptions,{buttons:[{text:"OK",click:function(){var c,d,e;e=$(this),c=$(".gis-color-button.selected",e).data("color"),d=$("#dialog-new-marker-text",e).val(),c&&""!==d&&(b._saveData(a.latlng.lng,a.latlng.lat,d,c,!0),$(this).dialog("close"))}},{text:"Отменить",click:function(){$(this).dialog("close")}}]})),a},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_opedDialogNewLabel:function(a){this._$dialogNew=this._$dialogNew||this._initDialogNew(),this._$dialogNew.latlng=a,this._$dialogNew.dialog("open")},_saveData:function(a,b,c,d,e){var f,g,h=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||h.x,b=b||h.y,c=c||this._$TEXTrow.val(),Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(b)&&""!==c?(d=d||this.getSelectedColor()||this.options.dataBinded.getBackColor(),!e&&this.options.dataBinded?this.options.dataBinded.setData({backColor:d,caption:c,latitude:b,longitude:a}):(g=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("marker")),f=Gis.textLabel({className:"gis-ui-marker",foreColor:g.foreColor,position:g.position,drawPoint:g.drawPoint,caption:c,latitude:b,longitude:a,backColor:d,draggable:!0,selectable:!0}),f.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(f)),this._update()):this._updateState()},_mapClicked:function(a){this._opedDialogNewLabel(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_deleteKeyFire:function(a){Gis.UI.DeleteActions.marker.call(this,a)},_deInitEvents:function(){$(this._$div).off("click",".gis-color-button",this._colorClickFunction),$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b=this;this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b._saveData()},this._deleteFunction=this._deleteFunction||function(a){b.isButtonEnable(this)&&b._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){b._updateState(),a.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._deselectFunction=this._deselectFunction||function(){b.isButtonEnable(this)&&b._containerController.getUIAttached().getMap().unselectLayer(b.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||a(b._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),this._colorClickFunction=this._colorClickFunction||function(){var a=$(this);a.hasClass("selected")||($(".gis-color-button.selected",b._$div).removeClass("selected"),a.addClass("selected"),b._newColor=a.data("color"),b._updateState())},this._$div.on("click",".gis-color-button",this._colorClickFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a!==this.options.dataBinded&&(this._newColor=void 0,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&(this._newColor=a.getBackColor(),a.on("change",this.updateData,this)),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions.marker=function(a,b){"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить метку?",callback:function(){this._containerController.getUIAttached().getMap().removeLayer(b||this.options.dataBinded)},context:this,id:"marker-remove-dialog"},b)},Gis.UI.DeleteActions.text=Gis.UI.DeleteActions.marker,Gis.Widget.MarkerProperty.CLASS_NAME="gis-widget-propertys-marker",Gis.Widget.MarkerProperty.CENTER_CHANGED=1,Gis.Widget.MarkerProperty.TEXT_CHANGED=3,Gis.Widget.MarkerProperty.BOTH_CHANGED=2,Gis.Widget.MarkerProperty.NOT_CHANGED=0,Gis.Widget.markerProperty=function(a){return new Gis.Widget.MarkerProperty(a)},Gis.Widget.MeasureProperty=Gis.Widget.Propertys.extend({includes:Gis.Widget.PointBehavior,_history:[],_type:"measure",_historyValues:[],_path:void 0,_defaultStyle:{color:"black",border:"white",thickness:"white",icon:{width:10,type:"circle"}},options:{colors:void 0},_updateHistory:function(){var a,b=this;this._history=[],this._historyValues=[],a=$("#points-selector li",this._$div),a.each(function(){b._history.push(this),b._historyValues.push({x:b.getPointValue($(".marker-x",$(this))),y:b.getPointValue($(".marker-y",$(this)))})})},back:function(){var a,b,c=this;this._isStateChanged()&&(!this._history||this._history.length<2?$("#points-selector li",this._$div).filter(function(d){return 2>d?(a=c._historyValues[d]?c._historyValues[d].x:"",b=c._historyValues[d]?c._historyValues[d].y:"",c.setHtmlPointSelectorWidgetData($(this),Gis.UI.coordinate(a,b),Gis.UI.coordinate(a,b)),!1):!0}).remove():($("#points-selector li",this._$div).not(this._history).remove(),this._history.forEach(function(d,e){$("#points-selector ol",c._$div).append($(d)),a=c._historyValues[e]?c._historyValues[e].x:"",b=c._historyValues[e]?c._historyValues[e].y:"",c.setHtmlPointSelectorWidgetData($(d),Gis.UI.coordinate(a,b),Gis.UI.coordinate(a,b))}))),this._updateState()},_clearInfo:function(){this._$infoContainer.remove(),this._$infoContainer=void 0},_clearMeasure:function(){var a=this;this._containerController.getUIAttached().getMap().removeLayer(this._path),this._deInitPathEvents(),$("#points-selector li",this._$div).not(function(b){var c=$(this);return 2>b?(a.setHtmlPointSelectorWidgetData(c,Gis.UI.coordinate("",""),Gis.UI.coordinate("","")),a._detachPointDataFromRow(c),this):!1}).remove(),this._updateHistory(),this._clearInfo(),this._updateState(),this._path=void 0},_setData:function(){},_hilightErrors:function(){var a,b,c,d=!1,e=this;return a=$("#points-selector li",this._$div),this._pointsCalculated=[],a.each(function(){b=$(".marker-x",$(this)),c=$(".marker-y",$(this)),d=d||e.checkPoint($(this))}),d},updateData:function(){this._setData(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.MeasureProperty.CLASS_NAME)},setBounds:function(){var a,b,c,d,e,f,g;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$("#points-selector",this._$div),e=$("#info-data",this._$div),d=c.parent(),$(".gis-widget-propertys-buttons-wraper",this._$div).each(function(){a-=$(this).outerHeight(!0)}),a-=c.outerHeight(!0)-c.height()+d.outerHeight(!0)-d.height()+$(".gis-widget-propertys-title",d).outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height(),g=e.parent().outerHeight(!0)-e.height(),f=a/2-g,c.css({maxHeight:Math.max(f,40)}),e.css({maxHeight:a-c.height()-g})},_xyRowHTML:function(){return"<li class='data-row'>\n"+this._HTMLPointSelectorWidget({tag:"span",yClass:"marker-input marker-y",xClass:"marker-input marker-x"})+"<span class='gis-widget-ico gis-widget-ico-up'></span><span class='gis-widget-ico gis-widget-ico-down'></span><span class='gis-widget-ico gis-widget-ico-remove'></span><span class='gis-widget-ico gis-widget-ico-add'></span>\n</li>\n"},initDataBlock:function(){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='points-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Точки</div>\n<div id='points-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ol>\n"+this._xyRowHTML()+this._xyRowHTML()+"</ol>\n<div class='gis-widget-add-to-end'><span class='gis-widget-ico gis-widget-ico-add'></span></div></div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){var a,b=!1,c=this;return a=$("#points-selector li",this._$div),c._history.length&&c._history.length!==a.length?!0:(a.each(function(a){var d=$(this),e=$(".marker-x",d),f=$(".marker-y",d);b=b||c._rowChanged(e)||c._rowChanged(f)||c._history[a]&&this!==c._history[a]}),b)},_updateButtonState:function(){var a=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),this.switchButtonState(this._$buttonNew,a&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,a),this.switchButtonState(this._$buttonDelete,this._path&&this._containerController.getUIAttached().getMap().getLayer(this._path.getId())),this.switchButtonState(this._$buttonRevert,a)},_getLastClearPoint:function(){var a,b,c,d,e;for(a=$("#points-selector li",this._$div),b=a.length-1;b>=0&&(c=$(".marker-x",a[b]),d=$(".marker-y",a[b]),""===c.val()&&""===d.val());b-=1)""===c.val()&&""===d.val()&&(e=a[b]);return e||(e=$(this._xyRowHTML()),$("#points-selector ol",this._$div).append(e),this._maskInput()),e},_insertNewPoint:function(a){var b,c,d=this._getLastClearPoint();a=this.coordinateToTemplate(a),b=a.x||"",c=a.y||"",this.setHtmlPointSelectorWidgetData(d,Gis.UI.coordinate(b,c),Gis.UI.coordinate(b,c))},_mapClicked:function(a){this._insertNewPoint(Gis.latLng(a.latLng.latitude,a.latLng.longitude)),this._calculateMeasuring(this._history.length===$("#points-selector li",this._$div).length&&this._path&&this._containerController.getUIAttached().getMap().hasLayer(this._path)),this._updateState()},_calculatePointData:function(a,b){var c,d,e,f;return a&&b?(e=this.templateToCoordinate(this.getPointValue($(".marker-x",$(a))),this.getPointValue($(".marker-y",$(a)))),f=this.templateToCoordinate(this.getPointValue($(".marker-x",$(b))),this.getPointValue($(".marker-y",$(b)))),c=Gis.latLng(e.y,e.x),d=Gis.latLng(f.y,f.x),{distance:c.distanceTo(d),angle:Gis.Projection.calculateAsimuth(c,d)}):void 0},_informationHTML:function(){var a="",b=0;return this._pointsCalculated&&this._pointsCalculated.length&&this._pointsCalculated.forEach(function(c,d){b+=c.distance,a+="<li class='gis-widget-info-row gis-widget-measure-info-row'><span class='title'>Длина "+(d+1)+"-"+(d+2)+":</span><span class='value'>"+c.distance.toFixed(2)+"</span></li><li class='gis-widget-info-row gis-widget-measure-info-row'><span class='title'>Угол "+(d+1)+"-"+(d+2)+":</span><span class='value'>"+c.angle.toFixed(2)+"</span></li>"}),a&&"<ul class='gis-widget-info gis-widget-measure-info'><li class='gis-widget-info-row gis-widget-measure-info-row'><span class='title'>Общая длина:</span><span class='value'>"+b.toFixed(2)+"</span></li>"+a+"</ul>"},_infoContainerHTML:function(a){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='info-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Информация</div>\n<div id='info-data' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>"+a+"</div>\n</div>\n"},_drawResultCalculation:function(){var a,b;b=this._informationHTML(),b&&(a=$(".gis-widget-measure-info",this._$div),a.length?a.replaceWith($(b)):(this._$infoContainer=$(this._infoContainerHTML(b)),this._$infoContainer.insertAfter($("."+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS,this._$div))),this.setBounds())},_updateDataFromPath:function(){var a,b,c,d,e,f,g=this._path.getPoints(),h=this;g&&(b=$("#points-selector li",this._$div),a=function(a,g){c=h.coordinateToTemplate(a.getLatLng()),d=$(b[g]),d&&(f=c.y||"",e=c.x||"",h.setHtmlPointSelectorWidgetData(d,Gis.UI.coordinate(e,f),Gis.UI.coordinate(e,f)),h._attachPointDataToRow(d,a,!0))},g.forEach(a),this._calculateMeasuring(!0))},_initPathEvents:function(){this._path&&!this._pathEventsInitialized&&(this._pathEventsInitialized=!0,this._path.on("change",this._updateDataFromPath,this),this._path.on("selected",this._layerSelected,this),this._path.on("unselected",this._layerUnSelected,this))},_deInitPathEvents:function(){this._path&&this._pathEventsInitialized&&(this._pathEventsInitialized=!1,this._path.off("change",this._updateDataFromPath,this),this._path.off("selected",this._layerSelected,this),this._path.off("unselected",this._layerUnSelected,this))},_getPathPoints:function(){return this._pathPoints.points},_drawPath:function(){var a,b;this._path?this._path.setData({points:this._getPathPoints()}):(b=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("measure")),a={color:b.color,border:b.border,thickness:b.thickness},this._path=Gis.path(Gis.Util.extend({tacticObjectType:"measurer",line:a,draggable:!0,selectable:!0,className:"gis-measure-marker",orthodrome:!0,icon:b.icon,points:this._getPathPoints()})),this._path.setControllableByServer(!1),this._path.setSelectedStyle(void 0)),this._containerController.getUIAttached().getMap().hasLayer(this._path)||this._path.addTo(this._containerController.getUIAttached().getMap()),this._initPathEvents()},_calculateMeasuring:function(a){var b,c;c=this,this._hilightErrors()||(b=$("#points-selector li",this._$div),this._pointsCalculated=[],this._pathPoints={points:[]},b.each(function(a){var d,e,f,g=$(this),h=$(".marker-y",g),i=$(".marker-x",g);d=b[a+1],""!==h.val()&&""!==i.val()&&(f=c.getPointWidgetData(g),e=c.templateToCoordinate(f.x,f.y),c.setHtmlPointSelectorWidgetData(g,f,f),c._attachPointDataToRow(g,{latitude:e.y,longitude:e.x,simplify:!0}),c._pathPoints.points.push(Gis.Util.extend(c._getPoint(g).objectData(),{latitude:e.y,longitude:e.x})),d&&c._pointsCalculated.push(c._calculatePointData(g,d)))}),!a&&c._pathPoints.points.length>=2&&this._drawPath(),c._pathPoints.points.length>=2&&this._drawResultCalculation(),this._updateHistory()),this._updateState()},_skChanged:Gis.Widget.ListPoints._skChanged,_layerSelected:function(a){var b,c,d=a.additional&&a.additional.markerKey;void 0!==d&&(c=$("#points-selector .data-row",this._$div),b=c[d],$(":focus").blur(),c.not(b).removeClass("selected"),b&&$(b).addClass("selected"))},_layerUnSelected:function(){var a;a=$("#points-selector .data-row",this._$div),a.removeClass("selected")},onRemove:function(){Gis.Widget.Propertys.prototype.onRemove.call(this),this._containerController.getUIAttached().getMap().removeLayer(this._path)},_deInitEvents:function(){this._deInitPathEvents(),this._$div.off("click",".gis-widget-ico-up",this._icoUpClick),this._$div.off("click",".gis-widget-ico-down",this._icoDownClick),this._$div.off("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.off("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.off("change",".data-row input, .data-row input",this._textRowChange),this._$div.off("keyup",".data-row input, .data-row input",this._textRowChange),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_removeRow:function(a){var b=a.parent();$(".data-row",b).length>2&&a.remove()},_deleteKeyFire:function(a){return"text"!==(a.srcElement||a.target).type&&$("#points-selector .data-row.selected",this._$div).length?(this._removeRow($("#points-selector .data-row.selected",this._$div)),this._updateState(),a.preventDefault(),!1):void 0},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a(),b.stopPropagation()}}var b=this;this._initPathEvents(),this._containerController.getUIAttached().getMap().on("layerselected",this._layerSelected,this),this._containerController.getUIAttached().getMap().on("layerunselected",this._layerUnSelected,this),this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b._calculateMeasuring()},this._icoUpClick=this._icoUpClick||function(){var a,c=$(this).parent();a=c.prev(),a.length&&c.insertBefore(a),b._updateState()},this._icoDownClick=this._icoDownClick||function(){var a,c=$(this).parent();a=c.next(),a.length&&a.insertBefore(c),b._updateState()},this._icoDeleteClick=this._icoDeleteClick||function(){var a=$(this).parent();b._removeRow(a),b._updateState()},this._icoPlusClick=this._icoPlusClick||function(){var a=$(this).parent();"li"===a[0].tagName.toLowerCase()?$(b._xyRowHTML()).insertBefore(a):$(b._xyRowHTML()).appendTo($("ol",a.parent())),b._maskInput(),b._updateState()},this._deleteFunction=this._deleteFunction||function(){b.isButtonEnable(this)&&b._clearMeasure()},this._textRowChange=this._textRowChange||function(){b._updateState()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._returnFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._deleteFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),this._$div.on("click",".gis-widget-ico-up",this._icoUpClick),this._$div.on("click",".gis-widget-ico-down",this._icoDownClick),this._$div.on("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.on("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.on("change",".data-row input, .data-row input",this._textRowChange),this._$div.on("keyup",".data-row input, .data-row input",this._textRowChange),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData(),$($("button",this._$div).not("[disabled=disabled]")[0]).focus()},bindData:function(){}}),Gis.Widget.MeasureProperty.CLASS_NAME="gis-widget-propertys-measure",Gis.Widget.MeasureProperty.CENTER_CHANGED=1,Gis.Widget.MeasureProperty.TEXT_CHANGED=3,Gis.Widget.MeasureProperty.BOTH_CHANGED=2,Gis.Widget.MeasureProperty.NOT_CHANGED=0,Gis.Widget.measureProperty=function(a){return new Gis.Widget.MeasureProperty(a)},Gis.Widget.ObjectProperty=Gis.Widget.Propertys.extend({_history:[],options:{types:void 0,colors:void 0},_type:"object",initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.types=this.options.types||["target","danger","circle","storm","simple"],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){var a;this._isStateChanged()?(this.revertHtmlPointSelectorWidgetData(this._$CoordinateContainer),this._$TEXTrow.val(this._$TEXTrow.data("old-val")),this.options.dataBinded&&(this._newColor=this.options.dataBinded.getImageColor())):(a=this._history.pop(),a&&this._setData(a.text,a.center,a.color)),this.updateData()},_setData:function(a,b){var c,d;b=this.coordinateToTemplate(b||this.options.dataBinded&&this.options.dataBinded.getLatLng()),a=a||this.options.dataBinded&&this.options.dataBinded.getPopup()||"",c=b.x||"",d=b.y||"",this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d)),this._setValue(this._$TEXTrow,a,a)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageColor()))},_updateType:function(){$(".gis-image-type-list",this._$div).replaceWith(this._HTMLtypeSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageType()))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),$(".gis-color-button.selected",this._$div).data("color")||(a=!0),a},_updateCoordinatesState:function(){this.isDataEditable()||!this.options.dataBinded||this.options.dataBinded.isDraggable()?(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled")):(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled"))},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$TEXTrow)},updateData:function(){this._setData(),this._updateColor(),this._updateType(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&"text"===a[b[0]].getType()&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.ObjectProperty.CLASS_NAME),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Xrow=$("#object-x",this._$div),this._$Yrow=$("#object-y",this._$div),this._$TEXTrow=$("#object-text",this._$div)},initDataBlock:function(){var a=this.options.dataBinded&&this.options.dataBinded.getLatLng()||"",b=this.options.dataBinded&&this.options.dataBinded.getPopup()||"",c=this.coordinateToTemplate(a),d=c.x||"",e=c.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Объект</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-row",x:d,y:e,xID:"object-x",yID:"object-y",yClass:"object-input",xClass:"object-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row data-title'><span>Комментарий:</span></li>\n<li class='data-row'>"+this._HTMLRowInput(b,"object-text","object-input")+"\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Пиктограмма</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"  gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageColor())+this._HTMLtypeSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageType())+"</div></div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"
},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$TEXTrow)||this.options.dataBinded&&(this.options.dataBinded.getImageColor()!==this.getSelectedColor()||this.options.dataBinded.getImageType()!==this.getSelectedType())},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новая",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b),this._$div.tooltip("close")},_initDialogNew:function(){var a,b=this;return a=$("#object-new-dialog"),a.length||(a=$('<div id="object-new-dialog"/>'),a.append("<div><span class='dialog-label'>Пиктограмма</span>"+this._HTMLtypeSelector(!1,this.options.dataBinded&&this.options.dataBinded.getImageType())+"</div>"),a.append("<div><span class='dialog-label'>Цвет объекта</span>"+this._HTMLcolorSelector(!1,this.options.dataBinded&&this.options.dataBinded.getImageColor(),!0)+"</div>"),a.append("<div><span class='dialog-label'>Комментарий</span><input type='text' id='dialog-new-object-text'/></div>"),a.appendTo($(document.body)),$(a).on("click",".gis-param-selector",function(){var a=$(this);a.hasClass("selected")||($(".gis-param-selector.selected",a.parent()).removeClass("selected"),a.addClass("selected"))}),$(a).on("dialogclose",function(){var a=$(this);$(".gis-param-selector.selected",a).removeClass("selected"),$("#dialog-new-object-text",a).val("")})),a.dialog({dialogClass:"no-title-bar",autoOpen:!1,closeOnEscape:!0,minHeight:10,minWidth:210,draggable:!0,modal:!0,buttons:[{text:"OK",click:function(){var c,d,e,f;f=$(this),c=$(".gis-color-button.selected",f).data("color"),e=$(".gis-image-type-button.selected",f).data("type"),d=$("#dialog-new-object-text",f).val(),c&&e&&(b._saveData(a.latlng.lng,a.latlng.lat,d,c,e,!0),$(this).dialog("close"))}},{text:"Отменить",click:function(){$(this).dialog("close")}}]}),a},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_opedDialogNewLabel:function(a){this._$dialogNew=this._$dialogNew||this._initDialogNew(),this._$dialogNew.latlng=a,this._$dialogNew.dialog("open")},_saveData:function(a,b,c,d,e,f){var g,h=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||h.x,b=b||h.y,c=c||this._$TEXTrow.val(),d=d||$(".gis-color-button.selected",this._$div).data("color")||this.options.dataBinded.getImageColor(),e=e||$(".gis-image-type-button.selected",this._$div).data("type")||this.options.dataBinded.getImageType(),Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(b)&&d&&e?(!f&&this.options.dataBinded?this.options.dataBinded.setData({icon:Gis.icon({type:e,color:d}),tooltip:c,latitude:b,longitude:a}):(g=Gis.imageLabel({tooltip:c,latitude:b,longitude:a,icon:Gis.icon({type:e,color:d}),draggable:!0,selectable:!0}),g.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(g)),this._update()):this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions.object.call(this,a)},_mapClicked:function(a){this._opedDialogNewLabel(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_deInitEvents:function(){$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b=this;this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b._saveData()},this._deleteFunction=this._deleteFunction||function(a){b.isButtonEnable(this)&&b._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){b._updateState(),a.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._deselectFunction=this._deselectFunction||function(){b.isButtonEnable(this)&&b._containerController.getUIAttached().getMap().unselectLayer(b.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||a(b._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a!==this.options.dataBinded&&(this._newColor=void 0,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions.object=function(a,b){var c=this;"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить объект?",callback:function(){c.removeLayerFromMap(b||c.options.dataBinded)},context:this,id:"object-remove-dialog"},b)},Gis.UI.DeleteActions.image=Gis.UI.DeleteActions.object,Gis.Widget.ObjectProperty.CLASS_NAME="gis-widget-propertys-object",Gis.Widget.ObjectProperty.CENTER_CHANGED=1,Gis.Widget.ObjectProperty.TEXT_CHANGED=3,Gis.Widget.ObjectProperty.BOTH_CHANGED=2,Gis.Widget.ObjectProperty.NOT_CHANGED=0,Gis.Widget.objectProperty=function(a){return new Gis.Widget.ObjectProperty(a)},Gis.Widget.PolylineProperty=Gis.Widget.Propertys.extend({_type:null,_typeSelector:!1,includes:Gis.Widget.PointBehavior,_history:[],_historyValues:[],_minimalPoints:2,options:{colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.dataBinded&&this._initPolylineEvents()},setBounds:function(){var a,b,c,d;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$("#points-selector",this._$div),d=c.parent(),$(".gis-widget-propertys-wraper, .gis-widget-propertys-buttons-wraper",this._$div).not(d).each(function(){a-=$(this).outerHeight(!0)}),a-=c.outerHeight(!0)-c.height()+d.outerHeight(!0)-d.height()+$(".gis-widget-propertys-title",d).outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height(),c.css({maxHeight:Math.max(a,40)})},_updateHistory:function(){var a,b=this;this._history=[],this._historyValues=[],a=$("#points-selector li",this._$div),a.each(function(){b._history.push(this),b._historyValues.push({x:b.getPointValue($(".marker-x",$(this))),y:b.getPointValue($(".marker-y",$(this)))})})},_skChanged:Gis.Widget.ListPoints._skChanged,_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0)))},back:function(){var a,b,c=this;this._isStateChanged()&&($("#points-selector li",this._$div).not(this._history).remove(),this._history.forEach(function(d,e){$("#points-selector ol",c._$div).append($(d)),a=void 0!=c._historyValues[e].x?c._historyValues[e].x:"",b=void 0!=c._historyValues[e].y?c._historyValues[e].y:"",c.setHtmlPointSelectorWidgetData($(d),Gis.UI.coordinate(a,b),Gis.UI.coordinate(a,b))}),this._updateColor(),this._updateStyle()),this._updateState()},_clearInfo:function(){this._$infoContainer&&(this._$infoContainer.remove(),this._$infoContainer=void 0)},_clearPolyline:function(){this._deleteLayerConfirm({title:"Вы действительно хотите удалить маршрут?",callback:function(){this.removeLayerFromMap(this.options.dataBinded)},context:this,id:"polyline-remove-dialog"})},_setData:function(){this._updateDataFromPolyline()},_hilightErrors:function(){var a,b,c,d=!1,e=this;return a=$("#points-selector li",this._$div),a.each(function(){b=$(".marker-x",$(this)),c=$(".marker-y",$(this)),d=d||e.checkPoint($(this))}),d=d||!this.getSelectedColor()},_updateCoordinatesState:function(){var a,b;b=this.getValueFromData("isDraggable",!0)?function(){$(".marker-x",$(this)).removeAttr("disabled"),$(".marker-y",$(this)).removeAttr("disabled")}:function(){$(".marker-x",$(this)).attr("disabled","disabled"),$(".marker-y",$(this)).attr("disabled","disabled")},this.isDataEditable()?$(".gis-widget-ico",this._$div).show():$(".gis-widget-ico",this._$div).hide(),a=$("#points-selector li",this._$div),a.each(b)},updateData:function(){this._setData(),this._updateColor(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.options.dataBinded&&this._initPolylineEvents(),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.PolylineProperty.CLASS_NAME),this._updateStyleList()},_xyRowHTML:function(){return"<li class='data-row'>\n"+this._HTMLPointSelectorWidget({tag:"span",yClass:"marker-input marker-y",xClass:"marker-input marker-x"})+"<span class='gis-widget-ico gis-widget-ico-up'></span><span class='gis-widget-ico gis-widget-ico-down'></span><span class='gis-widget-ico gis-widget-ico-remove'></span><span class='gis-widget-ico gis-widget-ico-add'></span>\n</li>\n"},initDataBlock:function(){var a="",b=0;for(b;b<this._minimalPoints;b+=1)a+=this._xyRowHTML();return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='points-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>ППМ</div>\n<div id='points-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ol>\n"+a+"</ol>\n<div class='gis-widget-add-to-end'><span class='gis-widget-ico gis-widget-ico-add'></span></div></div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Цвет</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector()+"</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this.options.dataBinded?"Подтвердить":"Новый")+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){var a,b=!1,c=this;if(a=$("#points-selector li",this._$div),c._history.length!==a.length)return!0;a.each(function(a){var d=$(this),e=$(".marker-x",d),f=$(".marker-y",d);c.options.dataBinded||(b=b||""!==c.getPointValue(e)),b=b||c._rowChanged(e)||c._rowChanged(f)||c._history[a]&&this!==c._history[a]}),this._typeSelector&&(b=b||this.isStyleChanged());var d=this.getValueFromData("getColor",null,!0);return b=b||this.options.dataBinded&&d!=this.getSelectedColor()},_updateButtonState:function(){var a=this._isStateChanged(),b=this.isDataEditable(),c=this.getValueFromData("isDraggable",!1);this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),$(".gis-button-text",this._$buttonNew).html(this.options.dataBinded&&a?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый"),this.switchButtonState(this._$buttonNew,(c||b)&&a&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,b&&this.options.dataBinded&&this._containerController.getUIAttached().getMap().getLayer(this.options.dataBinded.getId())),this.switchButtonState(this._$buttonRevert,(c||b)&&a)},_newRowXY:function(){var a=$(this._xyRowHTML());return $("#points-selector ol",this._$div).append(a),this._maskInput(),a},_getLastClearPoint:function(){var a,b,c,d,e,f=this._getSelectedRow();if(f)return(e=this.checkRowForClean(f.next()))?e:this.insertRowAfter(f,!0);for(a=$("#points-selector li",this._$div),b=a.length-1;b>=0;b-=1){var g=a[b];if(c=$(".marker-x",g),d=$(".marker-y",g),""!==c.val()||""!==d.val())break;""===c.val()&&""===d.val()&&(e=g)}return e||(e=this._newRowXY()),e},checkRowForClean:function(a){var b,c,d,e=$(a);return e.length>0&&(b=$(".marker-x",e),c=$(".marker-y",e),""===b.val()&&""===c.val()&&(d=e)),d},_insertNewPoint:function(a,b){var c,d,e=this.coordinateToTemplate(a);this._lastRow=this._getLastClearPoint(),b&&this._selectRowInList($(this._lastRow)),c=e.x||"",d=e.y||"",this.setHtmlPointSelectorWidgetData(this._lastRow,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d))},_mapClicked:function(a){(!this.options.dataBinded||this.options.dataBinded.isDraggable()&&this.isDataEditable())&&(this._insertNewPoint(Gis.latLng(a.latLng.latitude,a.latLng.longitude),!0),this.options.dataBinded&&this.options.dataBinded.getColor(!0)===this.getSelectedColor()?(this._calculatePolyline(this._history.length===$("#points-selector li",this._$div).length&&this._containerController.getUIAttached().getMap().hasLayer(this.options.dataBinded)),this.options.dataBinded.setSelectedPoint($("#points-selector li",this._$div).index(this._lastRow),!0)):this._updateState())},_calculatePointData:function(a){var b,c;a&&(c=this.templateToCoordinate(this.getPointValue($(".marker-x",$(a))),this.getPointValue($(".marker-y",$(a)))),b=Gis.latLng(c.y,c.x),this._pointsLatlng.push(b))},_informationHTML:function(){var a;return this._distanceCalculated=this._distanceCalculated||0,this._moving=this._moving||0,a="<li class='gis-widget-info-row gis-widget-polyline-info-row'><span class='title'>Путь :</span><span class='value'>"+this._distanceCalculated.toFixed(2)+"</span></li><li class='gis-widget-info-row gis-widget-polyline-info-row'><span class='title'>Перемещение:</span><span class='value'>"+this._moving.toFixed(2)+"</span></li>",a&&"<ul class='gis-widget-info  gis-widget-polyline-info'>"+a+"</ul>"},_infoContainerHTML:function(a){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='info-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Информация</div>\n<div id='info-data' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>"+a+"</div>\n</div>\n"},_drawResultCalculation:function(){var a,b;b=this._informationHTML(),b&&(a=$(".gis-widget-polyline-info",this._$div),a.length?a.replaceWith($(b)):(this._$infoContainer=$(this._infoContainerHTML(b)),this._$infoContainer.insertAfter($("."+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS,this._$div))))},_updateDataFromPolyline:function(){var a,b,c,d,e=this.options.dataBinded&&this.options.dataBinded.getPoints(),f=this,g=0;if(b=$("#points-selector li",this._$div),e){if(a=function(a,c){var d,e,h=$(b[c]),i=f.coordinateToTemplate(a.getLatLng());h.length||(h=f._newRowXY()),e=i.y||"",d=i.x||"",f.setHtmlPointSelectorWidgetData(h,Gis.UI.coordinate(d,e),Gis.UI.coordinate(d,e)),f._attachPointDataToRow(h,a,!0),g=c},e.forEach(a),b[g+1])for(c=g+1,d=b.length;d>c;c+=1)this._removeRow($(b[c]));this._calculatePolyline(!0)}else b.each(function(a){a<f._minimalPoints?(f.setHtmlPointSelectorWidgetData($(this),Gis.UI.coordinate("",""),Gis.UI.coordinate("","")),f._detachPointDataFromRow($(this))):f._removeRow($(this))});this._updateHistory()},_initPolylineEvents:function(){this.options.dataBinded&&!this.options.dataBindedEventsInitialized&&(this.options.dataBindedEventsInitialized=!0,this.options.dataBinded.on("change",this._updateDataFromPolyline,this),this.options.dataBinded.on("selected",this._layerSelected,this),this.options.dataBinded.on("unselected",this._layerUnSelected,this))},_deInitPolylineEvents:function(){this.options.dataBinded&&this.options.dataBindedEventsInitialized&&(this.options.dataBindedEventsInitialized=!1,this.options.dataBinded.off("change",this._updateDataFromPolyline,this),this.options.dataBinded.off("selected",this._layerSelected,this),this.options.dataBinded.off("unselected",this._layerUnSelected,this))},_getPathPoints:function(){return this.options.dataBindedPoints.points},_drawPolyline:function(){Gis.extendError()},_calculatePolyline:function(a){var b,c,d,e;c=this,this._hilightErrors()?(c._distanceCalculated=0,c._moving=0):(b=$("#points-selector li",this._$div),this._distanceCalculated=0,this._pointsLatlng=[],this.options.dataBindedPoints={points:[]},b.each(function(f){var g,h,i,j,k=$(this);h=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,k),i=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,k),g=b[f+1],e=c.getPointValue(h),d=c.getPointValue(i),""!==d&&""!==e&&(j=c.templateToCoordinate(d,e),c.setHtmlPointSelectorWidgetData(k,Gis.UI.coordinate(d,e),Gis.UI.coordinate(d,e)),a||c._attachPointDataToRow(k,{latitude:j.y,longitude:j.x}),c.options.dataBindedPoints.points.push(Gis.Util.extend(c._getPoint(k).objectData(),{latitude:j.y,longitude:j.x})),c._calculatePointData(k,g))}),c._moving=c._calculatePointData($(b[0]),$(b[b.length-1]),!0),a||this._drawPolyline(),this._updateHistory()),this._updateState()},_selectRowInList:function(a){var b;return b=$("#points-selector .data-row",this._$div),b.not(a).removeClass("selected"),a&&$(a).addClass("selected"),b},_getSelectedRow:function(){var a=$("#points-selector .data-row.selected",this._$div);return a.length>0?a:void 0},_layerSelected:function(a){var b,c,d=a.additional&&a.additional.markerKey;void 0!==d&&(c=$("#points-selector .data-row",this._$div),b=c[d],$(":focus").blur(),this._selectRowInList(b))},_layerUnSelected:function(){var a;a=$("#points-selector .data-row",this._$div),a.removeClass("selected")},_deInitEvents:function(){this._deInitPolylineEvents();var a=this._containerController.getUIAttached().getMap();a.off("layerselected",this._layerSelected,this),a.off("layerunselected",this._layerUnSelected,this),a.off("stylechanged",this._updateStyleList,this),this._$div.off("click",".gis-widget-ico-up",this._icoUpClick),this._$div.off("click",".gis-widget-ico-down",this._icoDownClick),this._$div.off("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.off("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.off("change",".data-row input, .data-row input",this._textRowChange),this._$div.off("keyup",".data-row input, .data-row input",this._textRowChange),this._$div.off("focus",".data-row input, .data-row input",this._textRowFocus),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_removeRow:function(a){var b=a.parent();$(".data-row",b).length>this._minimalPoints&&a.remove()},_deleteKeyFire:function(a){return $("#points-selector .data-row.selected",this._$div).length&&"text"!==(a.srcElement||a.target).type?(this._removeRow($("#points-selector .data-row.selected",this._$div)),this._updateState(),a.preventDefault(),!1):!0},_initEvents:function(){var a,b=this;this._initPolylineEvents(),a=this._containerController.getUIAttached().getMap(),a.on("layerselected",this._layerSelected,this),a.on("layerunselected",this._layerUnSelected,this),a.on("stylechanged",this._updateStyleList,this),this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b._calculatePolyline()},this._icoUpClick=this._icoUpClick||function(){if(b.isDataEditable()){var a,c=$(this).parent();a=c.prev(),a.length&&c.insertBefore(a),b._updateState()}},this._icoDownClick=this._icoDownClick||function(){if(b.isDataEditable()){var a,c=$(this).parent();a=c.next(),a.length&&a.insertBefore(c),b._updateState()}},this._icoDeleteClick=this._icoDeleteClick||function(){if(b.isDataEditable()){var a=$(this).parent();b._removeRow(a),b._updateState()}},this.insertRowAfter=function(a,c){var d=$(b._xyRowHTML());return"li"===a[0].tagName.toLowerCase()?c?d.insertAfter(a):d.insertBefore(a):d.appendTo($("ol",a.parent())),b._maskInput(),b._updateState(),d},this._icoPlusClick=this._icoPlusClick||function(){if(b.isDataEditable()){var a=$(this).parent();insertRowAfter(a)}},this._deleteFunction=this._deleteFunction||function(){b.isButtonEnable(this)&&b._clearPolyline()},this._textRowChange=this._textRowChange||function(){b._updateState()},this._textRowFocus=this._textRowFocus||function(){if(b.options.dataBinded){var a=$(this).parent();b._selectRowInList(a),b.options.dataBinded.setSelectedPoint($("#points-selector li",this._$div).index(a),!0)}},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._deselectFunction=this._deselectFunction||function(){b.isButtonEnable(this)&&b._containerController.getUIAttached().getMap().clearSelected()},this._KeyUpReturnFunction=this._KeyUpReturnFunction||this.generateEnteredFunction(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||this.generateEnteredFunction(b._returnFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||this.generateEnteredFunction(b._revertFunction),this._$div.on("click",".gis-widget-ico-up",this._icoUpClick),this._$div.on("click",".gis-widget-ico-down",this._icoDownClick),this._$div.on("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.on("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.on("change",".data-row input, .data-row input",this._textRowChange),this._$div.on("focus",".data-row input, .data-row input",this._textRowFocus),this._$div.on("keyup",".data-row input, .data-row input",this._textRowChange),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},_initPolyline:function(){this._initPolylineEvents()},_deInitPolyline:function(){this._detachPointDataFromAllRows(),this._deInitPolylineEvents(),this._clearInfo()},bindData:function(a){a!==this.options.dataBinded&&(this.options.dataBinded&&this._deInitPolyline(),Gis.Widget.Propertys.prototype.bindData.call(this,a),this._initPolyline(),this._updateStyleList(),this.updateData())}}),Gis.Widget.PolylineProperty.CLASS_NAME="gis-widget-propertys-polyline",Gis.Widget.PolylineProperty.CENTER_CHANGED=1,Gis.Widget.PolylineProperty.TEXT_CHANGED=3,Gis.Widget.PolylineProperty.BOTH_CHANGED=2,Gis.Widget.PolylineProperty.NOT_CHANGED=0,Gis.Widget.SectorProperty=Gis.Widget.Propertys.extend({_typeSelector:!0,_type:"sector",_history:[],_defaultStyle:{color:"#AF2D51",border:"white",thickness:2,selectedBorder:"rgb(75, 84, 255)",angleLineColor:"#272727",angleLineBorder:"white",angleLineThickness:2},options:{types:void 0,colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this._createEventFunctions(),this.options.types=this.options.types||[],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){this._isStateChanged()&&(this._revertTextData(this._$Xrow),this._revertTextData(this._$Yrow),this._revertTextData(this._$RInnerRow),this._revertTextData(this._$ROutterRow),this._revertTextData(this._$Angle1Row),this._revertTextData(this._$Angle2Row),this._revertTextData(this._$DirectionRow),this._revertTextData(this._$SolutionRow),this._updateStyle()),this.updateData()},_getFinishAngle:function(){var a=this.options.dataBinded&&360-(this.options.dataBinded.getStartAngle()||360)||359;return(a>=0?a:360+a)%360},_getStartAngle:function(){var a=this.options.dataBinded&&this.options.dataBinded.getFinishAngle()||0;return a>=0?a:360+a},_setData:function(a,b){var c,d,e,f,g=this.options.dataBinded&&this.options.dataBinded.getRadius()||0,h=this.options.dataBinded&&this.options.dataBinded.getInnerRadius()||0,i=this._getStartAngle()||0,j=this._getFinishAngle();b=this.options.dataBinded&&this.coordinateToTemplate(b||this.options.dataBinded&&this.options.dataBinded.getLatLng()),e=b&&b.x||"",f=b&&b.y||"",c=this._calculateDirection(this.options.dataBinded),d=this._calculateSolution(this.options.dataBinded),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(e,f),Gis.UI.coordinate(e,f)),this._setValue(this._$RInnerRow,h,h),this._setValue(this._$ROutterRow,g,g),this._setValue(this._$Angle1Row,i,i),this._setValue(this._$Angle2Row,j,j),this._setValue(this._$DirectionRow,c,c),this._setValue(this._$SolutionRow,d,d)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0)))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),a=a||this.checkNumeric(this._$RInnerRow),a=a||this.checkNumeric(this._$Angle2Row),a=a||this.checkNumeric(this._$DirectionRow),a=a||this.checkNumeric(this._$SolutionRow),a=a||this.checkNumeric(this._$ROutterRow),a=a||this.checkNumeric(this._$Angle1Row),$(".gis-color-button.selected",this._$div).data("color")||(a=!0),a},_updateCoordinatesState:function(){this.options.dataBinded&&!this.options.dataBinded.isDraggable()?(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled")):(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled"))},updateData:function(){this._setData(),this._pressed||this._updateColor(),this._updateState()},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$ROutterRow,this._$RInnerRow,this._$Angle1Row,this._$Angle2Row,this._$DirectionRow,this._$SolutionRow)},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&"sector"===a[b[0]].getType()&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.SectorProperty.CLASS_NAME),this._$Xrow=$("#sector-x",this._$div),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Yrow=$("#sector-y",this._$div),this._$ROutterRow=$("#sector-r1",this._$div),this._$RInnerRow=$("#sector-r2",this._$div),this._$Angle1Row=$("#sector-angle1",this._$div),this._$Angle2Row=$("#sector-angle2",this._$div),this._$DirectionRow=$("#sector-direction",this._$div),this._$SolutionRow=$("#sector-solution",this._$div),this._updateStyleList()},_getSolution:function(){return parseFloat(this._$SolutionRow.val())%360},_getDirection:function(){return parseFloat(this._$DirectionRow.val())%360},_anglesByDirection:function(){var a,b;return a=this._getDirection(),b=this._getSolution(),[(a-b/2)%360,a+b/2%360]},_calculateDirection:function(a){var b;return b=a?a.getStartAngle():parseFloat(this._$Angle1Row&&this._$Angle1Row.val())||0,(parseFloat(b)+parseFloat(this._calculateSolution(a))/2)%360},_calculateSolution:function(a){var b,c,d;return b=a?a.getStartAngle():360-(parseFloat(this._$Angle2Row&&this._$Angle2Row.val())||360),c=a?a.getFinishAngle():parseFloat(this._$Angle1Row&&this._$Angle1Row.val())||359,d=(c-b)%360,d>=0?d:360+d},initDataBlock:function(){var a=this.coordinateToTemplate(this.options.dataBinded&&this.options.dataBinded.getLatLng()||null),b=this.options.dataBinded&&this.options.dataBinded.getRadius()||"",c=this.options.dataBinded&&this.options.dataBinded.getInnerRadius()||"",d=this._getStartAngle()||"",e=this._getFinishAngle()||"",f=this._calculateDirection(this.options.dataBinded),g=this._calculateSolution(this.options.dataBinded),h=a.x||"",i=a.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Параметры</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:h,y:i,xID:"sector-x",yID:"sector-y",yClass:"sector-input",xClass:"sector-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row'><span>R внешний:</span>"+this._HTMLRowInput(b,"sector-r1","sector-input")+"</li>\n<li class='data-row'><span>R внутренний:</span>"+this._HTMLRowInput(c,"sector-r2","sector-input")+"</li>\n<li class='data-row'><span>Угол 1:</span>"+this._HTMLRowInput(d,"sector-angle1","sector-input")+"</li>\n<li class='data-row'><span>Угол 2:</span>"+this._HTMLRowInput(e,"sector-angle2","sector-input")+"</li>\n<li class='data-row'><span>Направление:</span>"+this._HTMLRowInput(f,"sector-direction","sector-input")+"</li>\n<li class='data-row'><span>Угол раствора:</span>"+this._HTMLRowInput(g,"sector-solution","sector-input")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector("Предустановки")+"</div></div>\n</div>\n"
},_onMouseDown:function(a){this._anglePath||(this._cleared=!0,this._pressed=!0,this.options.dataBinded&&(this._cleared=!1,this._containerController.getUIAttached().getMap().unselectLayer(this.options.dataBinded)),this._startPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_cancelDrag:function(){this._anglePath||(this._cleared=!1,this._pressed=!1,this._startPoint=null)},_drawFromDrag:function(){var a,b;this._cleared&&this._currentPoint&&this._startPoint&&(a=this._startPoint.distanceTo(Gis.latLng(this._startPoint.lat,this._currentPoint.lng)),b=this._startPoint.distanceTo(Gis.latLng(this._currentPoint.lat,this._startPoint.lng)),a=Math.max(a,b),this._saveData({x:this._startPoint.lng,y:this._startPoint.lat,r1:a,r2:0,angle:this._$Angle1Row.val(),angle2:this._$Angle2Row.val(),notFireServerEvent:!0}))},_updatePathAngle:function(a){if(this._anglePath){var b,c,d={},e=this._containerController.getUIAttached().getMap();c=this.options.dataBinded.getLatLng(),b=Gis.Widget.SectorProperty._calculatePointAngle(e.latLngToLayerPoint(Gis.latLng(c[0],c[1])),e.latLngToLayerPoint(a)),d[this._firstAngle?"finishAngle":"startAngle"]=b%360,this.options.dataBinded.setData(d,null,!0),this._anglePath.setData({points:[{latitude:c[0],longitude:c[1]},{latitude:a.lat,longitude:a.lng}]})}},_onMouseMove:function(a){this._pressed&&this._cleared&&!this._anglePath?(this._moved=!0,this._currentPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude),this._drawFromDrag()):this._updatePathAngle(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_finish:function(){this._deactivateAnglePath()},_deactivateAnglePath:function(){this._anglePath&&(this.fireServerEvent(this._firstAngle?"finishAngle":"startAngle"),this._containerController.getUIAttached().getMap().removeLayer(this._anglePath),this._anglePath=void 0)},fireServerEvent:function(a){this.options.dataBinded&&this.options.dataBinded.fire("change",{target:this.options.dataBinded,rows:this.options.dataBinded._getRowsChanged(a)||["innerRadius","radius","startAngle","finishAngle","latitude","longitude","fill"]})},_startAngleMove:function(a){var b,c;this.options.dataBinded&&(this._firstAngle=!0,this._deactivateAnglePath(),b=this.options.dataBinded.getLatLng(),c=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("sector")),this._anglePath=Gis.path({points:[{latitude:b[0],longitude:b[1]},{latitude:a.lat,longitude:a.lng}],draggable:!1,line:{color:c.angleLineColor,border:c.angleLineBorder,thickness:c.angleLineThickness},selectable:!1}),this._anglePath.setControllableByServer(!1),this._anglePath.addTo(this._containerController.getUIAttached().getMap()))},_finishDrawFromDrag:function(a){this._cleared=!1,this._startPoint=void 0,this._currentPoint=void 0,this.fireServerEvent(),this._anglePath||this._startAngleMove(a)},_onMouseUp:function(a){var b=this._moved&&this._pressed;this._moved=!1,this._pressed=!1,this._anglePath?this._firstAngle?(this._firstAngle=!1,this.fireServerEvent("finishAngle")):this._deactivateAnglePath():b&&this._finishDrawFromDrag(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_onMouseOut:function(){this._moved&&this._pressed&&this._finishDrawFromDrag(),this._moved=!1,this._pressed=!1},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новый",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$RInnerRow)||this._rowChanged(this._$ROutterRow)||this._rowChanged(this._$Angle1Row)||this._rowChanged(this._$Angle2Row)||this._rowChanged(this._$DirectionRow)||this._rowChanged(this._$SolutionRow)||this.options.dataBinded&&this.options.dataBinded.getColor(!0)!==this.getSelectedColor(),a=a||this.options.dataBinded&&this.getSelectedStyle()!==this.options.dataBinded.getTag("style")},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b)},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_saveData:function(a){function b(a){return 0>a&&(a=360+a%360),a}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;a=a||{},q=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow)),i=a.x||parseFloat(q.x),j=a.y||parseFloat(q.y),l=a.r2||parseFloat(this._$RInnerRow.val()),k=a.r1||parseFloat(this._$ROutterRow.val()),m=a.color||$(".gis-color-button.selected",this._$div).data("color")||this.options.dataBinded&&this.options.dataBinded.getColor(!0),a.angle||a.angle2||this._rowChanged(this._$Angle1Row)||this._rowChanged(this._$Angle2Row)||!this._rowChanged(this._$DirectionRow)&&!this._rowChanged(this._$SolutionRow)||(g=this._anglesByDirection(),a.angle=g[1],a.angle2=-g[0]),n=void 0!==a.angle&&$.isNumeric(a.angle)?a.angle:parseFloat(this._$Angle1Row.val()),o=-(void 0!==a.angle2&&$.isNumeric(a.angle2)?a.angle2:parseFloat(this._$Angle2Row.val())),o=b(o),n=b(n),e={color:this.getSelectedColor()},Gis.Util.isNumeric(i)&&Gis.Util.isNumeric(j)&&m&&void 0!==n&&k?(d={innerRadius:l,radius:k,startAngle:o,finishAngle:n,latitude:j,longitude:i,fill:e,tags:{style:this.getSelectedStyle()}},!a.forceNew&&this.options.dataBinded?this.options.dataBinded.setData(d,null,a.notFireServerEvent):(p=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("sector")),f={color:p.color,border:p.border,thickness:p.thickness},c=Gis.sector(Gis.Util.extend({},d,{draggable:!0,selectable:!0,line:f})),c.setSelectedStyle(Gis.Util.extend({},f,{border:p.selectedBorder})),h=this._containerController.getUIAttached().getMap(),c.addTo(h),h.selectLayer(c)),this._update()):this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions.sector.call(this,a)},_mapClicked:function(){},activate:function(){Gis.Widget.Propertys.prototype.activate.call(this)},deactivate:function(){Gis.Widget.Propertys.prototype.deactivate.call(this),this._cancelDrag()},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),$(document.body).off("keyup",this._KeyUpEscFunction),a.off("mouseup",this._onMouseUp,this),a.off("mousedown",this._onMouseDown,this),a.off("mousemove",this._onMouseMove,this),a.off("mouseout",this._onMouseOut,this),a.off("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_createEventFunctions:function(){var a=this;this._returnFunction=this._returnFunction||function(b){a.isButtonEnable(this)&&a._saveData(b)},this._escFunction=this._escFunction||function(b){a._finish(b)},this._deleteFunction=this._deleteFunction||function(b){a.isButtonEnable(this)&&a._deleteKeyFire(b)},this._textRowChange=this._textRowChange||function(b){a._updateState(),b.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){a._updateState()},this._revertFunction=this._revertFunction||function(){a.isButtonEnable(this)&&a.back()},this._deselectFunction=this._deselectFunction||function(){a.isButtonEnable(this)&&a._containerController.getUIAttached().getMap().unselectLayer(a.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||this.generateEnteredFunction(a._deleteFunction),this._KeyUpEscFunction=this._KeyUpEscFunction||this.generateEskeyFunction(a._escFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||this.generateEnteredFunction(a._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||this.generateEnteredFunction(a._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||this.generateEnteredFunction(a._revertFunction)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();$(document.body).on("keyup",this._KeyUpEscFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),a.on("mouseup",this._onMouseUp,this),a.on("mousedown",this._onMouseDown,this),a.on("mousemove",this._onMouseMove,this),a.on("mouseout",this._onMouseOut,this),a.on("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a||this._cleared||(this._cleared=!0),a!==this.options.dataBinded&&(this._deactivateAnglePath(),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this._updateStyleList(),this.updateData())}}),Gis.UI.DeleteActions.sector=function(a,b){"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить сектор?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"sector-remove-dialog"},b)},Gis.Widget.SectorProperty.CLASS_NAME="gis-widget-propertys-sector",Gis.Widget.SectorProperty._calculatePointAngle=function(a,b){var c=a.x,d=a.y,e=b.x,f=b.y,g=Math.atan2(d-f,c-e)/Math.PI*180;return(0>g?g+360:g)-90},Gis.Widget.sectorProperty=function(a){return new Gis.Widget.SectorProperty(a)},Gis.Widget.ZoomProperty=Gis.Widget.Propertys.extend({_type:"zoom",includes:Gis.Widget.ZoomBehavior,_history:[],_updateHistory:function(){this._updateButtonState()},back:function(){var a,b=this._containerController.getUIAttached().getMap();this._isStateChanged()?(this.revertHtmlPointSelectorWidgetData(this._$CoordinateContainer),this._list.setValueSelected(b.getZoom()),this._newZoom=b.getZoom()):(a=this._history.pop(),a&&(this.setZoomAndCenter(a.zoom,a.center),this._setData(a.zoom,a.center))),this._updateButtonState()},setZoomAndCenter:function(a,b){var c=this._containerController.getUIAttached().getMap();Gis.Util.isNumeric(a)&&a!==c.getZoom()?(c.setZoom(a),this._centerToSet=b):(this._centerToSet=null,c.setCenter(b,!0))},_updateCenter:function(){var a,b,c,d,e=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=e.x,b=e.y,Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(b)?(c=Gis.latLng(b,a),d=this._containerController.getUIAttached().getMap(),this._updateHistory({center:d.getCenter(),zoom:d.getZoom()}),this.setZoomAndCenter(this._newZoom,c)):Gis.Logger.log("ERROR UPDATE CENTER","x = "+a+" | y = "+b)},_setNewZoom:function(a){this._updateHistory({zoom:this._containerController.getUIAttached().getMap().getZoom()}),this._containerController.getUIAttached().getMap().setZoom(a)},zoomSelected:function(a){this._newZoom=parseFloat(a),this._updateButtonState()},_setData:function(a,b){var c,d;b=this.coordinateToTemplate(b||this._containerController.getUIAttached().getMap().getCenter()),a=a||this._containerController.getUIAttached().getMap().getZoom(),c=b.x||"",d=b.y||"",this._newZoom=a,this._list.setValueSelected(a),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d))},updateData:function(a){a&&"zoomend"===a.type&&this._centerToSet&&this.setZoomAndCenter(null,this._centerToSet),this._setData(),this._updateButtonState()},_initZoomList:function(){var a=this.getConvertedZoom();this._list=Gis.HTML.listView({data:this._getZoomValues(),container:$("#zoom-selector",this._$div)[0],callback:this.zoomSelected,context:this,defaultValue:{val:this._containerController.getUIAttached().getMap().getZoom(),name:a}})},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.ZoomProperty.CLASS_NAME),this._$Xrow=$("#zoom-x",this._$div),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Yrow=$("#zoom-y",this._$div),this._initZoomList(),this._setData()},initDataBlock:function(){var a=this.coordinateToTemplate(this._containerController.getUIAttached().getMap().getCenter()),b=a.x||"",c=a.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Текущие координаты центра</div>\n<div id='center-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-row",x:b,y:c,xID:"zoom-x",yID:"zoom-y",yClass:"zoom-input",xClass:"zoom-input"})+"</ul>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='zoom-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Текущий масштаб</div>\n<div id='zoom-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Перейти")+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_mapClicked:function(){},_isStateChanged:function(){var a,b,c;return a=this._rowChanged(this._$Xrow),b=this._rowChanged(this._$Yrow),c=a||b?Gis.Widget.ZoomProperty.CENTER_CHANGED:Gis.Widget.ZoomProperty.NOT_CHANGED,c=this._containerController.getUIAttached().getMap().getZoom()!==this._newZoom?c?Gis.Widget.ZoomProperty.BOTH_CHANGED:Gis.Widget.ZoomProperty.ZOOM_CHANGED:c},_updateButtonState:function(){var a=this._isStateChanged();this.switchButtonState($("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._history.length||a),this.switchButtonState($("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),a),$("#center-title",this._$div).html(a===Gis.Widget.ZoomProperty.BOTH_CHANGED||a===Gis.Widget.ZoomProperty.CENTER_CHANGED?"Новые координаты центра":"Текущие координаты центра"),$("#zoom-title",this._$div).html(a===Gis.Widget.ZoomProperty.BOTH_CHANGED||a===Gis.Widget.ZoomProperty.ZOOM_CHANGED?"Новый масштаб":"Текущий масштаб")},_deInitEvents:function(){Gis.Widget.Propertys.prototype._deInitEvents.call(this);var a=this._containerController.getUIAttached().getMap();a.off("zoomend moveend",this.updateData,this),a.off("tilelayerchanged",this._initZoomList,this),$(".data-row input",this._$div).off({keypress:this._keyupUpdateFunction,change:this._inputChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._updateStateFunc,keypress:this._keyupUpdateFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunc,keypress:this._keyupRevertFunction})},_initEvents:function(){var a,b=this;Gis.Widget.Propertys.prototype._initEvents.call(this),this._updateStateFunc=this._updateStateFunc||function(){b.isButtonEnable(this)&&b._updateCenter()},this._inputChange=this._inputChange||function(){b._updateButtonState()},this._revertFunc=this._revertFunc||function(){b.isButtonEnable(this)&&b.back()},this._keyupUpdateFunction=this._keyupUpdateFunction||function(a){if(b.isButtonEnable(this)){var c=13;a.keyCode===c||a.charCode===c+""?b._updateStateFunc():b._updateButtonState(),a.stopPropagation()}},this._keyupRevertFunction=this._keyupRevertFunction||function(a){var c=13;!b.isButtonEnable(this)||a.keyCode!==c&&a.charCode!==c+""||b.back()},a=this._containerController.getUIAttached().getMap(),a.on("zoomend moveend",this.updateData,this),a.on("tilelayerchanged",this._initZoomList,this),$(".data-row input",this._$div).on({change:this._inputChange,keyup:this._keyupUpdateFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._updateStateFunc,keyup:this._keyupUpdateFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunc,keyup:this._keyupRevertFunction})}}),Gis.Widget.ZoomProperty.CLASS_NAME="gis-widget-propertys-zoom",Gis.Widget.ZoomProperty.CENTER_CHANGED=1,Gis.Widget.ZoomProperty.ZOOM_CHANGED=3,Gis.Widget.ZoomProperty.BOTH_CHANGED=2,Gis.Widget.ZoomProperty.NOT_CHANGED=0,Gis.Widget.zoomProperty=function(a){return new Gis.Widget.ZoomProperty(a)},Gis.Widget.MoveProperty=Gis.Widget.ZoomProperty.extend({_type:"move"}),Gis.Widget.moveProperty=function(a){return new Gis.Widget.MoveProperty(a)},Gis.Widget.PathProperty=Gis.Widget.PolylineProperty.extend({_type:"path",_removePolyline:function(a){var b=a.target;b.off("remove",this._removePolyline,this)},_clearPolyline:function(){Gis.UI.DeleteActions.path.call(this)},_calculatePointData:function(a,b){var c,d,e,f,g=0;return a&&(e=this.templateToCoordinate(this.getPointValue($(".marker-x",$(a))),this.getPointValue($(".marker-y",$(a)))),c=Gis.latLng(e.y,e.x),this._pointsLatlng.push(c),b&&(f=this.templateToCoordinate(this.getPointValue($(".marker-x",$(b))),this.getPointValue($(".marker-y",$(b)))),d=Gis.latLng(f.y,f.x),g=c.distanceTo(d))),g},_drawPolyline:function(){var a,b;b=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("path")),a={color:this.getSelectedColor()},this.options.dataBinded?(a=Gis.Util.extend({},this.options.dataBinded.getOption("line").options,a),this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},a,{border:b.selectedBorder})),this.options.dataBinded.setData(Gis.Util.extend({},{line:a,points:this._getPathPoints()}))):(a.thickness=b.thickness,a.border=b.border,this.options.dataBinded=Gis.path(Gis.Util.extend({line:a,draggable:!0,selectable:!0,icon:b.icon,points:this._getPathPoints()})),this.options.dataBinded.setCourseEnable(!0),this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},a,{border:b.selectedBorder}))),this._containerController.getUIAttached().getMap().hasLayer(this.options.dataBinded)||(this.options.dataBinded.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(this.options.dataBinded)),this._initPolylineEvents()},_calculatePolyline:function(a){var b,c,d,e,f,g,h,i;c=this,this._hilightErrors()?(c._distanceCalculated=0,c._moving=0):(b=$("#points-selector li",this._$div),this._distanceCalculated=0,this._pointsLatlng=[],this.options.dataBindedPoints={points:[]},b.each(function(a){e=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,$(this)),f=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,$(this)),h=c.getPointValue(f),i=c.getPointValue(e),g=c.templateToCoordinate(h,i),d=b[a+1],c._attachPointDataToRow($(this),{latitude:g.y,longitude:g.x}),c.options.dataBindedPoints.points.push(Gis.Util.extend(c._getPoint($(this)).objectData(),{latitude:g.y,longitude:g.x})),c._distanceCalculated+=c._calculatePointData($(this),d)}),c._moving=c._calculatePointData($(b[0]),$(b[b.length-1]),!0),a||this._drawPolyline(),this._updateHistory()),this._drawResultCalculation(),this._updateState()},_updateDataFromPolyline:function(){var a,b,c,d,e=this.options.dataBinded&&this.options.dataBinded.getPoints(),f=this,g=0;if(b=$("#points-selector li",this._$div),e&&e.length){if(a=function(a,c){var d,e,h=$(b[c]),i=f.coordinateToTemplate(a.getLatLng());h.length||(h=f._newRowXY()),e=i.y||"",d=i.x||"",f.setHtmlPointSelectorWidgetData(h,Gis.UI.coordinate(d,e),Gis.UI.coordinate(d,e)),f._attachPointDataToRow(h,a,!0),g=c},e.forEach(a),b[g+1])for(c=g+1,d=b.length;d>c;c+=1)this._removeRow($(b[c]));this._calculatePolyline(!0)}else b.each(function(a){a<f._minimalPoints?(f.setHtmlPointSelectorWidgetData($(this),Gis.UI.coordinate("",""),Gis.UI.coordinate("","")),f._detachPointDataFromRow($(this))):f._removeRow($(this))});this._updateHistory()},_deInitEvents:function(){Gis.Widget.PolylineProperty.prototype._deInitEvents.call(this),this.options.dataBinded&&this.options.dataBinded.on("remove",this._removePolyline,this)},_initEvents:function(){this.options.dataBinded&&this.options.dataBinded.off("remove",this._removePolyline,this),Gis.Widget.PolylineProperty.prototype._initEvents.call(this)}}),Gis.UI.DeleteActions.path=function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить маршрут?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"path-remove-dialog"},b)},Gis.Widget.pathProperty=function(a){return new Gis.Widget.PathProperty(a)},Gis.Widget.PolygonProperty=Gis.Widget.PolylineProperty.extend({_typeSelector:!0,_type:"polygon",_minimalPoints:3,_clearPolyline:function(){Gis.UI.DeleteActions.polygon.call(this)},_drawPolyline:function(){var a,b,c;c=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("polygon")),a={color:c.color,border:c.border,thickness:c.thickness},b={color:this.getSelectedColor()},this.options.dataBinded?(this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},{color:this.options.dataBinded.getLineColor(),border:c.selectedBorder,thickness:a.thickness})),this.options.dataBinded.setData(Gis.Util.extend({},{fill:b,points:this._getPathPoints(),tags:{style:this.getSelectedStyle()}}))):(this.options.dataBinded=Gis.polygon(Gis.Util.extend({fill:b,line:a,draggable:!0,selectable:!0,icon:c.icon,points:this._getPathPoints(),tags:{style:this.getSelectedStyle()}})),this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},a,{border:c.selectedBorder}))),this._containerController.getUIAttached().getMap().hasLayer(this.options.dataBinded)||(this.options.dataBinded.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(this.options.dataBinded)),this._initPolylineEvents()}}),Gis.UI.DeleteActions.polygon=function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить полигон?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"polygon-remove-dialog"},b)},Gis.Widget.polygonProperty=function(a){return new Gis.Widget.PolygonProperty(a)};