/*! TacticMapClient.UI - v1.3.0 - 2014-12-30
* Copyright (c) SSS 2014 
 jQuery.UI included */
var GIS_UI_buildDate = "2014-12-30 14:06";
var GIS_UI_buildVersion = "1.3.0";
function getRequestUrl(a){var b=OSRM.C.PRECISION;return Gis.config(Gis.GEO_NEAREST_URL,"http://router.project-osrm.org/locate")+"?output=json&loc="+a.getLat().toFixed(b)+","+a.getLng().toFixed(b)}var GIS_UI_buildDate="2014-12-30 14:06",GIS_UI_buildVersion="1.3.0";!function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(jQuery),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;i>h;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(c[e]=a.isPlainObject(f)?a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,this.each(h?function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}:function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),1===arguments.length)return f[c]===b?null:f[c];f[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:0>d?"left":c>0?"right":"center",vertical:0>f?"top":e>0?"bottom":"middle"};l>n&&h(c+d)<n&&(i.horizontal="center"),m>p&&h(e+f)<p&&(i.vertical="middle"),i.important=g(h(c),h(d))>g(h(e),h(f))?"horizontal":"vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&0>=j?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):a.left=j>0&&0>=i?e:i>j?e+f-b.collisionWidth:e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&0>=j?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):a.top=j>0&&0>=i?e:i>j?e+f-b.collisionHeight:e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];0>k?(c=a.left+m+n+o+b.collisionWidth-g-f,(0>c||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];0>k?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(0>d||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&11>e,b.innerHTML="",c.removeChild(b)}()}(jQuery),function(a){var b,c="ui-button ui-widget ui-state-default ui-corner-all",d="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",e=function(){var b=a(this);setTimeout(function(){b.find(":ui-button").button("refresh")},1)},f=function(b){var c=b.name,d=b.form,e=a([]);return c&&(c=c.replace(/'/g,"\\'"),e=d?a(d).find("[name='"+c+"']"):a("[name='"+c+"']",b.ownerDocument).filter(function(){return!this.form})),e};a.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,e),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var d=this,g=this.options,h="checkbox"===this.type||"radio"===this.type,i=h?"":"ui-state-active";null===g.label&&(g.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(c).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){g.disabled||this===b&&a(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){g.disabled||a(this).removeClass(i)}).bind("click"+this.eventNamespace,function(a){g.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),h&&this.element.bind("change"+this.eventNamespace,function(){d.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return g.disabled?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(g.disabled)return!1;a(this).addClass("ui-state-active"),d.buttonElement.attr("aria-pressed","true");var b=d.element[0];f(b).not(b).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return g.disabled?!1:(a(this).addClass("ui-state-active"),b=this,void d.document.one("mouseup",function(){b=null}))}).bind("mouseup"+this.eventNamespace,function(){return g.disabled?!1:void a(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(b){return g.disabled?!1:void((b.keyCode===a.ui.keyCode.SPACE||b.keyCode===a.ui.keyCode.ENTER)&&a(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",g.disabled),this._resetButton()},_determineButtonType:function(){var a,b,c;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(a=this.element.parents().last(),b="label[for='"+this.element.attr("id")+"']",this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible"),c=this.element.is(":checked"),c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",c)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(c+" ui-state-active "+d).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(a,b){return this._super(a,b),"disabled"===a?(this.element.prop("disabled",!!b),void(b&&this.buttonElement.removeClass("ui-state-focus"))):void this._resetButton()},refresh:function(){var b=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");b!==this.options.disabled&&this._setOption("disabled",b),"radio"===this.type?f(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return void(this.options.label&&this.element.val(this.options.label));var b=this.buttonElement.removeClass(d),c=a("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),e=this.options.icons,f=e.primary&&e.secondary,g=[];e.primary||e.secondary?(this.options.text&&g.push("ui-button-text-icon"+(f?"s":e.primary?"-primary":"-secondary")),e.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+e.primary+"'></span>"),e.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+e.secondary+"'></span>"),this.options.text||(g.push(f?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",a.trim(c)))):g.push("ui-button-text-only"),b.addClass(g.join(" "))}}),a.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(a,b){"disabled"===a&&this.buttons.button("option",a,b),this._super(a,b)},refresh:function(){var b="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a){a.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,a.proxy(function(a){this.options.disabled&&a.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(a){a.preventDefault()},"click .ui-state-disabled > a":function(a){a.preventDefault()},"click .ui-menu-item:has(a)":function(b){var c=a(b.target).closest(".ui-menu-item");!this.mouseHandled&&c.not(".ui-state-disabled").length&&(this.select(b),b.isPropagationStopped()||(this.mouseHandled=!0),c.has(".ui-menu").length?this.expand(b):!this.element.is(":focus")&&a(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(b){var c=a(b.currentTarget);c.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(b,c)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var c=this.active||this.element.children(".ui-menu-item").eq(0);b||this.focus(a,c)},blur:function(b){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(b)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(b){a(b.target).closest(".ui-menu").length||this.collapseAll(b),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var b=a(this);b.data("ui-menu-submenu-carat")&&b.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(b){function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var d,e,f,g,h,i=!0;switch(b.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(b);break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(b);break;case a.ui.keyCode.HOME:this._move("first","first",b);break;case a.ui.keyCode.END:this._move("last","last",b);break;case a.ui.keyCode.UP:this.previous(b);break;case a.ui.keyCode.DOWN:this.next(b);break;case a.ui.keyCode.LEFT:this.collapse(b);break;case a.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(b);break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:this._activate(b);break;case a.ui.keyCode.ESCAPE:this.collapse(b);break;default:i=!1,e=this.previousFilter||"",f=String.fromCharCode(b.keyCode),g=!1,clearTimeout(this.filterTimer),f===e?g=!0:f=e+f,h=new RegExp("^"+c(f),"i"),d=this.activeMenu.children(".ui-menu-item").filter(function(){return h.test(a(this).children("a").text())}),d=g&&-1!==d.index(this.active.next())?this.active.nextAll(".ui-menu-item"):d,d.length||(f=String.fromCharCode(b.keyCode),h=new RegExp("^"+c(f),"i"),d=this.activeMenu.children(".ui-menu-item").filter(function(){return h.test(a(this).children("a").text())})),d.length?(this.focus(b,d),d.length>1?(this.previousFilter=f,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}i&&b.preventDefault()},_activate:function(a){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(a):this.select(a))},refresh:function(){var b,c=this.options.icons.submenu,d=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),d.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var b=a(this),d=b.prev("a"),e=a("<span>").addClass("ui-menu-icon ui-icon "+c).data("ui-menu-submenu-carat",!0);d.attr("aria-haspopup","true").prepend(e),b.attr("aria-labelledby",d.attr("id"))}),b=d.add(this.element),b.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),b.children(":not(.ui-menu-item)").each(function(){var b=a(this);/[^\-\u2014\u2013\s]/.test(b.text())||b.addClass("ui-widget-content ui-menu-divider")}),b.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!a.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(a,b){"icons"===a&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(b.submenu),this._super(a,b)},focus:function(a,b){var c,d;this.blur(a,a&&"focus"===a.type),this._scrollIntoView(b),this.active=b.first(),d=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",d.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()
},this.delay),c=b.children(".ui-menu"),c.length&&a&&/^mouse/.test(a.type)&&this._startOpening(c),this.activeMenu=b.parent(),this._trigger("focus",a,{item:b})},_scrollIntoView:function(b){var c,d,e,f,g,h;this._hasScroll()&&(c=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,d=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,e=b.offset().top-this.activeMenu.offset().top-c-d,f=this.activeMenu.scrollTop(),g=this.activeMenu.height(),h=b.height(),0>e?this.activeMenu.scrollTop(f+e):e+h>g&&this.activeMenu.scrollTop(f+e-g+h))},blur:function(a,b){b||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",a,{item:this.active}))},_startOpening:function(a){clearTimeout(this.timer),"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(a)},this.delay))},_open:function(b){var c=a.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(b.parents(".ui-menu")).hide().attr("aria-hidden","true"),b.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(c)},collapseAll:function(b,c){clearTimeout(this.timer),this.timer=this._delay(function(){var d=c?this.element:a(b&&b.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element),this._close(d),this.blur(b),this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element),a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,c){var d;this.active&&(d="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0)),d&&d.length&&this.active||(d=this.activeMenu.children(".ui-menu-item")[b]()),this.focus(c,d)},nextPage:function(b){var c,d,e;return this.active?void(this.isLastItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d-e<0}),this.focus(b,c)):this.focus(b,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(b)},previousPage:function(b){var c,d,e;return this.active?void(this.isFirstItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return c=a(this),c.offset().top-d+e>0}),this.focus(b,c)):this.focus(b,this.activeMenu.children(".ui-menu-item").first()))):void this.next(b)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(b){this.active=this.active||a(b.target).closest(".ui-menu-item");var c={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(b,!0),this._trigger("select",b,c)}})}(jQuery),function(a){a.widget("ui.draggable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"original"!==this.options.helper||a.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1):!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;return e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(document).width()-this.helperProportions.width-this.margins.left,(a(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:e.scrollTop(),left:e.scrollLeft()}),{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*d}},_generatePosition:function(b){var c,d,e,f,g=this.options,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=b.pageX,j=b.pageY;return this.offset.scroll||(this.offset.scroll={top:h.scrollTop(),left:h.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,b.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),b.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),b.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),b.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"ui-sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("ui-draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("ui-draggable"),e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("ui-draggable").options;b.css("cursor")&&(c._cursor=b.css("cursor")),b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("ui-draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("ui-draggable");b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName&&(b.overflowOffset=b.scrollParent.offset())},drag:function(b){var c=a(this).data("ui-draggable"),d=c.options,e=!1;c.scrollParent[0]!==document&&"HTML"!==c.scrollParent[0].tagName?(d.axis&&"x"===d.axis||(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-c.overflowOffset.top<d.scrollSensitivity&&(c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed)),d.axis&&"y"===d.axis||(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-c.overflowOffset.left<d.scrollSensitivity&&(c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed))):(d.axis&&"x"===d.axis||(b.pageY-a(document).scrollTop()<d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed))),d.axis&&"y"===d.axis||(b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)))),e!==!1&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}}),a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("ui-draggable"),c=b.options;b.snapElements=[],a(c.snap.constructor!==String?c.snap.items||":data(ui-draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!==b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("ui-draggable"),o=n.options,p=o.snapTolerance,q=c.offset.left,r=q+n.helperProportions.width,s=c.offset.top,t=s+n.helperProportions.height;for(l=n.snapElements.length-1;l>=0;l--)h=n.snapElements[l].left,i=h+n.snapElements[l].width,j=n.snapElements[l].top,k=j+n.snapElements[l].height,h-p>r||q>i+p||j-p>t||s>k+p||!a.contains(n.snapElements[l].item.ownerDocument,n.snapElements[l].item)?(n.snapElements[l].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=!1):("inner"!==o.snapMode&&(d=Math.abs(j-t)<=p,e=Math.abs(k-s)<=p,f=Math.abs(h-r)<=p,g=Math.abs(i-q)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j-n.helperProportions.height,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i}).left-n.margins.left)),m=d||e||f||g,"outer"!==o.snapMode&&(d=Math.abs(j-s)<=p,e=Math.abs(k-t)<=p,f=Math.abs(h-q)<=p,g=Math.abs(i-r)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k-n.helperProportions.height,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[l].snapping&&(d||e||f||g||m)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=d||e||f||g||m)}}),a.ui.plugin.add("draggable","stack",{start:function(){var b,c=this.data("ui-draggable").options,d=a.makeArray(a(c.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});d.length&&(b=parseInt(a(d[0]).css("zIndex"),10)||0,a(d).each(function(c){a(this).css("zIndex",b+c)}),this.css("zIndex",b+d.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a){function b(a){return parseInt(a,10)||0}function c(a){return!isNaN(parseInt(a,10))}a.widget("ui.resizable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String&&(this.handles[c]=a(this.handles[c],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),a(this.handles[c]).length},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(c){var d,e,f,g=this.options,h=this.element.position(),i=this.element;return this.resizing=!0,/absolute/.test(i.css("position"))?i.css({position:"absolute",top:i.css("top"),left:i.css("left")}):i.is(".ui-draggable")&&i.css({position:"absolute",top:h.top,left:h.left}),this._renderProxy(),d=b(this.helper.css("left")),e=b(this.helper.css("top")),g.containment&&(d+=a(g.containment).scrollLeft()||0,e+=a(g.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:d,top:e},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:i.width(),height:i.height()},this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()},this.originalPosition={left:d,top:e},this.sizeDiff={width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()},this.originalMousePosition={left:c.pageX,top:c.pageY},this.aspectRatio="number"==typeof g.aspectRatio?g.aspectRatio:this.originalSize.width/this.originalSize.height||1,f=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===f?this.axis+"-resize":f),i.addClass("ui-resizable-resizing"),this._propagate("start",c),!0},_mouseDrag:function(b){var c,d=this.helper,e={},f=this.originalMousePosition,g=this.axis,h=this.position.top,i=this.position.left,j=this.size.width,k=this.size.height,l=b.pageX-f.left||0,m=b.pageY-f.top||0,n=this._change[g];return n?(c=n.apply(this,[b,l,m]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),this.position.top!==h&&(e.top=this.position.top+"px"),this.position.left!==i&&(e.left=this.position.left+"px"),this.size.width!==j&&(e.width=this.size.width+"px"),this.size.height!==k&&(e.height=this.size.height+"px"),d.css(e),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(e)||this._trigger("resize",b,this.ui()),!1):!1},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&a.ui.hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(a){var b,d,e,f,g,h=this.options;g={minWidth:c(h.minWidth)?h.minWidth:0,maxWidth:c(h.maxWidth)?h.maxWidth:1/0,minHeight:c(h.minHeight)?h.minHeight:0,maxHeight:c(h.maxHeight)?h.maxHeight:1/0},(this._aspectRatio||a)&&(b=g.minHeight*this.aspectRatio,e=g.minWidth/this.aspectRatio,d=g.maxHeight*this.aspectRatio,f=g.maxWidth/this.aspectRatio,b>g.minWidth&&(g.minWidth=b),e>g.minHeight&&(g.minHeight=e),d<g.maxWidth&&(g.maxWidth=d),f<g.maxHeight&&(g.maxHeight=f)),this._vBoundaries=g},_updateCache:function(a){this.offset=this.helper.offset(),c(a.left)&&(this.position.left=a.left),c(a.top)&&(this.position.top=a.top),c(a.height)&&(this.size.height=a.height),c(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,d=this.size,e=this.axis;return c(a.height)?a.width=a.height*this.aspectRatio:c(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===e&&(a.left=b.left+(d.width-a.width),a.top=null),"nw"===e&&(a.top=b.top+(d.height-a.height),a.left=b.left+(d.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,d=this.axis,e=c(a.width)&&b.maxWidth&&b.maxWidth<a.width,f=c(a.height)&&b.maxHeight&&b.maxHeight<a.height,g=c(a.width)&&b.minWidth&&b.minWidth>a.width,h=c(a.height)&&b.minHeight&&b.minHeight>a.height,i=this.originalPosition.left+this.originalSize.width,j=this.position.top+this.size.height,k=/sw|nw|w/.test(d),l=/nw|ne|n/.test(d);return g&&(a.width=b.minWidth),h&&(a.height=b.minHeight),e&&(a.width=b.maxWidth),f&&(a.height=b.maxHeight),g&&k&&(a.left=i-b.minWidth),e&&k&&(a.left=i-b.maxWidth),h&&l&&(a.top=j-b.minHeight),f&&l&&(a.top=j-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var a,b,c,d,e,f=this.helper||this.element;for(a=0;a<this._proportionallyResizeElements.length;a++){if(e=this._proportionallyResizeElements[a],!this.borderDif)for(this.borderDif=[],c=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],d=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")],b=0;b<c.length;b++)this.borderDif[b]=(parseInt(c[b],10)||0)+(parseInt(d[b],10)||0);e.css({height:f.height()-this.borderDif[0]-this.borderDif[2]||0,width:f.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;
return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).data("ui-resizable"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var c,d,e,f,g,h,i,j=a(this).data("ui-resizable"),k=j.options,l=j.element,m=k.containment,n=m instanceof a?m.get(0):/parent/.test(m)?l.parent().get(0):m;n&&(j.containerElement=a(n),/document/.test(m)||m===document?(j.containerOffset={left:0,top:0},j.containerPosition={left:0,top:0},j.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(c=a(n),d=[],a(["Top","Right","Left","Bottom"]).each(function(a,e){d[a]=b(c.css("padding"+e))}),j.containerOffset=c.offset(),j.containerPosition=c.position(),j.containerSize={height:c.innerHeight()-d[3],width:c.innerWidth()-d[1]},e=j.containerOffset,f=j.containerSize.height,g=j.containerSize.width,h=a.ui.hasScroll(n,"left")?n.scrollWidth:g,i=a.ui.hasScroll(n)?n.scrollHeight:f,j.parentData={element:n,left:e.left,top:e.top,width:h,height:i}))},resize:function(b){var c,d,e,f,g=a(this).data("ui-resizable"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio),g.position.top=g._helper?i.top:0),g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top,c=Math.abs((g._helper?g.offset.left-l.left:g.offset.left-l.left)+g.sizeDiff.width),d=Math.abs((g._helper?g.offset.top-l.top:g.offset.top-i.top)+g.sizeDiff.height),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f&&(c-=Math.abs(g.parentData.left)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio))},stop:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=function(b){a(b).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};"object"!=typeof c.alsoResize||c.alsoResize.parentNode?d(c.alsoResize):c.alsoResize.length?(c.alsoResize=c.alsoResize[0],d(c.alsoResize)):a.each(c.alsoResize,function(a){d(a)})},resize:function(b,c){var d=a(this).data("ui-resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,d){a(b).each(function(){var b=a(this),e=a(this).data("ui-resizable-alsoresize"),f={},g=d&&d.length?d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(g,function(a,b){var c=(e[b]||0)+(h[b]||0);c&&c>=0&&(f[b]=c||null)}),b.css(f)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?i(e.alsoResize):a.each(e.alsoResize,function(a,b){i(a,b)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).data("ui-resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).data("ui-resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size,e=b.originalSize,f=b.originalPosition,g=b.axis,h="number"==typeof c.grid?[c.grid,c.grid]:c.grid,i=h[0]||1,j=h[1]||1,k=Math.round((d.width-e.width)/i)*i,l=Math.round((d.height-e.height)/j)*j,m=e.width+k,n=e.height+l,o=c.maxWidth&&c.maxWidth<m,p=c.maxHeight&&c.maxHeight<n,q=c.minWidth&&c.minWidth>m,r=c.minHeight&&c.minHeight>n;c.grid=h,q&&(m+=i),r&&(n+=j),o&&(m-=i),p&&(n-=j),/^(se|s|e)$/.test(g)?(b.size.width=m,b.size.height=n):/^(ne)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.top=f.top-l):/^(sw)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.left=f.left-k):(n-j>0?(b.size.height=n,b.position.top=f.top-l):(b.size.height=j,b.position.top=f.top+e.height-j),m-i>0?(b.size.width=m,b.position.left=f.left-k):(b.size.width=i,b.position.left=f.left+e.width-i))}})}(jQuery),function(a){function b(b,c){var d=(b.attr("aria-describedby")||"").split(/\s+/);d.push(c),b.data("ui-tooltip-id",c).attr("aria-describedby",a.trim(d.join(" ")))}function c(b){var c=b.data("ui-tooltip-id"),d=(b.attr("aria-describedby")||"").split(/\s+/),e=a.inArray(c,d);-1!==e&&d.splice(e,1),b.removeData("ui-tooltip-id"),d=a.trim(d.join(" ")),d?b.attr("aria-describedby",d):b.removeAttr("aria-describedby")}var d=0;a.widget("ui.tooltip",{version:"1.10.2",options:{content:function(){var b=a(this).attr("title")||"";return a("<a>").text(b).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(b,c){var d=this;return"disabled"===b?(this[c?"_disable":"_enable"](),void(this.options[b]=c)):(this._super(b,c),void("content"===b&&a.each(this.tooltips,function(a,b){d._updateContent(b)})))},_disable:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d[0],b.close(e,!0)}),this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.is("[title]")&&b.data("ui-tooltip-title",b.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var b=a(this);b.data("ui-tooltip-title")&&b.attr("title",b.data("ui-tooltip-title"))})},open:function(b){var c=this,d=a(b?b.target:this.element).closest(this.options.items);d.length&&!d.data("ui-tooltip-id")&&(d.attr("title")&&d.data("ui-tooltip-title",d.attr("title")),d.data("ui-tooltip-open",!0),b&&"mouseover"===b.type&&d.parents().each(function(){var b,d=a(this);d.data("ui-tooltip-open")&&(b=a.Event("blur"),b.target=b.currentTarget=this,c.close(b,!0)),d.attr("title")&&(d.uniqueId(),c.parents[this.id]={element:this,title:d.attr("title")},d.attr("title",""))}),this._updateContent(d,b))},_updateContent:function(a,b){var c,d=this.options.content,e=this,f=b?b.type:null;return"string"==typeof d?this._open(b,a,d):(c=d.call(a[0],function(c){a.data("ui-tooltip-open")&&e._delay(function(){b&&(b.type=f),this._open(b,a,c)})}),void(c&&this._open(b,a,c)))},_open:function(c,d,e){function f(a){j.of=a,g.is(":hidden")||g.position(j)}var g,h,i,j=a.extend({},this.options.position);if(e){if(g=this._find(d),g.length)return void g.find(".ui-tooltip-content").html(e);d.is("[title]")&&(c&&"mouseover"===c.type?d.attr("title",""):d.removeAttr("title")),g=this._tooltip(d),b(d,g.attr("id")),g.find(".ui-tooltip-content").html(e),this.options.track&&c&&/^mouse/.test(c.type)?(this._on(this.document,{mousemove:f}),f(c)):g.position(a.extend({of:d},this.options.position)),a("img",g).on("load",function(){f.call(this,j.of)}),a(document.body).on("resize",function(){f.call(this,j.of)}),g.hide(),this._show(g,this.options.show),this.options.show&&this.options.show.delay&&(i=this.delayedShow=setInterval(function(){g.is(":visible")&&(f(j.of),clearInterval(i))},a.fx.interval)),this._trigger("open",c,{tooltip:g}),h={keyup:function(b){if(b.keyCode===a.ui.keyCode.ESCAPE){var c=a.Event(b);c.currentTarget=d[0],this.close(c,!0)}},remove:function(){this._removeTooltip(g)}},c&&"mouseover"!==c.type||(h.mouseleave="close"),c&&"focusin"!==c.type||(h.focusout="close"),this._on(!0,d,h)}},close:function(b){var d=this,e=a(b?b.currentTarget:this.element),f=this._find(e);this.closing||(clearInterval(this.delayedShow),e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title")),c(e),f.stop(!0),this._hide(f,this.options.hide,function(){d._removeTooltip(a(this))}),e.removeData("ui-tooltip-open"),this._off(e,"mouseleave focusout keyup"),e[0]!==this.element[0]&&this._off(e,"remove"),this._off(this.document,"mousemove"),b&&"mouseleave"===b.type&&a.each(this.parents,function(b,c){a(c.element).attr("title",c.title),delete d.parents[b]}),this.closing=!0,this._trigger("close",b,{tooltip:f}),this.closing=!1)},_tooltip:function(b){var c="ui-tooltip-"+d++,e=a("<div>").attr({id:c,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return a("<div>").addClass("ui-tooltip-content").appendTo(e),e.appendTo(this.document[0].body),this.tooltips[c]=b,e},_find:function(b){var c=b.data("ui-tooltip-id");return c?a("#"+c):a()},_removeTooltip:function(a){a.remove(),delete this.tooltips[a.attr("id")]},_destroy:function(){var b=this;a.each(this.tooltips,function(c,d){var e=a.Event("blur");e.target=e.currentTarget=d[0],b.close(e,!0),a("#"+c).remove(),d.data("ui-tooltip-title")&&(d.attr("title",d.data("ui-tooltip-title")),d.removeData("ui-tooltip-title"))})}})}(jQuery),function(a){var b=5;a.widget("ui.slider",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;c>b;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var a=this.handles.add(this.range).filter("a");this._off(a),this._on(a,this._handleEvents),this._hoverable(a),this._focusable(a)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return l.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h===!1?!1:(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),0>d&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&d>c)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),void this._change(null,0)):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),void this._change(null,b);if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;e>d;d+=1)this._change(null,d);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=this._animateOff?!1:h.animate,k={};this.options.values&&this.options.values.length?this.handles.each(function(d){c=(i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())*100,k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?(d-e)/(f-e)*100:0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(c){var d,e,f,g,h=a(c.target).data("ui-slider-handle-index");switch(c.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(c.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(c.target).addClass("ui-state-active"),d=this._start(c,h),d===!1))return}switch(g=this.options.step,e=f=this.options.values&&this.options.values.length?this.values(h):this.value(),c.keyCode){case a.ui.keyCode.HOME:f=this._valueMin();break;case a.ui.keyCode.END:f=this._valueMax();break;case a.ui.keyCode.PAGE_UP:f=this._trimAlignValue(e+(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.PAGE_DOWN:f=this._trimAlignValue(e-(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(e===this._valueMax())return;f=this._trimAlignValue(e+g);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(e===this._valueMin())return;f=this._trimAlignValue(e-g)}this._slide(c,h,f)},click:function(a){a.preventDefault()},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}})}(jQuery),function(a){function b(a,b,c){return a>b&&b+c>a}function c(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}a.widget("ui.sortable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||c(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(b),a(b.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(d=a(this),!1):void 0}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),d&&(!this.options.handle||c||(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),e))?(this.currentItem=d,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&i>d+j,m="y"===this.options.axis||b+k>f&&g>b+k,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var c="x"===this.options.axis||b(this.positionAbs.top+this.offset.click.top,a.top,a.height),d="y"===this.options.axis||b(this.positionAbs.left+this.offset.click.left,a.left,a.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&"right"===g||"down"===f?2:1:f&&("down"===f?2:1):!1},_intersectsWithSides:function(a){var c=b(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),d=b(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"===f&&d||"left"===f&&!d:e&&("down"===e&&c||"up"===e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();
if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;j>d;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){(!c||d.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(d){var e,f,g,h,i,j,k,l,m,n,o=null,p=null;for(e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(o&&a.contains(this.containers[e].element[0],o.element[0]))continue;o=this.containers[e],p=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",d,this._uiHash(this)),this.containers[e].containerCache.over=0);if(o)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(g=1e4,h=null,n=o.floating||c(this.currentItem),i=n?"left":"top",j=n?"width":"height",k=this.positionAbs[i]+this.offset.click[i],f=this.items.length-1;f>=0;f--)a.contains(this.containers[p].element[0],this.items[f].item[0])&&this.items[f].item[0]!==this.currentItem[0]&&(!n||b(this.positionAbs.top+this.offset.click.top,this.items[f].top,this.items[f].height))&&(l=this.items[f].item.offset()[i],m=!1,Math.abs(l-k)>Math.abs(l+this.items[f][j]-k)&&(m=!0,l+=this.items[f][j]),Math.abs(l-k)<g&&(g=Math.abs(l-k),h=this.items[f],this.direction=m?"up":"down"));if(!h&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;h?this._rearrange(d,h,null,!0):this._rearrange(d,null,this.containers[p].element,!0),this._trigger("change",d,this._uiHash()),this.containers[p]._trigger("change",d,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(!d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)("auto"===this._storedCSS[d]||"static"===this._storedCSS[d])&&(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a){var b={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},c={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(b){var c=a(this).css(b).offset().top;0>c&&a(this).css("top",b.top-c)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&a.fn.draggable&&this._makeDraggable(),this.options.resizable&&a.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var b=this.options.appendTo;return b&&(b.jquery||b.nodeType)?a(b):this.document.find(b||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),a=b.parent.children().eq(b.index),a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,close:function(b){var c,d=this;if(this._isOpen&&this._trigger("beforeClose",b)!==!1){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{c=this.document[0].activeElement,c&&"body"!==c.nodeName.toLowerCase()&&a(c).blur()}catch(e){}this._hide(this.uiDialog,this.options.hide,function(){d._trigger("close",b)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(a,b){var c=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return c&&!b&&this._trigger("focus",a),c},open:function(){var b=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=a(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable(),b._trigger("focus")}),void this._trigger("open"))},_focusTabbable:function(){var a=this.element.find("[autofocus]");a.length||(a=this.element.find(":tabbable")),a.length||(a=this.uiDialogButtonPane.find(":tabbable")),a.length||(a=this.uiDialogTitlebarClose.filter(":tabbable")),a.length||(a=this.uiDialog),a.eq(0).focus()},_keepFocus:function(b){function c(){var b=this.document[0].activeElement,c=this.uiDialog[0]===b||a.contains(this.uiDialog[0],b);c||this._focusTabbable()}b.preventDefault(),c.call(this),this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)return b.preventDefault(),void this.close(b);if(b.keyCode===a.ui.keyCode.TAB){var c=this.uiDialog.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==this.uiDialog[0]||b.shiftKey?b.target!==d[0]&&b.target!==this.uiDialog[0]||!b.shiftKey||(e.focus(1),b.preventDefault()):(d.focus(1),b.preventDefault())}},mousedown:function(a){this._moveToTop(a)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var b;this.uiDialogTitlebar=a("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=a("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(a){a.preventDefault(),this.close(a)}}),b=a("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(b),this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title||a.html("&#160;"),a.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=a("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),a.isEmptyObject(c)||a.isArray(c)&&!c.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(a.each(c,function(c,d){var e,f;d=a.isFunction(d)?{click:d,text:c}:d,d=a.extend({type:"button"},d),e=d.click,d.click=function(){e.apply(b.element[0],arguments)},f={icons:d.icons,text:d.showText},delete d.icons,delete d.showText,a("<button></button>",d).button(f).appendTo(b.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,e){a(this).addClass("ui-dialog-dragging"),c._blockFrames(),c._trigger("dragStart",d,b(e))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(e,f){d.position=[f.position.left-c.document.scrollLeft(),f.position.top-c.document.scrollTop()],a(this).removeClass("ui-dialog-dragging"),c._unblockFrames(),c._trigger("dragStop",e,b(f))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,d=this.options,e=d.resizable,f=this.uiDialog.css("position"),g="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:this._minHeight(),handles:g,start:function(d,e){a(this).addClass("ui-dialog-resizing"),c._blockFrames(),c._trigger("resizeStart",d,b(e))},resize:function(a,d){c._trigger("resize",a,b(d))},stop:function(e,f){d.height=a(this).height(),d.width=a(this).width(),a(this).removeClass("ui-dialog-resizing"),c._unblockFrames(),c._trigger("resizeStop",e,b(f))}}).css("position",f)},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=this.uiDialog.is(":visible");a||this.uiDialog.show(),this.uiDialog.position(this.options.position),a||this.uiDialog.hide()},_setOptions:function(d){var e=this,f=!1,g={};a.each(d,function(a,d){e._setOption(a,d),a in b&&(f=!0),a in c&&(g[a]=d)}),f&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",g)},_setOption:function(a,b){var c,d,e=this.uiDialog;"dialogClass"===a&&e.removeClass(this.options.dialogClass).addClass(b),"disabled"!==a&&(this._super(a,b),"appendTo"===a&&this.uiDialog.appendTo(this._appendTo()),"buttons"===a&&this._createButtons(),"closeText"===a&&this.uiDialogTitlebarClose.button({label:""+b}),"draggable"===a&&(c=e.is(":data(ui-draggable)"),c&&!b&&e.draggable("destroy"),!c&&b&&this._makeDraggable()),"position"===a&&this._position(),"resizable"===a&&(d=e.is(":data(ui-resizable)"),d&&!b&&e.resizable("destroy"),d&&"string"==typeof b&&e.resizable("option","handles",b),d||b===!1||this._makeResizable()),"title"===a&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var a,b,c,d=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),d.minWidth>d.width&&(d.width=d.minWidth),a=this.uiDialog.css({height:"auto",width:d.width}).outerHeight(),b=Math.max(0,d.minHeight-a),c="number"==typeof d.maxHeight?Math.max(0,d.maxHeight-a):"none","auto"===d.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,d.height-a)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(b){return a(b.target).closest(".ui-dialog").length?!0:!!a(b.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var b=this,c=this.widgetFullName;a.ui.dialog.overlayInstances||this._delay(function(){a.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(d){b._allowInteraction(d)||(d.preventDefault(),a(".ui-dialog:visible:last .ui-dialog-content").data(c)._focusTabbable())})}),this.overlay=a("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),a.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(a.ui.dialog.overlayInstances--,a.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),a.ui.dialog.overlayInstances=0,a.uiBackCompat!==!1&&a.widget("ui.dialog",a.ui.dialog,{_position:function(){var b,c=this.options.position,d=[],e=[0,0];c?(("string"==typeof c||"object"==typeof c&&"0"in c)&&(d=c.split?c.split(" "):[c[0],c[1]],1===d.length&&(d[1]=d[0]),a.each(["left","top"],function(a,b){+d[a]===d[a]&&(e[a]=d[a],d[a]=b)}),c={my:d[0]+(e[0]<0?e[0]:"+"+e[0])+" "+d[1]+(e[1]<0?e[1]:"+"+e[1]),at:d.join(" ")}),c=a.extend({},a.ui.dialog.prototype.options.position,c)):c=a.ui.dialog.prototype.options.position,b=this.uiDialog.is(":visible"),b||this.uiDialog.show(),this.uiDialog.position(c),b||this.uiDialog.hide()}})}(jQuery),function(a){function b(){var a=document.createElement("input"),b="onpaste";return a.setAttribute(b,""),"function"==typeof a[b]?"paste":"input"}var c,d=b()+".mask",e=navigator.userAgent,f=/iphone/i.test(e),g=/android/i.test(e);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",replacement:"",placeholder:"_"},a.fn.extend({caret:function(a,b){var c;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof a?(b="number"==typeof b?b:a,this.each(function(){this.setSelectionRange?this.setSelectionRange(a,b):this.createTextRange&&(c=this.createTextRange(),c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",a),c.select())})):(this[0].setSelectionRange?(a=this[0].selectionStart,b=this[0].selectionEnd):document.selection&&document.selection.createRange&&(c=document.selection.createRange(),a=0-c.duplicate().moveStart("character",-1e5),b=a+c.text.length),{begin:a,end:b})},unmask:function(){return this.trigger("unmask")},mask:function(b,e){var h,i,j,k,l,m;return!b&&this.length>0?(h=a(this[0]),h.data(a.mask.dataName)()):(e=a.extend({placeholder:a.mask.placeholder,replacement:a.mask.replacement,completed:null},e),i=a.mask.definitions,j=[],k=m=b.length,l=null,a.each(b.split(""),function(a,b){"?"==b?(m--,k=a):i[b]?(j.push(new RegExp(i[b])),null===l&&(l=j.length-1)):j.push(null)}),this.trigger("unmask").each(function(){function h(a){for(;++a<m&&!j[a];);return a}function n(a){for(;--a>=0&&!j[a];);return a}function o(a,b){var c,d;if(!(0>a)){for(c=a,d=h(b);m>c;c++)if(j[c]){if(!(m>d&&j[c].test(w[d])))break;w[c]=w[d],w[d]=e.placeholder,d=h(d)}t(),v.caret(Math.max(l,a))}}function p(a){var b,c,d,f;for(b=a,c=e.placeholder;m>b;b++)if(j[b]){if(d=h(b),f=w[b],w[b]=c,!(m>d&&j[d].test(f)))break;c=f}}function q(a){var b,c,d,e=a.which;8===e||46===e||f&&127===e?(b=v.caret(),c=b.begin,d=b.end,d-c===0&&(c=46!==e?n(c):d=h(c-1),d=46===e?h(d):d),s(c,d),o(c,d-1),a.preventDefault()):27==e&&(v.val(x),v.caret(0,u()),a.preventDefault())}function r(b){var c,d,f,i=b.which,k=v.caret();b.ctrlKey||b.altKey||b.metaKey||32>i||i&&(k.end-k.begin!==0&&(s(k.begin,k.end),o(k.begin,k.end-1)),c=h(k.begin-1),m>c&&(d=String.fromCharCode(i),j[c].test(d)&&(p(c),w[c]=d,t(),f=h(c),g?setTimeout(a.proxy(a.fn.caret,v,f),0):v.caret(f),e.completed&&f>=m&&e.completed.call(v))),b.preventDefault())}function s(a,b){var c;for(c=a;b>c&&m>c;c++)j[c]&&(w[c]=e.placeholder)}function t(){v.val(w.join(""))}function u(a,b){var c,d,f=v.val(),g=-1;for(c=0,pos=0;m>c;c++)if(j[c]){for(w[c]=e.placeholder;pos++<f.length;)if(d=f.charAt(pos-1),j[c].test(d)){w[c]=d,g=c;break}if(pos>f.length)break}else w[c]===f.charAt(pos)&&c!==k&&(pos++,g=c);return a?t():b&&g>=0?(t(),v.val(v.val().replace(new RegExp(e.placeholder,"g"),e.replacement)),s(0,m)):k>g+1?(t(),v.val(""),s(0,m)):(t(),v.val(v.val().substring(0,g+1))),k?c:l}var v=a(this),w=a.map(b.split(""),function(a){return"?"!=a?i[a]?e.placeholder:a:void 0}),x=v.val();v.data(a.mask.dataName,function(){return a.map(w,function(a,b){return j[b]&&a!=e.placeholder?a:null}).join("")}),v.attr("readonly")||v.one("unmask",function(){v.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){clearTimeout(c);var a;x=v.val(),a=u(),c=setTimeout(function(){t(),a==b.length?v.caret(0,a):v.caret(a)},10)}).bind("blur.mask",function(){u(null,!0),v.val()!=x&&v.change()}).bind("keydown.mask",q).bind("keypress.mask",r).bind(d,function(){setTimeout(function(){var a=u(!0);v.caret(a),e.completed&&a==v.val().length&&e.completed.call(v)},0)}),u()}))}})}(jQuery),function(a){var b=window.EYE=function(){var b={init:[]};return{init:function(){a.each(b.init,function(a,b){b.call()})},extend:function(a){for(var b in a)void 0!=a[b]&&(this[b]=a[b])},register:function(a,c){b[c]||(b[c]=[]),b[c].push(a)}}}();a(b.init)}(jQuery),function(a){EYE.extend({getPosition:function(a,b){var c=0,d=0,e=a.style,f=!1;if(b&&"none"==jQuery.curCSS(a,"display")){var g=e.visibility,h=e.position;f=!0,e.visibility="hidden",e.display="block",e.position="absolute"}var i=a;if(i.getBoundingClientRect){var j=i.getBoundingClientRect();c=j.left+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft)-2,d=j.top+Math.max(document.documentElement.scrollTop,document.body.scrollTop)-2}else{if(c=i.offsetLeft,d=i.offsetTop,i=i.offsetParent,a!=i)for(;i;)c+=i.offsetLeft,d+=i.offsetTop,i=i.offsetParent;for(jQuery.browser.safari&&"absolute"==jQuery.curCSS(a,"position")&&(c-=document.body.offsetLeft,d-=document.body.offsetTop),i=a.parentNode;i&&"BODY"!=i.tagName.toUpperCase()&&"HTML"!=i.tagName.toUpperCase();)"inline"!=jQuery.curCSS(i,"display")&&(c-=i.scrollLeft,d-=i.scrollTop),i=i.parentNode}return 1==f&&(e.display="none",e.position=h,e.visibility=g),{x:c,y:d}},getSize:function(a){var b=parseInt(jQuery.curCSS(a,"width"),10),c=parseInt(jQuery.curCSS(a,"height"),10),d=0,e=0;if("none"!=jQuery.curCSS(a,"display"))d=a.offsetWidth,e=a.offsetHeight;else{var f=a.style,g=f.visibility,h=f.position;f.visibility="hidden",f.display="block",f.position="absolute",d=a.offsetWidth,e=a.offsetHeight,f.display="none",f.position=h,f.visibility=g}return{w:b,h:c,wb:d,hb:e}},getClient:function(a){var b,c;if(a)c=a.clientWidth,b=a.clientHeight;else{var d=document.documentElement;c=window.innerWidth||self.innerWidth||d&&d.clientWidth||document.body.clientWidth,b=window.innerHeight||self.innerHeight||d&&d.clientHeight||document.body.clientHeight}return{w:c,h:b}},getScroll:function(a){var b=0,c=0,d=0,e=0,f=0,g=0;return a&&"body"!=a.nodeName.toLowerCase()?(b=a.scrollTop,c=a.scrollLeft,d=a.scrollWidth,e=a.scrollHeight):(document.documentElement?(b=document.documentElement.scrollTop,c=document.documentElement.scrollLeft,d=document.documentElement.scrollWidth,e=document.documentElement.scrollHeight):document.body&&(b=document.body.scrollTop,c=document.body.scrollLeft,d=document.body.scrollWidth,e=document.body.scrollHeight),"undefined"!=typeof pageYOffset&&(b=pageYOffset,c=pageXOffset),f=self.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,g=self.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0),{t:b,l:c,w:d,h:e,iw:f,ih:g}},getMargins:function(a,b){var c=jQuery.curCSS(a,"marginTop")||"",d=jQuery.curCSS(a,"marginRight")||"",e=jQuery.curCSS(a,"marginBottom")||"",f=jQuery.curCSS(a,"marginLeft")||"";return b?{t:parseInt(c,10)||0,r:parseInt(d,10)||0,b:parseInt(e,10)||0,l:parseInt(f,10)}:{t:c,r:d,b:e,l:f}},getPadding:function(a,b){var c=jQuery.curCSS(a,"paddingTop")||"",d=jQuery.curCSS(a,"paddingRight")||"",e=jQuery.curCSS(a,"paddingBottom")||"",f=jQuery.curCSS(a,"paddingLeft")||"";return b?{t:parseInt(c,10)||0,r:parseInt(d,10)||0,b:parseInt(e,10)||0,l:parseInt(f,10)}:{t:c,r:d,b:e,l:f}},getBorder:function(a,b){var c=jQuery.curCSS(a,"borderTopWidth")||"",d=jQuery.curCSS(a,"borderRightWidth")||"",e=jQuery.curCSS(a,"borderBottomWidth")||"",f=jQuery.curCSS(a,"borderLeftWidth")||"";return b?{t:parseInt(c,10)||0,r:parseInt(d,10)||0,b:parseInt(e,10)||0,l:parseInt(f,10)||0}:{t:c,r:d,b:e,l:f}},traverseDOM:function(a,b){for(b(a),a=a.firstChild;a;)EYE.traverseDOM(a,b),a=a.nextSibling
},getInnerWidth:function(a,b){var c=a.offsetWidth;return b?Math.max(a.scrollWidth,c)-c+a.clientWidth:a.clientWidth},getInnerHeight:function(a,b){var c=a.offsetHeight;return b?Math.max(a.scrollHeight,c)-c+a.clientHeight:a.clientHeight},getExtraWidth:function(b){return a.boxModel?(parseInt(a.curCSS(b,"paddingLeft"))||0)+(parseInt(a.curCSS(b,"paddingRight"))||0)+(parseInt(a.curCSS(b,"borderLeftWidth"))||0)+(parseInt(a.curCSS(b,"borderRightWidth"))||0):0},getExtraHeight:function(b){return a.boxModel?(parseInt(a.curCSS(b,"paddingTop"))||0)+(parseInt(a.curCSS(b,"paddingBottom"))||0)+(parseInt(a.curCSS(b,"borderTopWidth"))||0)+(parseInt(a.curCSS(b,"borderBottomWidth"))||0):0},isChildOf:function(b,c,d){if(b==c)return!0;if(!c||!c.nodeType||1!=c.nodeType)return!1;if(b.contains&&!a.browser.safari)return b.contains(c);if(b.compareDocumentPosition)return!!(16&b.compareDocumentPosition(c));for(var e=c.parentNode;e&&e!=d;){if(e==b)return!0;e=e.parentNode}return!1},centerEl:function(b,c){var d=EYE.getScroll(),e=EYE.getSize(b);c&&"vertically"!=c||a(b).css({top:d.t+(Math.min(d.h,d.ih)-e.hb)/2+"px"}),c&&"horizontally"!=c||a(b).css({left:d.l+(Math.min(d.w,d.iw)-e.wb)/2+"px"})}}),a.easing.easeout||(a.easing.easeout=function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c})}(jQuery),function(a){var b=function(){var b=window.location.hash.replace("#",""),d=a("ul.navigationTabs a").bind("click",c).filter("a[rel="+b+"]");0==d.size()&&(d=a("ul.navigationTabs a:first")),c.apply(d.get(0)),a("#colorpickerHolder").ColorPicker({flat:!0}),a("#colorpickerHolder2").ColorPicker({flat:!0,color:"#00ff00",onSubmit:function(b,c){a("#colorSelector2 div").css("backgroundColor","#"+c)}}),a("#colorpickerHolder2>div").css("position","absolute");var e=!1;a("#colorSelector2").bind("click",function(){a("#colorpickerHolder2").stop().animate({height:e?0:173},500),e=!e}),a("#colorpickerField1, #colorpickerField2, #colorpickerField3").ColorPicker({onSubmit:function(b,c,d,e){a(e).val(c),a(e).ColorPickerHide()},onBeforeShow:function(){a(this).ColorPickerSetColor(this.value)}}).bind("keyup",function(){a(this).ColorPickerSetColor(this.value)}),a("#colorSelector").ColorPicker({color:"#0000ff",onShow:function(b){return a(b).fadeIn(500),!1},onHide:function(b){return a(b).fadeOut(500),!1},onChange:function(b,c){a("#colorSelector div").css("backgroundColor","#"+c)}})},c=function(){var b=a("ul.navigationTabs a").removeClass("active").index(this);a(this).addClass("active").blur(),a("div.tab").hide().eq(b).show()};EYE.register(b,"init")}(jQuery),function(a){var b=7,c=document.createElement("style");document.head.appendChild(c);var d=function(){function d(){a(document).unbind("mouseup",I),a(document).unbind("mousemove",H)}function e(){a(document).unbind("mousedown",N)}function f(){a(document).unbind("mouseup",z),a(document).unbind("mousemove",y)}function g(){a(document).unbind("mouseup",D),a(document).unbind("mousemove",C)}function h(){a(document).unbind("mouseup",F),a(document).unbind("mousemove",E)}var i=65,j='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_alpha"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_a colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',k={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},l=function(c,d){var e=W(c);a(d).data("colorpicker").fields.eq(1).val(e.r).end().eq(2).val(e.g).end().eq(3).val(e.b).end().eq(b).val(e.a).end()},m=function(c,d){a(d).data("colorpicker").fields.eq(4).val(c.h).end().eq(5).val(c.s).end().eq(6).val(c.b).end().eq(b).val(c.a).end()},n=function(b,c){a(c).data("colorpicker").fields.eq(0).val($(b)).end()},o=function(b,c){a(c).data("colorpicker").selector.css("backgroundColor","#"+Z({h:b.h,s:100,b:100})),a(c).data("colorpicker").selectorIndic.css({left:parseInt(150*b.s/100,10),top:parseInt(150*(100-b.b)/100,10)})},p=function(b,c){a(c).data("colorpicker").hue.css("top",parseInt(150-150*b.h/360,10))},q=function(b,d){a(d).data("colorpicker").alpha.css("top",parseInt(150-150*b.a/100,10));var e="#"+Z(b),f={h:b.h,s:b.s,b:b.b,a:0},g=$(f);c.innerHTML=".colorpicker_alpha { background: -webkit-gradient(linear,50% 0,50% 100%,color-stop(0%,"+e+"), color-stop(100%,"+g+"));background: -webkit-linear-gradient(top,"+e+" 0,"+g+" 100%);background: -moz-linear-gradient(top,"+e+" 0,"+g+" 100%);background: -o-linear-gradient(top,"+e+" 0,"+g+" 100%);background: linear-gradient(top,"+e+" 0,"+g+" 100%);}"},r=function(){},s=function(b,c){a(c).data("colorpicker").newColor.css("backgroundColor",$(b))},t=function(b){var c=b.charCode||b.keyCode||-1;if(c>i&&90>=c||32==c)return!1;var d=a(this).parent().parent();d.data("colorpicker").livePreview===!0&&u.apply(this)},u=function(c){var d,e=a(this).parent().parent();e.data("colorpicker").color=d=this.parentNode.className.indexOf("_hex")>0?U(S(this.value)):this.parentNode.className.indexOf("_hsb")>0?Q({h:parseInt(e.data("colorpicker").fields.eq(4).val(),10),s:parseInt(e.data("colorpicker").fields.eq(5).val(),10),b:parseInt(e.data("colorpicker").fields.eq(6).val(),10),a:parseInt(e.data("colorpicker").fields.eq(b).val(),10)}):V(R({r:parseInt(e.data("colorpicker").fields.eq(1).val(),10),g:parseInt(e.data("colorpicker").fields.eq(2).val(),10),b:parseInt(e.data("colorpicker").fields.eq(3).val(),10),a:parseInt(e.data("colorpicker").fields.eq(b).val(),10)})),c&&(l(d,e.get(0)),n(d,e.get(0)),m(d,e.get(0))),o(d,e.get(0)),p(d,e.get(0)),q(d,e.get(0)),s(d,e.get(0)),e.data("colorpicker")&&e.data("colorpicker").onChange.apply(e,[d,Z(d),W(d)])},v=function(){var b=a(this).parent().parent();b.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},w=function(){i=this.parentNode.className.indexOf("_hex")>0?70:65,a(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),a(this).parent().addClass("colorpicker_focus")},x=function(b){var c=a(this).parent().find("input").focus(),d={el:a(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:b.pageY,field:c,val:parseInt(c.val(),10),preview:a(this).parent().parent().data("colorpicker").livePreview};a(document).bind("mouseup",d,z),a(document).bind("mousemove",d,y)},y=function(a){return a.data.field.val(Math.max(0,Math.min(a.data.max,parseInt(a.data.val+a.pageY-a.data.y,10)))),a.data.preview&&u.apply(a.data.field.get(0),[!0]),!1},z=function(a){return u.apply(a.data.field.get(0),[!0]),a.data.el.removeClass("colorpicker_slider").find("input").focus(),f(),!1},A=function(){var b={cal:a(this).parent(),y:a(this).offset().top};b.preview=b.cal.data("colorpicker").livePreview,a(document).bind("mouseup",b,D),a(document).bind("mousemove",b,C)},B=function(){var b={cal:a(this).parent(),y:a(this).offset().top};b.preview=b.cal.data("colorpicker").livePreview,a(document).bind("mouseup",b,F),a(document).bind("mousemove",b,E)},C=function(a){return u.apply(a.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150,10)).get(0),[a.data.preview]),!1},D=function(a){return l(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),n(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),g(),!1},E=function(a){return u.apply(a.data.cal.data("colorpicker").fields.eq(b).val(parseInt(100*(150-Math.max(0,Math.min(150,a.pageY-a.data.y)))/150,10)).get(0),[a.data.preview]),!1},F=function(a){return l(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),n(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),h(),!1},G=function(){var b={cal:a(this).parent(),pos:a(this).offset()};b.preview=b.cal.data("colorpicker").livePreview,a(document).bind("mouseup",b,I),a(document).bind("mousemove",b,H)},H=function(a){return u.apply(a.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,a.pageY-a.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,a.pageX-a.data.pos.left))/150,10)).get(0),[a.data.preview]),!1},I=function(a){return l(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),n(a.data.cal.data("colorpicker").color,a.data.cal.get(0)),d(),!1},J=function(){a(this).addClass("colorpicker_focus")},K=function(){a(this).removeClass("colorpicker_focus")},L=function(){var b=a(this).parent(),c=b.data("colorpicker").color;b.data("colorpicker").origColor=c,r(c,b.get(0)),b.data("colorpicker")&&b.data("colorpicker").onSubmit(c,Z(c),W(c),b.data("colorpicker").el)},M=function(){var b=a("#"+a(this).data("colorpickerId"));b.data("colorpicker")&&b.data("colorpicker").onBeforeShow.apply(this,[b.get(0)]);var c=a(this).offset(),d=P(),e=c.top+this.offsetHeight,f=c.left;return e+176>d.t+d.h&&(e-=this.offsetHeight+176),f+356>d.l+d.w&&(f-=356),b.css({left:f+"px",top:e+"px"}),0!=b.data("colorpicker").onShow.apply(this,[b.get(0)])&&b.show(),a(document).bind("mousedown",{cal:b},N),!1},N=function(a){O(a.data.cal.get(0),a.target,a.data.cal.get(0))||(a.data.cal.data("colorpicker")&&0!=a.data.cal.data("colorpicker").onHide.apply(this,[a.data.cal.get(0)])&&a.data.cal.hide(),e())},O=function(a,b,c){if(a==b)return!0;if(a.contains)return a.contains(b);if(a.compareDocumentPosition)return!!(16&a.compareDocumentPosition(b));for(var d=b.parentNode;d&&d!=c;){if(d==a)return!0;d=d.parentNode}return!1},P=function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(a?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(a?document.documentElement.clientHeight:document.body.clientHeight)}},Q=function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b)),a:Math.min(100,Math.max(0,a.a))}},R=function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b)),a:Math.min(255,Math.max(0,a.a))}},S=function(a){var b=6-a.length;if(b>0){for(var c=[],d=0;b>d;d++)c.push("0");c.push(a),a=c.join("")}return a},T=function(a){var a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(65280&a)>>8,b:255&a}},U=function(a){return V(T(a))},V=function(a){var b={h:0,s:0,b:0,a:100},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),e=d-c;return b.b=d,b.a=a.a,b.s=0!=d?255*e/d:0,b.h=0!=b.s?a.r==d?(a.g-a.b)/e:a.g==d?2+(a.b-a.r)/e:4+(a.r-a.g)/e:-1,b.h*=60,b.h<0&&(b.h+=360),b.s*=100/255,b.b*=100/255,b},W=function(a){var b={},c=Math.round(a.h),d=Math.round(255*a.s/100),e=Math.round(255*a.b/100);if(b.a=Math.round(a.a),0==d)b.r=b.g=b.b=e;else{var f=e,g=(255-d)*e/255,h=(f-g)*(c%60)/60;360==c&&(c=0),60>c?(b.r=f,b.b=g,b.g=g+h):120>c?(b.g=f,b.b=g,b.r=f-h):180>c?(b.g=f,b.r=g,b.b=g+h):240>c?(b.b=f,b.r=g,b.g=f-h):300>c?(b.b=f,b.g=g,b.r=g+h):360>c?(b.r=f,b.g=g,b.b=f-h):(b.r=0,b.g=0,b.b=0)}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b),a:Math.round(b.a)}},X=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];return a.each(c,function(a,b){1==b.length&&(c[a]="0"+b)}),c.join("")},Y=function(a){var b=[a.r.toString(),a.g.toString(),a.b.toString(),(a.a/100).toString()];return"rgba("+b.join(", ")+")"},Z=function(a){return X(W(a))},$=function(a){return Y(W(a))};return{init:function(b){if(b=a.extend({},k,b||{}),Gis.Util.isDefine(b.color.a)&&b.color.a<=1&&(b.color.a*=100),"string"==typeof b.color)b.color=U(b.color);else if(void 0!=b.color.r&&void 0!=b.color.g&&void 0!=b.color.b)b.color=V(b.color);else{if(void 0==b.color.h||void 0==b.color.s||void 0==b.color.b)return this;b.color=Q(b.color)}return this.each(function(){if(!a(this).data("colorpickerId")){var c=a.extend({},b);c.origColor=b.color;var d="collorpicker_"+parseInt(1e3*Math.random());a(this).data("colorpickerId",d);var e=a(j).attr("id",d);c.flat?e.appendTo(this).show():e.appendTo(document.body),c.fields=e.find("input").bind("keyup",t).bind("change",u).bind("blur",v).bind("focus",w),e.find("span").bind("mousedown",x).end(),c.selector=e.find("div.colorpicker_color").bind("mousedown",G),c.selectorIndic=c.selector.find("div div"),c.el=this,c.hue=e.find("div.colorpicker_hue div"),c.alpha_container=e.find("div.colorpicker_alpha"),c.alpha=e.find("div.colorpicker_alpha div"),e.find("div.colorpicker_hue").bind("mousedown",A),e.find("div.colorpicker_alpha").bind("mousedown",B),c.newColor=e.find("div.colorpicker_new_color"),e.data("colorpicker",c),e.find("div.colorpicker_submit").bind("mouseenter",J).bind("mouseleave",K).bind("click",L),l(c.color,e.get(0)),m(c.color,e.get(0)),n(c.color,e.get(0)),p(c.color,e.get(0)),q(c.color,e.get(0)),o(c.color,e.get(0)),r(c.color,e.get(0)),s(c.color,e.get(0)),c.flat?e.css({position:"relative",display:"block"}):a(this).bind(c.eventName,M)}})},showPicker:function(){return this.each(function(){a(this).data("colorpickerId")&&M.apply(this)})},hidePicker:function(){return this.each(function(){a(this).data("colorpickerId")&&a("#"+a(this).data("colorpickerId")).hide()})},destroy:function(){var b,c=this;return d(),e(),f(),g(),h(),this.each(function(){a(this).data("colorpickerId")&&(b=a("#"+a(this).data("colorpickerId")),b.hide(),c.onShow=null,c.onBeforeShow=null,c.onHide=null,c.onChange=null,c.onSubmit=null,b.remove())})},setColor:function(b){if("string"==typeof b)b=U(b);else if(void 0!=b.r&&void 0!=b.g&&void 0!=b.b)b=V(b);else{if(void 0==b.h||void 0==b.s||void 0==b.b)return this;b=Q(b)}return this.each(function(){if(a(this).data("colorpickerId")){var c=a("#"+a(this).data("colorpickerId"));c.data("colorpicker").color=b,c.data("colorpicker").origColor=b,l(b,c.get(0)),m(b,c.get(0)),n(b,c.get(0)),p(b,c.get(0)),q(b,c.get(0)),o(b,c.get(0)),r(b,c.get(0)),s(b,c.get(0))}})}}}();a.fn.extend({ColorPicker:d.init,ColorPickerHide:d.hidePicker,ColorPickerShow:d.showPicker,ColorPickerSetColor:d.setColor,ColorPickerDestroy:d.destroy})}(jQuery),Gis.HTML={listView:function(a){function b(){this.style.display="none",Gis.HTML.addClass(this.parentNode.querySelector(s),u)}function c(){var a=document.querySelectorAll(".html-select-view"),b=document.querySelectorAll("."+s),c=0,d=b.length;if(a.length)for(c=0,d=a.length;d>c;c+=1)a[c].style.display="none";if(b.length)for(c=0,d=b.length;d>c;c+=1)Gis.HTML.addClass(b[c],u)}function d(){this.style.display="block",Gis.HTML.removeClass(this.parentNode.querySelectorAll("."+s),u)}function e(a,c,d){return function(){if(!Gis.HTML.hasClass(this,"html-list-title")&&!d||!d.call(c,this.getAttribute("data-value"))){var e=l.querySelector(".html-select-view-title");e.setAttribute("data-value",this.getAttribute("data-value")),j||(e.innerHTML=this.innerHTML),Gis.HTML.removeClass(l.querySelectorAll(".selected"),"selected"),Gis.HTML.addClass(this,"selected"),a&&a.call(c,this.getAttribute("data-value")),b.call(l.querySelector(".html-select-view"))}}}function f(a){var b=13;(a.keyCode===b||a.charCode===""+b)&&e.call(this,a)}function g(a){return v()&&Gis.HTML.hasClass(this,u)?(d.call(this.parentNode.querySelector(".html-select-view")),a.stopPropagation(),!1):void b.call(this.parentNode.querySelector(".html-select-view"))}function h(a,b,d){var h=(d||document).querySelectorAll(".html-select-view-row");Gis.HTML.addEventListener(h,"click",e(a,b,p)),Gis.HTML.addEventListener(h,"keypress",f),Gis.HTML.hasClass(document.body,"list-initialized")||(Gis.HTML.addClass(document.body,"list-initialized"),Gis.HTML.addEventListener(document.body,"click",c)),Gis.HTML.addEventListener((d||document).querySelector(".html-select-view-title-container"),"click",g)}function i(a,b,c,d,e){function f(a){var b=a.val,c=a.row,d=a.selected,e=a.childs,f=c.prefix||"";return"<li class='"+(e?"html-list-title ":"html-list-active ")+"html-select-view-row"+(d===f+b?" selected":"")+"' data-value='"+f+b+"'>"+c.name+(e||"")+"</li>"}var g,i,j=e.val,k=e&&e.name;return a&&a.forEach?(a.forEach(function(a){i="",g=a.val,Gis.Util.isArray(a.childs)&&(a.childs.forEach(function(a){i+=f({val:a.val,row:a,selected:j,childs:!1})}),i&&(i='<ul class="ui-list-childs">'+i+"</ul>")),r+=f({val:g,row:a,selected:j,childs:i})}),i="<div class='html-select-view-container'><div class='html-select-view-title-container "+u+"'><span class='html-select-view-title' data-value='"+j+"'>"+k+"</span><span class='"+t+" '></span></div><ul class='html-select-view' style='display: none'>"+r+"</ul></div>",b.innerHTML=i,h(c,d,b),b.querySelector(".html-select-view-container")):void 0}var j,k,l,m,n,o,p,q,r="",s="html-select-view-title-container",t="html-select-view-selector",u="closed";if(k=a.data,l=a.container,!l)return{setValueSelected:function(){},getValueSelected:function(){}};m=a.callback,p=a.onBeforeSelect,q=a.onBeforeOpen,n=a.context,j=a.noText,o=a.defaultValue||k&&k[0];var v=function(){return!q||q(l)};return function(a){return{setValueSelected:function(b){if(this.getValueSelected()!==b){var c,d,e,f,g,h=!1;for(b+="",Gis.HTML.removeClass(a.querySelectorAll(".selected"),"selected"),c=a.querySelectorAll(".html-select-view-row"),g=a.querySelector(".html-select-view-title"),d=0,e=c.length;e>d;d+=1)f=c[d],f.getAttribute("data-value")===b&&(Gis.HTML.addClass(f,"selected"),g.setAttribute("data-value",b),h=!0,j||(g.innerHTML=f.innerHTML));h||(Gis.HTML.removeClass(c,"selected"),g.setAttribute("data-value",""),g.innerHTML=""),m.call(n,b)}},getValueSelected:function(){var b=a.querySelector(".html-select-view-title");return b?b.getAttribute("data-value"):void 0}}}(i(k,l,m,n,o))},hasClass:function(a,b){return a.className.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},addClass:function(a,b){a&&a.classList.add(b)},removeClass:function(a,b){var c;if(a)if(a.className)a.classList.remove(b);else if(a.length)for(c=a.length-1;c>=0;c-=1)a[c].classList.remove(b)},addEventListener:function(a,b,c){var d;if(a.addEventListener)a.addEventListener(b,c);else if(a[0]&&a[0].addEventListener)for(d in a)a.hasOwnProperty(d)&&a[d].addEventListener&&a[d].addEventListener(b,c)},removeEventListener:function(a,b,c){var d;if(a.removeEventListener)a.removeEventListener(b,c);else if(a[0]&&a[0].removeEventListener)for(d in a)a.hasOwnProperty(d)&&a[d].removeEventListener&&a[d].removeEventListener(b,c)},LOADER_HTML:'<div class="windows8"><div class="container"><div class="wBall" id="wBall_1"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_2"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_3"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_4"><div class="wInnerBall"></div></div><div class="wBall" id="wBall_5"><div class="wInnerBall"></div></div></div></div>'},Gis.UI=Gis.BaseClass.extend({_attached:!1,_widgetContainers:{},_containers:{},_widgets:{},_geoSystemConverter:void 0,options:{style:void 0,actionsEnabled:"ellipse marker measure move object path polygon sector select zoom heatmap overlay areal-relief visibility geo geo-path",userSet:void 0},getStyle:function(a){return this.options.style[a]},getActionsActive:function(){var a="select zoom ellipse marker measure layers relief move object path polygon sector heatmap overlay areal-relief visibility geo geo-path";switch(this.options.userSet){case Gis.UI.USERSET.FULL:return a;case Gis.UI.USERSET.VIEW_ONLY:return"select move zoom measure heatmap areal-relief visibility geo geo-path";default:return this.options.userSet&&this.options.userSet.length?this.options.userSet.reduce(function(b,c){return b+(a.indexOf(c)>=0?c+" ":"")},"").trim():this.options.actionsEnabled}},_initActions:function(){var a=this.getActionsActive(),b=Gis.Util.isArray(a)?a:a.split(" "),c=this;b.forEach(function(a){a&&Gis.UI.Action[a](c)})},initialize:function(a,b){var c=this;this._geoSystemConverter=new Gis.UI.CoordinateConverter,this._geoSystemConverter.on("skchanged",function(a){this.fire("skchanged",a)},this),Gis.BaseClass.prototype.initialize.call(this,b),this._initActions(),this.options.style=b&&b.style||Gis.UI.DEFAULT_STYLE,this._resizeFunction=function(){c._recalculateContainerStyles()},this._keyDown=function(a){c.keyDown(a)},this._mouseMove=function(a){c.mouseMove(a)},this._contextMenu=function(a){return a.preventDefault(),a.stopPropagation(),!1},this._mouseDown=function(a){c.mouseDown(a)},this._mouseUp=function(a){c.mouseUp(a)},this._keyUp=function(a){c.keyUp(a)},a&&this.attachToMap(a)},getGeoConverter:function(){return this._geoSystemConverter},_setContainerStyle:function(){this._container.style.position="relative",this._container.className+=" gis-ui-container"},_addContainer:function(a){function b(a,b,c){void 0!==c&&(a.style[b]=c)}var c=document.createElement("div");return c.className+=" "+a.className+" ",c.style.position="absolute",b(c,"top",a.top),b(c,"left",a.left),b(c,"right",a.right),b(c,"bottom",a.bottom),this._container.appendChild(c),this._containers[a.className]=c,c},_createTopContainer:function(){this._addContainer({className:Gis.UI.POSITION.TOP,left:0,top:0})},_createBottomContainer:function(){this._addContainer({className:Gis.UI.POSITION.BOTTOM,left:0,bottom:0})},_createLeftContainer:function(){this._addContainer({className:Gis.UI.POSITION.LEFT,left:0,top:0})},_createRightContainer:function(){this._addContainer({className:Gis.UI.POSITION.RIGHT,right:0,top:0})},_createRightInnerContainer:function(){this._addContainer({className:Gis.UI.POSITION.RIGHT_INNER,right:0,top:0})},_createLeftInnerContainer:function(){this._addContainer({className:Gis.UI.POSITION.LEFT_INNER,left:0,top:0})},calculateStyles:function(){var a,b=this._containers[Gis.UI.POSITION.TOP],c=this._containers[Gis.UI.POSITION.BOTTOM],d=this._containers[Gis.UI.POSITION.LEFT],e=this._containers[Gis.UI.POSITION.RIGHT],f=this._containers[Gis.UI.POSITION.RIGHT_INNER],g=this._containers[Gis.UI.POSITION.LEFT_INNER],h=$(c).is(":visible"),i=$(b).is(":visible"),j=i?$(b).outerHeight(!0):0,k=h?$(c).outerHeight(!0):0,l=$(this._container).width(),m=$(this._container).height(),n=$(d).is(":visible")?$(d).outerWidth(!0):0,o=$(e).is(":visible")?$(e).outerWidth(!0):0,p=(l-n-o)/2,q=m-j-k,r=50;$(d).css({paddingBottom:h?0:24}),a=this.getMap()._getMapOffset&&this.getMap()._getMapOffset()||0,d.style.top=j+"px",e.style.top=j+"px",f.style.top=a+j+"px",f.style.right=a+o+"px",f.style.width=($(f).width()||p)+"px",g.style.width=($(f).width()||p)+"px",g.style.top=j+"px",g.style.left=n+"px",g.style.zIndex=r,f.style.zIndex=r,e.style.zIndex=r,d.style.zIndex=r,b.style.zIndex=r+1,c.style.zIndex=r,$(f).data(Gis.UI.DATA_SELECTORS.AVAILABLE_WIDTH,p),$(g).data(Gis.UI.DATA_SELECTORS.AVAILABLE_WIDTH,p),$(f).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,q-2*a),$(g).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,q-2*a),$(d).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,q),$(e).data(Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT,q),L.Grid&&(L.Grid.OFFSET_TEXT_TOP=j,L.Grid.OFFSET_TEXT_LEFT=n,L.Grid.OFFSET_TEXT_RIGHT=o,L.Grid.OFFSET_TEXT_BOTTOM=k)},_recalculateContainerStyles:function(){this.fire("presizerecalculated"),this.calculateStyles(),this.fire("sizerecalculated")},getAvailableContainerBounds:function(a){var b,c,d;return d=Gis.UI.POSITION[a.toUpperCase()],this._containers[d]?(b=$(this._containers[d]),c=b.data(),{width:c[Gis.UI.DATA_SELECTORS.AVAILABLE_WIDTH]||b.width(),height:c[Gis.UI.DATA_SELECTORS.AVAILABLE_HEIGHT]||b.height()}):void 0},_createWidgetContainers:function(){this.addContainer(Gis.Widget.container({position:"TOP"})),this.addContainer(Gis.Widget.container({position:"LEFT"})),this.addContainer(Gis.Widget.container({position:"RIGHT"})),this.addContainer(Gis.Widget.container({position:"LEFT_INNER"})),this.addContainer(Gis.Widget.container({position:"RIGHT_INNER"})),this.addContainer(Gis.Widget.container({position:"BOTTOM"}))},_createContainers:function(){this._createTopContainer(),this._createBottomContainer(),this._createLeftContainer(),this._createRightContainer(),this._createRightInnerContainer(),this._createLeftInnerContainer(),this._recalculateContainerStyles(),this._createWidgetContainers(),$(window).on("resize",this._resizeFunction)},_initializeHTML:function(){this._container=this._map.getMapContainer().parentNode,this._setContainerStyle(),this._createContainers()},_checkPredefinedState:function(){var a=this;switch(this.options.userSet){case Gis.UI.USERSET.FULL:this.addWidget(Gis.Widget.instruments()),this.addWidget(Gis.Widget.mapcontrol()),this.addWidget(Gis.Widget.scheme()),this.addWidget(Gis.Widget.sliderHorisontal()),this.addWidget(Gis.Widget.sliderVertical());break;case Gis.UI.USERSET.VIEW_ONLY:this.addWidget(Gis.Widget.instruments({instruments:"select move zoom measure"})),this.addWidget(Gis.Widget.mapcontrol()),this.addWidget(Gis.Widget.scheme()),this.addWidget(Gis.Widget.sliderHorisontal()),this.addWidget(Gis.Widget.sliderVertical());break;default:this.options.userSet&&this.options.userSet.length&&this.options.userSet.forEach(function(b){Gis.Widget[b]&&a.addWidget(Gis.Widget[b](a.options.userSet))})}},attachToMap:function(a){return this._map=a,this._attached||(Gis.Map.GridVisibilityChanged&&this._map.on(Gis.Map.GridVisibilityChanged.TYPE,this._resizeFunction,this),a.setDraggableEnabled(!1),this._initializeHTML(),this._attached=!0,this.initKeyNavigation(),this.initMouseNavigation(),this._checkPredefinedState()),this},getMap:function(){return this._map},recalculateMaxSize:function(){var a,b,c,d,e=this._widgetContainers[Gis.UI.POSITION.TOP].getNeedSize(),f=this._widgetContainers[Gis.UI.POSITION.BOTTOM].getNeedSize(!0),g=this._widgetContainers[Gis.UI.POSITION.LEFT].getNeedSize(),h=this._widgetContainers[Gis.UI.POSITION.LEFT_INNER].getNeedSize(),i=this._widgetContainers[Gis.UI.POSITION.RIGHT].getNeedSize(),j=this._widgetContainers[Gis.UI.POSITION.RIGHT_INNER].getNeedSize();a=g[0]+h[0]+i[0]+j[0],c=e[1]+f[1],b=Math.max(c+j[1],c+h[1],c,c+i[1]),d=$("html, body, div#map, div#leaflet-map-gis"),d.css("minWidth",Math.max(e[0],a)),d.css("minHeight",Math.max(b))},hideAll:function(a){for(var b in this._widgetContainers)this._widgetContainers.hasOwnProperty(b)&&this._widgetContainers[b].hideChilds(a)},showAll:function(){for(var a in this._widgetContainers)this._widgetContainers.hasOwnProperty(a)&&this._widgetContainers[a].showChilds()},addWidget:function(a){if(a.isControlAvailable(null,this._map)){var b=Gis.UI.POSITION[a.getPosition().toUpperCase()];this._widgetContainers[b].addChild(a),this.recalculateMaxSize()}return this._recalculateContainerStyles(),this},removeWidget:function(a){if(a){var b=Gis.UI.POSITION[a.getPosition().toUpperCase()];this._widgetContainers[b].removeChild(a),this.recalculateMaxSize()}return this._recalculateContainerStyles(),this},removeWidgetByType:function(a){if(a){var b,c=this._widgetContainers;for(b in c)c.hasOwnProperty(b)&&a&&c[b].removeWidgetByType(a)}return this},addContainer:function(a){var b=Gis.UI.POSITION[a.getPosition().toUpperCase()];this._widgetContainers[b]=a,a.onAdd(this),a.draw(this._containers[b],this.getAvailableContainerBounds(b)),this._recalculateContainerStyles()},_initZoom:function(a){var b;this._lastAction&&"zoom"===this._lastAction.getType()||(this._lastAction&&(this._lastAction.closeAction(),this._lastAction=void 0),b=Gis.UI.Action.zoom(this),b.isExecuted()||(this._lastAction=b,Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().pause(),b.setData({noUI:!0,zoomOut:a}),b.execute()))},_initMove:function(){var a;this._lastAction&&"move"===this._lastAction.getType()||(this._lastAction&&(this._lastAction.closeAction(),this._lastAction=void 0),a=Gis.UI.Action.move(this),a.isExecuted()||(Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().pause(),a.setData({noUI:!0}),a.execute(),this._lastAction=a))},keyDown:function(a){var b=32,c=18,d=17,e=!1,f=a.keyCode||parseInt(a.charCode,10),g=f===b,h=a.srcElement||a.target,i="text"!==h.type;(i&&g||this._lastAction&&(f===c||f===d))&&(a.ctrlKey?(a.altKey&&(e=!0),this._initZoom(e),a.preventDefault()):(this._initMove(),a.preventDefault()))},mouseDown:function(a){var b=2,c=0;a.originalEvent.button===b?(this._secondButton=!0,this._map.on("mouseup",this._mouseUp),this._map.on("mouseout",this._mouseUp)):this._secondButton&&a.originalEvent.button===c&&(this._secondButton=!1,this._zoomStarted=!0,this._oldDraggable=this._map.isDraggableEnabled(),this._map.setDraggableEnabled(!1),this._initZoom(),this._map.on("mousemove",this._mouseMove),a.originalEvent.preventDefault())},mouseUp:function(a){this._secondButton=!1,this._map.off("mouseup",this._mouseUp),this._map.off("mouseout",this._mouseUp),this._map.off("mousemove",this._mouseMove),this._zoomStarted===!0&&(this._lastAction&&(this._lastAction._onMouseUp(a),this._lastAction.closeAction(),this._lastAction=void 0),this._map.setDraggableEnabled(this._oldDraggable),Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().resume()),this._zoomStarted=!1},mouseMove:function(a){this._zoomStarted&&(this._map.off("mousemove",this._mouseMove),this._lastAction._onMouseDown(a))},keyUp:function(a){var b=32,c=17;this._lastAction&&a.keyCode===b?(this._lastAction.closeAction(),this._lastAction=void 0,Gis.UI.ActionController.getLastExecuted()&&Gis.UI.ActionController.getLastExecuted().resume()):this._lastAction&&a.keyCode===c&&this._initMove()},initKeyNavigation:function(){document.body.addEventListener("keydown",this._keyDown),document.body.addEventListener("keyup",this._keyUp)},initMouseNavigation:function(){-1===navigator.userAgent.toLowerCase().indexOf("msie")&&(this._map.getMapContainer().addEventListener("contextmenu",this._contextMenu),this._map.on("mousedown",this._mouseDown))}}),Gis.UI.version=window.GIS_UI_buildVersion||"1.0.4",Gis.UI.POSITION={TOP:"gis-top-container",BOTTOM:"gis-bottom-container",LEFT:"gis-left-container",RIGHT:"gis-right-container",LEFT_INNER:"gis-left-inner-container",RIGHT_INNER:"gis-right-inner-container"},Gis.UI.DATA_SELECTORS={AVAILABLE_WIDTH:"availableWidth",AVAILABLE_HEIGHT:"availableHeight"},Gis.UI.USERSET={NONE:void 0,FULL:["instruments","mapcontrol","slidervertical","scheme","sliderhorisontal","controlmap","controlpostcenter","controlmapselector","controlobjectcenter","controlzoom","controlconnectionstate","controlmouseposition","zoom","move","select","measure","layers","relief","path","object","marker","polygon","ellipse","sector","schemesaveall","schemeload","schemeclear","heatmap","overlay","visibility","areal-relief","geo","geo-path"],VIEW_ONLY:["instruments","mapcontrol","slidervertical","scheme","sliderhorisontal","controlpostcenter","controlmapselector","controlobjectcenter","controlzoom","controlconnectionstate","controlmouseposition","zoom","move","select","measure","layers","relief","heatmap","areal-relief","visibility","geo-path"]},function(a){function b(a,b){return"GAUSZONE"+a+(b?"LATLNG":"")}function c(a){var b={c:"N","в":"E","з":"W","ю":"S","cш":"N","вд":"E","зд":"W","юш":"S"};return b[a.toLowerCase().substr(0,1)]||a.toUpperCase()}function d(a){var b={n:"СШ",e:"ВД",w:"ЗД",s:"ЮШ"};return b[a.toLowerCase().substr(0,1)]||a.toUpperCase()}function e(a,b){return b>=60&&(a+=1,b=0),[a,b]}function f(a,b){var c,d,e="",f=(Math.floor(a)+"").length;if(b>f)for(d=0,c=b-f;c>d;d+=1)e+="0";return e+a}function g(a,b,c,d,e){return proj4.transform(new proj4.Proj(a),new proj4.Proj(b),new proj4.Point(c,d,e))
}for(var h="current-selected-coordinate-system",i="wgs84",j=i,k=1;61>k;k+=1)proj4.defs(b(k),"+proj=tmerc +lat_0=0 +lon_0="+(6*k-3)+" +k=1 +x_0="+k+"500000 +y_0=0 +ellps=krass +towgs84=24,-123,-94,-0.000000096963,0.000001212034,0.000000630258,1.0 +units=m +no_defs"),proj4.defs(b(k,!0),"+proj=longlat +ellps=krass +towgs84=23.9,-141.3,-80.9,0,-0.37,-0.85,-0.12");proj4.defs("EPSG:4923","+proj=longlat +a=6378136 +b=6356751.361745712 +towgs84=0.0,0.0,1.5,-0.0,0.0,-0.076,0.0 +no_defs"),$.mask.definitions.X="[E|W]",$.mask.definitions.Y="[S|N]";var l=a.Util.toFixed,m=1,n=3,o=5,p={full:{isDirectional:!0,template:/([-]*[\d]+)[\u00B0]*\s(\d+)[']* (\d+[\.\d+]*)["]*(\s[SNEWСЮШВЗДsnewсюшвзд]+)*/,getTemplate:function(a){return(a?"99":"999")+"° 99' 99.9\""},fillTemplate:function(a,b,c,g,h){c=c||0,b=b||0,a=a||0;var i,j,k=parseFloat(b),n=parseFloat(c);return g||(g=parseFloat(a)>0?h?"E":"N":h?"W":"S"),j=parseFloat(l(a,9)),j=Math.abs(j),a=parseInt(j,10),b=parseInt(60*(j-a),10)+parseInt(k),c=l(parseFloat(60*(60*(j-a)+k-b))+n,m),i=e(b,c),b=i[0],c=f(i[1],2),i=e(a,b),a=f(i[0],h?3:2),b=f(i[1],2),a+String.fromCharCode("176")+" "+b+"' "+c+'" '+d(g)},fromBase:function(a,b){return this.fillTemplate(a,null,null,null,b)},toBase:function(a){var b,d,e=1;if(a+="",b=a.match(this.template),b&&b.length){if(b[4])switch(d=c(b[4].trim()).toLowerCase()){case"w":case"s":e=-1}return(parseFloat(b[1])+parseFloat(b[2])/60+parseFloat(b[3])/3600)*e}return 0}},middle:{isDirectional:!0,template:/([-]*[\d]+)[\u00B0]*\s(\d+[\.\d*]*)[']*(\s[SNEWСЮШВЗДsnewсюшвзд]+)*/,getTemplate:function(a){return(a?"99":"999")+"° 99.999'"},fillTemplate:function(a,b,c,g,h){var i,j;return c=parseFloat(c||0),b=parseFloat(b||0),a=parseFloat(a||0),g||(g=parseFloat(a)>0?h?"E":"N":h?"W":"S"),j=parseFloat(l(a,9)),j=Math.abs(j),a=parseInt(j,10),c&&(b+=c/60),b=l(60*(j-a)+parseFloat(b),n),i=e(a,b),a=f(i[0],h?3:2),b=f(i[1],2),a+String.fromCharCode("176")+" "+b+"' "+d(g)},fromBase:function(a,b){return this.fillTemplate(a,null,null,null,b)},toBase:function(a){var b,d,e=1;if(a+="",b=a.match(this.template),b&&b.length){if(b[3])switch(d=c(b[3].trim()).toLowerCase()){case"w":case"s":e=-1}return(parseFloat(b[1])+parseFloat(b[2])/60)*e}return 0}},"short":{isDirectional:!0,template:/([-]*[\d]+[\.]*[\d]*)[\u00B0]*(\s[SNEWСЮШВЗДsnewсюшвзд]+)*/,getTemplate:function(a){return(a?"99":"999")+".99999°"},fillTemplate:function(a,b,c,e,g){var h,i,j;return c=parseFloat(c||0),b=parseFloat(b||0),a=parseFloat(a||0),e||(e=parseFloat(a)>0?g?"E":"N":g?"W":"S"),a=Math.abs(a),c&&(b+=c/60),b&&(a+=b/60),h=parseFloat(l(a,o)),i=Math.floor(h),j=l(h-Math.floor(h)+"",o).replace(/0\./,""),i=f(i,g?3:2),i+"."+j+String.fromCharCode("176")+" "+d(e)},fromBase:function(a,b){return this.fillTemplate(a,null,null,null,b)},toBase:function(a){var b,d,e=1;if(a+="",b=a.match(this.template),b&&b.length){if(b[2])switch(d=c(b[2].trim()).toLowerCase()){case"w":case"s":e=-1}return parseFloat(b[1])*e}return parseFloat(a)}}};a.UI.Coordinate=a.BaseClass.extend({accuracy:9,initialize:function(b,c,d){a.Util.isArray(b)?(this.x=b[0],this.y=b[1],this.z=b[2]):b&&b.hasOwnProperty("x")?(this.x=b.x,this.y=b.y,this.z=b.z):b&&b.hasOwnProperty("lat")?(this.x=b.lng,this.y=b.lat,this.z=b.z):b&&b.hasOwnProperty("latitude")?(this.x=b.longitude,this.y=b.latitude,this.z=b.z):(this.x=b,this.y=c,this.z=d),this.x=void 0==this.x||"NaN"===this.x?"":this.x,this.y=void 0==this.y||"NaN"===this.y?"":this.y,this.z=void 0==this.z||"NaN"===this.z?"":this.z},getX:function(){return this.x},getY:function(){return this.y},getZ:function(){return this.z}}),a.UI.coordinate=function(b,c,d){return b&&b.getZ?b:new a.UI.Coordinate(b,c,d)},a.UI.CoordinateConverter=a.BaseClass.extend({_selectedTemplate:"full",_baseSystem:i,_selectedSystem:j,templates:{wgs84:["full","middle","short"],"sk-42":["full","middle","short"],"pz-90":["full","middle","short"]},getDirectionNameInner:c,getDirectionNameOutter:d,_systemNames:{wgs84:"WGS-84","sk-42":"СК-42","pz-90":"ПЗ-90",gauss:"Гаусс-Крюгер",full:"ГМС","short":"Г",middle:"ГМ"},options:{availableSystems:[j,"sk-42","pz-90","gauss"]},getCurrentMask:function(a){return this.getSelectedTemplate()&&p[this.getSelectedTemplate()]&&p[this.getSelectedTemplate()].getTemplate(a)},isTemplateDirectional:function(a,b){return b=b||this.getSelectedTemplate(),this.isTemplatingAvailable(a)&&b&&p[b]&&p[b].isDirectional},initialize:function(){var c=this,d=a.Preferences.getPreferenceData(h);d&&this.setActiveSystem(d),this._systems={gauss:{fromBase:function(c,d,e){var f=g("WGS84",b(a.Util.getZoneFromLongitude(c)),c,d,e);return a.UI.coordinate(l(f.y),l(f.x),l(f.z))},toBase:function(d,e,f){var h=""+parseInt(e,10),i=h.substr(0,h.length-6);i=i?i>60?i%60:0>i?60+i%60:i:null;var j=g(b(i||c._autoZone),"WGS84",(i?"":c._autoZone||1)+parseFloat(e),parseFloat(d),parseFloat(f));return a.UI.coordinate(parseFloat(l(j.x,8)),parseFloat(l(j.y,8)),parseFloat(l(j.z,8)))}},wgs84:{template:!0,fromBase:function(b,c,d){return a.UI.coordinate(b,c,d)},toBase:function(b,c,d){return a.UI.coordinate(parseFloat(b),parseFloat(c),parseFloat(d))}},"sk-42":{template:!0,fromBase:function(c,d,e){var f=g("WGS84",b(a.Util.getZoneFromLongitude(c),!0),c,d,e);return a.UI.coordinate(l(f.x,8),l(f.y,8),l(f.z,8))},toBase:function(c,d,e){var f=g(b(a.Util.getZoneFromLongitude(c),!0),"WGS84",c,d,e);return a.UI.coordinate(parseFloat(l(f.x,8)),parseFloat(l(f.y,8)),parseFloat(l(f.z,8)))}},"pz-90":{template:!0,fromBase:function(b,c,d){var e=g("WGS84","EPSG:4923",b,c,d);return a.UI.coordinate(l(e.x,8),l(e.y,8),l(e.z,8))},toBase:function(b,c,d){var e=g("EPSG:4923","WGS84",b,c,d);return a.UI.coordinate(parseFloat(l(e.x,8)),parseFloat(l(e.y,8)),parseFloat(l(e.z,8)))}}},a.BaseClass.prototype.initialize.apply(this,arguments)},getAvailableTemplates:function(a){return this.templates[a]&&this.templates[a].slice(0)},getAvailableSystems:function(){return this.options.availableSystems.slice(0)},isMetric:function(a){var b=["gauss"];return a=a||this._selectedSystem,b.indexOf(a)>=0},getSystemName:function(a){return this._systemNames[a]||a},isNeedZone:function(a){var b=["gauss"];return b.indexOf(this.getSystemNameFromKey(a))>=0},getAutoZone:function(){return a.SK_AUTOZONE},setAutoZone:function(b){var c={oldSk:this._selectedSystem,oldTemplate:this._selectedTemplate,oldZone:a.SK_AUTOZONE};a.SK_AUTOZONE=b,this.fire("skchanged",c)},isCorrectZoneSelected:function(){return this.isCorrectZone(a.SK_AUTOZONE)},isCorrectZone:function(b){return a.Util.isNumeric(b)},setActiveSystem:function(b){var c={oldSk:this._selectedSystem,oldTemplate:this._selectedTemplate,oldZone:a.SK_AUTOZONE};return b.indexOf(a.UI.CoordinateConverter.DELIMETER)>=0&&(b=b.split(a.UI.CoordinateConverter.DELIMETER)),a.Util.isArray(b)?(this._selectedSystem=b[0],this._selectedTemplate=b[1],a.SK_AUTOZONE=b[2]):this._selectedSystem=b,a.Preferences.setPreferenceData(h,b),this.fire("skchanged",c),a.EventBus&&a.EventBus.fire("skchanged",c),this},getSystemNameFromKey:function(b){return b.indexOf(a.UI.CoordinateConverter.DELIMETER)>=0?(b=b.split(a.UI.CoordinateConverter.DELIMETER),b[0]):b},getSelectedSystem:function(){return this._selectedSystem},getFullSystemKey:function(b,c,d){return b+a.UI.CoordinateConverter.DELIMETER+(this.isCorrectTemplateSelected(c,b)?c:"null")+a.UI.CoordinateConverter.DELIMETER+(this.isCorrectZone(d)?d:"null")},getFullSystemSelectedKey:function(){return this.getFullSystemKey(this._selectedSystem,this.getSelectedTemplate(),this.getAutoZone())},getFullSystemName:function(b){b=b||this.getFullSystemSelectedKey();var c=b.split(a.UI.CoordinateConverter.DELIMETER),d=c[0],e=c[1],f=c[2];return this.getSystemName(d)+(this.isNeedZone(d)?" ("+(a.Util.isNumeric(f)?f:"авто")+")":this.isTemplatingAvailable(d)?" ("+this.getSystemName(e)+")":"")},isTemplatingAvailable:function(a){a=a||this._selectedSystem;var b=!!this.templates[a];return!!b},getSelectedTemplate:function(){return this._selectedTemplate},isCorrectTemplateSelected:function(a,b){return this.isTemplatingAvailable(b||this._selectedSystem)&&this.templates[b||this._selectedSystem].indexOf(a||this._selectedTemplate)>=0},toTemplate:function(b,c){return this.isCorrectTemplateSelected(c)?a.UI.coordinate(p[this._selectedTemplate].fromBase(b.x,!0),p[this._selectedTemplate].fromBase(b.y)):b},coordinateFromTeplate:function(a,b){var c=this.isTemplatingAvailable(b)&&(this.getFormat(a)||p[this._selectedTemplate]);return void 0!=a&&c?c.toBase(a):""},fromTemplate:function(b,c){return this.isTemplatingAvailable(c)?a.UI.coordinate(this.coordinateFromTeplate(b.x,c),this.coordinateFromTeplate(b.y,c)):b},convert:function(b,c,d,e,f,g){var h,i,j;return j=a.UI.coordinate(d,e,f),void 0!=j.x&&""!==j.x&&(h=this.getFormatByName(b),i=this.getFormatByName(c),j=this.fromTemplate(a.UI.coordinate(d,e,f),b),h&&h.toBase&&i&&i.fromBase&&(j=h.toBase(j.x,j.y,j.z),j=i.fromBase(j.x,j.y,j.z),!g&&i.template&&(j=this.toTemplate(j)))),j},fromBase:function(a,b,c){return this.convert("wgs84",this._selectedSystem,a,b,c)},toBase:function(a,b,c){return this.convert(this._selectedSystem,"wgs84",a,b,c,!0)},getFormat:function(a){var b;a+="";for(b in p)if(p.hasOwnProperty(b)&&a.match(p[b].template))return p[b]},fromRandomTemplateToCurrent:function(b,d){function e(){alert("Не удалось выполнить преобразование."),a.Logger.log("Не удалось выполнить преобразование.",b)}function f(a){var b,c=[/([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+)['|\:]+[\s]*(\d+[\.\d+]*)["]*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/g,/([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+[\.\d*]*)[']*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/g];if(a)for(h=0,i=c.length;i>h;h+=1)if(b=a.match(c[h]))return b;return a}function g(b,d){for(h=0,i=m.length;i>h;h+=1)if(j=b.match(m[h])){var f=parseFloat(j[1]);if(k=b.match(/[SNEWСЮШВЗДsnewсюшвзд]+/))switch(k=c(k[0].trim()).toLowerCase()){case"w":case"s":n=-1}return void 0!=j[2]&&(j[2]=j[2].replace(",","."),f+=parseFloat(j[2])/60),void 0!=j[3]&&0===h&&(j[3]=j[3].replace(",","."),f+=parseFloat(j[3])/3600),o.isTemplatingAvailable()&&p[o._selectedTemplate]?p[o._selectedTemplate].fillTemplate(j[1].replace(",","."),j[2],0===h?j[3]:null,k,d):o.isMetric()?[parseFloat(j[2]),parseFloat(j[0])]:parseFloat(a.Util.toFixed(f*n,8))}if(k=b.match(/[SNEWСЮШВЗДsnewсюшвзд]+/),o.isMetric()&&(b.match(/[\u00B0|\:]+/)||k))return e(),!1;if(k)switch(k=c(k[0].trim()).toLowerCase()){case"w":case"s":b=-1*parseFloat(b)}return o.isTemplatingAvailable()&&p[o._selectedTemplate]?p[o._selectedTemplate].fromBase(b,d):parseFloat(b)}b&&(b=b.replace(",","."));var h,i,j,k,l,m=[/^([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+)['|\:]+[\s]*(\d+[\.\d+]*)["]*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/,/^([-]*[\d]+)[\u00B0|\:]+[\s]*(\d+[\.\d*]*)[']*(\s*[SNEWСЮШВЗДsnewсюшвзд]+)*/,/^([-]*[\d]+)*[\s]*[\.][,]*[\s]*(\d+)/],n=1,o=this;return b+="",b=f(b),a.Util.isArray(b)?(l=[],b.length>1?b.forEach(function(a,c){l[c]=g(b[c],1===c)}):l=g(b[0],d)):l=g(b,d),l},getFormatByName:function(a){return this._systems[a]}}),a.UI.CoordinateConverter.DELIMETER="_|_"}(Gis),function(a){"use strict";var b="40px",c="100%",d="gray";a.UI.CONTAINER_CLASSES={TOP:"gis-top-container",BOTTOM:"gis-bottom-container",LEFT:"gis-left-container",RIGHT:"gis-right-container",LEFT_INNER:"gis-left-inner-container",RIGHT_INNER:"gis-right-inner-container"};var e=window.GIS_RGBA_DISABLE?"white":"rgba(255, 255, 255, 0.8",f=window.GIS_RGBA_DISABLE?"rgb(75, 84, 255)":"rgba(75, 84, 255, 0.8)",g=window.GIS_RGBA_DISABLE?"rgb(175, 45, 81)":"rgba(175, 45, 81, 0.8)";a.UI.DEFAULT_STYLE={measure:{color:"black",border:e,thickness:2,icon:{width:10,type:"circle"}},path:{border:e,thickness:2,selectedBorder:f,icon:{type:"m",color:g,width:15}},polygon:{color:g,border:e,selectedBorder:f,thickness:2,icon:{type:"circle",color:g,width:15}},sector:{color:g,border:e,thickness:2,selectedBorder:f,angleLineColor:"#272727",angleLineBorder:e,angleLineThickness:2},ellipse:{color:g,border:e,thickness:2,selectedBorder:f},marker:{foreColor:"#ffffff",position:"centerright",drawPoint:!0},zoom:{fill:{color:"rgba(0, 16, 235, 0.3)"},line:{color:"rgba(0, 16, 235, 0.9)",thickness:2}},predefinedColors:window.GIS_RGBA_DISABLE?["rgb(255, 57, 17)","rgb(22, 50, 255)","rgb(128, 128, 128)","rgb(255, 216, 216)","rgb(0, 148, 255)"]:["rgba(255, 57, 17, 0.8)","rgba(22, 50, 255, 0.8)","rgba(128, 128, 128, 0.8)","rgba(255, 216, 216, 0.8)","rgba(0, 148, 255, 0.8)"]},a.UI.DEFAULT_STYLE[a.UI.CONTAINER_CLASSES.TOP]={width:c,height:b,background:d},a.UI.DEFAULT_STYLE[a.UI.CONTAINER_CLASSES.BOTTOM]={width:c,height:b,background:d},a.UI.DEFAULT_STYLE[a.UI.CONTAINER_CLASSES.LEFT]={width:"40px",height:b,background:d}}(Gis),function(a){"use strict";var b,c;a.UI.Util={saveDataToFile:function(){var a="этот текст будет сохранен в файл",b=navigator.userAgent.toLowerCase();if(-1!=b.indexOf("msie")&&-1==b.indexOf("opera")&&-1==b.indexOf("webtv")){var c=window.open();c.document.write(a),c.document.execCommand("saveAs",!0,".xml")}else var c=window.open("data:application/download;charset=utf-8;base64,"+btoa(a))}},Gis.UI.loadZeroClipboard=function(a){require([Gis.config("relativePath")+"libs/ui/scripts/ZeroClipboard.js"],function(b){window.ZeroClipboard=b,a(b)},function(){Gis.notify("Не удалось загрузить ZeroClipboard, копирование в буфер обмена невозможно.","error")})},a.UI.uiUsersetInclude=function(b,c){return b?(a.Util.isArray(c)||(c=[c]),b.concat(c).unique()):b},a.UI.uiUsersetExclude=function(b,c){var d,e;return b?(a.Util.isArray(c)||(c=[c]),b=b.slice(),c.forEach(function(a){for(e=b.length,d=0;e>d;d+=1)if(b[d]===a){b.splice(d,1);break}}),b):b},Gis.UI.preventDefault=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},Gis.UI.disableTextSelection=function(a){Gis.HTML.addEventListener(a||window,"selectstart",Gis.UI.preventDefault)},Gis.UI.enableTextSelection=function(a){Gis.HTML.removeEventListener(a||window,"selectstart",Gis.UI.preventDefault)},Array.prototype.unique=function(){for(var a=this.slice(),b=0;b<a.length;++b)for(var c=b+1;c<a.length;++c)a[b]===a[c]&&a.splice(c--,1);return a},Gis.UI.restoreSelection=function(){if(this.saveSelection){window.getSelection().removeAllRanges();for(var a=0;a<this.saveSelection.length;a++)window.getSelection().addRange(this.saveSelection[a]);this.saveSelection=!1}},Gis.UI.isCopyApiSupported=function(){return window.clipboardData&&clipboardData.setData},Gis.UI.isFlashSupported=function(){return!Gis.Util.isFileProtocol()&&"undefined"!=typeof navigator.mimeTypes["application/x-shockwave-flash"]},Gis.UI.isNeedUseZeroClipboard=function(){return!Gis.UI.isCopyApiSupported()&&Gis.UI.isFlashSupported()},Gis.UI.getCoordinatesString=function(a,b,c){var d=a.getLatLngArray?a.getLatLngArray():Gis.latLng(a.getCenter());return d?(Gis.Util.isArray(d)||(d=[d]),c&&d.length>2&&d.splice(1,d.length-2),d=d.reduce(function(a,c){return(a?a+"\n":"")+b.coordinateToText(Gis.latLng(c))},"")):void 0},Gis.UI.copyToClipboard=function(a){return window.clipboardData&&clipboardData.setData?(clipboardData.setData("text",a),!0):(this.isFlashSupported()||(b=b||$("<div><p>Прямое копирование не поддерживается. Скопируйте координаты из поля ниже.</p><textarea ></textarea></div>"),c=c||b[0].querySelector("textarea"),c&&(c.style.height=Math.min(200,20*a.split("\n").length)+"px",c.value=a),b.dialog({modal:!0,draggable:!1,dialogClass:"no-title-bar copy-latlng",resizable:!1,minHeight:65,autoOpen:!0,buttons:{"Закрыть":function(){$(this).dialog("close")}},open:function(){c=this.querySelector("textarea"),c.setSelectionRange(0,c.value.length),c.focus()}})),!1)}}(Gis),Gis.UI.Action=Gis.BaseClass.extend({_type:void 0,_selectType:void 0,_executed:!1,options:{useCache:!0,dataBinded:void 0,noUI:!1},_isActionAvailable:function(a){var b=this._ui.getMap().getSetting("ui");return b&&b.indexOf(a.getType())>=0},_layerSelected:function(a){var b,c,d=a.layer;c=d.getParentId()||d.getId(),d=this._ui.getMap().getLayer(c),d.getType()!==this._selectType?(b=Gis.UI.ActionController.getAction(d.getType()),b&&!b.isExecuted()&&this._isActionAvailable(b)&&(b.setData({dataBinded:d}),this._disable(),b.fire("newactionexecuted",{action:b}),b.execute())):this._widget.bindData(d)},getFirstSelection:function(){var a=this._ui.getMap().getSelected(),b=Object.keys(a);return b.length&&a[b[0]].getType()===this._selectType?a[b[0]]:void 0},_layerUnSelected:function(a){a.layer.getOriginalType()===this._selectType&&this._widget.isAttachedToUi()&&this._widget.bindData(void 0)},initialize:function(a,b){var c,d=this.options.useCache&&Gis.UI.ActionController.getAction(this.getType());if(d)throw new Error("You can not use constructor direct");c=this,this._ui=a,Gis.BaseClass.prototype.initialize.call(this,b),this._executeFunction=function(a){if(!Gis.UI.Action.DO_NOT_EXECUTE_ONCE){if(!c._executed){var b=Gis.UI.ActionController.getLastExecuted();b&&b._type!==c._type&&b.closeAction(),c.fire("newactionexecuted",{action:c}),c.execute()}a.preventDefault()}Gis.UI.Action.DO_NOT_EXECUTE_ONCE=!1},Gis.UI.ActionController.pushAction(this)},getType:function(){return this._type},isExecuted:function(){return this._executed},attachToButton:function(a,b){this._containerAtached||(b=b.split(" ")[0],$(a).on("click","."+b,this._executeFunction),this._containerAtached=a,this._className=b)},execute:function(){Gis.UI.ActionController.pushExecuted(this),this.options.dataBinded=this.options.dataBinded||this.getFirstSelection(),this._executed=!0,this._oldDraggable=this._ui.getMap().isDraggableEnabled(),this._oldFilter=this._ui.getMap().getFilterSelect(),this._containerAtached&&$("."+this._className,this._containerAtached).addClass(Gis.UI.Action.SELECTED_CLASS_NAME),this.initEvents()},bindData:function(a){this.options.dataBinded=a},_disable:function(){this._executed=!1,this._ui.getMap().setDraggableEnabled(this._oldDraggable),this._containerAtached&&$("."+this._className,this._containerAtached).removeClass(Gis.UI.Action.SELECTED_CLASS_NAME),this.deInitEvents()},initEvents:function(){this._ui.getMap().on("layerselected",this._layerSelected,this),this._ui.getMap().on("layerunselected",this._layerUnSelected,this)},deInitEvents:function(){this._ui.getMap().off("layerselected",this._layerSelected,this),this._ui.getMap().off("layerunselected",this._layerUnSelected,this)},pause:function(){this.deInitEvents(),this._widget&&this._widget.deactivate()},resume:function(){this.initEvents(),this._widget&&this._widget.activate()},closeAction:function(){this._executed&&(this._disable(),this.options.noUI=!1,Gis.UI.ActionController.popLastExecuted())},getId:function(){return this._id=this._id||Gis.Util.generateGUID(),this._id}}),Gis.UI.Action.DO_NOT_EXECUTE_ONCE=!1,Gis.UI.Action.SELECTED_CLASS_NAME="selected",function(a){"use strict";a.UI.Action.AreaRelief=a.UI.Action.extend({_type:"areal-relief",_selectType:"areal-relief",_classMapObject:"gis-map-areal-relief",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapObject),this._widget=a.Widget.areaReliefProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),this._ui.getMap().clearSelectedOnClick(!0),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapObject),this.options.dataBinded=void 0}}),a.UI.Action["areal-relief"]=function(b,c){var d=a.UI.ActionController.getAction("areal-relief");return d?(d.setData(c),d):new a.UI.Action.AreaRelief(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Custom=a.UI.Action.extend({options:{useCache:!1,className:void 0},_type:"custom",_selectType:"custom",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!0),this.options.className&&$(this._ui.getMap().getMapContainer()).addClass(this.options.className),this.fire("executed")},_update:function(){},_disable:function(){a.UI.Action.prototype._disable.call(this),this.options.className&&$(this._ui.getMap().getMapContainer()).removeClass(this.options.className),this.fire("disabled"),this.options.dataBinded=void 0}}),a.UI.Action.Custom.type="custom",a.UI.Action.custom=function(b,c){return new a.UI.Action.Custom(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Ellipse=a.UI.Action.extend({_type:"ellipse",_selectType:"ellipse",_classMapEllipse:"gis-map-ellipse",execute:function(){this._ui.getMap().clearSelectedOnClick(!1),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.UI.Action.Ellipse.type),a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),$(this._ui.getMap().getMapContainer()).addClass(this._classMapEllipse),this._widget=a.Widget.ellipseProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_update:function(){},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapEllipse),this.options.dataBinded=void 0}}),a.UI.Action.Ellipse.type="ellipse",a.UI.Action.ellipse=function(b,c){var d=a.UI.ActionController.getAction("ellipse");return d?(d.setData(c),d):new a.UI.Action.Ellipse(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Geo=a.UI.Action.extend({_type:"geo",_selectType:"geo",_classMapObject:"gis-map-geo",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!0),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapObject),this._widget=a.Widget.geoProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),this._ui.getMap().clearSelectedOnClick(!0),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapObject),this.options.dataBinded=void 0}}),a.UI.Action.geo=function(b,c){var d=a.UI.ActionController.getAction("geo");return d?(d.setData(c),d):new a.UI.Action.Geo(b,c)}}(Gis),function(a){"use strict";a.UI.Action.GeoPath=a.UI.Action.extend({_type:"geo-path",_selectType:"geo-path",_classMapObject:"gis-map-geo-path",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!0),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapObject),this._widget=a.Widget.geoPathProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),this._ui.getMap().clearSelectedOnClick(!0),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapObject),this.options.dataBinded=void 0}}),a.UI.Action["geo-path"]=function(b,c){var d=a.UI.ActionController.getAction("geo-path");return d?(d.setData(c),d):new a.UI.Action.GeoPath(b,c)}}(Gis),function(a){"use strict";a.UI.Action.HeatMap=a.UI.Action.extend({_type:"heatmap",_selectType:"heatmap",_classMapHeatMap:"gis-map-heatmap",execute:function(){this._ui.getMap().clearSelectedOnClick(!1),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.UI.Action.HeatMap.type),a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),$(this._ui.getMap().getMapContainer()).addClass(this._classMapHeatMap),this._widget=a.Widget.heatMapProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_update:function(){},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapHeatMap),this.options.dataBinded=void 0}}),a.UI.Action.HeatMap.type="heatmap",a.UI.Action.heatmap=function(b,c){var d=a.UI.ActionController.getAction("heatmap");return d?(d.setData(c),d):new a.UI.Action.HeatMap(b,c)}}(Gis),function(a){"use strict";Gis.UI.Action.Layers=a.UI.Action.extend({_type:"layers",_ui:void 0,_zoomBounds:void 0,_selectType:"layers",_classMapLayers:"gis-map-layers",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!0),$(this._ui.getMap().getMapContainer()).addClass(this._classMapLayers),this._widget=a.Widget.layersProperty(),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapLayers)}}),Gis.UI.Action.layers=function(b,c){var d=a.UI.ActionController.getAction("layers");return d?(d.setData(c),d):new Gis.UI.Action.Layers(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Marker=a.UI.Action.extend({_type:"marker",_selectType:"text",_classMapMarker:"gis-map-marker",execute:function(){this._executed||(this._ui.getMap().filterSelect(a.UI.Action.Marker.type),a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),$(this._ui.getMap().getMapContainer()).addClass(this._classMapMarker),this._widget=a.Widget.markerProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget))},_disable:function(){this._executed&&(this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapMarker),this.options.dataBinded=void 0)}}),a.UI.Action.Marker.type="text",a.UI.Action.marker=function(b,c){var d=a.UI.ActionController.getAction("marker");return d?(d.setData(c),d):new a.UI.Action.Marker(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Measure=a.UI.Action.extend({_type:"measure",_ui:void 0,_zoomBounds:void 0,_selectType:"measurer",_classMapMeasure:"gis-map-measuring",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapMeasure),this._widget=a.Widget.measureProperty(),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapMeasure)}}),a.UI.Action.measure=function(b,c){var d=a.UI.ActionController.getAction("measure");return d?(d.setData(c),d):new a.UI.Action.Measure(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Move=a.UI.Action.extend({_type:"move",_classMapMove:"gis-map-moving",execute:function(){a.UI.Action.prototype.execute.call(this),this._oldClearOnClick=this._ui.getMap().isClearOnClick(),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!0),this._ui.getMap().filterSelect(a.ObjectController.FILTER_NOTHING,this.options.noUI),$(this._ui.getMap().getMapContainer()).addClass(this._classMapMove),this.options.noUI||(this._widget=a.Widget.moveProperty(),this._ui.addWidget(this._widget))},_update:function(){},_disable:function(){this.options.noUI||this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),this._ui.getMap().clearSelectedOnClick(this._oldClearOnClick),this._ui.getMap().filterSelect(void 0,this.options.noUI),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapMove)}}),a.UI.Action.move=function(b,c){var d=a.UI.ActionController.getAction("move");return d?(d.setData(c),d):new a.UI.Action.Move(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Object=a.UI.Action.extend({_type:"object",_selectType:"image",_classMapObject:"gis-map-object",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapObject),this._widget=a.Widget.objectProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapObject),this.options.dataBinded=void 0}}),a.UI.Action.object=function(b,c){var d=a.UI.ActionController.getAction("object");return d?(d.setData(c),d):new a.UI.Action.Object(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Overlay=a.UI.Action.extend({_type:"overlay",_selectType:"overlay",_classMapOverlay:"gis-map-overlay",execute:function(){this._ui.getMap().clearSelectedOnClick(!1),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.UI.Action.Overlay.type),a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),$(this._ui.getMap().getMapContainer()).addClass(this._classMapOverlay),this._widget=a.Widget.overlayProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_update:function(){},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapOverlay);var b=this.getFirstSelection();b===this.options.dataBinded&&this._ui.getMap().clearSelected(),this.options.dataBinded=void 0}}),a.UI.Action.Overlay.type="overlay",a.UI.Action.overlay=function(b,c){var d=a.UI.ActionController.getAction("overlay");return d?(d.setData(c),d):new a.UI.Action.Overlay(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Path=a.UI.Action.extend({_type:"path",_selectType:"path",_ui:void 0,_zoomBounds:void 0,_classMapPath:"gis-map-path",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapPath),this._widget=a.Widget.pathProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapPath),this.options.dataBinded=void 0}}),a.UI.Action.path=function(b,c){var d=a.UI.ActionController.getAction("path");return d?(d.setData(c),d):new a.UI.Action.Path(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Polyton=a.UI.Action.extend({_type:"polygon",_selectType:"polygon",_ui:void 0,_zoomBounds:void 0,_classMapPolyton:"gis-map-polygon",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(this._selectType),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapPolyton),this._widget=a.Widget.polygonProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapPolyton),this.options.dataBinded=void 0}}),a.UI.Action.polygon=function(b,c){var d=a.UI.ActionController.getAction("polygon");return d?(d.setData(c),d):new a.UI.Action.Polyton(b,c)}}(Gis),function(a){"use strict";Gis.UI.Action.Relief=a.UI.Action.extend({_type:"relief",_ui:void 0,_zoomBounds:void 0,_selectType:"relief",_classMapRelief:"gis-map-relief",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!0),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapRelief),this._widget=a.Widget.reliefProperty(),this._ui.addWidget(this._widget),this._ui.hideAll(this._widget)
},_disable:function(){this._ui.removeWidget(this._widget),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapRelief),this._ui.showAll()}}),Gis.UI.Action.relief=function(b,c){var d=a.UI.ActionController.getAction("relief");return d?(d.setData(c),d):new Gis.UI.Action.Relief(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Sector=a.UI.Action.extend({_type:"sector",_selectType:"sector",_classMapSector:"gis-map-sector",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().clearSelectedOnClick(!1),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.UI.Action.Sector.type),$(this._ui.getMap().getMapContainer()).addClass(this._classMapSector),this._widget=a.Widget.sectorProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.getMap().clearSelectedOnClick(!0),this._ui.removeWidget(this._widget),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapSector),this.options.dataBinded=void 0}}),a.UI.Action.Sector.type="sector",a.UI.Action.sector=function(b,c){var d=a.UI.ActionController.getAction("sector");return d?(d.setData(c),d):new a.UI.Action.Sector(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Select=a.UI.Action.extend({_type:"select",_classMapSelecting:"gis-map-selecting",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!0),this._ui.getMap().setDraggableEnabled(!0),Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),this._ui.getMap().filterSelect(a.ObjectController.FILTER_ALL,!0),$(this._ui.getMap().getMapContainer()).addClass(this._classMapSelecting)},_disable:function(){a.UI.Action.prototype._disable.call(this),this._ui.getMap().filterSelect(a.ObjectController.FILTER_NOTHING,!0),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapSelecting)}}),a.UI.Action.select=function(b,c){var d=a.UI.ActionController.getAction("select");return d?(d.setData(c),d):new a.UI.Action.Select(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Visibility=a.UI.Action.extend({_type:"visibility",_selectType:"visibility",_classMapObject:"gis-map-visibility",execute:function(){a.UI.Action.prototype.execute.call(this),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!0),this._ui.getMap().filterSelect(this._selectType),$(this._ui.getMap().getMapContainer()).addClass(this._classMapObject),this._widget=a.Widget.visilibityProperty({dataBinded:this.options.dataBinded}),this._ui.addWidget(this._widget)},_disable:function(){this._ui.removeWidget(this._widget),this._ui.getMap().clearSelectedOnClick(!0),a.UI.Action.prototype._disable.call(this),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapObject),this.options.dataBinded=void 0}}),a.UI.Action.visibility=function(b,c){var d=a.UI.ActionController.getAction("visibility");return d?(d.setData(c),d):new a.UI.Action.Visibility(b,c)}}(Gis),function(a){"use strict";a.UI.Action.Zoom=a.UI.Action.extend({_type:"zoom",_ui:void 0,options:{zoomOut:!1},_zoomOut:void 0,_zoomBounds:void 0,_classMapZoom:"gis-map-zooming",_classMapZoomOut:"gis-map-zooming-out",initialize:function(b){var c=this;a.UI.Action.prototype.initialize.call(this,b),this._onKeyPress=this._onKeyPress||function(a){var b=18;return a.keyCode===b||a.charCode===b+""?(c._InitZoomOut(),!1):void 0},this._onKeyUp=this._onKeyUp||function(){c._deInitZoomOut()}},execute:function(){this._executed||(a.UI.Action.prototype.execute.call(this),this._oldClearOnClick=this._ui.getMap().isClearOnClick(),this._ui.getMap().clearSelectedOnClick(!1),this._ui.getMap().setDraggableEnabled(!1),this._ui.getMap().filterSelect(a.ObjectController.FILTER_NOTHING,this.options.noUI),Gis.UI.disableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).addClass(this._classMapZoom),this.options.zoomOut&&this._InitZoomOut(),this.options.noUI||(this._widget=a.Widget.zoomProperty(),this._ui.addWidget(this._widget)))},initEvents:function(){a.UI.Action.prototype.initEvents.call(this);var b=this._ui.getMap();document.body.addEventListener("keydown",this._onKeyPress),document.body.addEventListener("keyup",this._onKeyUp),this._ui.getMap().getMapContainer().addEventListener("keydown",this._onKeyPress),this._ui.getMap().getMapContainer().addEventListener("keyup",this._onKeyUp),b.on("mousedown",this._onMouseDown,this)},deInitEvents:function(){a.UI.Action.prototype.deInitEvents.call(this);var b=this._ui.getMap();b.off("mousedown",this._onMouseDown,this),document.body.removeEventListener("keydown",this._onKeyPress),document.body.removeEventListener("keyup",this._onKeyUp),this._ui.getMap().getMapContainer().removeEventListener("keydown",this._onKeyPress),this._ui.getMap().getMapContainer().removeEventListener("keyup",this._onKeyUp)},_InitZoomOut:function(){this._zoomOut=!0,$(this._ui.getMap().getMapContainer()).addClass(this._classMapZoomOut)},_deInitZoomOut:function(){$(this._ui.getMap().getMapContainer()).removeClass(this._classMapZoomOut),this._zoomOut=!1},_onMouseMove:function(a){var b,c;if(this._mouseDown){if(c=a.originalEvent,!this._moved&&L.point(c.clientX,c.clientY).distanceTo(L.point(this._startEvent.clientX,this._startEvent.clientY))<5)return;b=this._ui.getStyle("zoom"),this._divZoom?(this._divZoom.style.width=Math.max(this._startEvent.clientX,c.clientX)-Math.min(this._startEvent.clientX,c.clientX)+"px",this._divZoom.style.height=Math.max(this._startEvent.clientY,c.clientY)-Math.min(this._startEvent.clientY,c.clientY)+"px",this._divZoom.style[Gis.DomUtil.prefixes("transform")]=Gis.DomUtil.isCssTransform3d()?"translate3d("+Math.min(this._startEvent.clientX,c.clientX)+"px, "+Math.min(this._startEvent.clientY,c.clientY)+"px,0)":"translate("+Math.min(this._startEvent.clientX,c.clientX)+"px, "+Math.min(this._startEvent.clientY,c.clientY)+"px)"):(this._divZoom=document.createElement("div"),this._divZoom.classList.add("gis-ui-zoom-div"),this._divZoom.style.backgroundColor=b.fill.color,this._divZoom.style.borderColor=b.line.color,this._ui.getMap().getMapContainer().appendChild(this._divZoom)),this._moved=!0}},_onMouseDown:function(a){var b=this._ui.getMap();b.on("mousemove",this._onMouseMove,this),b.on("mouseup",this._onMouseUp,this),b.on("mouseout",this._onMouseUp,this),this._ui.getMap().setDraggableEnabled(!1),this._latlngStart=a.latLng,this._startEvent=a.originalEvent,this._moved=!1,this._mouseDown=!0},_disableMove:function(){this._divZoom&&(this._ui.getMap().getMapContainer().removeChild(this._divZoom),delete this._divZoom),this._moved=!1,this._mouseDown=!1},_onMouseUp:function(b){var c,d;this._mouseDown&&(c=this._ui.getMap(),c.off("mousemove",this._onMouseMove,this),c.off("mouseup",this._onMouseUp,this),c.off("mouseout",this._onMouseUp,this),this._moved?c.setZoom(a.Objects.Polygon.generateSquareLatLng(this._latlngStart,b.latLng,null,!0)):(d=c.getZoom(),this._zoomOut||b.originalEvent.altKey?d-=1:d+=1,c.setZoomAround([b.latLng.latitude,b.latLng.longitude],d))),this._disableMove()},_disable:function(){this._executed&&(this._deInitZoomOut(),this.options.noUI||this._ui.removeWidget(this._widget),this._ui.getMap().clearSelectedOnClick(this._oldClearOnClick),a.UI.Action.prototype._disable.call(this),this._ui.getMap().filterSelect(void 0,this.options.noUI),this._disableMove(),this.options.zoomOut=!1,Gis.UI.enableTextSelection(this._ui.getMap().getMapContainer()),$(this._ui.getMap().getMapContainer()).removeClass(this._classMapZoom))}}),a.UI.Action.zoom=function(b,c){var d=a.UI.ActionController.getAction("zoom");return d?(d.setData(c),d):new a.UI.Action.Zoom(b,c)}}(Gis),function(a){"use strict";a.UI.ActionController={_list:{},_listExecuted:[],pushAction:function(a){var b=a.getType();this._list[b]||(this._list[b]=a)},_getByLayerType:function(a){var b;for(b in this._list)if(this._list.hasOwnProperty(b)&&this._list[b]._selectType===a)return this._list[b]},getAction:function(a){var b=this._list[a];return b||this._getByLayerType(a)},getFirstAction:function(){return this._list[Object.keys(this._list)[0]]},pushExecuted:function(a){this._listExecuted.push(a)},popLastExecuted:function(){return this._listExecuted.pop()},getLastExecuted:function(){return this._listExecuted[this._listExecuted.length-1]}}}(Gis),function(){"use strict";function a(a){return a.hasClass(b)?"Сбросить все":"Выделить все"}var b="checked",c="some-checked",d=1,e=0,f=-1,g="checkbox-switch-all";Gis.checkAll={initialize:function(a){a()},_updateCheckedState:function(){var g=this._stateChecked();switch(g){case d:this._swithchAll.addClass(b),this._swithchAll.removeClass(c);break;case f:this._swithchAll.addClass(c),this._swithchAll.removeClass(b);break;case e:this._swithchAll.removeClass(b),this._swithchAll.removeClass(c)}this._swithchAll.next().text(a(this._swithchAll))},_createEventListeners:function(){var a=this;this._switchAllClikcked=this._switchAllClikcked||function(){a.$container.tooltip("close");var d=a._stateChecked();return d&&d!==f?($("li span.checkbox",a._$layerList).removeClass(b),$(".checkbox",this).removeClass(b)):($("li span.checkbox",a._$layerList).addClass(b),$(".checkbox",this).addClass(b)),$("li span.checkbox",a._$layerList).removeClass(c),a.fire("change"),!1}},_stateChecked:function(){var a=$("li span.checkbox",this.$checkBoxList),c=$("li span.checkbox."+b,this.$checkBoxList);return a.length===c.length?d:c.length?f:e},setSwitchContainer:function(a,b){this.$container=a,this.$checkBoxList=b,this._swithchAll=this.findSwitchAll()},findSwitchAll:function(){return $("."+g+" span",this.$container)},switcherHtml:function(a){return a=a||"div","<"+a+" class='"+g+"'><span class='checkbox'></span><span class='name'></span></"+a+">\n"},initSwitcherEvents:function(){this._createEventListeners(),this.$container.on("click","."+g,this._switchAllClikcked),this.$container.tooltip({items:"."+g,track:!0,content:function(){return a($(this))}}),this._updateButtonState&&this.on("change",this._updateButtonState,this)},deInitSwitcherEvents:function(){this.$container.off("click","."+g,this._switchAllClikcked),this._updateButtonState&&this.off("change",this._updateButtonState,this)}}}(this||self),function(){"use strict";var a=new RGBColor("black"),b=Gis.Objects.HeatMap.getRbg;Gis.setConfig("heatmap.colors",[Gis.config("heatmap.color"),[{percent:0,color:new RGBColor("black")},{percent:1,color:new RGBColor("white")}],[{percent:0,color:new RGBColor("yellow")},{percent:.5,color:new RGBColor("brown")},{percent:1,color:new RGBColor("red")}],[{percent:0,color:new RGBColor("rgb(0,10,252)")},{percent:.5,color:new RGBColor("rgb(34, 34, 32)")},{percent:1,color:new RGBColor("rgb(164, 170, 19)")}]]),Gis.gradientWidget={initialize:function(a){a(),this._colors=Gis.config("heatmap.colors")},_HTMLgradientSelector:function(){var a="<ul class='gradient-colors gis-color-list'>",b=0,c=this._colors.length;for(b=0;c>=b;b+=1)a+="<li class='gradient gis-propertys-button gis-color-button gis-param-selector' data-index='"+b+"'><canvas/></li>";return a+="</ul>"},getSelectedColorList:function(a){var b=$(".gradient",this._$div);return this._colors[b.index(b.filter(".selected"))]||a},_equalsColor:function(c,d){var e,f,g,h,i=c&&(c.getSelectedGradient()||c.getGradient()),j=!0;if(!i)return!1;if(d||(d=this.getSelectedColorList(c.getGradient())),!d)return!0;if(i.length!=d.length)return!1;for(e=0,f=i.length;f>e;e+=1)if(g=b(i[e].color,a).toRGB(),h=b(d[e].color,a).toRGB(),j=j&&g===h,!j)return!1;return j},initGradientList:function(a,b){var c,d,e,f,g,h,i=$(".gradient",a),j=$(".gradient canvas",a);for(i.removeClass("selected"),d=0,e=j.length;e>d;d+=1)c=j[d],c.width=16,c.height=60,h=this._colors[d],h||b&&(h=b.getGradient()),h?(this._equalsColor(b,h)?c.parentElement.classList.add("selected"):c.parentElement.classList.remove("selected"),h=Gis.Objects.HeatMap.parseColors(h),c.parentNode.style.display="inline-block",f=c.getContext("2d"),g=f.createLinearGradient(0,c.offsetHeight,0,0),h.forEach(function(a){g.addColorStop(a.percent,a.color.toRGBA())}),f.fillStyle=g,f.fillRect(0,0,c.width,c.height)):c.parentNode.style.display="none"}}}(this||self),function(){"use strict";function a(){return'<div class="map-dialog" id="'+D+'"><div class="padding-3"><div class="top"><div id="map-type-filter"><ul><li><label><input class="'+M+'" name="map-type" checked type="radio" value="all"/><span>Все</span></label></li><li><label><input name="map-type" type="radio" value="lan"/><span>Интернет</span></label></li><li><label><input name="map-type" type="radio" value="local"/><span>Оффлайн</span></label></li></ul></div><div class="map-controls"><button class="gis-propertys-button" id="map-refresh"><span></span></button><button class="gis-propertys-button" id="map-control">Управление</button></div></div><div class="middle"><div class="map-filter"><input name="map-filter" type="text" placeholder="Фильтр" value=""/></div></div><div id="'+F+'"></div><div class="map-buttons"><div class="right"><button class="gis-propertys-button map-ok">Ок</button><button class="gis-propertys-button map-cancel">Отмена</button></div><div class="additional-buttons"><button class="gis-propertys-button" id="map-additional">Дополнительные карты...</button>'+(Gis.Map.GridVisibilityChanged?'<div class="grid-container"><button class="gis-propertys-button" id="map-grid">Без сетки</button></div>':"")+"</div></div></div></div>"}function b(a){a.sort(function(a,b){var c=b.title.toLowerCase(),d=a.title.toLowerCase();return d>c?1:c>d?-1:0})}function c(){$("li.selected",q).removeClass("selected"),$(document.getElementsByClassName(t.getSelectedMapKey())[0]).addClass("selected")}function d(a){return a.getCustomLayers()?'<span class="actions"><button data-action="layers" class="action gis-propertys-button widget-control gis-button-layers layers"><span class="gis-button-icon" title="Слои"></span></button></span>':""}function e(a){var c,e,f,g,h="",i=t.getSelectedMapKey();return f=i,y?i=u.getKey():u=t.getMap(i),a&&(b(a),h=a.reduce(function(a,b){return c=i===b.key?G:"",e=t.getMap(b.key),c+=" gis-all",c+=e.isLocal()?" gis-local":" gis-lan",c+=" "+b.key,g="",a+'<li class="map-element '+c+'" data-key="'+b.key+'">'+g+'<span class="name">'+b.title+"</span>"+d(e)+"</li>"},"")),'<ul class="map-list data-list element-hover">'+h+"</ul>"}function f(){o.dialog("close")}function g(){return u}function h(){var a=r.val().toLowerCase(),b=w.filter(function(){return $(this).data("filter-index").indexOf(a)>-1&&j(this)}).css({display:"block"});w.not(b).css({display:"none"})}function i(){return v||(v=$("."+M,p).val()),v}function j(a){return $(a).hasClass("gis-"+i())}function k(){s[t.getMapList(u).length?"removeClass":"addClass"]("disabled")}function l(){h()}function m(){var a=o.parent(),b=a.position();Gis.Preferences.setPreferenceData(E,{width:a.outerWidth(),height:a.outerHeight(),position:{my:"left+"+b.left+" top+"+b.top,at:"left top"}})}function n(){return Gis.Preferences.getPreferenceData(E)}var o,p,q,r,s,t,u,v,w,x,y,z,A,B=300,C=390,D="map-dialog",E="MAPS_DIALOG_DIMENSION",F="map-list-container",G="selected",H=!1,I=null,J=null,K=null,L={},M="checked",N={w:Math.max(C,Math.min(.8*$(window).width(),600)),h:Math.max(Math.min(B,.8*$(window).height(),500),300)};L.selectRow=function(){this.classList.contains(G)||($("."+G,q).removeClass(G),this.classList.add(G),u=t.getMap($(this).data("key")))},L.revert=function(){J&&y&&(t.getMap(J).setAdditionalLayers(K),t.setMapType(J,!0),K=null,J=null),t.switchGridVisibility&&(I?I!==t.getSelectedGrid()&&t.switchGridVisibility(I):t.switchGridVisibility(t.getSelectedGrid()))},L.doClick=function(){y=!0,L.selectRow.call(this),k()},L.mapClicked=function(){L.doClick.call(this),u&&u.getKey()===t.getSelectedMapKey()||t.setMapType(g(),!0)},L.actionClicked=function(){switch($(this).data("action")){case"layers":x.showCustomLayersDialog(t.getMap($(this).parents(".map-element").data("key")))}return!1},L.typeFilterClicked=function(){var a=$(this);v=a.val(),a.hasClass(M)||($("."+M,p).removeClass(M),a.addClass(M)),l()},L.animateButton=function(){var a=$(this),b="webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionEnd",c=function(){a.off(b,c),a.removeClass("animate").removeClass("rotated")};a.hasClass("animate")||(a.addClass("animate"),Gis.requestAnimationFrame(50)(function(){a.addClass("rotated"),a.on(b,c)}))},A=Gis.BaseClass.extend({defaultDialogOptions:{closeOnEscape:!0,autoOpen:!1,modal:!1,resizable:!0,draggable:!0,minHeight:B,minWidth:C,position:{my:"left+50 top+50",at:"left top",of:window},width:N.w,height:N.h,dialogClass:"shadow"},_createDialog:function(){var b=this,d=n()||{};o||(o=$(a()),o.dialog(Gis.Util.extend({},this.defaultDialogOptions,d,{title:"Выбор карты",open:function(){$("#gis-select-map").addClass("active"),t.on("maplistchanged",b.mapListChanged,b),t.on("tilelayerchanged",c,this),Gis.Map.GridVisibilityChanged&&t.on(Gis.Map.GridVisibilityChanged.TYPE,b.mapTypeChanged,b),z=!0,I=t.getSelectedGrid&&t.getSelectedGrid(),J=t.getSelectedMapKey(),K=t.getMap(J).getAdditionalLayers()},close:function(){$("#gis-select-map").removeClass("active"),t.off("maplistchanged",b.mapListChanged,b),t.off("tilelayerchanged",c,this),Gis.Map.GridVisibilityChanged&&t.off(Gis.Map.GridVisibilityChanged.TYPE,b.mapTypeChanged,b),b.fire("close"),b.closeGrids(),z=!1},beforeClose:function(){m()}})),p=$("#map-type-filter",o),r=$(".map-filter input",o),s=$("#map-additional",o),q=$("#"+F,o),q.on("click","li.map-element",L.mapClicked),q.on("click",".action",L.actionClicked),o.on("click",".map-ok",function(){f()}),q.on("dblclick",".map-list > li",function(){return t.getMapList(u).length&&b.showSecondDialog(u),!1}),o.on("click",".map-cancel",function(){L.revert(),f()}),o.on("click","#map-control",function(){return location.href="tmtsm://open",!1}),o.on("click","#map-refresh",function(){L.animateButton.call($("span",this)),t.loadTileMapsData()}),o.on("click","#map-additional",function(){$(this).hasClass("disabled")||b.showSecondDialog(u)}),Gis.Map.GridVisibilityChanged&&o.on("click","#map-grid",function(){return $(this).hasClass("disabled")||($(this).hasClass("selected")?b.closeGrids():b.showGrid(this)),!1}),o.on("input",".map-filter input",l),p.on("click","input",L.typeFilterClicked),this.closeGrids=function(){$("#map-grid",o).removeClass("selected"),b._grids&&b._grids.remove(),$(document.body).off("click",b.closeGrids)})},close:function(){f()},gridName:function(a){var b={};return b[Gis.Map.GRID_TYPES.KILOMETR]="Километровая сетка",b[Gis.Map.GRID_TYPES.NOMENCLATE]="Номенклатурная сетка",b[Gis.Map.GRID_TYPES.GRAD]="Градусная сетка",b[a]||a},mapTypeChanged:function(){$("#map-grid",o).text(this.gridName(t.getSelectedGrid())||"Без сетки")},showGrid:function(a){this.closeGrids();var b,c='<ul class="grid-list">',d=this;b=t.getSelectedGrid()?"":"selected",c+='<li class="'+b+'" data-key="-1">Без сетки</li>';for(var e in Gis.Map.GRID_TYPES)Gis.Map.GRID_TYPES.hasOwnProperty(e)&&(b=t.getSelectedGrid()===Gis.Map.GRID_TYPES[e]?"selected":"",c+='<li class="'+b+'" data-key="'+e+'">'+this.gridName(Gis.Map.GRID_TYPES[e])+"</li>");c+="</ul>",this._grids=$(c),$(document.body).append(this._grids),$(document.body).on("click",this.closeGrids),this._grids.on("click","li",function(){if(!$(this).hasClass("selected")){var a=Gis.Map.GRID_TYPES[$(this).data("key")];t.switchGridVisibility(a||t.getSelectedGrid()),d.mapTypeChanged()}return d.closeGrids(),!1}),$(a).addClass("selected"),this._grids.menu(),this._grids.css({left:$(a).offset().left,top:$(a).offset().top+$(a).outerHeight()+2})},isOpened:function(){return z},getMap:function(){return t},setClicked:function(a){y=a},initialize:function(){this._createDialog(),x=this},_activateMapList:function(){this._activateList(q),w=$("li.map-element",q),w.each(function(){$(this).data("filter-index",$("span.name",this).html().toLowerCase())})},_activateList:function(){},setMap:function(a){t=a},setControlAvailable:function(a){H=a,$("#map-control",o).css({display:t&&t.getLocalTMS()&&a?"inline-block":"none"})},mapListChanged:function(){this.replaceMaps()},replaceMaps:function(a){a=a||t.getMapList(),q.html(e(a)),this._activateMapList(),k(),l()},open:function(a){if(y=!1,null==t)throw new Error("Need Gis.Map object to be set Gis.MapListControl.setMap");this.replaceMaps(a),o.dialog("open")}}),Gis.mapListControl=function(){return x||new A},Gis.mapListControl.include=function(a){A.include(a)}}(this||self),function(){"use strict";function a(){return"<div id='layer-opacity-slider'> </div>"}function b(){return'<div id="'+v+'"><div class="padding-3"><div class="map-text">Основная карта: <span class="map-name"></span><div>Проекция: <span class="map-projection"></span></div></div><div id="'+x+'"></div><div class="map-buttons"><div class="right"><button class="gis-propertys-button map-ok">Ок</button><button class="gis-propertys-button map-cancel">Отмена</button></div></div></div></div>'}function c(a){a.sort(function(a,b){var c=q.getAdditionalLayerInfo(a),d=q.getAdditionalLayerInfo(b),e=b.title.toLowerCase(),f=a.title.toLowerCase();return c&&!d?-1:!c&&d?1:c&&d?c.order-d.order:f>e?1:e>f?-1:0})}function d(a){o[a?"addClass":"removeClass"]("visible"),Gis.DomUtil.isCssTransform()||o.css("display",a?"block":"none"),a||h()}function e(){m.dialog("close")}function f(a){$(".ui-slider-handle",n)[a?"addClass":"removeClass"]("animation")}function g(){n=$(a()),o=$("<div class='slider-opacity-container'></div>"),o.append(n),m.append(o),o.on("click",function(){return!1}),n.slider({min:0,max:100,orientation:"vertical"}),f(!0),n.on("slidestart",function(){f(!1)}).on("slidestop",function(){f(!0)}),d(!1)}function h(){$(".slider",p).removeClass("slider"),n.off("slide")}function i(){var a,b=$("li",p);return $(".checked",b).length&&(a=[],b.each(function(b){a.push({key:$(this).data("key"),order:b,opacity:parseInt($(".opacity",this).text(),10)/100,checked:$(".checked",this).length})})),a}function j(){p.on("click",".checkbox",function(){$(this).toggleClass("checked"),u&&clearTimeout(u)}),m.on("dblclick",".map-list li",function(){$(".checkbox",this).toggleClass("checked"),u&&clearTimeout(u),u=setTimeout(function(){y.saveMap()},200)}),m.on("click",".map-ok",y.saveMap),m.on("click",".map-cancel",function(){u&&clearTimeout(u),e()}),p.on("click",".opacity",y.opacityClick),p.on("click",".up",function(){var a=$(this).parent(),b=a.prev();b&&a.insertBefore(b)}),p.on("click",".down",function(){var a=$(this).parent(),b=a.next();b&&a.insertAfter(b)}),p.on("mousedown","li",function(){var a=$(this),b=function(){a.removeClass("selected"),$(document.body).off("mouseup",b)};a.addClass("selected"),$(document.body).on("mouseup",b)})}function k(){var a=m.parent(),b=a.position();Gis.Preferences.setPreferenceData(w,{width:a.outerWidth(),height:a.outerHeight(),position:{my:"left+"+b.left+" top+"+b.top,at:"left top"}})}function l(){return Gis.Preferences.getPreferenceData(w)}var m,n,o,p,q,r,s,t,u,v="map-dialog-additional",w="map-dialog-additional-dimension",x="map-list-container-additional",y={};y.createMapListAdditional=function(a){var b,d,e="";return a&&(c(a),e=a.reduce(function(a,c){return b=s.getMap().getMap(c.key),d=q.getAdditionalLayerInfo(c.key),a+'<li data-key="'+c.key+'"><span class="up"></span><span class="down"></span><span class="gis-propertys-button opacity">'+Math.round(100*(d&&d.opacity||1))+'</span><span class="checkbox '+(d&&d.checked?"checked":"")+'"></span><span class="name">'+c.title+"</span></li>"},"")),'<ul class="map-list data-list element-hover">'+e+"</ul>"},y.opacityClick=function(){var a,b,c=$(this);return c.hasClass("slider")?d(!1):(h(),c.addClass("slider"),n.slider("value",parseInt(c.text(),10)),n.on("slide",function(a,b){c.html(b.value)}),d(!0),a=$(this).offset(),b=m.offset(),o.css({top:a.top-b.top})),!1},y.saveMap=function(){q.setAdditionalLayers(i()),r.setMapType(r.getSelectedMapKey(),!0),e()};var z=function(){d(!1)};t={_createDialogSecond:function(){var a=this,c=l()||{};m||(m=$(b()),m.dialog(Gis.Util.extend({},this.defaultDialogOptions,{title:"Выбор дополнительных карт",position:{my:"left+80 top+80",at:"left top",of:window},open:function(){r=a.getMap(),$(document.body).on("click",z)},close:function(){d(!1),$(document.body).off("click",z)},beforeClose:function(){k()}},c)),g(),p=$("#"+x,m),j())},initialize:function(a){a(),s=this,this._createDialogSecond(),this.on("close",e)},_activateMapListAdditional:function(){this._activateList(p),$(">ul",p).sortable({axis:"y",containment:"parent",placeholder:"sortable-placeholder"})},replaceMapsAdditional:function(a){a=a||this.getMap().getMapList(q),a&&(p.html(y.createMapListAdditional.call(this,a)),s._activateMapListAdditional())},showSecondDialog:function(a){if(q=a,this.setClicked(!1),null==this.getMap())throw new Error("Need Gis.Map object to be set Gis.MapListControl.setMap");this.replaceMapsAdditional(),$("span.map-name",m).html(q.getTitle()),$("span.map-projection",m).html(q.getCrs().getCode()),m.dialog("open")}},Gis.mapListControl.include(t)}(this||self),function(){"use strict";function a(){return'<div class="map-custom-layers" id="'+o+'"><div class="padding-3"><div class="map-text">Карта: <span class="map-name"></span></div><div class="a-list" id="'+q+'"></div><div class="map-buttons"><div class="left">'+this.switcherHtml()+'</div><div class="right"><button class="gis-propertys-button map-ok">Ок</button><button class="gis-propertys-button map-cancel">Отмена</button></div></div></div></div>'}function b(){var a=k.parent(),b=a.position();Gis.Preferences.setPreferenceData(p,{width:a.outerWidth(),height:a.outerHeight(),position:{my:"left+"+b.left+" top+"+b.top,at:"left top"}})}function c(){return Gis.Preferences.getPreferenceData(p)}function d(a){a.sort(function(a,b){var c=b.name.toLowerCase(),d=a.name.toLowerCase();return d>c?1:c>d?-1:0})}function e(a,b){var c,e="";return a&&(d(a),e=a.reduce(function(a,d){return c=b||m.isCustomLayerActive(d.index),a+'<li class="layer" data-index="'+d.index+'"><span class="checkbox '+(c?"checked":"")+'"></span><span class="name">'+d.name+"</span></li>"},"")),'<ul class="map-list data-list element-hover">'+e+"</ul>"}function f(){k.dialog("close")}function g(){var a=$(".layer",j),b=[];return $(".checked",a).length&&a.each(function(){$(".checked",this).length&&b.push(parseInt($(this).data("index"),10))}),b}function h(){m.setActiveCustomLayers(g()),l.getSelectedMapKey()===m.getKey()&&l.setMapType(l.getSelectedMapKey(),!0),f()}function i(){j.on("click",".layer",function(){$(".checkbox",this).toggleClass("checked"),n.fire("change")}),k.on("click",".map-ok",h),k.on("click",".map-cancel",function(){f()}),this.initSwitcherEvents(),this.on("change",function(){this._updateCheckedState()},this)}var j,k,l,m,n,o="map-custom-layers",p="map-dialog-layers-dimension",q="map-custom-layers-list",r={_initDialogLayers:function(){var d=this,e=c()||{};k||(k=$(a.call(this)),k.dialog(Gis.Util.extend({},this.defaultDialogOptions,{title:"Выбор слоев",position:{my:"left+80 top+80",at:"left top",of:window},open:function(){l=d.getMap()},close:function(){},beforeClose:function(){b()}},e)),j=$("#"+q,k),this.setSwitchContainer(k,j),i.call(this))},initialize:function(a){a(),n=this,this._initDialogLayers(),this.on("close",f)},replaceCustomLayers:function(a){a=a||m.getCustomLayers(),a&&(j.html(e(a,m.isAllCustomLayersSelected())),n.fire("change"))},showCustomLayersDialog:function(a){if(m=a,this.setClicked(!1),null==this.getMap())throw new Error("Need Gis.Map object to be set Gis.MapListControl.setMap");this.replaceCustomLayers(),$("span.map-name",k).html(m.getTitle()),k.dialog("open")}};Gis.mapListControl.include(r),Gis.mapListControl.include(Gis.checkAll)}(this||self),Gis.OSRM={getMapZoom:function(){var a,b=Gis.Map.CURRENT_MAP.options.provider.map,c=b.getBounds(),d=-1,e=18,f=b.getSize(),g=c.getNorthWest(),h=c.getSouthEast(),i=!0;do d++,a=L.CRS.EPSG3857.latLngToPoint(h,d).subtract(L.CRS.EPSG3857.latLngToPoint(g,d)),i=f.contains(a);while(i&&e>=d);return d-1}},Gis.OSRM.TYPE_FORWARD="forward",Gis.OSRM.TYPE_BACKWARD="backward",function(){"use strict";Gis.opacityWidget={OPACITY_CLASS:"gis-widget-opacity",OPACITY_CLASS_TEXT:"gis-widget-opacity-text",initialize:function(a){a()},_HTMLSlider:function(){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='opacity-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Непрозрачность</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-opacity-container'><div class=\""+this.OPACITY_CLASS+'"></div></div></div>\n'},getOpacity:function(){return this._$slider.slider("value")/100},isChangedOpacity:function(){return this._slided},resetOpacity:function(){this._slided=!1},setOpacity:function(a){return this._$slider.slider("value",100*a)},initSlider:function(a){function b(a,b){c._$number.html()!==b.value&&c._$number.html(b.value),c._slided=!0,c._updateState(),c._sliding(c.getOpacity())}var c=this,d=100,e=0;this._$slider=$("."+this.OPACITY_CLASS,a).slider({max:d,min:e,step:1,change:b,slide:b}),this.resetOpacity(),$("a",this._$slider).append("<span></span>"),this._$number=$("a span",this._$slider)}}}(this||self),Gis.Widget=Gis.Widget||{},Gis.Widget.Base=Gis.BaseClass.extend({_dialogOptions:{dialogClass:"no-title-bar",autoOpen:!1,modal:!0,width:340,closeOnEscape:!0,minHeight:10,draggable:!0,resizable:!1},_typePrefix:"",_type:void 0,options:{position:"TOP",enabled:!0},getNeedSize:function(){Gis.extendError()},_initDialogClose:function(a){var b,c,d,e;return c=a.id||"gis-remove-dialog",d=a.callback||function(){},e=a.context||this,b=$("#"+c),b.length||(b=$('<div id="'+c+'"/>'),b.appendTo($(document.body))),b.dialog($.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){d.call(e),$(this).dialog("close")}},{text:"Нет",click:function(){$(this).dialog("close")}}]})),b},_deleteLayerConfirm:function(a,b){b=b||this.options.dataBinded,b&&(this._$dialogRemove=this._initDialogClose(a),this._$dialogRemove.html((a.title||"")+(!b.isEditableByUser()&&b.isMetaData()?"<hr><span>Объект будет скрыт, т.к. недостаточно прав для его удаления</span>":"")),this._$dialogRemove.dialog("open"))},initialize:function(){var a=this;Gis.BaseClass.prototype.initialize.apply(this,arguments),this._pointDirectionClicked=function(){if($(this).hasClass("disabled")||a.options.dataBinded&&a.isDataEditable&&(!a.isDataEditable()||!a.getValueFromData("isDraggable",!0)))return this;var b,c,d,e=["СШ ЮШ","ВД ЗД"],f=$(this),g=f.html();b=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,f.parent()).length?e[0]:e[1],b=b.split(" "),c=b.indexOf(g),d=b.length>c+1?b[c+1]:b[0],f.html(d),a.fire("change")},this._pointDirectionCopy=function(b){return b.originalEvent.clipboardData.setData("Text",a.getPointValue(a.getPointY($(this)))+" "+a.getPointValue(a.getPointX($(this)))),a.fire("change"),!1},this._pointDirectionPaste=function(b){var c=a._containerController.getUIAttached().getGeoConverter().fromRandomTemplateToCurrent(b.originalEvent.clipboardData.getData("Text"),$(this).hasClass(Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED));return c&&(Gis.Util.isArray(c)?(c.forEach(function(b){a.setHtmlPointValue($(this),b)}),c[0]&&a.setHtmlPointValue(a.getPointY($(this)),c[0]),c[1]&&a.setHtmlPointValue(a.getPointX($(this)),c[1])):a.setHtmlPointValue($(this),c),a.fire("change")),!1}},getModalPreloader:function(){var a=$(".modalPreloader");return a.length||(a=$('<div class="modalPreloader" style="display: none; text-align: center;"><div class="text"><h2 style="font-size: 16px;"></h2><div class="loader"></div></div></div>').appendTo(document.body)),a},showModalPreloader:function(a){var b=this.getModalPreloader();$("h2",b).html(a),b.show()},hideModalPreloader:function(){var a=this.getModalPreloader();a.hide()},getPointX:function(a){var b=a.parent().parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED);return b.length||(b=a.parent().parent().parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED)),b
},getPointY:function(a){var b=a.parent().parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED);return b.length||(b=a.parent().parent().parent().parent().find("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED)),b},isAttachedToUi:function(){return this._containerController&&this._containerController.getUIAttached()},templateToCoordinate:function(){var a=this._containerController.getUIAttached().getGeoConverter();return a.toBase.apply(a,arguments)},getCoordinateRowName:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=[{x:"X",y:"Y"},{y:"&phi;",x:"&lambda;"}];return c[b.isMetric()?0:1][a?"y":"x"]},_HTMLRowName:function(a){return"<span class='gis-row-name "+(a?"y":"x")+"-name'>"+this.getCoordinateRowName(a)+"</span>"},_HTMLRowInput:function(a,b,c,d,e){return"<input type='text' title='"+(d||"")+"'  placeholder='"+(e||"")+"' data-old-val='"+a+"' "+(b?"id='"+b+"'":"")+" class='"+(c||"")+"' value='"+a+"'/>"},_HTMLPointSelector:function(a,b,c,d){var e="",f=this._containerController.getUIAttached().getGeoConverter();return a&&a.match&&(e=a.match(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_FIND),e=e&&e.length?e[0]:""),a=a.replace(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE,"").trim(),!e&&f.isTemplateDirectional()&&(e=c.indexOf(Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED)>=0?"СШ":"ВД"),"<span class='gis-point-selector "+(f.isTemplateDirectional()?"gis-direction":"")+"'><input type='text' data-is-point='true' title='"+(d||"")+"' data-old-val=\""+a+'" '+(b?"id='"+b+"'":"")+" class='"+(c||"")+"' value=\""+a+"\"/><span class='point-direction' data-old-val='"+e+"'>"+e+"</span><span title='Используется фиксированная зона' class='point-attention'>!</span></span>"},_HTMLPointSelectorWidget:function(a){var b,c=a.tag||"span",d=a.xClass||"",e=a.yClass||"",f=a.x||"",g=a.y||"",h=a.tagClass||"",i=this._containerController.getUIAttached().getGeoConverter();return b=i.isMetric(i.getSelectedSystem()),b?"<"+c+" class='"+h+"'><div class='gis-point-wraper'>"+this._HTMLRowName()+this._HTMLPointSelector(f,a.xID,d+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_X)+"</div></"+c+">\n<"+c+" class='"+h+"'><div class='gis-point-wraper'>"+this._HTMLRowName(!0)+this._HTMLPointSelector(g,a.yID,e+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_Y)+"</div></"+c+">\n":"<"+c+" class='"+h+"'><div class='gis-point-wraper'>"+this._HTMLRowName(!0)+this._HTMLPointSelector(g,a.yID,e+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_Y)+"</div></"+c+">\n<"+c+" class='"+h+"'><div class='gis-point-wraper'>"+this._HTMLRowName()+this._HTMLPointSelector(f,a.xID,d+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_X)+"</div></"+c+">\n"},setHtmlPointSelectorWidgetData:function(a,b,c){if(b&&void 0!=b.x&&this.setHtmlPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a),b.x,c&&c.x),b&&void 0!=b.y){var d=this._containerController.getUIAttached().getGeoConverter(),e=b.x&&d.isNeedZone(d.getSelectedSystem())&&Gis.Util.isInFixedZoneBounds(this.templateToCoordinate(b).x);this.setHtmlPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,a),b.y,c&&c.y,e)}},revertHtmlPointSelectorWidgetData:function(a){this.setHtmlPointSelectorWidgetData(a,this.getPointWidgetData(a,!0))},getPointWidgetData:function(a,b){return Gis.UI.coordinate(this.getPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a),b),this.getPointValue($("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,a),b))},setHtmlPointValue:function(a,b,c,d){function e(){return a.hasClass(Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED)}function f(a){var b=k?e()?"СШ":"ВД":"";return a+="",a&&a.match&&k&&(b=a.match(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_FIND),b=b&&b.length?j.getDirectionNameOutter(b[0]):""),b}var g,h,i,j=this._containerController.getUIAttached().getGeoConverter(),k=j.isTemplateDirectional();return a=$(a),a.data("is-point",!0),g=a.parent(),g[k?"addClass":"removeClass"]("gis-direction"),b=void 0==b?"":b,d?$(".point-attention",a.parent()).addClass(Gis.Widget.Base.POSITION_VALUE_CLASS_FIXED_ZONE):$(".point-attention",a.parent()).removeClass(Gis.Widget.Base.POSITION_VALUE_CLASS_FIXED_ZONE),h=f(b),b+="",b=b.replace(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE,"").trim(),$(".point-direction",g).html(h),a.val(b),void 0!=c&&(i=f(c),c+="",c=c.replace(Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE,"").trim(),$(".point-direction",g).data("old-val",i),a.data("old-val",c)),this},getPointValue:function(a,b,c,d){var e,f=this._containerController.getUIAttached().getGeoConverter().isTemplateDirectional(c,d);return b?(e=a.data("old-val"),""!==e?e+(f&&a.data("is-point")?" "+$(".point-direction",a.parent()).data("old-val"):""):""):(e=a.val(),""!==e?e+(f&&a.data("is-point")?" "+$(".point-direction",a.parent()).html():""):"")},coordinateToTemplate:function(a,b,c){Gis.Util.isArray(a)&&(a=Gis.UI.coordinate([a[1],a[0],a[2]]));var d=this._containerController.getUIAttached().getGeoConverter();return d.fromBase.call(d,a,b,c)},coordinateToText:function(a){a=Gis.latLng(a);var b=this._containerController.getUIAttached().getGeoConverter(),c=a&&this.coordinateToTemplate(a.lng,a.lat),d=b.isMetric(b.getSelectedSystem());return c&&c.x&&c.y?d?c.x+", "+c.y:c.y+", "+c.x:"Позиция не определена"},canFitTo:function(){return!0},onRemove:function(){this._deInitEvents(),this._$div.remove()},onAdd:function(a){this.container=a.getContainer(),this._containerController=a,this.initHTML()},isControlAvailable:function(a,b){var c=!b&&this._containerController.getUIAttached(),d=(b||c&&this._containerController.getUIAttached().getMap()).getSetting("ui"),e=d&&d.indexOf(a||this._typePrefix+this._type)>=0;return e},initHTML:function(){this._$div=$('<div class="'+Gis.Widget.Base.CLASS_NAME+'"/>')},getType:function(){return this._type},addTo:function(a){a.addChild(this)},getPosition:function(){return this.options.position},hide:function(){this._$div.addClass("hide")},show:function(){this._$div.removeClass("hide")},_deInitEvents:function(){this._containerController.getUIAttached().off("skchanged",this._skChanged,this),this._$div.off("click",".point-direction",this._pointDirectionClicked),this._$div.off("copy","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionCopy),this._$div.off("paste","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionPaste)},_initEvents:function(){this._containerController.getUIAttached().on("skchanged",this._skChanged,this),this._$div.on("click",".point-direction",this._pointDirectionClicked),this._$div.on("copy","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionCopy),this._$div.on("paste","."+Gis.Widget.Base.POSITION_VALUE_CLASS,this._pointDirectionPaste)},_skChanged:function(){var a=this._HTMLRowName(),b=this._HTMLRowName(!0);$(".x-name",this._$div).each(function(){$(this).replaceWith(a)}),$(".y-name",this._$div).each(function(){$(this).replaceWith(b)})},draw:function(){this.container.appendChild(this._$div[0]),this._initEvents()},getWidth:function(){return this._$div.width()},getHeight:function(){return this._$div.height()},isDataEditable:function(a){return a=a||this.options.dataBinded,!a||a.isEditableByUser()},afterUpdate:function(){this.fire("updated",{target:this})},removeLayerFromMap:function(a){this._containerController.getUIAttached().getMap().clearMap(null,!1,a.getId())}}),Gis.UI.DeleteActions={post:function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить ПОСТ?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"post-remove-dialog"},b)},source:function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить объект?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"source-remove-dialog"},b)}},Gis.UI.DeleteActions[Gis.Objects.HeatMap.prototype.options.tacticObjectType]=function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить объект?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"heat_map-remove-dialog"},b)},Gis.Widget.Base.CLASS_NAME="gis-widget",Gis.Widget.Base.TITLE_CLASS="gis-widget-title",Gis.Widget.Base.REVERT_CLASS="gis-widget-revert",Gis.Widget.Base.GO_CLASS="gis-widget-go",Gis.Widget.TYPE={},Gis.Widget.Base.POSITION_VALUE_CLASS="position-value",Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED="position-value-x",Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED="position-value-y",Gis.Widget.Base.POSITION_VALUE_CLASS_FIXED_ZONE="zone-fixed",Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES="SNEWСЮШВЗДsnewсюшвзд",Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_REPLACE=new RegExp("["+Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES+"]","g"),Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES_REGEXP_FIND=new RegExp("["+Gis.Widget.Base.POSITION_VALUE_DIRECTION_NAMES+"]+"),Gis.Widget.Base.POSITION_VALUE_CLASS_X=Gis.Widget.Base.POSITION_VALUE_CLASS+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,Gis.Widget.Base.POSITION_VALUE_CLASS_Y=Gis.Widget.Base.POSITION_VALUE_CLASS+" "+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,Gis.Widget.Button=Gis.BaseClass.extend({required:["className","action"],options:{tag:"li",className:void 0,title:void 0,action:void 0},getButton:function(a){var b;return this._node||(this._container=a,this._node=document.createElement(this.options.tag),b=document.createElement("span"),this.options.title&&(b.title=this.options.title),this._node.appendChild(b),this._node.className=Gis.Widget.Button.BUTTON_CLASS_NAME+" "+this.options.className,$(this._node).data("class-name",this.options.className),this.options.action.attachToButton(a,this.options.className)),this._node},getId:function(){return this._id=this._id||Gis.Util.generateGUID(),this._id},getAction:function(){return this.options.action}}),Gis.Widget.Button.BUTTON_CLASS_NAME="gis-instruments-button",function(a){"use strict";a.Widget.ContainerBehavior={child:null,addChild:function(a){a.isControlAvailable(null,this._ui.getMap())&&!this.containsChild(a)&&a.canFitTo(this)&&(this._$container.parent().show(),this.child.push(a),a.onAdd(this))},hideChilds:function(a){var b,c;for(b=0,c=this.child.length;c>b;b+=1)this.child[b]&&a!==this.child[b]&&this.child[b].hide()},showChilds:function(){var a,b;for(a=0,b=this.child.length;b>a;a+=1)this.child[a]&&this.child[a].show()},swapVisible:function(){this.child.length?this._$container.parent().show():this._$container.parent().hide()},removeChild:function(a){var b,c;for(b=0,c=this.child.length;c>b;b+=1)a===this.child[b]&&delete this.child[b];a.onRemove(),this.swapVisible()},removeWidgetByType:function(a){var b,c,d=this.child;for(b=0,c=d.length;c>b;b+=1)a===d[b].getType()&&this.removeChild(d[b])},containsChild:function(a){var b,c;for(b=0,c=this.child.length;c>b;b+=1)if(a===this.child[b])return!0;return!1}}}(Gis),Gis.Widget.TYPE.CONTAINER=1,Gis.Widget.Container=Gis.Widget.Base.extend({_className:"",includes:Gis.Widget.ContainerBehavior,_$container:null,_type:Gis.Widget.TYPE.CONTAINER,options:{width:null,height:null},getNeedSize:function(a){var b,c=0,d=0;return this.child.forEach(function(e){b=e.getNeedSize(),a?c=b[0]:c+=b[0],d+=b[1]}),[c+this._$container.outerWidth(!0)-this._$container.width(),d+this._$container.outerHeight(!0)-this._$container.height()]},initializeHTMLcontainer:function(){this._$container=$('<div style="position: relative;" class="'+Gis.Widget.Base.CLASS_NAME+" "+Gis.Widget.Container.CLASS_NAME+" "+this._className+'"><div class="dragger"><div></div></div>')},initialize:function(a){Gis.Widget.Base.prototype.initialize.call(this,a),this.child=[],this.initializeHTMLcontainer()},onAdd:function(a){this._ui=a},getUIAttached:function(){return this._ui},draw:function(a){$(a).append(this._$container),this.swapVisible()},getContainer:function(){return this._$container[0]},getAvailableWidth:function(){var a=this.getWidth();this.child.forEach(function(b){a-=$(b).width()})},getAvailableHeight:function(){var a=this.getHeight();this.child.forEach(function(b){a-=$(b).height()})},getWidth:function(){return this._ui.getAvailableContainerBounds(this.options.position).width},getHeight:function(){return this._ui.getAvailableContainerBounds(this.options.position).height},addTo:function(a){a.addContainer(this)}}),Gis.Widget.Container.CLASS_NAME="gis-widget-container",Gis.Widget.container=function(a){return new Gis.Widget.Container(a)},function(){"use strict";function a(){var c=$(".show-submenu");c.off("click","li",b),c.removeClass("show-submenu"),$(document.body).off("click",a)}function b(){return $(".show-submenu").off("click","li",b),$(this.parentNode).off("click","li",c),$(this.parentNode).off("click","li",b),f?void clearTimeout(f):(Gis.UI.Action.DO_NOT_EXECUTE_ONCE||$(this).trigger("click"),!1)}function c(){return Gis.UI.Action.DO_NOT_EXECUTE_ONCE=!1,$(this.parentNode).off("click","li",c),$(this.parentNode).off("click","li",b),!1}function d(d){function e(){f=!1,Gis.UI.Action.DO_NOT_EXECUTE_ONCE=!0,$(d).on("click","li",c),$(document.body).on("click",a),d.classList.add("show-submenu")}function g(a){if($(d).on("click","li",b),a.altKey||a.offsetX>10&&a.offsetY>13){if(!$(".show-submenu").length)return $(this).off("click","li",c),e(),!1}else f=setTimeout(e,500)}$(d).on("mousedown","li:first-child",g)}var e;e={select:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-select",title:"Выбрать объект",action:Gis.UI.Action.select(a)})},move:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-move",title:"Переместить карту",action:Gis.UI.Action.move(a)})},zoom:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-zoom",title:"Масштабировать карту",action:Gis.UI.Action.zoom(a)})},measure:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-measure",title:"Измерить",action:Gis.UI.Action.measure(a)})},layers:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-layers",title:"Настроить слои объектов",action:Gis.UI.Action.layers(a)})},relief:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-relief hide",title:"Линейный рельеф",action:Gis.UI.Action.relief(a)})},visibility:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-visibility hide",title:"Область видимости",action:Gis.UI.Action.visibility(a)})},"areal-relief":function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-areal-relief hide",title:"Площадной рельеф",action:Gis.UI.Action["areal-relief"](a)})},geo:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-geo",title:"Геокодирование",action:Gis.UI.Action.geo(a)})},"geo-path":function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-geo-path",title:"Построение маршрутов",action:Gis.UI.Action["geo-path"](a)})},marker:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-marker",title:"Добавить/редактировать маркер",action:Gis.UI.Action.marker(a)})},object:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-object",title:"Добавить/редактировать объект",action:Gis.UI.Action.object(a)})},path:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-path",title:"Добавить/редактировать путь",action:Gis.UI.Action.path(a)})},polygon:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-polygon",title:"Добавить/редактировать полигон",action:Gis.UI.Action.polygon(a)})},ellipse:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-ellipse",title:"Добавить/редактировать эллипс",action:Gis.UI.Action.ellipse(a)})},sector:function(a){return new Gis.Widget.Button({tag:"li",className:"gis-instruments-button-sector",title:"Добавить/редактировать сектор",action:Gis.UI.Action.sector(a)})}};var f;Gis.Widget.Instruments=Gis.Widget.Base.extend({_type:"instruments",_buttons:{},options:{instruments:["select","move","zoom","measure","layers",["relief","areal-relief"],"visibility","geo","geo-path","separator","marker","object","path","polygon","ellipse","sector"],position:"left",enabled:!0},initialize:function(){Gis.Widget.Base.prototype.initialize.apply(this,arguments),Gis.Widget.Instruments.instance=this},_newActionExecuted:function(b){var c,d,e;a(),d=b.action,e=d.getId();for(c in this._buttons)this._buttons.hasOwnProperty(c)&&this._buttons[c].getId()!==e&&this._buttons[c].getAction().closeAction()},getNeedSize:function(){var a=0;return $(">li",$(this._list)).each(function(){a+=$(this).outerHeight(!0)}),[$(this._list).outerWidth(!0),a+this._$div.outerHeight(!0)-this._$div.height()]},createButton:function(a){var b=a.getAction?a:new Gis.Widget.Button({tag:"li",className:a.className,title:a.title,action:Gis.UI.Action.custom(this._containerController.getUIAttached())});b.getAction().on("newactionexecuted",this._newActionExecuted,this),this._buttons[b.getId()]=b;var c=b.getButton(this._list);return{button:b,htmlButton:c}},addButton:function(a,b){var c=this.createButton(a,b),d=c.button,e=c.htmlButton;return(b||this._list).appendChild(e),!b&&this._buttonSumbenu?$(e).insertBefore(this._buttonSumbenu):(b||this._list).appendChild(e),d},addSingleButton:function(a,b,c,e,f){var g,h,i,j,k,l;if(!a&&e||this.isControlAvailable(a)&&b.hasOwnProperty(a)&&Gis.UI.ActionController.getAction(a)){if(e){i=document.createElement("ul"),j=document.createElement("ul"),k=this.addSingleButton(e[0],b,null,null,i);for(var m=0,n=e.length;n>m;m+=1)k=this.addSingleButton(e[m],b,null,null,j);i.classList.add("with-childs"),h=document.createElement("li"),h.appendChild(j),i.appendChild(h),h=document.createElement("li"),h.appendChild(i),this._list.appendChild(h),d(i)}else g=b[a](this._containerController.getUIAttached()),l=this.addButton(g,f),f&&l.getAction().on("newactionexecuted",function(){var a=$(this),b=$(">:first-child",$(a.parents(".with-childs")[0]));b[0].className!==a[0].className&&(b[0].className=a[0].className)},l.getButton());c=c||a}return"separator"===a&&(h=document.createElement("li"),h.className=Gis.Widget.Button.BUTTON_CLASS_NAME+" gis-instruments-button-separator",this._list.appendChild(h)),c},onAdd:function(a){var b,c,d,f,g;Gis.Widget.Base.prototype.onAdd.call(this,a),b=this,c=this.options.instruments,d=e,c.forEach(function(a){g=Gis.Util.isArray(a)?b.addSingleButton(null,d,g,a):b.addSingleButton(a,d,g)}),f=document.createElement("li");var h=document.createElement("span");f.appendChild(h),f.className=Gis.Widget.Button.BUTTON_CLASS_NAME+" gis-instruments-button-submenu",h.title="Дополнительные действия",b._list.appendChild(f),this._buttonSumbenu=$(f),this.draw(),g=g||Gis.UI.ActionController.getFirstAction(),g&&Gis.UI.ActionController.getAction(g).execute(),this.afterUpdate()},mapListChanged:function(){var a=this._containerController.getUIAttached().getMap(),b=a.getFirstTMS()?"removeClass":"addClass";$(".gis-instruments-button-relief",this._list)[b]("hide"),$(".gis-instruments-button-visibility",this._list)[b]("hide"),$(".gis-instruments-button-areal-relief",this._list)[b]("hide")},_deInitEvents:function(){this._containerController.getUIAttached().off("sizerecalculated",this.setWidth,this),this._containerController.getUIAttached().getMap().off("maplistchanged",this.mapListChanged,this),$(this._list).off("click",".gis-instruments-button-submenu",this._subMenuClick),$(document.body).off("click",this._bodyClick),this._$div.tooltip("destroy")},_initEvents:function(){var a=this;this._containerController.getUIAttached().on("sizerecalculated",this.setWidth,this),this._containerController.getUIAttached().getMap().on("maplistchanged",this.mapListChanged,this),this._subMenuClick=function(){return a._$menuContainer.toggleClass("show"),a._buttonSumbenu[a._$menuContainer.hasClass("show")?"addClass":"removeClass"]("selected"),!1},this._bodyClick=function(){a._$menuContainer.removeClass("show"),a._buttonSumbenu.removeClass("selected")},$(this._list).on("click",".gis-instruments-button-submenu",this._subMenuClick),$(document.body).on("click",this._bodyClick),this._$div.tooltip({items:".gis-instruments-button > span[title]",track:!0})},setWidth:function(){var a,b,c,d,e,f,g=this,h=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,i=this._$menu;this._$div.css({width:this._containerController.getWidth(),height:h});var j=this._list;if(h=$(j).height(),j){var k=$("li",i),l=k.length;l&&(f=k[0]),a=Array.prototype.slice.call($(">li",j).not(g._buttonSumbenu)),b=$(a[0]).outerHeight(!0),c=b;var m=!1;for(d=0,e=a.length;e>d;d+=1)c+=b,(m||0>h-c)&&(m=!0,f?$(a[d]).insertBefore(f):i.append(a[d]));c=b*$("li",j).length-1,k=Array.prototype.slice.call($("li",i)),l=k.length;var n;if(!m&&l&&h-c>b)for(d=0,e=k.length;e>d;d+=1)n=l-d===1?0:b,h-c>=n&&$(k[d]).insertBefore(this._buttonSumbenu),c+=b;var o=$("li",i);o.length?(this._$menuContainer.css({width:$(o[0]).outerWidth(!0)*Math.ceil(o.length*b/i.height())}),this._buttonSumbenu.addClass("show")):(this._buttonSumbenu.removeClass("show"),this._bodyClick())}},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.Instruments.CLASS_NAME),this.setWidth(),this._list=document.createElement("ul"),this._list.className="instruments-list",this._$div[0].appendChild(this._list),this._$menuContainer=$('<div class="instruments-submenu-container"><ul class="instruments-submenu"></ul></div>'),this._$div.append(this._$menuContainer),this._$menu=$("ul",this._$menuContainer)},draw:function(){Gis.Widget.Base.prototype.draw.call(this)},afterUpdate:function(){Gis.Widget.Base.prototype.afterUpdate.call(this),this.mapListChanged()}}),Gis.Widget.Instruments.CLASS_NAME="gis-widget-instruments",Gis.Widget.instruments=function(a){return Gis.Widget.Instruments.instance||new Gis.Widget.Instruments(a)}}(),Gis.Widget.PointBehavior={_attachPointDataToRow:function(a,b,c){b?(!a.data("point")||c)&&(b.getId||Gis.Util.extend(b,{id:Gis.Util.generateGUID()}),a.data("point",Gis.pathPoint(Gis.Util.extend(b,{forcePaint:!0})))):a.data("point",null)},_detachPointDataFromRow:function(a){this._attachPointDataToRow(a,null)},_detachPointDataFromAllRows:function(){var a=this;$("#points-selector li",this._$div).each(function(){a._detachPointDataFromRow($(this))})},_getPoint:function(a){return a.data("point")}},function(){function a(a){return a.getName()||a.getTypeName(a.getType())||"Неизвестный объект"}var b=function(b){var c=a(b),d=this.additionalData(b);return"<span class='gis-name'>"+c+"</span><span class='additional'>"+d+"</span>"},c=function(a){var b=a.getOptionsWithStyle().icon,c="";return b&&(c="<div class='ico-preview' data-id='"+a.getId()+"' width='24' height='24'></div>"),c};Gis.UI.TitleGenerators={post:c,source:c,_generateRowName:function(a){return b.call(this,a)},_generateIco:function(a){return this[a.getType()]?this[a.getType()].call(this,a):""},updateText:function(b,c){var d=$(".gis-name",c),e=$(".additional",c),f=a(b.target),g=this.additionalData(b.target);d.text()!==f&&d.text(f),e.text()!==g&&e.text(g)},additionalData:function(a){return Gis.UI.getCoordinatesString(a,this,!0)}}}(),function(a){"use strict";a.Widget.ZoomBehavior={getConvertedZoom:function(){return this._containerController.getUIAttached().getMap().getZoom()},_getZoomValues:function(){var a,b=[],c=this._containerController.getUIAttached().getMap(),d=c.getMinZoom(),e=c.getMaxZoom();for(a=e;a>=d;a-=1)b.push({val:a,name:a});return b}}}(Gis),function(){"use strict";var a,b=function(){$(this).tooltip("close")};Gis.Widget.MapControl=Gis.Widget.Base.extend({includes:Gis.Widget.ZoomBehavior,_type:"mapcontrol",_buttons:{},options:{position:"top"},initialize:function(b){var c=this;a=this,Gis.Widget.Base.prototype.initialize.call(this,b),this._centerObject=function(){var a;a=c._getFirstSelected(),c._objectCentered?c._deinitCenterOnObject():(a||c._lastSelected)&&c._initCenterOnObject(a||c._lastSelected)},this._centerPost=function(){c._postCentered?c._deinitCenterOnPost():c._lastPostSelected&&c._initCenterOnPost(c._lastPostSelected)},this._selectMap=function(){Gis.Widget.MapControl.mapDialog.isOpened()?Gis.Widget.MapControl.mapDialog.close():(Gis.Widget.MapControl.mapDialog.setMap(c._containerController.getUIAttached().getMap()),Gis.Widget.MapControl.mapDialog.setControlAvailable(c.isControlAvailable("controlmap")),Gis.Widget.MapControl.mapDialog.open())},this._zoomIn=function(){c._containerController.getUIAttached().getMap().zoomIn()},this._centerFromLayer=function(a){var b=c._lastSelected.getCenter(),d=a.rows&&(a.rows.indexOf("latitude")>=0||a.rows.indexOf("longitude")>=0||a.rows.indexOf("latitudes")>=0||a.rows.indexOf("longitudes")>=0);a&&(d||c._lastSelected&&"source"===c._lastSelected.getType())&&c._isLayerOutFromContainer(b)&&c._containerController.getUIAttached().getMap().setCenter(b)},this._centerFromPost=function(){var a=c._lastPostSelected.getCenter();c._isLayerOutFromContainer(a)&&this._containerController.getUIAttached().getMap().setCenter(a)},this._zoomOut=function(){c._containerController.getUIAttached().getMap().zoomOut()}},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a),this.draw()},_skChanged:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=$("#gis-widget-control-mouse-position",this._$div);this.updateDataPosition({latLng:b.convert(a.oldSk,"wgs84",Gis.UI.coordinate($(".value-x",c).html().trim(),$(".value-y",c).html().trim()))}),Gis.Widget.Base.prototype._skChanged.call(this)},setWidth:function(){this._$div.css({width:this._containerController.getWidth(),height:this._containerController.getHeight()})},_checkRemoveButtonAvailable:function(){var a=this._containerController.getUIAttached().getMap(),b=Gis.TileMapService.decodeKey(a.getSelectedMapKey());$(".gis-control-map-remove")[b&&b.length>1&&a.isMeOwnerOfTms(b[1])?"show":"hide"]()},_postCenterHtml:function(){return this.isControlAvailable("controlpostcenter")?"<li class='gis-control-element gis-post-center'><div class='gis-control-square-button' id='gis-post-center' title='Авто-центрирование по посту'><span></span></div><div class='post-list'></div></li>":""},_mapSelectorContainer:function(){return this.isControlAvailable("controlmapselector")?"<li class='gis-control-element gis-map-selector'><div class='gis-control-square-button' id='gis-select-map' title='Выбрать карту'><span></span></li>":""},_objectCenterHtml:function(){return this.isControlAvailable("controlobjectcenter")?"<li class='gis-control-element gis-object-center'><div class='gis-control-square-button' id='gis-object-center'  title='Авто-центрирование по объекту'><span></span></div></li>":""},_zoomSelectorHtml:function(){return this.isControlAvailable("controlzoom")?"<li class='gis-control-element gis-zoom-selector'><div id='gis-widget-control-zoom-selector'></div><div class='gis-control-square-button' id='gis-control-zoom-in' title='Увеличить масштаб'><span></span></div><div class='gis-control-square-button' id='gis-control-zoom-out' title='Уменьшить масштаб'><span></span></div></li>":""},_connectionStateHtml:function(){return this.isControlAvailable("controlconnectionstate")?"<li class='gis-control-element gis-connection-status'><div id='gis-widget-control-status-connection' title='Статус соединения'></div></li>":""},_mousePositionHtml:function(){return this.isControlAvailable("controlmouseposition")?"<li class='gis-control-element gis-mouse-position'><div id='gis-widget-control-mouse-position' title='Текущая позиция указателя мыши'></div><div class='gis-sk-selector-container'><div class='gis-sk-title'></div><div id='gis-sk-selector'></div></div></li>":""},_generateControlsHtml:function(){var a="";return a+=this._mapSelectorContainer(),a+=this._postCenterHtml(),a+=this._objectCenterHtml(),a+=this._zoomSelectorHtml(),a+=this._connectionStateHtml(),a+=this._mousePositionHtml(),a=a?"<ul class='gis-widget-control'>"+a+"</ul>":""},_isLayerOutFromContainer:function(a){return!this._containerController.getUIAttached().getMap().getMapBounds().pad(-.8).contains(a)},zoomSelected:function(a){this._containerController.getUIAttached().getMap().setZoom(parseFloat(a))},_createPostList:function(){this._listPost=Gis.HTML.listView({data:this._getPostValues(),container:$(".gis-post-center > div.post-list",this._$list)[0],callback:this.postSelected,context:this,defaultValue:{val:"",name:""},noText:!0})},_getSkValues:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=[];return a=a||b.getAvailableSystems(),a.forEach(function(a){var d=b.getAvailableTemplates(a);d?c=c.concat(d.map(function(c){return{val:b.getFullSystemKey(a,c),name:b.getFullSystemName(b.getFullSystemKey(a,c))}})):b.isNeedZone(a)?c=c.concat([{val:a+Gis.UI.CoordinateConverter.DELIMETER+"null"+Gis.UI.CoordinateConverter.DELIMETER+"null",name:b.getSystemName(a)+" (авто)"},{val:a+Gis.UI.CoordinateConverter.DELIMETER+"null"+Gis.UI.CoordinateConverter.DELIMETER+"fix",name:b.getSystemName(a)+" (фикс)"}]):c.push({val:a,name:b.getSystemName(a)})}),c},showActiveZoneDialog:function(a){var b,c=$(".dialogZone"),d=!1,e=this._containerController.getUIAttached().getGeoConverter(),f=this;c.length||(c=$('<div class="dialogZone" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Выбор спорной зоны</h2><label for="fixed" >Фиксированная зона <input name="fixed" type="text"></label></div>').appendTo(document.body));var g=function(){var b,c=$(this);d=!1,b=$('input[name="fixed"]',c),parseInt(b.val(),10)&&(d=!0,e.setActiveSystem(a.replace("fix",parseInt(b.val(),10))),f._createSkList()),d&&c.dialog("close")},h=function(a){13===a.keyCode&&g.call(c)};b=this._containerController.getUIAttached().getMap(),this._$dialogZone=c.dialog(Gis.Util.extend(this._dialogOptions,{buttons:[{text:"Сохранить",click:g},{text:"Отменить",click:function(){$(this).dialog("close")}}]})).on("dialogopen",function(){var a=e.getAutoZone();$('input[name="fixed"]',$(this)).val(Gis.Util.isNumeric(a)?a:Gis.Util.getZoneFromLongitude(b.getCenter().lng)),c.on("keyup",h)}).on("dialogclose",function(){c.off("keyup",h)}),this._$dialogZone.dialog("open")},getNeedSize:function(){var a=0;return $(">li",this._$list).each(function(){a+=$(this).outerWidth(!0)}),[a+this._$div.outerWidth(!0)-this._$div.width()+this._$list.outerWidth(!0)-this._$list.width(),this._$div.outerHeight(!0)]},skSelected:function(a){return this._containerController.getUIAttached().getGeoConverter().isNeedZone(a)&&"fix"===a.split(Gis.UI.CoordinateConverter.DELIMETER)[2]?(this.showActiveZoneDialog(a),!0):(this._containerController.getUIAttached().getGeoConverter().setActiveSystem(a),!1)},_createSkList:function(){var a=this._containerController.getUIAttached().getGeoConverter();this._skPost=Gis.HTML.listView({data:this._getSkValues(),container:$("#gis-sk-selector",this._$list)[0],onBeforeSelect:this.skSelected,context:this,defaultValue:{val:a.getFullSystemSelectedKey().replace(/_\|_(\d+)/g,"_|_fix"),name:a.getFullSystemName()}})},_getMapValues:function(){var a=this._containerController.getUIAttached().getMap().getMapList();return a.sort(function(a,b){var c=b.title.toLowerCase(),d=a.title.toLowerCase();return d>c?1:c>d?-1:0}),a.map(function(a){return{val:a.key,name:a.title}})},_recalculatePost:function(a){a&&a.target&&"post"===a.target.getType()&&this._createPostList()},_createZoomList:function(){var a;a=this.getConvertedZoom(),this._listZoom=Gis.HTML.listView({data:this._getZoomValues(),container:$("#gis-widget-control-zoom-selector",this._$list)[0],callback:this.zoomSelected,context:this,defaultValue:{val:this._containerController.getUIAttached().getMap().getZoom(),name:a}})},_tileLayerChanged:function(){this._createZoomList(),this._checkRemoveButtonAvailable()},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.MapControl.CLASS_NAME),this.setWidth(),this._$list=$(this._generateControlsHtml()),this._$div.append(this._$list),this._$statusConnection=$("#gis-widget-control-status-connection",this._$list),this._createZoomList(),this._createPostList(),this._createSkList(),this.updateStatusConnection(),this._setMousePosition(this._containerController.getUIAttached().getMap().getCenter())
},postSelected:function(a){var b=this._containerController.getUIAttached().getMap().getLayer(a);this._deinitCenterOnObject(),this._initCenterOnPost(b)},_getPostValues:function(){var a=[],b=this._containerController.getUIAttached().getMap(),c=b.getLayerIDs();return c.forEach(function(c){var d=b.getLayer(c);"post"===d.getType()&&a.push({val:c,name:d.getName()||c})}),a},updateDataZoom:function(){this._listZoom.setValueSelected(this._containerController.getUIAttached().getMap().getZoom())},updateDataPosition:function(a){this._setMousePosition(a.latLng)},_setMousePosition:function(a){var b,c=this.coordinateToTemplate(a),d=this._containerController.getUIAttached().getGeoConverter(),e=d.isMetric(d.getSelectedSystem());b=e?"<span>"+this._HTMLRowName()+': <span class="value-x">'+c.x+" </span></span><span>"+this._HTMLRowName(!0)+': <span class="value-y">'+c.y+"</span></span>":"<span>"+this._HTMLRowName(!0)+': <span class="value-y">'+c.y+" </span></span><span>"+this._HTMLRowName()+': <span class="value-x">'+c.x+"</span></span>",$("#gis-widget-control-mouse-position",this._$div).html(b)},_deinitCenterOnPost:function(){this._lastPostSelected&&(this._lastPostSelected.off("change",this._centerFromPost,this),$("#gis-post-center",this._$div).removeClass("active"),this._postCentered=!1)},_initCenterOnPost:function(a){var b=a.getLatLng();b&&b[0]&&b[1]&&(this._deinitCenterOnPost(),this._deinitCenterOnObject(),this._listPost.setValueSelected(a.getId()),this._lastPostSelected=a,a.on("change",this._centerFromPost,this),this._containerController.getUIAttached().getMap().setCenter(b,!0),$("#gis-post-center",this._$div).addClass("active"),this._postCentered=!0)},_deinitCenterOnObject:function(){this._lastSelected&&(this._lastSelected.off("change",this._centerFromLayer,this),$("#gis-object-center",this._$div).removeClass("active"),this._objectCentered=!1)},_initCenterOnObject:function(a){this._deinitCenterOnObject(),this._deinitCenterOnPost(),this._lastSelected=a,a.on("change",this._centerFromLayer,this),this._containerController.getUIAttached().getMap().setCenter(a.getCenter()),$("#gis-object-center",this._$div).addClass("active"),this._objectCentered=!0},_setSelected:function(a){switch(a.type){case"unselectlayer":this._layerSelected===a.layer&&(this._layerSelected=void 0);break;case"selectlayer":this._layerSelected=a.layer}},_updateLoader:function(){var a=Gis.config(L.TileWithLoader.CONFIG_KEY,L.TileWithLoader.FULL_LOADER);if(a===L.TileWithLoader.FULL_LOADER||a===L.TileWithLoader.CORNER_LOADER){var b=Gis.ProgressBarController.isLoading();b!==this._loading&&(this._loading=b,$(".gis-connection-status",this._$div)[this._loading?"addClass":"removeClass"]("loading"))}},_tilesCountChanged:function(){this._updateLoader()},_deInitEvents:function(){var a=this._containerController.getUIAttached(),c=a.getMap();Gis.EventBus.on("tilesloading tilesloaded",this._tilesCountChanged,this),c.off("zoomend",this.updateDataZoom,this),c.off("mousemove",this.updateDataPosition,this),c.off("statuschanged",this.updateStatusConnection,this),this._$div.off("click","#gis-control-zoom-in",this._zoomIn),this._$div.off("click","#gis-control-zoom-out",this._zoomOut),this._$div.off("click","#gis-object-center",this._centerObject),a.off("sizerecalculated",this.setWidth,this),c.off("layerremoved layeradded",this._recalculatePost,this),a.on("selectlayer unselectlayer",this._setSelected,this),c.off("tilelayerchanged",this._tileLayerChanged,this),this._$div.off("click","#gis-select-map",this._selectMap),this._deinitCenterOnObject(),this._$div.tooltip("destroy"),this._$div.off("mouseleave mouseout",b),Gis.Widget.Base.prototype._deInitEvents.call(this)},_getFirstSelected:function(){if(this._layerSelected)return this._layerSelected;var a,b,c=this._containerController.getUIAttached().getMap();return b=c.getSelected(),a=Object.keys(b)[0],b=a&&b[a]},updateStatusConnection:function(a){var b=a&&a.target,c=b&&b.getStatus()||0;this._$statusConnection.html('<div class="server-status server-status-'+c+'"></div>'),c=Gis.Widget.MapControl.STATUS_TEXT[c]&&Gis.Widget.MapControl.STATUS_TEXT[c](b),c=(c||"")+"<hr/>"+Gis.moduleName.ru+': <span class="value">'+Gis.version+'</span>, сборка <span class="value">'+Gis.buildDate+"</span>",c+='<hr/>Версия графического интерфейса: <span class="value">'+Gis.UI.version+'</span>, сборка <span class="value">'+GIS_UI_buildDate+"</span>",this._$statusConnection.data("aTooltip",'<div class="serve-status-tooltip">'+c+"</div>")},_initEvents:function(){var a=this._containerController.getUIAttached(),c=a.getMap();Gis.EventBus.on("tilesloading tilesloaded",this._tilesCountChanged,this),this._updateLoader(),c.on("zoomend",this.updateDataZoom,this),c.on("mousemove",this.updateDataPosition,this),c.on("statuschanged",this.updateStatusConnection,this),this._$div.on("click","#gis-control-zoom-in",this._zoomIn),this._$div.on("click","#gis-control-zoom-out",this._zoomOut),this._lastSelected=this._getFirstSelected(),this._$div.on("click","#gis-object-center",this._centerObject),this._$div.on("click","#gis-post-center",this._centerPost),this._$div.on("click","#gis-select-map",this._selectMap),c.on("layerremoved layeradded",this._recalculatePost,this),a.on("selectlayer unselectlayer",this._setSelected,this),c.on("tilelayerchanged",this._tileLayerChanged,this),a.on("sizerecalculated",this.setWidth,this),Gis.Widget.Base.prototype._initEvents.call(this),this._$div.on("mouseleave mouseout",b),this._$div.tooltip({track:!0,content:function(){var a=$(this),b=a.data("aTooltip");return b?b:a.is("[title]")?a.attr("title"):void 0}})},draw:function(){Gis.Widget.Base.prototype.draw.call(this)}}),Gis.Widget.MapControl.STATUS_TEXT={0:function(){return"Активное соединение отсутствует"},1:function(a){return"Соединение с сервером "+a.getDomain()+":"+a.getPort()+" установлено"},2:function(a){return"Выполняется соединение с сервером "+a.getDomain()+":"+a.getPort()}},Gis.Widget.MapControl.CLASS_NAME="gis-widget-mapcontrol",Gis.Widget.MapControl.mapDialog=Gis.mapListControl(),Gis.Widget.mapcontrol=function(b){return a?b&&a.setOptions(b):new Gis.Widget.MapControl(b),a}}(),function(){"use strict";function a(){return!1}function b(a){return a.getName()||a.getTypeName(a.getType())||"Неизвестный объект"}function c(){return n.hasClass(s)?d():void 0}function d(){return $("input",n).val().toLowerCase()}function e(a,b){var c,d,e,f,g,h,i,j=$(a);if(a){var k,l=j.data("layer-id");k=this._containerController.getUIAttached().getMap().getLayer(l),this._containerController.getUIAttached().fire("selectlayer",{layer:k}),j[b?"addClass":"removeClass"]("selected"),b&&(i=a.getBoundingClientRect(),h=i.height,f=this._filteredList[0].getBoundingClientRect().top,c=this._filteredList.scrollTop(),e=this._filteredList.height(),d=i.top,(f>d||d+h>=f+e)&&(g=f+e/2-d-h/2,this._filteredList.scrollTop(c-g)))}}function f(a){var b=this;$(".gis-row-layer",this._$list).not($(a)).each(function(){var a,c=$(this).data("layer-id");a=b._containerController.getUIAttached().getMap().getLayer(c),b._containerController.getUIAttached().fire("unselectlayer",{layer:a})}),$(".gis-row-layer",this._$list).not($(a)).removeClass("selected")}function g(a,c,d,e){return d===a.getType()&&c(a)&&(!e||b(a).toLowerCase().indexOf(e)>-1)}function h(){o._fillList()}function i(a){"focusin"===a.type?n[0].classList.add(u):n[0].classList.remove(u)}function j(a){return a.keyCode===v&&(n[0].classList.remove(s),k()),!1}function k(){d()&&o._fillList(),n[0].classList.contains(s)?$("input",n)[0].focus():$("input",n)[0].blur()}var l,m,n,o,p,q=3e3,r="selected-type",s="selected",t="hided",u="focused",v=27,w="is-scheme-collapsed";Gis.Widget.Scheme=Gis.Widget.Base.extend({includes:Gis.Widget.ZoomBehavior,_type:"scheme",_buttons:{},options:{position:"right_inner",enabled:!0},selectRow:e,unSelectRows:f,getNeedSize:function(){return[this._$div.outerWidth(!0),200]},initialize:function(a){function b(a){var b,d,e,f,g,h,i,j=[];a=a||"data.json";var k=c._containerController.getUIAttached();b=k.getMap(),d=b.getLayerIDs(),d.forEach(function(a){e=b.getLayer(a),Gis.Widget.Scheme.TYPES.indexOf(e.getType())>-1&&j.push(e)}),h=JSON.stringify(j,null,"    "),i="text/plain;charset="+document.characterSet,window.WebKitBlobBuilder?(f=new WebKitBlobBuilder,f.append(h),g=f.getBlob(i)):g=new Blob([h],{type:i}),saveAs(g,a)}var c=this;o=this,Gis.UI.isNeedUseZeroClipboard()&&Gis.UI.loadZeroClipboard(function(a){a.config({swfPath:Gis.config("relativePath")+"libs/ui/ZeroClipboard.swf"})}),Gis.Widget.Base.prototype.initialize.call(this,a),this._layerDblClicked=function(){var a,b,d,e=$(this).data("layer-id");return a=c._containerController.getUIAttached().getMap().getLayer(e),a&&(d=a.getLatLngBounds&&a.getLatLngBounds(),d?c._containerController.getUIAttached().getMap().setMapBounds(d):(b=a.getCenter(),b&&c._containerController.getUIAttached().getMap().setCenter(b))),!1},this._layerClicked=function(){var a,b=$(this).data("layer-id");return a=c._containerController.getUIAttached().getMap().getLayer(b),a&&(c.unSelectRows(this),c.selectRow(this,!0),a.isSelectable()&&a.fire("select",{force:!0})),!1},this._actionClicked=function(a){var b,d=$(this).data(),e=$(this).parent().parent().data("layer-id");switch(b=c._containerController.getUIAttached().getMap().getLayer(e),d.action){case"delete":try{Gis.UI.DeleteActions[b.getType()]&&Gis.UI.DeleteActions[b.getType()].call(c,{srcElement:{}},b)}catch(a){Gis.Logger.log("Error delete",a.message,a.stack)}break;case"copy":var f=Gis.UI.getCoordinatesString(b,c);f?Gis.UI.copyToClipboard(f)&&Gis.notify("Позиция скопирована в буфер обмена","info"):Gis.notify("Позиция неопределена","warning");break;case"menu":Gis.UI.isNeedUseZeroClipboard()&&c.initZeroCopy.call($(".copy",$(this).parent())[0])}return $($(this).parent()).toggleClass("active"),!1},this.isCollapsed=function(){return!c.$_middle.is(":visible")},this.toggleCollapsed=function(){var a=c.isCollapsed()?"block":"none";c.$_middle.css({display:a}),c.$_header.css({display:a}),c.isCollapsed()?(Gis.Widget.Scheme.needHeight=function(){return c._$div.outerHeight(!0)},c.$_collapse.addClass("collapsed")):(Gis.Widget.Scheme.needHeight=Gis.Widget.Scheme.needHeightNormal,c.$_collapse.removeClass("collapsed")),Gis.Preferences.setPreferenceData(w,c.isCollapsed()),c._containerController.getUIAttached()._recalculateContainerStyles()},this._saveAllClick=function(){var a=c._containerController.getUIAttached().getMap();if(!$(this).hasClass("disabled"))if(Gis.Util.isCellNet())try{var d,e,f=[];d=a.getLayerIDs(),d.forEach(function(b){e=a.getLayer(b),Gis.Widget.Scheme.TYPES.indexOf(e.getType())>-1&&f.push(e)}),cellnet.savejson(JSON.stringify(f,null,"    "))}catch(g){alert(g)}else{var h,i=$("#dialog-save-file-name");i.length||(i=$('<div id="dialog-save-file-name"><h3>Укажите имя файла для сохранения</h3><input id="file-name-user" type="text"/></div>'),i.appendTo($(document.body))),i.dialog({dialogClass:"no-title-bar",autoOpen:!1,modal:!0,width:280,closeOnEscape:!0,minHeight:10,draggable:!0,buttons:[{text:"Сохранить",click:function(){b($("input",$(this)).val()||"data.json"),$(this).dialog("close")}},{text:"Отменить",click:function(){$(this).dialog("close")}}]}),h=a.getLayerIDs(),h&&h.length&&($("input",i).val("data.json"),i.dialog("open"),$("input",i).select())}},this._fileChange=function(){var a,b,d=c._containerController.getUIAttached();a=d.getMap(),b=this.files[0],this.value="";var e=new FileReader;e.onload=function(a){return function(b){var c;try{c=JSON.parse(b.target.result),Gis.Util.fillMapFromObject(a,c)}catch(d){Gis.Logger.log("Некорректные данные в файле",b.target.result,d.stack)}}}(a),e.readAsText(b,"utf-8")},this._fileClick=function(){if(Gis.Util.isCellNet()){var a=c._containerController.getUIAttached().getMap(),b=cellnet.loadjson();return b&&a.fillObjects(b),!1}},this._typeClicked=function(){c._setTypeOpen($(this).parent().data("type-id"))},this.allClearClick=function(){$(this).hasClass("disabled")||c._deleteLayersConfirm()},this.filterTypeSelected=function(a){l=a||Gis.Widget.Scheme.TYPE_FILER_ALL,c._selectedType=a,m=l===Gis.Widget.Scheme.TYPE_FILER_ALL?function(a){return Gis.Widget.Scheme.TYPES.indexOf(a.getType())>-1&&a.getOriginalType()===a.getType()}:function(a){return a.getType()===l},c._fillList()},this.triggerFilter=function(){return n[0].classList.toggle(s),k(),!1},this.initZeroCopy=function(){if(Gis.UI.isNeedUseZeroClipboard()){var a=this;if(this._binded)return;this._binded=!0,this.classList.remove("not-binded");var b=new ZeroClipboard(this);b.on("copy",function(b){var d,e=$(a).parents(".gis-row-layer").data("layer-id");d=c._containerController.getUIAttached().getMap().getLayer(e);var f=d.getCenter();return f?(f=c.coordinateToText(f),void b.clipboardData.setData("text/plain",f)):void Gis.notify("Позиция неопределена","warning")}),b.on("aftercopy",function(){Gis.notify("Позиция скопирована в буфер обмена","info")}),b.on("error",function(a){console.log(a)})}}},_deleteLayersConfirm:function(){var a=$(".dialogMapClear"),b=this._containerController.getUIAttached().getMap();a.length||(a=$('<div class="dialogMapClear" style="display: none; text-align: left;"><h2 style="font-size: 16px;">Подтверждение очистки карты</h2><div style="margin-top: 10px">Вы действительно хотите очистить карту?</div><div style="margin-top: 10px; padding-top: 5px; border-top: 1px solid #ffffff;"><input type="checkbox" style="margin-right: 10px;" name="delete-owner"  id="delete-owner" /><label for="delete-owner">Удалить созданные оператором объекты</label></div></div>').appendTo(document.body)),this._$dialogRemoveMap=a.dialog(Gis.Util.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){var c=$("#delete-owner",a).is(":checked");b.clearMap(function(a){return c||!a.isEditableByUser()},!1),a.dialog("close")}},{text:"Нет",click:function(){a.dialog("close")}}]})),this._$dialogRemoveMap.dialog("open")},removeFuncFilter:function(a){return a&&a.isEditableByUser()&&Gis.Widget.Scheme.TYPES.indexOf(a.getType())>-1},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a),this.draw(),this.setBounds();var b=Gis.Preferences.getPreferenceData(w);Gis.setConfig(Gis.Widget.Scheme.COLLAPSE_BY_DEFAULT_KEY,!0),Gis.Util.isDefine(b)||(b=Gis.config(Gis.Widget.Scheme.COLLAPSE_BY_DEFAULT_KEY,!1)),b!==this.isCollapsed()&&this.toggleCollapsed()},_getFirstSelected:function(){var a,b,c=this._containerController.getUIAttached().getMap();return b=c.getSelected(),a=Object.keys(b)[0],b=a&&b[a]},_postCenterHtml:function(){return"<div class='gis-control-square-button' id='gis-post-center'><span></span></div><div class='post-list'></div>"},_footerHtml:function(){return'<div><div class="gis-widget-button" id="gis-collapse" title=\'Свернуть\'></div>'+(this.isControlAvailable("schemesaveall")?"<div class='gis-widget-button' id='gis-save-all' title='Сохранить всю топосхему'></div>":"")+(this.isControlAvailable("schemeload")?"<div class='gis-widget-button' id='gis-load-all' title='Загрузить топосхему из файла'><input type='file' title='' name='file'></div>":"")+(this.isControlAvailable("schemeclear")?"<div class='gis-widget-button' id='gis-clear-all' title='Очистить карту'></div>":"")+"</div>"},_contentHtml:function(){return"<ul id='gis-list-filtered' class='data-list element-hover'></ul>"},_headerHtml:function(){return"<div><div class='gis-widget-button btn' id='gis-filter-all' title='Фильтр'><span></span><div class='input-group'><input type='text' placeholder='Фильтр'></div></div><div id='gis-show-filter'></div></div>"},_generateControlsHtml:function(){var a="<ul class='gis-widget-scheme'>";return a+="<li class='gis-scheme-element gis-map-header'>"+this._headerHtml()+"</li>",a+="<li class='gis-scheme-element gis-map-middle'>"+this._contentHtml()+"</li>",a+="<li class='gis-scheme-element gis-map-footer'>"+this._footerHtml()+"</li>",a+="</ul>"},_getTypeValues:function(){var a,b=[],c=[{val:Gis.Widget.Scheme.TYPE_FILER_ALL,name:"Все"}];return a=this._containerController.getUIAttached().getMap(),a.getRenderer().getKnownTypes().forEach(function(a){b.indexOf(a)<0&&Gis.Widget.Scheme.TYPES.indexOf(a)>=0&&(c.push({val:a,name:Gis.Widget.Scheme.TYPE_NAMES[a]}),b.push(a))}),-1===b.indexOf(p)&&(p=void 0),c},_getRowsFiltered:function(a,b){var d,e,f,h,i={};d=this._containerController.getUIAttached().getMap(),e=b?[b.getId()]:d.getLayerIDs();var j=c();return e.forEach(function(b){h=d.getLayer(b),f=h.getOriginalType(),Gis.Widget.Scheme.TYPES.indexOf(h.getType())>-1&&(i[f]=i[f]||[],i[f].push({layer:h,visible:g(h,a,f,j)}))}),i},_skChanged:function(){this.filterTypeSelected(this._selectedType),Gis.Widget.Base.prototype._skChanged.call(this)},drawIcon:function(a){var b,c,d=a.getOptionsWithStyle();if(a&&("source"===a.getType()||"post"===a.getType())){c=d.icon;var e=21;if(c)if("div"===this.tagName.toLowerCase()){b=this.outerWidth;var f=(e-b)/2,g=document.createElement("canvas"),h=Gis.Additional.Icon[c.getType()];if("source"===a.getType()&&d.bearingStyle){b=12,f=1;var i=document.createElement("canvas");i.width=e,i.height=e;var j=i.getContext("2d");j.beginPath(),j.shadowBlur=1,j.shadowColor=d.bearingStyle.getBorder(),j.strokeStyle=d.bearingStyle.getColor(),j.fillStyle=d.bearingStyle.getColor(),j.lineWidth=d.bearingStyle.getThickness(),j.moveTo(0,14),j.lineTo(e,0),j.stroke(),this.appendChild(i)}if(g.width=b,g.height=b,this.appendChild(g),$(g).css({top:f,left:(e-b)/2}),h)h(c.getOption("color")||"black",b,g);else{var k=new Image;k.onload=function(){g.getContext("2d").drawImage(k,0,0,b,b)},k.src=c.getImageUrl()}}else this.src=c.getImageUrl()}},_drawIcons:function(a){var b,c=this._containerController.getUIAttached().getMap(),d=this;$(".ico-preview",a||this._filteredList).each(function(){b=c.getLayer($(this).data("id")),d.drawIcon.call(this,b)})},getRowActions:function(a){return"<div class='actions'><div class='action real-action delete  "+this._editableClass(a)+" gis-widget-button' title='Удалить' data-action='delete'></div><div class='action real-action copy not-binded gis-widget-button' data-clipboard-text='Позиция неопределена' title='Скопировать координаты' data-action='copy'></div><div class='action menu gis-widget-button'  data-action='menu'  title='Меню'></div></div>"},_selectedClass:function(a,b){return a&&a.getId()===b.getId()?"selected":""},_editableClass:function(a){return this.isDataEditable(a)&&a.isEditableByUser()?"":""},_generateRow:function(a,b){return'<li id="gis-row-layer-'+a.getId()+"\" class='gis-row-layer "+this._selectedClass(this._getFirstSelected(),a)+(b?"":" "+t)+"' data-layer-id='"+a.getId()+"'>"+this.getRowActions(a)+this._generateIco(a)+'<div class="row-name">'+this._generateRowName(a)+"</div></li>"},_fillList:function(){var a,b,d,e,f="",g=this._getRowsFiltered(m),h=c(),i=Gis.Widget.Scheme.TYPE_FILER_ALL!==l||h;for(a in g)if(g.hasOwnProperty(a)){var j=i?"":"<span>"+Gis.Widget.Scheme.TYPE_NAMES[a]+"</span>";for(f+="<li class='gis-type gis-type-"+a+" "+(h||p&&p===a?r:"")+"' data-type-id='"+a+"'>"+j+"<ul>",b=0,d=g[a].length;d>b;b+=1)e=g[a][b],f+=this._generateRow(e.layer,e.visible);f+="</ul></li>"}this._rows={},this._filteredList.html(f),this._drawIcons(),i&&p!==l&&!h&&this._setTypeOpen(l)},_getFilterSelected:function(a){var b,c;if(this._selectedType){for(a=a||this._getTypeValues(),b=0,c=a.length;c>b;b+=1)if(a[b].val===this._selectedType)return this._selectedType;this._selectedType=void 0}},_createTypeList:function(){var a=this._getTypeValues(),b=this._getFilterSelected(a)||Gis.Widget.Scheme.TYPE_FILER_ALL;this._listTypes=Gis.HTML.listView({data:a,container:$("#gis-show-filter",this._$list)[0],callback:this.filterTypeSelected,context:this,defaultValue:{val:b,name:Gis.Widget.Scheme.TYPE_NAMES[b]}})},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.Scheme.CLASS_NAME),this._$div.css({position:"absolute"}),this._$list=$(this._generateControlsHtml()),this._rows={},this._filteredList=$("#gis-list-filtered",this._$list),this._$div.append(this._$list),this._createTypeList(),this.$_middle=$(".gis-map-middle",this._$list),this.$_header=$(".gis-map-header",this._$list),this.$_footer=$(".gis-map-footer",this._$list),this.$_collapse=$("#gis-collapse",this.$_footer),this.$_save=$("#gis-save-all",this.$_footer),this.$_clean=$("#gis-clear-all",this.$_footer),n=$("#gis-filter-all",this._$list)},setBounds:function(){var a,b;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=this.isCollapsed()?this._$div.outerHeight(!0):Math.min(b/2,300),this.$_middle.css({height:a-this.$_header.outerHeight(!0)-this.$_footer.outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height()}),this._$div.css({top:b-a})},_setTypeOpen:function(a){a?($(".gis-type."+r,this._$list).not($(".gis-type-"+a,this._$list)).removeClass(r),p!==a?$(".gis-type-"+a,this._$list).addClass(r):($(".gis-type-"+a,this._$list).removeClass(r),a=void 0)):$(".gis-type."+r,this._$list).removeClass(r),p=a},_layerEvent:function(){if(this._funcEvent)return this._funcEvent;var a=this,b={layerunselected:function(b){var c;c=$(".gis-row-layer.selected",a._$list),c.data("layer-id")===b.layer.getId()&&a.selectRow(c,!1)},layerselected:function(b){if(!m||m(b.layer||b.target)){var d=b.layer.getParentId()||b.layer.getId(),e=c();$(".gis-row-layer.selected",this._$list).removeClass("selected"),$(".gis-row-layer",this._$list).each(function(){d===$(this).data("layer-id")&&Gis.Widget.Scheme.TYPES.indexOf(b.layer.getType())>=0&&(e||b.layer.getType()===p||a._setTypeOpen(b.layer.getType()),a.unSelectRows(this),a.selectRow(this,!0))})}},layerchanged:function(b){var c;if(!a._layerNotForScheme(b)&&(!m||m(b.layer||b.target))){var d=b.target.getId();if(a._rows[d])c=a._rows[d];else{if(c=$("#gis-row-layer-"+d,a._filteredList),!c.length)return a._layerAdded(b);a._rows[d]=c}if(b.target.options.icon&&b.rows&&b.rows.indexOf("icon")>-1){var e=$(a._generateRow(b.target,!c.hasClass(t)));if(c.replaceWith(e),a._rows[d]=e,e.length>0){var f=$(".ico-preview",e);f.length>0&&a.drawIcon.call(f[0],b.target)}}else this.updateText(b,c)}}};return this._funcEvent=function(c){b[c.type]&&b[c.type].call(a,c)},this._funcEvent},_deInitEvents:function(){Gis.Widget.Base.prototype._deInitEvents.call(this);var b=this._containerController.getUIAttached().getMap(),c=this;b.off("layeradded",this._layerAdded,this),b.off("layerremoved",this._layerRemoved,this),b.off("layerremoved layeradded",this._checkButtonsActive,this),b.getRenderer().off("layervisibilitychanged",this._recalculateListDelayed,this),b.getRenderer().off("layervisibilitychanged",this._checkButtonsActive,this),this._$list.off("dblclick",".gis-row-layer",this._layerDblClicked),this._$list.off("click",".gis-row-layer",this._layerClicked),this._$list.off("click",".gis-type > span",this._typeClicked),this.$_middle.off("click",".actions .action",this._actionClicked),Gis.UI.isNeedUseZeroClipboard()&&Gis.UI.loadZeroClipboard(function(){c.$_middle.off("mouseenter",".actions .copy.not-binded",c.initZeroCopy)}),this._$list.off("click","#gis-filter-all",this.triggerFilter),this._$list.off("click","#gis-filter-all input",a),n.off("input","input",h),n.on("focus blur","input",i),n.off("keyup","input",j),this._$list.off("click","#gis-collapse",this.toggleCollapsed),this._$list.off("click","#gis-save-all",this._saveAllClick),this._$list.off("change","#gis-load-all > input",this._fileChange),this._$list.off("change","#gis-load-all > input",this._fileChange),this._$list.off("click","#gis-load-all > input",this._fileClick),this._$list.off("click","#gis-clear-all",this.allClearClick),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this),this._containerController.getUIAttached().getMap().off("layerselected layerunselected layerchanged",this._layerEvent(),this),this._$div.tooltip("destroy")},_layerNotForScheme:function(a){return a&&a.target&&a.target.getType&&(-1===Gis.Widget.Scheme.TYPES.indexOf(a.target.getType())||a.target.isControllableByServer()===Gis.FULL_LOCAL)},_recalculateList:function(a){this._layerNotForScheme(a)||(this._createTypeList(),this.filterTypeSelected(this._selectedType),this.afterUpdate())},_recalculateListDelayed:function(a){var b=this;this._recalculateListTimeout||(this._recalculateListTimeout=setTimeout(function(){b._recalculateListTimeout=null,Gis.requestAnimationFrame(50)(function(){b._recalculateList(a)})},q))},_layerAdded:function(a){var b,c,d,e=a.target;if((!m||m(e))&&!$("#gis-row-layer-"+e.getId(),this._filteredList).length){if(d=$(".gis-type-"+e.getType(),this._filteredList),!d.length)return void this._recalculateList(a);b=this._getRowsFiltered(m,e),c=$(this._generateRow(e,b&&b[e.getType()]&&b[e.getType()][0].visible)),$(">ul",d).append(c),this._drawIcons(c)}},_layerRemoved:function(a){var b=$(".gis-type-"+a.target.getType(),this._filteredList);$("#gis-row-layer-"+a.target.getId(),b).remove(),delete this._rows[a.target.getId()],$("ul li",b).length||(b.remove(),this._createTypeList())},_checkButtonsActive:function(){var a=this._containerController.getUIAttached().getMap(),b=a.getLayerIDs(),c=b.filter(function(b){var c=a.getLayer(b);return Gis.Widget.Scheme.TYPES.indexOf(c.getType())>-1});0==c.length?(this.$_save.addClass("disabled"),this.$_clean.addClass("disabled")):(this.$_save.removeClass("disabled"),this.$_clean.removeClass("disabled"))},_initEvents:function(){Gis.Widget.Base.prototype._initEvents.call(this);var b=this._containerController.getUIAttached().getMap(),c=this;b.on("layeradded",this._layerAdded,this),b.on("layerremoved",this._layerRemoved,this),b.on("layerremoved layeradded",this._checkButtonsActive,this),b.getRenderer().on("layervisibilitychanged",this._recalculateListDelayed,this),b.getRenderer().on("layervisibilitychanged",this._checkButtonsActive,this),this._$list.on("dblclick",".gis-row-layer",this._layerDblClicked),this._$list.on("click",".gis-row-layer",this._layerClicked),this.$_middle.on("click",".actions .action",this._actionClicked),Gis.UI.isNeedUseZeroClipboard()&&Gis.UI.loadZeroClipboard(function(){c.$_middle.on("mouseenter",".actions .copy.not-binded",c.initZeroCopy)}),this._$list.on("click",".gis-type > span",this._typeClicked),this._$list.on("click","#gis-save-all",this._saveAllClick),this._$list.on("click","#gis-collapse",this.toggleCollapsed),this._$list.on("change","#gis-load-all > input",this._fileChange),this._$list.on("click","#gis-load-all > input",this._fileClick),this._$list.on("click","#gis-clear-all",this.allClearClick),this._$list.on("click","#gis-filter-all",this.triggerFilter),this._$list.on("click","#gis-filter-all input",a),n.on("input","input",h),n.on("focus blur","input",i),n.on("keyup","input",j),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this),this._containerController.getUIAttached().getMap().on("layerselected layerunselected layerchanged",this._layerEvent(),this),this._$div.tooltip({items:".gis-row-layer .row-name",track:!0,content:function(){var a=$($(this).parent()),c=b.getLayer(a.data("layer-id"));return c?c.getFormatedDescription():""}})},afterUpdate:function(){Gis.Widget.Base.prototype.afterUpdate.call(this)}}),Gis.Widget.Scheme.TYPE_FILER_ALL="-1",Gis.Widget.Scheme.TYPE_NAMES={source:"Объект",post:"Пост",ellipse:"Эллипс",visibility:"Область видимости",path:"Маршрут",polygon:"Полигон",sector:"Сектор",image:"Иконка",text:"Маркер"},Gis.Widget.Scheme.TYPE_NAMES[Gis.Objects.Overlay.prototype.options.tacticObjectType]="Оверлей",Gis.Widget.Scheme.TYPE_NAMES[Gis.Objects.VisibilityMap.prototype.options.tacticObjectType]="Область видимости",Gis.Widget.Scheme.TYPE_NAMES[Gis.Objects.ArealRelief.prototype.options.tacticObjectType]="Площадной рельеф",Gis.Widget.Scheme.TYPE_NAMES[Gis.Objects.HeatMap.prototype.options.tacticObjectType]="Температурная карта",Gis.Widget.Scheme.TYPE_NAMES[Gis.Objects.GeoPath.prototype.options.tacticObjectType]="Автоматическй маршрут",Gis.Widget.Scheme.TYPES=[Gis.Objects.VisibilityMap.prototype.options.tacticObjectType,Gis.Objects.ArealRelief.prototype.options.tacticObjectType,Gis.Objects.Overlay.prototype.options.tacticObjectType,"source","post",Gis.Objects.HeatMap.prototype.options.tacticObjectType,Gis.Objects.GeoPath.prototype.options.tacticObjectType,"ellipse","path","polygon","sector","image","text"],Gis.Widget.Scheme.CLASS_NAME="gis-widget-scheme-container",Gis.Widget.Scheme.TYPE_NAMES[Gis.Widget.Scheme.TYPE_FILER_ALL]="Все",Gis.Widget.scheme=function(a){return o&&a&&o.setData(a),o||new Gis.Widget.Scheme(a)},Gis.Widget.Scheme.needHeightNormal=function(a){return Math.min(a/2,300)},Gis.Widget.Scheme.needHeight=Gis.Widget.Scheme.needHeightNormal,Gis.Widget.Scheme.include(Gis.UI.TitleGenerators),Gis.Widget.Scheme.COLLAPSE_BY_DEFAULT_KEY="collapse_scheme_by_default"}(this),Gis.Widget.SliderBase=Gis.Widget.Base.extend({_type:null,options:{step:.01,position:null,enabled:!0},getNeedSize:function(){return[50,this._$div.outerHeight(!0)]},initialize:function(a){var b=this;Gis.Widget.Base.prototype.initialize.call(this,a),this._decrease=function(){b._increase(1)}},_increase:function(){Gis.extendError()},getSliderValue:function(){return-parseFloat(this._slider.slider("value"))},getStep:function(){return parseFloat(this._slider.slider("option","step"))},getMapPixelBounds:function(){var a,b,c,d=this._containerController.getUIAttached().getMap(),e=d.getMapProvider();return a=d.getMaxBounds(),b=a&&a.getSouthWest()||Gis.latLng(-90,-180),c=a&&a.getNorthEast()||Gis.latLng(85,180),new Gis.Bounds(e.project(c),e.project(b))},getCalculatedStep:function(){Gis.extendError()},setBounds:function(){Gis.extendError()},_setValue:function(){Gis.extendError()},_setMaximum:function(){Gis.extendError()},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();a.off("moveend zoomend",this._setValue,this),a.off("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._$div.off("click",".gis-latitude-previous",this._increase),this._$div.off("click",".gis-latitude-next",this._decrease),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();this._$div.on("click",".gis-latitude-previous",this._increase),this._$div.on("click",".gis-latitude-next",this._decrease),a.on("moveend zoomend",this._setValue,this),a.on("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this)}}),Gis.Widget.SliderVertical=Gis.Widget.SliderBase.extend({_type:"slidervertical",options:{step:.01,position:"right",enabled:!0},getNeedSize:function(){return[this._$div.outerWidth(!0),50]},initialize:function(a){var b=this;Gis.Widget.SliderBase.prototype.initialize.call(this,a),this._increase=function(a){a=Gis.Util.isNumeric(a)&&a||-1;var c,d,e=b._containerController.getUIAttached().getMap();c=e.getCenter(),d=e.getMapProvider(),e.setCenter(d.unproject(Gis.point(d.project(c).x,b.getSliderValue()+b.getStep()*a)))}},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a);var b,c=this._containerController.getUIAttached().getMap(),d=c.getMapProvider(),e=this;b=this.getMapPixelBounds(),this.draw(),this.setBounds(),this._slider=$("#scroll-bar",this._$div).slider({orientation:"vertical",step:this.getCalculatedStep(),start:function(){var a=c.getCenter();e._x=d.project(a).x,e._slided=!0},stop:function(){e._slided=!1,e._x=null},min:-b.getBottomLeft().y,max:-b.getTopRight().y,value:-d.project(c.getCenter()).y,slide:function(a,b){var f=c.getCenter();c.setCenter(d.unproject(Gis.point(e._x||d.project(f).x,-b.value)),!0)}}),this._init=!0},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.SliderVertical.CLASS_NAME),this._$div.append("<div><div class='gis-widget-button gis-latitude-previous'></div><div id='scroll-bar'></div><div class='gis-widget-button gis-latitude-next'></div></div>")},setBounds:function(){var a;a=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,this._$div.css({height:a}),$("#scroll-bar",this._$div).css({height:this._$div.height()-($(">div",this._$div).outerHeight(!0)-$(">div",this._$div).height())})
},getCalculatedStep:function(){var a=this.getMapPixelBounds();return(a.getBottomLeft().y-a.getTopRight().y)/(100*this._containerController.getUIAttached().getMap().getZoom()+1)},_setValue:function(){if(!this._slided&&this._init){var a=this._containerController.getUIAttached().getMap(),b=a.getMapProvider();$("#scroll-bar",this._$div).slider("value",-b.project(a.getCenter()).y)}},_setMaximum:function(){var a,b=this._containerController.getUIAttached().getMap(),c=b.getMapProvider();a=this.getMapPixelBounds(),this._init&&$("#scroll-bar",this._$div).slider("option",{min:-a.getBottomLeft().y,max:-a.getTopRight().y,step:this.getCalculatedStep()||this.options.step,value:-c.project(b.getCenter()).y})}}),Gis.Widget.SliderVertical.CLASS_NAME="gis-widget-sliderVertical-container",Gis.Widget.sliderVertical=function(a){return new Gis.Widget.SliderVertical(a)},Gis.Widget.slidervertical=Gis.Widget.sliderVertical,Gis.Widget.SliderHorisontal=Gis.Widget.SliderBase.extend({_type:"sliderhorisontal",options:{step:.01,position:"bottom",enabled:!0},initialize:function(a){var b=this;Gis.Widget.SliderBase.prototype.initialize.call(this,a),this._increase=function(a){a=Gis.Util.isNumeric(a)&&a||-1;var c,d,e=b._containerController.getUIAttached().getMap();c=e.getCenter(),d=e.getMapProvider(),e.setCenter(d.unproject(Gis.point(b.getSliderValue()-b.getStep()*a,d.project(c).y)))}},getSliderValue:function(){return parseFloat(this._slider.slider("value"))},onAdd:function(a){Gis.Widget.Base.prototype.onAdd.call(this,a);var b,c=this._containerController.getUIAttached().getMap(),d=this,e=c.getMapProvider();b=this.getMapPixelBounds(),this.draw(),this.setBounds(),this._slider=$("#scroll-bar-h").slider({orientation:"horizontal",step:this.getCalculatedStep(),start:function(){var a=c.getCenter();d._y=e.project(a).y,d._slided=!0},stop:function(){d._slided=!1,d._y=null},min:b.getBottomLeft().x,max:b.getTopRight().x,value:e.project(c.getCenter()).x,slide:function(a,b){var f=c.getCenter();c.setCenter(e.unproject(Gis.point(b.value,d._y||e.project(f).y)),!0)}}),this._init=!0},getCalculatedStep:function(){var a=this.getMapPixelBounds();return(a.getTopRight().x-a.getBottomLeft().x)/(100*this._containerController.getUIAttached().getMap().getZoom()+1)},_setMaximum:function(){var a=this._containerController.getUIAttached().getMap(),b=a.getMapProvider(),c=this.getMapPixelBounds();this._init&&$("#scroll-bar-h",this._$div).slider("option",{min:c.getBottomLeft().x,max:c.getTopRight().x,value:b.project(a.getCenter()).x,step:this.getCalculatedStep()||this.options.step})},initHTML:function(){Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.SliderHorisontal.CLASS_NAME),this._$div.append("<div><div class='gis-widget-button gis-longitude-previous'></div><div id='scroll-bar-h'></div><div class='gis-widget-button gis-longitude-next'></div></div>")},_setValue:function(){if(!this._slided&&this._init){var a=this._containerController.getUIAttached().getMap(),b=a.getMapProvider();$("#scroll-bar-h",this._$div).slider("value",b.project(a.getCenter()).x)}},setBounds:function(){},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();a.off("moveend zoomend",this._setValue,this),a.off("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._$div.off("click",".gis-longitude-previous",this._decrease),this._$div.off("click",".gis-longitude-next",this._increase),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();this._$div.on("click",".gis-longitude-previous",this._decrease),this._$div.on("click",".gis-longitude-next",this._increase),a.on("moveend zoomend",this._setValue,this),a.on("maxboundschanged zoomend sizerecalculated projectionchanged",this._setMaximum,this),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this)}}),Gis.Widget.SliderHorisontal.CLASS_NAME="gis-widget-sliderHorisontal-container",Gis.Widget.sliderHorisontal=function(a){return new Gis.Widget.SliderHorisontal(a)},Gis.Widget.sliderhorisontal=Gis.Widget.sliderHorisontal,Gis.Widget.ListPoints={_skChanged:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;a&&(e=this._containerController.getUIAttached().getGeoConverter(),c=a.oldTemplate,b=a.oldSk,d=e.getSelectedSystem(),h=$("#points-selector li",this._$div),l=e.isMetric(d),k=e.isMetric(b)!==l,h.each(function(){var a,h,o=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,$(this)),p=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,$(this)),q=n._getPoint($(this));i=q&&q.getLatLng(),j=i&&n.coordinateToTemplate(i),k&&(m=p.parents(".point-tag"),l?m.insertBefore(o.parents(".point-tag")):m.insertAfter(o.parents(".point-tag"))),f=e.convert(b,d,n.getPointValue(p,null,b,c),n.getPointValue(o,null,b,c)),g=e.convert(b,d,n.getPointValue(p,!0,b,c),n.getPointValue(o,!0,b,c)),a=Gis.UI.coordinate(n._rowChanged(p)?f.x:j?j.x:f.x,n._rowChanged(o)?f.y:j?j.y:f.y),h=Gis.UI.coordinate(n._rowChanged(p)?g.x:j?j.x:g.x,n._rowChanged(o)?g.y:j?j.y:g.y),n.setHtmlPointSelectorWidgetData($(this),a,h)})),Gis.Widget.Propertys.prototype._skChanged.call(this)}},Gis.Widget.Propertys=Gis.Widget.Base.extend({_type:"propertys",_defaultColor:"#FFFFFF",_defaultStyle:{color:"#AF2D51",border:"white",selectedBorder:"rgb(75, 84, 255)",thickness:2,icon:{type:"circle",color:"#AF2D51",width:15}},options:{position:"right_inner",enabled:!0,needCheckLayers:!0,dataBinded:void 0},checkNumeric:function(a){var b=!1;return $.isNumeric(this.getPointValue(a))?a.removeClass("error"):(b=!0,a.addClass("error")),b},getNeedSize:function(){return[this._$div.outerWidth(!0),200]},checkCoordinate:function(a){var b=!1;return""!==a.val()&&$.isNumeric(this._containerController.getUIAttached().getGeoConverter().coordinateFromTeplate(this.getPointValue(a)))?a.removeClass("error"):(b=!0,a.addClass("error")),b},checkPoint:function(a){var b=!1,c=this.getPointWidgetData(a);return""===c.x?(b=!0,$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a).addClass("error")):""===c.y?(b=!0,$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,a).addClass("error")):$("."+Gis.Widget.Base.POSITION_VALUE_CLASS,a).removeClass("error"),b},_maskInput:function(a){var b=this._containerController.getUIAttached().getGeoConverter(),c=b.getCurrentMask(),d=b.getCurrentMask(!0),e=function(){var a=$(this).parent().parent(),b=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a);b.length||(b=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,a.parent())),b.focus()},f=function(){var a=$(this).parent().parent().parent(),b=a.next();b.length&&$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,b).focus()};!a&&c?$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,this._$div).each(function(){$(this).mask(c,{completed:f,replacement:"0"})}):$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,this._$div).unmask(),!a&&c?$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,this._$div).mask(d,{completed:e,replacement:"0"}):$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,this._$div).unmask()},_rowChanged:function(a){return a=$(a),this.getPointValue(a)!==this.getPointValue(a,!0)},_setValue:function(a,b,c){return a.data("is-point")?this.setHtmlPointValue(a,b,c):(a=$(a),b=void 0==b?"":b,a.val(b),void 0!=c&&a.data("old-val",c),this)},bindData:function(a){this.options.dataBinded!==a&&(this.options.dataBinded=a,this._update())},_hilightErrors:function(){},_generateKeyPressFunction:function(a,b){return function(c){(c.keyCode===a||c.charCode===a+"")&&b(),c.stopPropagation()}},generateEskeyFunction:function(a){var b=27;return this._generateKeyPressFunction(b,a)},generateEnteredFunction:function(a){var b=13;return this._generateKeyPressFunction(b,a)},_updateState:function(){this._updateButtonState(),this._updateCoordinatesState(),this._updateColorState(),this._updateTypeState(),this._updateParamsState(),this._hilightErrors()},isStyleChanged:function(){return this.getSelectedStyle()!=this.getValueFromData("getTag",null,"style")},getValueFromData:function(a,b){return this.options.dataBinded&&this.options.dataBinded[a]?this.options.dataBinded[a].apply(this.options.dataBinded,Array.prototype.slice.call(arguments,2,arguments.length)):b},initialize:function(a){var b=this;Gis.Widget.Base.prototype.initialize.call(this,a),this._paramClickFunction=this._paramClickFunction||function(){var a=$(this);!a.hasClass("selected")&&b.isDataEditable()&&($(".gis-param-selector.selected",a.parent()).not(a).removeClass("selected"),a.addClass("selected"),b.fire("color-change"),b.fire("change"))},this._CustomColorChangedFunc=function(a){return function(c,d,e,f){var g=f&&$(f)||$(".gis-color-custom",a),h="rgba("+e.r+", "+e.g+","+e.b+", "+e.a/100+")";$(".gis-param-selector.selected",g.parent()).not(g).removeClass("selected"),g.addClass("selected"),g.data("color",h),$("span",g).css("background",h),b.fire("color-change"),b.fire("change")}}},initHTML:function(){this._$div||(Gis.Widget.Base.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.Propertys.CLASS_NAME),this._$div.append(this.initDataBlock()),this._$div.append(this.initButtonsBlock()))},onRemove:function(){Gis.Widget.Base.prototype.onRemove.call(this)},onAdd:function(a){this.options.hasOwnProperty("colors")&&(this.options.colors=this.options.colors||a.getUIAttached().getStyle("predefinedColors")),Gis.Widget.Base.prototype.onAdd.call(this,a),this.draw(),this.setBounds()},initDataBlock:function(){},initButtonsBlock:function(){},_initDialogBaseLayer:function(){var a,b=this;return a=$("#base-layer-dialog"),a.length||(a=$('<div id="base-layer-dialog"><h2>Для продолжения необходимо включить отображение базового слоя. Сделать это сейчас?</h2></div>'),a.appendTo($(document.body)),a.dialog($.extend(this._dialogOptions,{buttons:[{text:"Да",click:function(){b._containerController.getUIAttached().getMap().getRenderer().getVisibilityController().setLayerVisible(Gis.ObjectVisibilityController.BASE_LAYER_KEY,!0),$(this).dialog("close")}},{text:"Нет",click:function(){$(this).dialog("close")}}]}))),a},checkBaseLayer:function(){return!this.options.needCheckLayers||this._containerController.getUIAttached().getMap().getRenderer().getVisibilityController().isLayerVisible(Gis.ObjectVisibilityController.BASE_LAYER_KEY)?!0:(this._initDialogBaseLayer().dialog("open"),!1)},_mapClickedWithCheck:function(a){this.checkBaseLayer()&&this._mapClicked(a)},_mapClicked:function(){},updateData:function(){},_saveData:function(){},_setData:function(){},isButtonEnable:function(a){return!Gis.HTML.hasClass(a,"disabled")},switchButtonState:function(a,b){b?a.removeClass("disabled"):a.addClass("disabled")},switchInputState:function(a){var b=Array.prototype.slice.call(arguments,1);b.forEach(a?function(a){a.removeAttr("disabled")}:function(a){a.attr("disabled","disabled")})},_HTMLstyleSelector:function(a){var b,c="";return b=this._containerController.getUIAttached().getMap().getStylesByObjectType(this._type),this._typeSelector&&b&&b.length&&(c='<div><p class="data-title">'+(a||"Тип")+'</p><div id="gis-ui-style-selector"></div></div>'),c},styleSelected:function(){this._updateState()},onBeforeStyleOpen:function(a){return!$(">.disabled",a).length},getSelectedColor:function(){return $(".gis-color-button.selected",this._$div).data("color")},_updateParamsState:function(){},_updateColorState:function(){this.switchButtonState($(".gis-color-button",this._$div),this.isDataEditable())},_updateCoordinatesState:function(){this.switchButtonState($(".gis-color-button",this._$div),this.isDataEditable())},_updateTypeState:function(){this.switchButtonState($(".html-select-view-container",this._$div),this.isDataEditable())},_updateStyle:function(){this._styleList&&this._styleList.setValueSelected(this.options.dataBinded&&this.options.dataBinded.getTag("style")||"deffaultValue")},getSelectedStyle:function(){var a=this._styleList&&this._styleList.getValueSelected();return"deffaultValue"!==a?a:null},_getStyleValues:function(){var a,b=[],c=this._containerController.getUIAttached().getMap(),d=c.getStylesByObjectType(this._type),e=d.length;for(b.push({val:"deffaultValue",name:"Стиль"}),a=0;e>a;a+=1)b.push({val:d[a],name:c.getStyle(d[a]).getStyleName()});return b},_updateStyleList:function(){var a=this.options.dataBinded&&this.options.dataBinded.getStyle();this._styleList=Gis.HTML.listView({data:this._getStyleValues(),container:$("#gis-ui-style-selector",this._$div)[0],callback:this.styleSelected,onBeforeOpen:this.onBeforeStyleOpen,context:this,defaultValue:{val:a&&a.getStyleId()||"deffaultValue",name:a&&a.getStyleName()||"Стиль полигона"}})},_HTMLcolorSelector:function(a,b,c){var d,e=!1;return d="",b=b||this.options.dataBinded&&this.options.dataBinded.getBackColor&&this.options.dataBinded.getBackColor(),this.options.colors.forEach(function(c,f){e=e||c===b,d+="<li class='gis-propertys-button gis-color-button"+(a&&c===b||!b&&!f?" selected":"")+" gis-param-selector' data-color='"+c+"'><span style='background: "+c+";'></span></li>"}),a&&!e&&b?d+="<li class='gis-propertys-button gis-color-button gis-param-selector selected "+($(document.body).ColorPicker?"gis-color-custom":"")+"' data-color='"+b+"'><span style='background: "+b+";'></span></li>":!c&&$(document.body).ColorPicker&&(d+="<li class='gis-propertys-button gis-color-button gis-param-selector gis-color-custom' data-color='"+this._defaultColor+"' value='"+this._defaultColor+"'><span style='background: "+this._defaultColor+";'></span></li>"),"<ul class='gis-color-list '>"+d+"</ul>"},_repaintIcons:function(a){$(".gis-image-type-button",a).each(function(){var a=$("canvas",this),b=a.length?a[0]:document.createElement("canvas");a.length||(b.width=12,b.height=12,$("span",this).append(b)),Gis.Additional.Icon[$(this).data("type")]("#FFFFFF",12,b,"#828282")})},_HTMLtypeSelector:function(a,b){var c,d=!1;return c="",b=b||this.options.dataBinded&&this.options.dataBinded.getImageType&&this.options.dataBinded.getImageType(),this.options.types.forEach(function(e){e&&Gis.Additional.Icon[e]&&(d=d||e===b,c+="<li title='"+e+"' class='gis-propertys-button gis-image-type-button"+(a&&e===b?" selected":"")+" gis-param-selector' data-type='"+e+"'><span></span></li>")}),a&&!d&&b&&(c+="<li title='"+b+"' class='gis-propertys-button gis-image-type-button gis-param-selector selected' data-type='"+b+" ' ><span></span></li>"),"<ul class='gis-image-type-list '>"+c+"</ul>"},_deleteKeyFire:function(){},_revertTextData:function(a){return a=$(a),a.data("is-point")?(this.setHtmlPointValue(a,this.getPointValue(a,!0)),this):(a.val(a.data("old-val")),this)},setBounds:function(){var a,b,c,d;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$("#points-selector",this._$div),d=c.parent(),$(".gis-widget-propertys-wraper, .gis-widget-propertys-buttons-wraper",this._$div).not(d).each(function(){a-=$(this).outerHeight(!0)}),a-=c.outerHeight(!0)-c.height()+d.outerHeight(!0)-d.height()+$(".gis-widget-propertys-title",d).outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height(),c.css({maxHeight:Math.max(a,40)})},_initEvents:function(){var a=this;Gis.Widget.Base.prototype._initEvents.call(this),this._mapKeyUp=this._mapKeyUp||function(b){var c=8,d=46,e=b.keyCode||parseInt(b.charCode,10);(e===c||e===d)&&a._deleteKeyFire(b)},this._mapKeyPress=this._mapKeyPress||function(a){var b=8,c=a.keyCode||parseInt(a.charCode,10);return"text"!==(a.srcElement||a.target).type&&c===b?(a.preventDefault(),!1):void 0},this._containerController.getUIAttached().getMap().on("click",this._mapClickedWithCheck,this),document.body.addEventListener("keydown",this._mapKeyPress),document.body.addEventListener("keyup",this._mapKeyUp),$(this._$div).on("click",".gis-param-selector",this._paramClickFunction),this.on("change",this._updateState,this),this._containerController.getUIAttached().on("sizerecalculated",this.setBounds,this),this._activateColorPicker(),this._$div.tooltip({track:!0}),this._maskInput()},_destroyColorPicker:function(a){a=a||this._$div,$(document.body).ColorPickerDestroy&&$(".gis-color-custom",a).length&&$(".gis-color-custom",this._$div).ColorPickerDestroy()},_activateColorPicker:function(a){if(a=a||this._$div,$(document.body).ColorPicker&&$(".gis-color-custom",a).length&&this.isDataEditable()){var b=$(".gis-color-custom span",a).css("background-color");$(".gis-color-custom",a).ColorPicker({color:b&&new RGBColor(b)||this._defaultColor,onSubmit:this._CustomColorChangedFunc(a),onChange:this._CustomColorChangedFunc(a)})}},_updateColor:function(a){this._destroyColorPicker(),$(".gis-color-list",this._$div).replaceWith(a||this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor())),this._activateColorPicker()},_skChanged:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;a&&this._$Xrow&&this._$Yrow&&(e=this._containerController.getUIAttached().getGeoConverter(),b=a.oldSk,d=a.oldTemplate,l=e.getSelectedSystem(),e.isMetric(b)!==e.isMetric(l)&&(m=this._$Xrow.parent().parent().parent(),e.isMetric(l)?m.insertBefore(this._$Yrow.parent().parent().parent()):m.insertAfter(this._$Yrow.parent().parent().parent())),c=l,h=this.options.dataBinded&&this.options.dataBinded.getLatLng(),i=h&&this.coordinateToTemplate(h),f=e.convert(b,c,this.getPointValue(this._$Xrow,null,b,d),this.getPointValue(this._$Yrow,null,b,d)),g=e.convert(b,c,this.getPointValue(this._$Xrow,!0,b,d),this.getPointValue(this._$Yrow,!0,b,d)),j=Gis.UI.coordinate(this._rowChanged(this._$Xrow)?f.x:i?i.x:f.x,this._rowChanged(this._$Yrow)?f.y:i?i.y:f.y),k=Gis.UI.coordinate(this._rowChanged(this._$Xrow)?g.x:i?i.x:g.x,this._rowChanged(this._$Yrow)?g.y:i?i.y:g.y),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,j,k)),Gis.Widget.Base.prototype._skChanged.call(this),this._maskInput()},_deInitEvents:function(){Gis.Widget.Base.prototype._deInitEvents.call(this),this.off("change",this._updateState,this),this._containerController.getUIAttached().getMap().off("click",this._mapClickedWithCheck,this),document.body.removeEventListener("keydown",this._mapKeyPress),document.body.removeEventListener("keyup",this._mapKeyUp),this._containerController.getUIAttached().off("sizerecalculated",this.setBounds,this),$(this._$div).off("click",".gis-param-selector",this._paramClickFunction);try{this._$div.tooltip("destroy")}catch(a){Gis.Logger.log(a.message)}this._destroyColorPicker(),this._maskInput(!0)},activate:function(){this._initEvents()},deactivate:function(){this._deInitEvents()},draw:function(){$(this.container).prepend(this._$div),this._initEvents()},_update:function(){},keyPressPreventDefault:function(a){a.stopPropagation()},_buttonHTML:function(a,b,c,d,e){return b=b||"",d=d||Gis.Widget.Propertys.titles[a]||"","<button title='"+d+"' class='widget-control "+Gis.Widget.Propertys.BUTTON_CLASS_NAME+" "+(c?"":"disabled")+" "+a+(b?" gis-button-with-text":"")+"'>"+(e?"":"<span class='gis-button-icon'></span>")+"<span class='gis-button-text'>"+b+"</span></button>"}}),Gis.Widget.Propertys.CLASS_NAME="gis-widget-propertys",Gis.Widget.Propertys.DATA_WRAPER_CLASS="gis-widget-propertys-wraper",Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS="gis-widget-propertys-buttons-wraper",Gis.Widget.Propertys.DATA_BLOCK_CLASS="gis-widget-propertys-data",Gis.Widget.Propertys.DATA_TITLE_CLASS="gis-widget-propertys-title",Gis.Widget.Propertys.BUTTON_CLASS_NAME="gis-propertys-button",Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME="gis-propertys-button-delete",Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME="gis-propertys-button-deselect",Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME="gis-propertys-button-return",Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME="gis-propertys-button-revert",Gis.Widget.Propertys.titles={},Gis.Widget.Propertys.titles[Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME]="Удалить",Gis.Widget.Propertys.titles[Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME]="Снять выделение",Gis.Widget.Propertys.titles[Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME]="Отменить изменения",Gis.Widget.propertys=function(a){return new Gis.Widget.Propertys(a)},function(){"use strict";var a,b,c,d;Gis.Widget.AreaReliefProperty=Gis.Widget.Propertys.extend({_history:[],options:{types:void 0,colors:void 0},_type:"object",initialize:function(a){c=this,Gis.Widget.Propertys.prototype.initialize.call(this,a),b=Gis.config("gis.ui.areal-accuracy-list")||{0:"Низкая",2:"Средняя",4:"Высокая"},this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){!this._isStateChanged(),this.options.dataBinded||this.removeCircle(),this.revertHtmlPointSelectorWidgetData(this._$northWestContainer),this.revertHtmlPointSelectorWidgetData(this._$southEastContainer),this._southEast=null,this._northWest=null,this.updateData()},getNorthWest:function(){return this._northWest||this.options.dataBinded&&this.options.dataBinded.getNorthWest()},getSouthEast:function(){return this._southEast||this.options.dataBinded&&this.options.dataBinded.getSouthEast()},_setData:function(a,b,c,d){var e,f,g;!c&&this.options.dataBinded&&(this._list3.setValueSelected(this.options.dataBinded.getOption("accuracy")),d||(L.ReliefControlSquare.getInstance().setOptions({bounds:this.options.dataBinded.getArealBounds()}),this._drawSquare())),a=this.coordinateToTemplate(this.getNorthWest()),g=this.options.dataBinded&&this.options.dataBinded.getNorthWest(),g=g&&this.coordinateToTemplate(g)||a,e=a.x||"",f=a.y||"",this.setHtmlPointSelectorWidgetData(this._$northWestContainer,Gis.UI.coordinate(e,f),c?null:Gis.UI.coordinate(e,f)),b=this.coordinateToTemplate(this.getSouthEast()),g=this.options.dataBinded&&this.options.dataBinded.getSouthEast(),g=g&&this.coordinateToTemplate(g)||b,e=b.x||"",f=b.y||"",this.setHtmlPointSelectorWidgetData(this._$southEastContainer,Gis.UI.coordinate(e,f),c?null:Gis.UI.coordinate(e,f))},_hilightErrors:function(){return this.checkPoint(this._$northWestContainer)||this.checkPoint(this._$southEastContainer)},updateData:function(){this._setData(null,null,!this.options.dataBinded),this.initGradientList(this._$div,this.options.dataBinded),this._pressed||this._updateColor(),this._updateState()},_updateColor:function(){},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=Gis.Map.CURRENT_MAP.getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&"text"===a[b[0]].getType()&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.AreaReliefProperty.CLASS_NAME),this._$northWestContainer=$("#north-west-selector",this._$div),this._$southEastContainer=$("#south-east-selector",this._$div),this._initLists(),this.initGradientList(this._$div)},_getTypeName:function(a){return names[a]},_getTypeValues:function(){var a,b=[];for(a in names)names.hasOwnProperty(a)&&b.push({val:a,name:names[a]});return b},_getAccuracyValues:function(){var a,c=[];for(a in b)b.hasOwnProperty(a)&&c.push({val:a,name:b[a]});return c},_initLists:function(){var a=this,c=this.options.dataBinded&&this.options.dataBinded.getOption("accuracy")||a._accuracy||0;this._list3=Gis.HTML.listView({data:this._getAccuracyValues(),container:$("#accuracy-selector",this._$div)[0],callback:function(b){a._accuracy=b,a._updateState()},context:this,defaultValue:{val:c,name:b[c]}})},initDataBlock:function(){var a=this.options.dataBinded&&this.options.dataBinded.getLatLng()||"",b=this.coordinateToTemplate(a),c=b.x||"",d=b.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLgradientSelector(this.options.dataBinded)+"</div></div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Область</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='north-west-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:c,y:d,xID:"areal-x-1",yID:"areal-y-1",yClass:"areal-y",xClass:"areal-x"})+"</ul>\n<ul id='south-east-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:c,y:d,xID:"areal-x-2",yID:"areal-y-2",yClass:"areal-y",xClass:"areal-x"})+"</ul>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Детальность</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div>\n<ul>\n<li class='data-row visibility-accuracy'><span id='accuracy-selector'></span>\n</ul>\n</div>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},accuracyChanged:function(){return this.options.dataBinded&&this.options.dataBinded.getOption("accuracy")!==this._list3.getValueSelected()},getXrow:function(a){return $(".areal-x",a)},getYrow:function(a){return $(".areal-y",a)},_isStateChanged:function(){var a;return a=this._rowChanged(this.getXrow(this._$northWestContainer))||this._rowChanged(this.getYrow(this._$northWestContainer))||this._rowChanged(this.getXrow(this._$southEastContainer))||this._rowChanged(this.getYrow(this._$southEastContainer))||this.accuracyChanged()||this.options.dataBinded&&(!this._equalsColor(this.options.dataBinded)||this.options.dataBinded&&this.getSelectedStyle()!==this.options.dataBinded.getTag("style")),a||!this.options.dataBinded&&this.isUiDrawed()},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новая",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&!this._hilightErrors()),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b),this._$div.tooltip("close")},_saveData:function(b,c,d,e){var f,g=this.templateToCoordinate(this.getPointValue(this.getXrow(this._$northWestContainer)),this.getPointValue(this.getYrow(this._$northWestContainer))),h=this.templateToCoordinate(this.getPointValue(this.getXrow(this._$southEastContainer)),this.getPointValue(this.getYrow(this._$southEastContainer)));if(b=b||g.x,c=c||g.y,d=d||h.x,e=e||h.y,Gis.Util.isNumeric(b)&&Gis.Util.isNumeric(c)&&Gis.Util.isNumeric(d)&&Gis.Util.isNumeric(e)){this.drawSquare(),f={accuracy:this._list3.getValueSelected(),n:c,s:e,w:b,e:d},a?a.setData(f):a=Gis.arealRelief(Gis.extend({id:Gis.Util.generateGUID(),selectable:!0},f));var i=this.getSelectedColorList();a.setUserSelectedGradient(i&&Gis.Objects.HeatMap.unParseColors(i)),Gis.Map.CURRENT_MAP.hasLayer(a)||a.addTo(Gis.Map.CURRENT_MAP),Gis.Map.CURRENT_MAP.selectLayer(a),this._updateState()}else this._updateState()},dragend:function(){this._northWest=L.ReliefControlSquare.getInstance().getNorthWest(),this._southEast=L.ReliefControlSquare.getInstance().getSouthEast(),this._setData(this._northWest,this._southEast,!0,!0),this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions[Gis.Objects.ArealRelief.prototype.options.tacticObjectType].call(this,a)},removeCircle:function(){Gis.Map.CURRENT_MAP.options.provider.map.removeLayer(L.ReliefControlSquare.getInstance())},onRemove:function(){this.removeCircle(),Gis.Widget.Propertys.prototype.onRemove.call(this)},_drawSquare:function(a,b){var c=this;Gis.Util.loadKinetic(function(){L.ReliefControlSquare.getInstance(!c.options.dataBinded&&a&&b&&{bounds:L.latLngBounds(a,b)}).addTo(Gis.Map.CURRENT_MAP.options.provider.map)})},drawSquare:function(a,b){var c=this;if(a&&a.latLng){var d=L.latLng(a.latLng.latitude,a.latLng.longitude),e=L.latLng((b||a).latLng.latitude,(b||a).latLng.longitude);c._drawSquare(d,e)}},_mapClicked:function(a){c.isUiDrawed()||this.drawSquare(a)},_mouseDown:function(a){c.checkBaseLayer()&&!c.isUiDrawed()&&(this.setDraggableEnabled(!1),d=a,c.drawSquare(a),this.on("mousemove",c._mouseMove,this))},_mouseMove:function(a){d&&c.drawSquare(d,a),this.on("mouseup mouseleave",c._mouseUp,this)},_mouseUp:function(a){c.drawSquare(d,a),d=null,this.setDraggableEnabled(!0),this.off("mouseup",c._mouseUp,this),this.off("mousemove",c._mouseMove,this)},isUiDrawed:function(){return Gis.Map.CURRENT_MAP.options.provider.map.hasLayer(L.ReliefControlSquare.getInstance())},_deInitEvents:function(){L.ReliefControlSquare.getInstance().off("add",this.dragend,this),L.ReliefControlSquare.getInstance().off("dragend",this.dragend,this),this._$div.off("click",".point-direction",this.updateCircleFromWidget),$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction});var a=this._containerController.getUIAttached().getMap();a.off("mousedown",this._mouseDown,a),Gis.Widget.Propertys.prototype._deInitEvents.call(this),this._destroyColorPicker($("#object-new-dialog"))},_updateSquareFromWidget:function(){if(!this._hilightErrors()){var a=this.templateToCoordinate(this.getPointValue(this.getXrow(this._$northWestContainer)),this.getPointValue(this.getYrow(this._$northWestContainer))),b=this.templateToCoordinate(this.getPointValue(this.getXrow(this._$southEastContainer)),this.getPointValue(this.getYrow(this._$southEastContainer)));this._drawSquare(L.latLng(a.y,a.x),L.latLng(b.y,b.x))}},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b=this;this.updateCircleFromWidget=function(){b._updateSquareFromWidget()},L.ReliefControlSquare.getInstance().on("add",this.dragend,this),L.ReliefControlSquare.getInstance().on("dragend",this.dragend,this),this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b.checkBaseLayer()&&b._saveData()},this._deleteFunction=this._deleteFunction||function(a){b.isButtonEnable(this)&&b._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){b._updateState(),a.stopPropagation(),b.updateCircleFromWidget()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._returnFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),this._$div.on("click",".point-direction",this.updateCircleFromWidget),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction});
var c=this._containerController.getUIAttached().getMap();c.on("mousedown",this._mouseDown,c),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a!==this.options.dataBinded&&(this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a?a.on("change",this.updateData,this):this.removeCircle(),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions[Gis.Objects.ArealRelief.prototype.options.tacticObjectType]=function(a,b){var c=this;"visibility"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить рельеф?",callback:function(){c.removeLayerFromMap(b||c.options.dataBinded)},context:this,id:"visibility-remove-dialog"},b)},Gis.Widget.AreaReliefProperty.CLASS_NAME="gis-widget-propertys-visibility",Gis.Widget.AreaReliefProperty.include(Gis.gradientWidget),Gis.Widget.areaReliefProperty=function(a){return c?a&&c.setData(a):new Gis.Widget.AreaReliefProperty(a),c}}(),Gis.Widget.EllipseProperty=Gis.Widget.Propertys.extend({_typeSelector:!0,_type:"ellipse",_history:[],options:{types:void 0,colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.types=this.options.types||[],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){var a;this._isStateChanged()?(this._revertTextData(this._$Xrow),this._revertTextData(this._$Yrow),this._revertTextData(this._$R1row),this._revertTextData(this._$R2row),this._revertTextData(this._$AngleRow),this.options.dataBinded&&this._updateStyle()):(a=this._history.pop(),a&&this._setData(a.text,a.center,a.color)),this.updateData()},_setData:function(a,b){var c,d=this.getValueFromData("getAlpha",""),e=this.getValueFromData("getBetta",""),f=this.getValueFromData("getGamma",0);b=b||this.getValueFromData("getLatLng",null),c=this.options.dataBinded&&this.coordinateToTemplate(b)||Gis.UI.coordinate("",""),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,c,c),this._setValue(this._$R1row,d,d),this._setValue(this._$R2row,e,e),this._setValue(this._$AngleRow,f,f)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.getValueFromData("getColor","",!0)))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),a=a||this.checkNumeric(this._$R1row),a=a||this.checkNumeric(this._$R2row),a=a||this.checkNumeric(this._$AngleRow),$(".gis-color-button.selected",this._$div).data("color")||(a=!0),a},_updateCoordinatesState:function(){this.isDataEditable()&&this.getValueFromData("isDraggable",!0)?(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled")):(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled"))},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$R1row,this._$R2row,this._$AngleRow)},updateData:function(){this._setData(),this._pressed||this._updateColor(),this._updateState(),this.afterUpdate()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.EllipseProperty.CLASS_NAME),this._$Xrow=$("#ellipse-x",this._$div),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Yrow=$("#ellipse-y",this._$div),this._$R1row=$("#ellipse-r1",this._$div),this._$R2row=$("#ellipse-r2",this._$div),this._$AngleRow=$("#ellipse-angle",this._$div),this._updateStyleList()},initDataBlock:function(){var a=this.getValueFromData("getLatLng",null),b=this.getValueFromData("getAlpha",""),c=this.getValueFromData("getBetta",""),d=this.getValueFromData("getGamma",""),e=this.coordinateToTemplate(a),f=e.x||"",g=e.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Координаты</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:f,y:g,xID:"ellipse-x",yID:"ellipse-y",yClass:"ellipse-input",xClass:"ellipse-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row'><span>Радиус 1:</span>"+this._HTMLRowInput(b,"ellipse-r1","ellipse-input","Радиус по оси горизонтали")+"</li>\n<li class='data-row'><span>Радиус 2:</span>"+this._HTMLRowInput(c,"ellipse-r2","ellipse-input","Радиус по оси вертикали")+"</li>\n<li class='data-row'><span>Угол поворота:</span>"+this._HTMLRowInput(d,"ellipse-angle","ellipse-input","Угол поворота по часовой стрелке относительно вертикальной оси")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector("Предустановки")+"</div></div>\n</div>\n"},_onMouseDown:function(a){this.checkBaseLayer()&&(this._cleared=!0,this._pressed=!0,this.options.dataBinded&&(this._cleared=!1,this._containerController.getUIAttached().getMap().unselectLayer(this.options.dataBinded)),this._startPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_drawFromDrag:function(a,b){var c,d;this._cleared&&this._currentPoint&&this._startPoint&&(c=this._startPoint.distanceTo(Gis.latLng(this._startPoint.lat,this._currentPoint.lng)),d=this._startPoint.distanceTo(Gis.latLng(this._currentPoint.lat,this._startPoint.lng)),a&&(c=d=Math.max(c,d)),this._saveData({x:this._startPoint.lng,y:this._startPoint.lat,r1:c,r2:d,angle:0,skipServerMessage:b}),this.updateData())},_onMouseMove:function(a){this._pressed&&this._cleared&&(this._moved=!0,this._currentPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude),this._drawFromDrag(a.originalEvent.shiftKey,!0))},_finishDrawFromDrag:function(){this._cleared=!1,this._startPoint=void 0,this._currentPoint=void 0},fireServerEvent:function(){this.options.dataBinded&&this.options.dataBinded.fire("change",{target:this.options.dataBinded,rows:["alpha","betta","gamma","latitude","longitude","fill"]})},_onMouseUp:function(){this._pressed&&this._cleared&&this.fireServerEvent(),this._moved=!1,this._pressed=!1,this._finishDrawFromDrag()},_onMouseOut:function(){this._moved=!1,this._pressed=!1,this._finishDrawFromDrag()},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новый",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$R1row)||this._rowChanged(this._$R2row)||this._rowChanged(this._$AngleRow)||this.options.dataBinded&&this.options.dataBinded.getColor(!0)!==this.getSelectedColor(),a=a||this.options.dataBinded&&this.getSelectedStyle()!==this.options.dataBinded.getTag("style")},_updateButtonState:function(){var a,b;this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),b=this._isStateChanged(),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b)},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_saveData:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||{},f=a.x||m.x,g=a.y||m.y,h=a.r1||this._$R1row.val(),i=a.r2||this._$R2row.val(),j=a.color||$(".gis-color-button.selected",this._$div).data("color")||this.options.dataBinded&&this.options.dataBinded.getColor(!0),k=void 0!==a.angle&&$.isNumeric(a.angle)?a.angle:this._$AngleRow.val(),d={color:this.getSelectedColor()},Gis.Util.isNumeric(f)&&Gis.Util.isNumeric(g)&&j&&Gis.Util.isNumeric(k)&&i&&h?(c={alpha:h,betta:i,gamma:k,latitude:g,longitude:f,fill:d,tags:{style:this.getSelectedStyle()}},!a.forceNew&&this.options.dataBinded?this.options.dataBinded.setData(c,null,a.skipServerMessage):(l=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("ellipse")),e={color:l.color,border:l.border,thickness:l.thickness},b=Gis.ellipse(Gis.Util.extend({id:Gis.Util.generateGUID()},c,{draggable:!0,selectable:!0,line:e})),b.setSelectedStyle(Gis.Util.extend({},e,{border:l.selectedBorder})),b.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(b)),this._update()):this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions.ellipse.call(this,a)},_mapClicked:function(){},_deInitEvents:function(){var a;$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),a=this._containerController.getUIAttached().getMap(),a.off("mouseup",this._onMouseUp,this),a.off("mousedown",this._onMouseDown,this),a.off("mousemove",this._onMouseMove,this),a.off("mouseout",this._onMouseOut,this),a.off("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b,c=this;this._returnFunction=this._returnFunction||function(){c.isButtonEnable(this)&&c.checkBaseLayer()&&c._saveData()},this._deleteFunction=this._deleteFunction||function(a){c.isButtonEnable(this)&&c._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){c.fire("change"),a.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){c.fire("change")},this._revertFunction=this._revertFunction||function(){c.isButtonEnable(this)&&c.back()},this._deselectFunction=this._deselectFunction||function(){c.isButtonEnable(this)&&c._containerController.getUIAttached().getMap().unselectLayer(c.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(c._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(c._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||a(c._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(c._revertFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),b=this._containerController.getUIAttached().getMap(),b.on("mouseup",this._onMouseUp,this),b.on("mousedown",this._onMouseDown,this),b.on("mousemove",this._onMouseMove,this),b.on("mouseout",this._onMouseOut,this),b.on("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a||this._cleared||(this._cleared=!0),a!==this.options.dataBinded&&(this._newColor=void 0,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this._updateStyleList(),this.updateData())}}),Gis.UI.DeleteActions.ellipse=function(a,b){var c=this;"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить эллипс?",callback:function(){c.removeLayerFromMap(b||c.options.dataBinded)},context:this,id:"ellipse-remove-dialog"},b)},Gis.Widget.EllipseProperty.CLASS_NAME="gis-widget-propertys-ellipse",Gis.Widget.EllipseProperty.CENTER_CHANGED=1,Gis.Widget.EllipseProperty.TEXT_CHANGED=3,Gis.Widget.EllipseProperty.BOTH_CHANGED=2,Gis.Widget.EllipseProperty.NOT_CHANGED=0,Gis.Widget.ellipseProperty=function(a){return new Gis.Widget.EllipseProperty(a)},function(){"use strict";function a(a){var b=Gis.Map.CURRENT_MAP.options.provider.map;i?i.setLatLng(a):i=L.marker(a,{icon:L.icon({iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],iconUrl:Gis.config("relativePath")+"images/marker-source.png"})}),b.hasLayer(i)||i.addTo(b)}function b(){if(i){var a=Gis.Map.CURRENT_MAP.options.provider.map;a.hasLayer(i)&&a.removeLayer(i)}}var c,d,e,f,g,h,i,j="forward",k="backward",l=j,m=l,n={},o={fill:!0,stroke:!0,weight:3,color:"rgba(16, 0, 247, 0.5)",fillColor:"rgba(255, 255, 255, 0.46)"},p={stroke:!0,weight:3,color:"rgba(16, 0, 247, 0.5)"};n[j]="Прямое",n[k]="Обратное",Gis.Widget.GeoCodeProperty=Gis.Widget.Propertys.extend({_type:"geo",options:{needCheckLayers:!1},_history:[],initialize:function(){Gis.Widget.Propertys.prototype.initialize.call(this),d=this},back:function(){this.revertHtmlPointSelectorWidgetData(this._$posiiton),this._$text.val(h),this._list.setValueSelected(m),this._updateButtonState()},_setData:function(a,b){b=this.coordinateToTemplate(b||g||Gis.Map.CURRENT_MAP.getCenter());var c=b&&b.x||"",d=b&&b.y||"";a=a||h,this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d)),this._setValue(this._$text,a,a)},updateData:function(){this._setData(),this._updateButtonState()},_updateTypeState:function(){switch(Gis.Widget.Propertys.prototype._updateTypeState.call(this),l){case j:this._$posiiton.addClass("hide"),this._$text.removeClass("hide");break;case k:this._$text.addClass("hide"),this._$posiiton.removeClass("hide")}},drawPolygon:function(a){var b=a.geojson.type.toLowerCase().indexOf("line")>-1;e=L.geoJson(a.geojson,{style:function(){return b?p:o}}).addTo(Gis.Map.CURRENT_MAP.options.provider.map)},doShowOnMap:function(c){var d,g=f[$(c).data("id")];return e&&Gis.Map.CURRENT_MAP.options.provider.map.hasLayer(e)&&Gis.Map.CURRENT_MAP.options.provider.map.removeLayer(e),g&&(d=g.lat&&g.lon&&L.latLng(g.lat,g.lon),g.geojson?(b(),this.drawPolygon(g)):a(d,g.display_name,!0),g.boundingbox?Gis.Map.CURRENT_MAP.options.provider.map.fitBounds(L.latLngBounds([g.boundingbox[0],g.boundingbox[2]],[g.boundingbox[1],g.boundingbox[3]])):g.lat&&g.lon&&Gis.Map.CURRENT_MAP.setCenter(Gis.latLng(g.lat,g.lon))),!1},fillList:function(a){var b,c,d=a.length,e="";for(f=a,b=0;d>b;b+=1)c=a[b],e+='<li data-id="'+b+'">'+(c.icon?'<img src="'+c.icon+'" alt="'+c.display_name+'">':"")+'<span class="name">'+c.display_name+"</span></li>";e||(e="<li>Ничего не найдено</li>"),$("ul",this._$resultContainer).html(e)},setBounds:function(){var a,b,c,d;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$("ul",this._$resultContainer),d=c.parents(".gis-widget-propertys-wraper"),$(".gis-widget-propertys-buttons-wraper, .gis-widget-propertys-wraper",this._$div).not(d).each(function(){a-=$(this).outerHeight(!0)}),a-=d.outerHeight(!0)-c.height(),c.css({maxHeight:a})},getRowLoaderHeight:function(){var a=0,b=$("li",this._$resultContainer);b.each(function(){a+=$(this).outerHeight(!0)});var c=$(b[0]);return a-=c.outerHeight(!0)-c.height(),Math.min(200,a)},getSearchUrl:function(){switch(l){case Gis.OSRM.TYPE_FORWARD:return Gis.config(Gis.GEO_FORWARD_SEARCH_URL,"http://nominatim.openstreetmap.org/search")+"?q="+this._$text.val()+"&limit="+Gis.config(Gis.GEO_FORWARD_SEARCH__MAX_RESULTS,30)+"&format=json&polygon_geojson=1&addressdetails=1";case Gis.OSRM.TYPE_BACKWARD:var a=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));return Gis.config(Gis.GEO_REVERSE_SEARCH_URL,"http://nominatim.openstreetmap.org/reverse")+"?format=json&lat="+a.y+"&lon="+a.x+"&polygon_geojson=1&addressdetails=1&zoom="+Gis.OSRM.getMapZoom()}},_doRequest:function(d){var e=this,f=l;c&&c.abort();var i=$("ul",this._$resultContainer);i.html('<li style="height: '+this.getRowLoaderHeight()+'px;">'+Gis.HTML.LOADER_HTML+"</li>"),$(".windows8",this._$resultContainer).addClass("show"),f===k&&d?a(d):b(),c=$.ajax({url:this.getSearchUrl(),success:function(b){if(m=f,f===k){b&&Gis.Util.isDefine(b.lat)&&Gis.Util.isDefine(b.lon)&&a(L.latLng(parseFloat(b.lat),parseFloat(b.lon))),b=[b];var c=e.templateToCoordinate(e.getPointValue(e._$Xrow),e.getPointValue(e._$Yrow));g=Gis.latLng(c.y,c.x)}else h=e._$text.val();b[0]&&b[0].error&&(b=[]),e.fillList(b),e._setData()},complete:function(){c=null,e._updateButtonState()},error:function(a){0!==a.status&&(e.fillList([]),Gis.notify("Не удалось запросить данные","error"))}}),this._updateButtonState()},_getTypeValues:function(){var a,b=[];for(a in n)n.hasOwnProperty(a)&&b.push({val:a,name:n[a]});return b},_getTypeName:function(a){return n[a]},initHTML:function(){var a=this;Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.GeoCodeProperty.CLASS_NAME),this._$Xrow=$("#query-x",this._$div),this._$Yrow=$("#query-y",this._$div),this._$resultContainer=$("#result-container",this._$div),this._$text=$("#query-text",this._$div),this._$posiiton=$("#position-selector",this._$div),this._$button=$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME+" .gis-button-text",this._$div),this._list=Gis.HTML.listView({data:this._getTypeValues(),container:$("#type-selector",this._$div)[0],callback:function(b){l=b,a._updateState()},context:this,defaultValue:{val:l,name:this._getTypeName(l)}}),f&&this.fillList(f),this._setData(),this._updateState()},initDataBlock:function(){var a=g||Gis.Map.CURRENT_MAP.getCenter(),b=this.coordinateToTemplate(a),c=b.x||"",d=b.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='search-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Параметры поиска</div>\n<div id='search-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul>\n<li class='data-row query-param'><span class='type-title'>Тип кодирования</span><span id='type-selector'></span>"+this._HTMLRowInput(h||"","query-text","query-input query-right",null,"Введите запрос")+"\n</ul>\n<ul id='position-selector' class='inline-points hide'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:c,y:d,xID:"query-x",yID:"query-y",yClass:"query-input",xClass:"query-input"})+"</ul>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='result-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Результат поиска</div>\n<div id='result-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div id='result-container'><ul class=' data-list element-hover'><li>Укажите параметры поиска и нажмите \"Найти\"</li></ul></div></div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Найти")+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_mapClicked:function(a){if(l===k){var b,c,d=Gis.latLng(a.latLng.latitude,a.latLng.longitude),e=this.coordinateToTemplate(d);b=e.x||"",c=e.y||"",this.setHtmlPointSelectorWidgetData(this._$posiiton,Gis.UI.coordinate(b,c),Gis.UI.coordinate(b,c)),this._doRequest(d)}},_hilightErrors:function(){switch(l){case k:return this.checkPoint(this._$posiiton);case j:return!this._$text.val()}},typeChanged:function(){return m!==l},_isStateChanged:function(){var a;switch(l){case k:a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow);break;case j:a=this._rowChanged(this._$text)}return a||this.typeChanged()},_updateButtonState:function(){var a=this._isStateChanged();this.switchButtonState($("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),a),this.switchButtonState($("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),a&&!this._hilightErrors())},_deInitEvents:function(){Gis.Widget.Propertys.prototype._deInitEvents.call(this);this._containerController.getUIAttached().getMap();$(".data-row input",this._$div).off({keypress:this._keyupUpdateFunction,change:this._inputChange}),$("#result-container").off("click","li",this._showOnMap),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._updateStateFunc,keypress:this._keyupUpdateFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunc,keypress:this._keyupRevertFunction}),e&&Gis.Map.CURRENT_MAP.options.provider.map.removeLayer(e),b()},_initEvents:function(){var a,b=this;this._showOnMap=function(){b.doShowOnMap(this)},Gis.Widget.Propertys.prototype._initEvents.call(this),this._updateStateFunc=this._updateStateFunc||function(){b.isButtonEnable($("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,b._$div)[0])&&b._doRequest()},this._inputChange=this._inputChange||function(){b._updateButtonState()},this._revertFunc=this._revertFunc||function(){b.isButtonEnable(this)&&b.back()},$("#result-container").on("click","li",this._showOnMap),this._keyupUpdateFunction=this._keyupUpdateFunction||function(a){if(b.isButtonEnable(this)){var c=13;a.keyCode===c||a.charCode===c+""?b._updateStateFunc():b._updateButtonState(),a.stopPropagation()}},this._keyupRevertFunction=this._keyupRevertFunction||function(a){var c=13;!b.isButtonEnable(this)||a.keyCode!==c&&a.charCode!==c+""||b.back()},a=this._containerController.getUIAttached().getMap(),$("input",this._$div).on({change:this._inputChange,keyup:this._keyupUpdateFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._updateStateFunc,keyup:this._keyupUpdateFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunc,keyup:this._keyupRevertFunction}),document.getElementById("query-text").focus()}}),Gis.GEO_FORWARD_SEARCH__MAX_RESULTS="gis.geo.forward.max_results",Gis.GEO_FORWARD_SEARCH_URL="gis.geo.forward",Gis.GEO_REVERSE_SEARCH_URL="gis.geo.reverse",Gis.GEO_SHORTEN_URL="gis.geo.shorten",Gis.GEO_TIMESTAMP_URL="gis.timestamp.url",Gis.GEO_ROUTING_URL="gis.routing.url",Gis.GEO_NEAREST_URL="gis.nearest.url",Gis.Widget.GeoCodeProperty.CLASS_NAME="gis-widget-propertys-geo",Gis.Widget.geoProperty=function(a){return d||new Gis.Widget.GeoCodeProperty(a)}}(),function(){"use strict";function a(a){var b=a||OSRM.G.route;b.saved&&(b.hideAdditional(),OSRM.G.route=new OSRM.Route)}function b(a){return d||$("#gui-input-source",a).val()+$("#gui-input-target",a).val()}var c,d,e=!0;Gis.Widget.GeoPathProperty=Gis.Widget.Propertys.extend({_type:"geo-path",_defaultStyle:{color:"rgba(15, 55, 213, 0.42)",border:"white",dash:Gis.Dash.dot,selectedBorder:"rgba(0, 0, 0, 0.64)",thickness:2},options:{needCheckLayers:!1,colors:void 0},_history:[],initialize:function(){Gis.Widget.Propertys.prototype.initialize.call(this),c=this},setData:function(){Gis.Widget.Propertys.prototype.initialize.apply(this,arguments)},back:function(){},updateData:function(){this._updateColor(),this._updateButtonState()},setBounds:function(){{var a,b,c;$()}b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b)-$("#information-box-header",this._$div).outerHeight(!0)-$("#main-wrapper",this._$div).outerHeight(!0);var d=$("#information-box",this._$div),e=$(".color-selector-block",this._$div);c=d.parents(".gis-widget-propertys-wraper"),a-=c.outerHeight(!0)-$(".gis-widget-propertys-data",c).height()+e.outerHeight(!0),d.css({maxHeight:a-(d.outerHeight(!0)-d.height())})},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.GeoPathProperty.CLASS_NAME),this._$div.attr("id","gui"),c._updateButtonState()},_isStateChanged:function(){var a=!1,b=this.getValueFromData("getColor",null,!0);return a=a||this.options.dataBinded&&b!=this.getSelectedColor()},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))),this._colorChanged(!0)},initDataBlock:function(){return'<!-- gui -->                <!-- main gui -->                    <div id="main-wrapper" class="box-wrapper '+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"\"><div id='search-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Маршрутные точки</div>\n<div class=\""+Gis.Widget.Propertys.DATA_BLOCK_CLASS+'">                        <!-- input box -->                        <div id="main-input" class="box-content">                            <!--  input mask -->                            <div id="input-mask">                                <!-- source/target input -->                                <div class="full">                                    <div id="input-source" class="input-marker">                                        <div class="left"><span id="gui-search-source-label" class="input-label nowrap">Start:</span></div>                                        <div class="center stretch"><input id="gui-input-source" class="input-box" type="text" maxlength="200" value="" title="Enter start" /></div>                                        <div class="right"><button class="widget-control gis-propertys-button location-show" id="gui-search-source"><span></span></button></div>                                    </div>                                    <div id="input-target" class="input-marker">                                        <div class="left"><span id="gui-search-target-label" class="input-label nowrap">End:</span></div>                                        <div class="center stretch"><input id="gui-input-target" class="input-box" type="text" maxlength="200" value="" title="Enter destination" /></div>                                        <div class="right"><button class="widget-control gis-propertys-button location-show" id="gui-search-target"><span></span></button></div>                                    </div>                                </div>                                <div class="quad"></div>                                <!-- action buttons -->                                <div class="full">                                    <div class="row">                                        <div class="left"><button title="Сбросить" class="widget-control gis-propertys-button gis-propertys-button-deselect" id="gui-reset"><span class="gis-button-icon"></span><span class="gis-button-text"></span></button></div>                                        <div class="center" style="display: none"><select id="gui-engine-toggle" class="engine-select"></select></div>                                        <div class="right"><button class="widget-control gis-propertys-button" id="gui-reverse">Reverse</button></div>                                    </div>                                </div>                            </div>                            </div>                            </div>                        </div><div class=\''+Gis.Widget.Propertys.DATA_WRAPER_CLASS+" color-selector-block'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Цвет</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector()+'</div>\n</div>\n<!-- output box --><div id="main-output" class="box-content '+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"\"><div id='search-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Маршрут</div>\n<div class=\""+Gis.Widget.Propertys.DATA_BLOCK_CLASS+'"><div id="information-box-header"></div><div id="information-box" class="information-box-with-small-header"></div></div></div>                </div>'},initButtonsBlock:function(){return""},_mapClicked:function(){},_updateButtonState:function(){},_getPathPoints:function(){},routeNameChanged:function(a){d=a.name,this._saveRoute()},_saveRoute:function(){if(this.options.dataBinded&&this.options.dataBinded.getPath()!==OSRM.G.route||!this.options.dataBinded&&OSRM.G.route.saved)return void Gis.Logger.log("not equals routes");if(OSRM.G.markers.route.length>1){var a,d,e,f;d=c._defaultStyle,a={color:c.getSelectedColor()},f=[];for(var g=0,h=OSRM.G.markers.route.length;h>g;g+=1)f.push(OSRM.G.markers.route[g].getPosition());e=c.options.dataBinded,a.thickness=d.thickness,a.border=d.border,c.options.dataBinded?e.setData(Gis.Util.extend({},{name:b(),routing:f})):(OSRM.G.route.checksum=OSRM.G.markers.checksum,e=Gis.geoPath(Gis.Util.extend({routing:f,path:OSRM.G.route,id:Gis.Util.generateGUID(),name:b(),draggable:!1,selectable:!0,icon:d.icon}))),e.setSelectedStyle(Gis.Util.extend({},a,{border:d.selectedBorder})),c.options.dataBinded=e,c._containerController.getUIAttached().getMap().hasLayer(e)||(e.addTo(c._containerController.getUIAttached().getMap()),c._containerController.getUIAttached().getMap().selectLayer(e)),c._updateButtonState()}},_unselectLayer:function(){c.isButtonEnable(this)&&(c.options.dataBinded?c._containerController.getUIAttached().getMap().unselectLayer(c.options.dataBinded):(a(),OSRM.GUI.resetRouting()))},_colorChanged:function(a){OSRM.G.route&&(OSRM.G.route.updateCurrentRouteStyle(c.getSelectedColor()),a||this._saveRoute())},onRemove:function(){a(),OSRM.deinit(),Gis.Widget.Propertys.prototype.onRemove.apply(this,arguments)},onAdd:function(){Gis.Widget.Propertys.prototype.onAdd.apply(this,arguments),this.options.dataBinded&&this.updateData(),this.requestRouting(e),OSRM.init(),e=!1},_initEvents:function(){Gis.EventBus.on("route-changed",this.setBounds,this),Gis.EventBus.on("route-name-changed",this.routeNameChanged,this),Gis.Widget.Propertys.prototype._initEvents.apply(this,arguments),this.on("color-change",this._colorChanged,this),this._$div.on("click","#gui-reset",this._unselectLayer)},_deInitEvents:function(){Gis.Widget.Propertys.prototype._deInitEvents.apply(this,arguments),Gis.EventBus.off("route-changed",this.setBounds,this),Gis.EventBus.off("route-name-changed",this.routeNameChanged,this),this.off("color-change",this._colorChanged,this),this._$div.off("click","#gui-reset",this._unselectLayer)
},requestRouting:function(b){if(this.options.dataBinded){var c=this.options.dataBinded.getRouting();OSRM.G.route=this.options.dataBinded.getPath(),OSRM.G.markers.setSource(c[0]),OSRM.G.markers.setTarget(c[c.length-1]),OSRM.G.markers.checksum=this.options.dataBinded.getPath().checksum,OSRM.G.markers.removeVias();for(var d=1,e=c.length-1;e>d;d+=1)OSRM.G.markers.setVia(d-1,c[d]);OSRM.G.markers.show(),OSRM.Routing.getRoute()}else b||(a(),OSRM.GUI.resetRouting())},bindData:function(b){b!==this.options.dataBinded&&(d=!1,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a(this.options.dataBinded&&this.options.dataBinded.getPath()),OSRM.GUI.resetRouting(),b&&b.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,b),c.updateData(),this.requestRouting())}}),Gis.Widget.GeoPathProperty.CLASS_NAME="gis-widget-propertys-geo-path",Gis.Widget.geoPathProperty=function(a){return c?(c.setData(a),c):new Gis.Widget.GeoPathProperty(a)},Gis.UI.DeleteActions[Gis.Objects.GeoPath.prototype.options.tacticObjectType]=function(a,b){(a.srcElement||a.target).type!==Gis.Objects.GeoPath.prototype.options.tacticObjectType&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить маршрут?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"geo-path-remove-dialog"},b)}}(),Gis.Widget.HeatMapProperty=Gis.Widget.Propertys.extend({_typeSelector:!0,_type:Gis.Objects.HeatMap.prototype.options.tacticObjectType,_history:[],_defaultStyle:{color:"#AF2D51",border:"white",thickness:2,selectedBorder:"rgb(75, 84, 255)",angleLineColor:"#272727",angleLineBorder:"white",angleLineThickness:2},options:{types:void 0,colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this._createEventFunctions(),this.options.types=this.options.types||[],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){this._isStateChanged()&&this._updateStyle(),this.updateData()},_mapClicked:function(){},_setData:function(){},_updateColor:function(){},_hilightErrors:function(){var a=!1;return Gis.Util.isDefine($(".gis-color-button.selected",this._$div).data("index"))||(a=!0),a},updateData:function(){this._setData(),this.initGradientList(this._$div,this.options.dataBinded),this._pressed||this._updateColor(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&a[b[0]].getType()===Gis.Objects.HeatMap.prototype.options.tacticObjectType&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.HeatMapProperty.CLASS_NAME),this.initGradientList(this._$div)},initDataBlock:function(){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLgradientSelector(this.options.dataBinded)+"</div></div>\n</div>\n"},_onMouseDown:function(){},_onMouseMove:function(){},_onMouseOut:function(){},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){return this.options.dataBinded&&(!this._equalsColor(this.options.dataBinded)||this.options.dataBinded&&this.getSelectedStyle()!==this.options.dataBinded.getTag("style"))},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый",$(".gis-button-text",this._$buttonNew).html(a);this.isDataEditable();this.switchButtonState(this._$buttonNew,this.options.dataBinded&&b&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,this.options.dataBinded),this.switchButtonState(this._$buttonRevert,b)},_saveData:function(){if(this.options.dataBinded){var a=this.getSelectedColorList();this.options.dataBinded.setUserSelectedGradient(a&&Gis.Objects.HeatMap.unParseColors(a)),this._updateState()}},_deleteKeyFire:function(a){Gis.UI.DeleteActions[Gis.Objects.HeatMap.prototype.options.tacticObjectType].call(this,{srcEvent:a,srcElement:this.options.dataBinded})},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),$(document.body).off("keyup",this._KeyUpEscFunction),a.off("mousedown",this._onMouseDown,this),a.off("mousemove",this._onMouseMove,this),a.off("mouseout",this._onMouseOut,this),a.off("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_createEventFunctions:function(){var a=this;this._returnFunction=this._returnFunction||function(b){a.isButtonEnable(this)&&a._saveData(b)},this._escFunction=this._escFunction||function(b){a._finish(b)},this._deleteFunction=this._deleteFunction||function(b){a.isButtonEnable(this)&&a._deleteKeyFire(b)},this._textRowChange=this._textRowChange||function(b){a._updateState(),b.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){a._updateState()},this._revertFunction=this._revertFunction||function(){a.isButtonEnable(this)&&a.back()},this._deselectFunction=this._deselectFunction||function(){a.isButtonEnable(this)&&a._containerController.getUIAttached().getMap().unselectLayer(a.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||this.generateEnteredFunction(a._deleteFunction),this._KeyUpEscFunction=this._KeyUpEscFunction||this.generateEskeyFunction(a._escFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||this.generateEnteredFunction(a._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||this.generateEnteredFunction(a._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||this.generateEnteredFunction(a._revertFunction)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();$(document.body).on("keyup",this._KeyUpEscFunction),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),a.on("mousedown",this._onMouseDown,this),a.on("mousemove",this._onMouseMove,this),a.on("mouseout",this._onMouseOut,this),a.on("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a||this._cleared||(this._cleared=!0),a!==this.options.dataBinded&&(this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions[Gis.Objects.HeatMap.prototype.options.tacticObjectType]=function(a,b){(b||this.options.dataBinded).getType()===Gis.Objects.HeatMap.prototype.options.tacticObjectType&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить тепловую карту?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"heatmap-remove-dialog"},b)},Gis.Widget.HeatMapProperty.CLASS_NAME="gis-widget-propertys-heatmap",Gis.Widget.HeatMapProperty.include(Gis.gradientWidget),Gis.Widget.heatMapProperty=function(a){return new Gis.Widget.HeatMapProperty(a)},function(){var a=function(a,b){var c=b.toLowerCase(),d=a.toLowerCase();return d>c?1:c>d?-1:0},b="layer",c="checked",d="invisible";Gis.Widget.LayersProperty=Gis.Widget.Propertys.extend({options:{needCheckLayers:!1},_type:"layers",_getVisibilityController:function(){return this._visibilityController||(this._visibilityController=this._containerController.getUIAttached().getMap().getRenderer().getVisibilityController()),this._visibilityController},onAdd:function(){this._eventsChanged=[],this._eventsListChanged={added:[],removed:[]},Gis.Widget.Propertys.prototype.onAdd.apply(this,arguments),this._getVisibilityController()},_setData:function(){},updateData:function(){this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.LayersProperty.CLASS_NAME),this._$layerList=$(".layers-menu",this._$div),this.setSwitchContainer(this._$div,this._$layerList)},setBounds:function(){var a,b;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),a-=$(".gis-widget-propertys-data",this._$div).outerHeight(!0)-$(".gis-widget-propertys-data",this._$div).height(),$(".gis-widget-propertys-buttons-wraper",this._$div).each(function(){a-=$(this).outerHeight(!0)}),a-=this._$div.outerHeight(!0)-this._$div.height(),this._$layerList.css("maxHeight",a-$("#layers-title",this._$div).outerHeight(!0))},_constructLayerElement:function(a,e){var f=this._getVisibilityController().isLayerVisible(a)?c:"";return"<li data-"+b+'="'+a+'" class='+(1>e?d:"")+'><span class="checkbox '+f+'"></span><span class="name">'+(a||Gis.ObjectVisibilityController.BASE_LAYER_NAME)+'</span><span class="count" data-count="'+e+'">'+e+"</span></li>"},_layersList:function(){var b,c,d,e,f=this._getVisibilityController().getLayers(),g="";if(f)for(e=this._calculateCountObjects(),f.sort(a),b=0,c=f.length;c>b;b+=1)d=f[b],g+=this._constructLayerElement(d,e[d]);return g},_mapClicked:function(){},_calculateCountObjects:function(a){var b,c,d,e,f,g,h=this._containerController.getUIAttached().getMap(),i={};for(a=a||h.getRenderer().getLayers(),b=0,c=a.length;c>b;b+=1)if(f=a[b],f.isCountable())for(g=this._visibilityController.getLayersFromObject(f),d=0,e=g.length;e>d;d+=1)i[g[d]]||(i[g[d]]=0),i[g[d]]+=1;return i},_getExistsRow:function(a){return $('[data-layer="'+a+'"]',this._$layerList)},_removeRow:function(a){this._getExistsRow(a).remove()},_addRow:function(b,c,d){var e,f;c=Gis.Util.isDefine(c)?c:this._calculateCountObjects()[b],d=d||this._visibilityController.getLayers().sort(a),e=d.indexOf(b),e>0?(f=this._getExistsRow(d[e-1]),f?$(this._constructLayerElement(b,c)).insertAfter(f):this._$layerList.append(this._constructLayerElement(b,c))):this._$layerList.prepend(this._constructLayerElement(b,c))},_onListChanged:function(a){function b(a,b,f){if(a&&(d=a.length))for(c=0;d>c;c+=1)e=f.indexOf(a[c]),e>-1?f.splice(e,1):b.indexOf(a[c])<0&&b.push(a[c])}var c,d,e,f=this;b(a.removed,this._eventsListChanged.removed,this._eventsListChanged.added),b(a.added,this._eventsListChanged.added,this._eventsListChanged.removed),this._listChangeTimeout||(this._listChangeTimeout=setTimeout(function(){var a,b,c,d=f._eventsListChanged.added,e=f._eventsListChanged.removed;if(f._listChangeTimeout=void 0,f._eventsListChanged.added=[],f._eventsListChanged.removed=[],e&&(b=e.length))for(a=0;b>a;a+=1)f._removeRow(e[a]);if(d&&(b=d.length))for(c=f._calculateCountObjects(),a=0;b>a;a+=1)f._addRow(d[a],c[d[a]]);e&&e.length&&f._updateButtonState()},1500))},initDataBlock:function(){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+" layer-list-container'>\n<div id='layers-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Слои</div>\n<div class=\""+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"\"><div id='layers-selector'><ul class='layers-menu data-list element-hover'>\n"+this._layersList()+"</ul>\n</div>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n"+this.switcherHtml("li")+"<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Применить")+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_isChecked:function(a){return this._getCheckBox(a).hasClass(c)},_getCheckBox:function(a){return $(".checkbox",a)},_setChecked:function(a,b){this._getCheckBox(a)[b?"addClass":"removeClass"](c)},_isStateChanged:function(){var a,c=$("li",this._$layerList),d=0,e=c.length;for(d;e>d;d+=1)if(a=$(c[d]),this._getVisibilityController().isLayerVisible(a.data(b))!==this._isChecked(a))return!0;return!1},_updateButtonState:function(){this._updateCheckedState();var a=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this.switchButtonState(this._$buttonNew,a),this.switchButtonState(this._$buttonRevert,a)},getLayers:function(){var a=[],c=this;return $("li",c._$layerList).each(function(){var d=$(this);a.push(new Gis.ObjectVisibilityController.VisibilityData(d.data(b),c._isChecked(d)))}),a},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap().getRenderer();Gis.Widget.Propertys.prototype._deInitEvents.call(this),this._$layerList.off("click","li",this._rowClicked),this._$div.off("mouseenter",this._mouseEnter),this._$div.off("click","."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._okClicked),this._$div.off("click","."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._revertClicked),this._visibilityController.off(Gis.ObjectVisibilityController.LIST_CHANGE_EVENT.TYPE,this._onListChanged,this),a.off(Gis.ObjectController.LAYER_CHANGED_EVENT.TYPE,this._objectChanged,this),a.off(Gis.ObjectController.LAYER_ADD_EVENT.TYPE,this._objectChanged,this),a.off(Gis.ObjectController.LAYER_REMOVE_EVENT.TYPE,this._objectChanged,this),this.deInitSwitcherEvents()},_initEvents:function(){function a(a,b){a.data("count",b),a.text(b)}var c=this,d=this._containerController.getUIAttached().getMap().getRenderer();this._okClicked=function(){return c._getVisibilityController().setLayersVisible(c.getLayers()),c._updateButtonState(),!1},this._revertClicked=function(){return $("li",c._$layerList).each(function(){var a=$(this);c._setChecked(a,c._getVisibilityController().isLayerVisible(a.data(b)))}),c._updateButtonState(),!1},this._rowClicked=function(){var a=$(this);return c._setChecked(a,!c._isChecked(a)),c._updateButtonState(),!1},this._mouseEnter=function(){c._$layerList.css("height",c._$layerList.height()),c._$div.on("mouseleave",c._mouseLeave)},this._mouseLeave=function(){c._$layerList.css("height","auto"),c._$div.off("mouseleave",c._mouseLeave)},this._objectChanged=function(b){-1===c._eventsChanged.indexOf(b.target)&&(c._eventsChanged.push(b.target),c.changedTimeout||(c.changedTimeout=setTimeout(function(){var b,d,e,f,g,h,i,j,k,l=c._visibilityController.getLayersFromObject(c._eventsChanged[0]),m=c._calculateCountObjects();for(b=1,d=c._eventsChanged.length;d>b;b+=1)for(k=c._visibilityController.getLayersFromObject(c._eventsChanged[b]),e=0,f=k.length;f>e;e+=1)-1===l.indexOf(k[e])&&l.push(k[e]);for(c._eventsChanged=[],b=0,d=l.length;d>b;b+=1)i=l[b],j=m[i],g=c._getExistsRow(i),h=$("span.count",g),h.data("count")!==j&&a(h,j);c.changedTimeout=void 0},2e3)))},this._$layerList.on("click","li",this._rowClicked),this._$div.on("mouseenter",this._mouseEnter),this._$div.on("click","."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._okClicked),this._$div.on("click","."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._revertClicked),this._visibilityController.on(Gis.ObjectVisibilityController.LIST_CHANGE_EVENT.TYPE,this._onListChanged,this),d.on(Gis.ObjectController.LAYER_CHANGED_EVENT.TYPE,this._objectChanged,this),d.on(Gis.ObjectController.LAYER_ADD_EVENT.TYPE,this._objectChanged,this),d.on(Gis.ObjectController.LAYER_REMOVE_EVENT.TYPE,this._objectChanged,this),this.initSwitcherEvents(),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData(),$($("button",this._$div).not("[disabled=disabled]")[0]).focus()},bindData:function(){}}),Gis.Widget.LayersProperty.include(Gis.checkAll),Gis.Widget.LayersProperty.CLASS_NAME="gis-widget-propertys-layers",Gis.Widget.layersProperty=function(a){return new Gis.Widget.LayersProperty(a)}}(),Gis.Widget.MarkerProperty=Gis.Widget.Propertys.extend({_history:[],_type:"marker",_defaultStyle:{foreColor:"#ffffff",position:"centerright",drawPoint:!0},options:{colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){var a,b;this._isStateChanged()?(b=this.getPointWidgetData(this._$CoordinateContainer,!0),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,b.x,b.y),this._$TEXTrow.val(this._$TEXTrow.data("old-val")),this.options.dataBinded&&(this._newColor=this.options.dataBinded.getBackColor()),this._updateStyle()):(a=this._history.pop(),a&&this._setData(a.text,a.center,a.color)),this.updateData()},_setData:function(a,b){var c;b=b||this.options.dataBinded&&this.options.dataBinded.getLatLng(),a=a||this.options.dataBinded&&this.options.dataBinded.getText()||"",c=this.coordinateToTemplate(b),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,c,c),this._setValue(this._$TEXTrow,a,a)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),""===this._$TEXTrow.val()?(a=!0,this._$TEXTrow.addClass("error")):this._$TEXTrow.removeClass("error"),a},_updateCoordinatesState:function(){this.isDataEditable()&&this.getValueFromData("isDraggable",!0)?(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled")):(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled"))},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$TEXTrow)},updateData:function(){this._setData(),this._updateColor(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&a[b[0]].getType()===Gis.UI.Action.Marker.type&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.MarkerProperty.CLASS_NAME),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Xrow=$("#marker-x",this._$div),this._$Yrow=$("#marker-y",this._$div),this._$TEXTrow=$("#marker-text",this._$div)},initDataBlock:function(){var a=this.options.dataBinded&&this.options.dataBinded.getLatLng()||"",b=this.options.dataBinded&&this.options.dataBinded.getText()||"",c=this.coordinateToTemplate(a),d=c.x||"",e=c.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Метка</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:d,y:e,xID:"marker-x",yID:"marker-y",yClass:"marker-input",xClass:"marker-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row data-title'><span>Текст:</span></li>\n<li class='data-row'><input type='text' data-old-val='"+b+"' id='marker-text' class='marker-input' value='"+b+"'/></li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0)+"</div>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$TEXTrow)||this.getSelectedColor()&&this.options.dataBinded&&this.options.dataBinded.getBackColor(!0)!==this.getSelectedColor()},_updateButtonState:function(){var a,b;this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),b=this._isStateChanged(),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новая",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b)},_initDialogClose:function(){var a,b=this;return a=$("#marker-remove-dialog"),a.length||(a=$('<div id="marker-remove-dialog"/>'),a.appendTo($(document.body))),a.dialog($.extend(this._dialogOptions,{buttons:[{text:"OK",click:function(){b.removeLayerFromMap(b.options.dataBinded),$(this).dialog("close")}},{text:"Отменить",click:function(){$(this).dialog("close")}}]})),a},_initDialogNew:function(){var a,b=this;return a=$("#marker-new-dialog"),a.length||(a=$('<div id="marker-new-dialog"/>'),a.append("<div><span class='dialog-label'>Цвет метки</span>"+this._HTMLcolorSelector(!1,null,!1)+"</div>"),a.append("<div><span class='dialog-label'>Текст метки</span><div class='input-wraper'><input type='text' id='dialog-new-marker-text'/></div></div>"),a.appendTo($(document.body)),this._activateColorPicker(a),$(a).on("click",".gis-color-button",function(){var b=$(this);b.hasClass("selected")||($(".gis-color-button.selected",a).removeClass("selected"),b.addClass("selected"))}),$(a).on("dialogclose",function(){var a=$(this);$(".gis-color-button.selected",a).removeClass("selected"),$($(".gis-color-button",a)[0]).addClass("selected"),$("#dialog-new-marker-text",a).val("")})),a.dialog($.extend(this._dialogOptions,{buttons:[{text:"OK",click:function(){var c,d,e;e=$(this),c=$(".gis-color-button.selected",e).data("color"),d=$("#dialog-new-marker-text",e).val(),c&&""!==d&&(b._saveData(a.latlng.lng,a.latlng.lat,d,c,!0),$(this).dialog("close"))}},{text:"Отменить",click:function(){$(this).dialog("close")}}]})),a},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_opedDialogNewLabel:function(a){this._$dialogNew=this._$dialogNew||this._initDialogNew(),this._$dialogNew.latlng=a,this._$dialogNew.dialog("open")},_saveData:function(a,b,c,d,e){var f,g,h=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||h.x,b=b||h.y,c=c||this._$TEXTrow.val(),Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(b)&&""!==c?(d=d||this.getSelectedColor()||this.options.dataBinded.getBackColor(),!e&&this.options.dataBinded?this.options.dataBinded.setData({backColor:d,caption:c,latitude:b,longitude:a}):(g=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("marker")),f=Gis.textLabel({id:Gis.Util.generateGUID(),className:"gis-ui-marker",foreColor:g.foreColor,position:g.position,drawPoint:g.drawPoint,caption:c,latitude:b,longitude:a,backColor:d,draggable:!0,selectable:!0}),f.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(f)),this._update()):this._updateState()},_mapClicked:function(a){this._opedDialogNewLabel(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_deleteKeyFire:function(a){Gis.UI.DeleteActions.marker.call(this,a,this.options.dataBinded)},_deInitEvents:function(){$(this._$div).off("click",".gis-color-button",this._colorClickFunction),$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this),this._destroyColorPicker($("#marker-new-dialog"))},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b=this;this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b.checkBaseLayer()&&b._saveData()},this._deleteFunction=this._deleteFunction||function(a){b.isButtonEnable(this)&&b._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){b._updateState(),a.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._deselectFunction=this._deselectFunction||function(){b.isButtonEnable(this)&&b._containerController.getUIAttached().getMap().unselectLayer(b.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||a(b._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),this._colorClickFunction=this._colorClickFunction||function(){var a=$(this);a.hasClass("selected")||($(".gis-color-button.selected",b._$div).removeClass("selected"),a.addClass("selected"),b._newColor=a.data("color"),b._updateState())},this._$div.on("click",".gis-color-button",this._colorClickFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a!==this.options.dataBinded&&(this._newColor=void 0,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&(this._newColor=a.getBackColor(),a.on("change",this.updateData,this)),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions.marker=function(a,b){"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить метку?",callback:function(){this._containerController.getUIAttached().getMap().removeLayer(b||this.options.dataBinded)},context:this,id:"marker-remove-dialog"},b)},Gis.UI.DeleteActions.text=Gis.UI.DeleteActions.marker,Gis.Widget.MarkerProperty.CLASS_NAME="gis-widget-propertys-marker",Gis.Widget.MarkerProperty.CENTER_CHANGED=1,Gis.Widget.MarkerProperty.TEXT_CHANGED=3,Gis.Widget.MarkerProperty.BOTH_CHANGED=2,Gis.Widget.MarkerProperty.NOT_CHANGED=0,Gis.Widget.markerProperty=function(a){return new Gis.Widget.MarkerProperty(a)},Gis.Widget.MeasureProperty=Gis.Widget.Propertys.extend({includes:Gis.Widget.PointBehavior,_history:[],_type:"measure",_historyValues:[],_path:void 0,_defaultStyle:{color:"black",border:"white",thickness:"white",icon:{width:10,type:"circle"}},options:{needCheckLayers:!1,colors:void 0},_updateHistory:function(){var a,b=this;this._history=[],this._historyValues=[],a=$("#points-selector li",this._$div),a.each(function(){b._history.push(this),b._historyValues.push({x:b.getPointValue($(".marker-x",$(this))),y:b.getPointValue($(".marker-y",$(this)))})})},back:function(){var a,b,c=this;this._isStateChanged()&&(!this._history||this._history.length<2?$("#points-selector li",this._$div).filter(function(d){return 2>d?(a=c._historyValues[d]?c._historyValues[d].x:"",b=c._historyValues[d]?c._historyValues[d].y:"",c.setHtmlPointSelectorWidgetData($(this),Gis.UI.coordinate(a,b),Gis.UI.coordinate(a,b)),!1):!0}).remove():($("#points-selector li",this._$div).not(this._history).remove(),this._history.forEach(function(d,e){$("#points-selector ol",c._$div).append($(d)),a=c._historyValues[e]?c._historyValues[e].x:"",b=c._historyValues[e]?c._historyValues[e].y:"",c.setHtmlPointSelectorWidgetData($(d),Gis.UI.coordinate(a,b),Gis.UI.coordinate(a,b))}))),this._updateState()},_clearInfo:function(){this._$infoContainer.remove(),this._$infoContainer=void 0},_clearMeasure:function(){var a=this;this._containerController.getUIAttached().getMap().removeLayer(this._path),this._deInitPathEvents(),$("#points-selector li",this._$div).not(function(b){var c=$(this);return 2>b?(a.setHtmlPointSelectorWidgetData(c,Gis.UI.coordinate("",""),Gis.UI.coordinate("","")),a._detachPointDataFromRow(c),this):!1}).remove(),this._updateHistory(),this._clearInfo(),this._updateState(),this._path=void 0},_setData:function(){},_hilightErrors:function(){var a,b,c,d=!1,e=this;
return a=$("#points-selector li",this._$div),this._pointsCalculated=[],a.each(function(){b=$(".marker-x",$(this)),c=$(".marker-y",$(this)),d=d||e.checkPoint($(this))}),d},updateData:function(){this._setData(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.MeasureProperty.CLASS_NAME)},setBounds:function(){var a,b,c,d,e,f,g;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$("#points-selector",this._$div),e=$("#info-data",this._$div),d=c.parent(),$(".gis-widget-propertys-buttons-wraper",this._$div).each(function(){a-=$(this).outerHeight(!0)}),a-=c.outerHeight(!0)-c.height()+d.outerHeight(!0)-d.height()+$(".gis-widget-propertys-title",d).outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height(),g=e.parent().outerHeight(!0)-e.height(),f=a/2-g,c.css({maxHeight:Math.max(f,40)}),e.css({maxHeight:a-c.height()-g})},_xyRowHTML:function(){return"<li class='data-row'>\n<div class=\"gis-point-in-list inline-points\">"+this._HTMLPointSelectorWidget({tag:"span",tagClass:"point-tag",yClass:"marker-input marker-y",xClass:"marker-input marker-x"})+"</div><span class='gis-widget-ico gis-widget-ico-up'></span><span class='gis-widget-ico gis-widget-ico-down'></span><span class='gis-widget-ico gis-widget-ico-remove'></span><span class='gis-widget-ico gis-widget-ico-add'></span>\n</li>\n"},initDataBlock:function(){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='points-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Точки</div>\n<div id='points-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ol>\n"+this._xyRowHTML()+this._xyRowHTML()+"</ol>\n<div class='gis-widget-add-to-end'><span class='gis-widget-ico gis-widget-ico-add'></span></div></div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){var a,b=!1,c=this;return a=$("#points-selector li",this._$div),c._history.length&&c._history.length!==a.length?!0:(a.each(function(a){var d=$(this),e=$(".marker-x",d),f=$(".marker-y",d);b=b||c._rowChanged(e)||c._rowChanged(f)||c._history[a]&&this!==c._history[a]}),b)},_updateButtonState:function(){var a=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),this.switchButtonState(this._$buttonNew,a&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,a),this.switchButtonState(this._$buttonDelete,this._path&&this._containerController.getUIAttached().getMap().getLayer(this._path.getId())),this.switchButtonState(this._$buttonRevert,a)},_getLastClearPoint:function(){var a,b,c,d,e;for(a=$("#points-selector li",this._$div),b=a.length-1;b>=0&&(c=$(".marker-x",a[b]),d=$(".marker-y",a[b]),""===c.val()&&""===d.val());b-=1)""===c.val()&&""===d.val()&&(e=a[b]);return e||(e=$(this._xyRowHTML()),$("#points-selector ol",this._$div).append(e),this._maskInput()),e},_insertNewPoint:function(a){var b,c,d=this._getLastClearPoint();a=this.coordinateToTemplate(a),b=a.x||"",c=a.y||"",this.setHtmlPointSelectorWidgetData(d,Gis.UI.coordinate(b,c),Gis.UI.coordinate(b,c))},_mapClicked:function(a){this._insertNewPoint(Gis.latLng(a.latLng.latitude,a.latLng.longitude)),this._calculateMeasuring(this._history.length===$("#points-selector li",this._$div).length&&this._path&&this._containerController.getUIAttached().getMap().hasLayer(this._path)),this._updateState()},_calculatePointData:function(a,b){var c,d,e,f;return a&&b?(e=this.templateToCoordinate(this.getPointValue($(".marker-x",$(a))),this.getPointValue($(".marker-y",$(a)))),f=this.templateToCoordinate(this.getPointValue($(".marker-x",$(b))),this.getPointValue($(".marker-y",$(b)))),c=Gis.latLng(e.y,e.x),d=Gis.latLng(f.y,f.x),{distance:c.distanceTo(d),angle:Gis.Projection.calculateAsimuth(c,d)}):void 0},_informationHTML:function(){var a="",b=0;return this._pointsCalculated&&this._pointsCalculated.length&&this._pointsCalculated.forEach(function(c,d){b+=c.distance,a+="<li class='gis-widget-info-row gis-widget-measure-info-row'><span class='title'>Длина "+(d+1)+"-"+(d+2)+":</span><span class='value'>"+c.distance.toFixed(2)+"</span></li><li class='gis-widget-info-row gis-widget-measure-info-row'><span class='title'>Угол "+(d+1)+"-"+(d+2)+":</span><span class='value'>"+c.angle.toFixed(2)+"</span></li>"}),a&&"<ul class='gis-widget-info gis-widget-measure-info'><li class='gis-widget-info-row gis-widget-measure-info-row'><span class='title'>Общая длина:</span><span class='value'>"+b.toFixed(2)+"</span></li>"+a+"</ul>"},_infoContainerHTML:function(a){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='info-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Информация</div>\n<div id='info-data' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>"+a+"</div>\n</div>\n"},_drawResultCalculation:function(){var a,b;b=this._informationHTML(),b&&(a=$(".gis-widget-measure-info",this._$div),a.length?a.replaceWith($(b)):(this._$infoContainer=$(this._infoContainerHTML(b)),this._$infoContainer.insertAfter($("."+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS,this._$div))))},_updateDataFromPath:function(){var a,b,c,d,e,f,g=this._path.getPoints(),h=this;g&&(b=$("#points-selector li",this._$div),a=function(a,g){c=h.coordinateToTemplate(a.getLatLng()),d=$(b[g]),d&&(f=c.y||"",e=c.x||"",h.setHtmlPointSelectorWidgetData(d,Gis.UI.coordinate(e,f),Gis.UI.coordinate(e,f)),h._attachPointDataToRow(d,a,!0))},g.forEach(a),this._calculateMeasuring(!0))},_initPathEvents:function(){this._path&&!this._pathEventsInitialized&&(this._pathEventsInitialized=!0,this._path.on("change",this._updateDataFromPath,this),this._path.on("selected",this._layerSelected,this),this._path.on("unselected",this._layerUnSelected,this))},_deInitPathEvents:function(){this._path&&this._pathEventsInitialized&&(this._pathEventsInitialized=!1,this._path.off("change",this._updateDataFromPath,this),this._path.off("selected",this._layerSelected,this),this._path.off("unselected",this._layerUnSelected,this))},_getPathPoints:function(){return this._pathPoints.points},_drawPath:function(){var a,b;this._path?this._path.setData({points:this._getPathPoints()}):(b=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("measure")),a={color:b.color,border:b.border,thickness:b.thickness},this._path=Gis.path(Gis.Util.extend({id:Gis.Util.generateGUID(),forcePaint:!0,tacticObjectType:"measurer",line:a,draggable:!0,selectable:!0,className:"gis-measure-marker",orthodrome:!0,icon:b.icon,points:this._getPathPoints()})),this._path.setControllableByServer(!1),this._path.setSelectedStyle(void 0)),this._containerController.getUIAttached().getMap().hasLayer(this._path)||this._path.addTo(this._containerController.getUIAttached().getMap()),this._initPathEvents()},_calculateMeasuring:function(a){var b,c;c=this,this._hilightErrors()||(b=$("#points-selector li",this._$div),this._pointsCalculated=[],this._pathPoints={points:[]},b.each(function(a){var d,e,f,g=$(this),h=$(".marker-y",g),i=$(".marker-x",g);d=b[a+1],""!==h.val()&&""!==i.val()&&(f=c.getPointWidgetData(g),e=c.templateToCoordinate(f.x,f.y),c.setHtmlPointSelectorWidgetData(g,f,f),c._attachPointDataToRow(g,{latitude:e.y,longitude:e.x,simplify:!0}),c._pathPoints.points.push(Gis.Util.extend(c._getPoint(g).objectData(),{latitude:e.y,longitude:e.x})),d&&c._pointsCalculated.push(c._calculatePointData(g,d)))}),!a&&c._pathPoints.points.length>=2&&this._drawPath(),c._pathPoints.points.length>=2&&this._drawResultCalculation(),this._updateHistory()),this._updateState()},_skChanged:Gis.Widget.ListPoints._skChanged,_layerSelected:function(a){var b,c,d=a.additional&&a.additional.markerKey;void 0!==d&&(c=$("#points-selector .data-row",this._$div),b=c[d],$(":focus").blur(),c.not(b).removeClass("selected"),b&&$(b).addClass("selected"))},_layerUnSelected:function(){var a;a=$("#points-selector .data-row",this._$div),a.removeClass("selected")},onRemove:function(){Gis.Widget.Propertys.prototype.onRemove.call(this),this._containerController.getUIAttached().getMap().removeLayer(this._path)},_deInitEvents:function(){this._deInitPathEvents(),this._$div.off("click",".gis-widget-ico-up",this._icoUpClick),this._$div.off("click",".gis-widget-ico-down",this._icoDownClick),this._$div.off("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.off("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.off("change",".data-row input, .data-row input",this._textRowChange),this._$div.off("keyup",".data-row input, .data-row input",this._textRowChange),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_removeRow:function(a){var b=a.parent();$(".data-row",b).length>2&&a.remove()},_deleteKeyFire:function(a){return"text"!==(a.srcElement||a.target).type&&$("#points-selector .data-row.selected",this._$div).length?(this._removeRow($("#points-selector .data-row.selected",this._$div)),this._updateState(),a.preventDefault(),!1):void 0},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a(),b.stopPropagation()}}var b=this;this._initPathEvents(),this._containerController.getUIAttached().getMap().on("layerselected",this._layerSelected,this),this._containerController.getUIAttached().getMap().on("layerunselected",this._layerUnSelected,this),this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b._calculateMeasuring()},this._icoUpClick=this._icoUpClick||function(){var a,c=$(this).parent();a=c.prev(),a.length&&c.insertBefore(a),b._updateState()},this._icoDownClick=this._icoDownClick||function(){var a,c=$(this).parent();a=c.next(),a.length&&a.insertBefore(c),b._updateState()},this._icoDeleteClick=this._icoDeleteClick||function(){var a=$(this).parent();b._removeRow(a),b._updateState()},this._icoPlusClick=this._icoPlusClick||function(){var a=$(this).parent();"li"===a[0].tagName.toLowerCase()?$(b._xyRowHTML()).insertBefore(a):$(b._xyRowHTML()).appendTo($("ol",a.parent())),b._maskInput(),b._updateState()},this._deleteFunction=this._deleteFunction||function(){b.isButtonEnable(this)&&b._clearMeasure()},this._textRowChange=this._textRowChange||function(){b._updateState()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._returnFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._deleteFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),this._$div.on("click",".gis-widget-ico-up",this._icoUpClick),this._$div.on("click",".gis-widget-ico-down",this._icoDownClick),this._$div.on("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.on("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.on("change",".data-row input, .data-row input",this._textRowChange),this._$div.on("keyup",".data-row input, .data-row input",this._textRowChange),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData(),$($("button",this._$div).not("[disabled=disabled]")[0]).focus()},bindData:function(){}}),Gis.Widget.MeasureProperty.CLASS_NAME="gis-widget-propertys-measure",Gis.Widget.MeasureProperty.CENTER_CHANGED=1,Gis.Widget.MeasureProperty.TEXT_CHANGED=3,Gis.Widget.MeasureProperty.BOTH_CHANGED=2,Gis.Widget.MeasureProperty.NOT_CHANGED=0,Gis.Widget.measureProperty=function(a){return new Gis.Widget.MeasureProperty(a)},Gis.Widget.ObjectProperty=Gis.Widget.Propertys.extend({_history:[],options:{types:void 0,colors:void 0},_type:"object",initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a);var b=Gis.config(Gis.Widget.ObjectProperty.CONFIG_TYPES_KEY);this.options.types=this.options.types||b&&b.split(" ")||["target","danger","circle","storm","simple"],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){var a;this._isStateChanged()?(this.revertHtmlPointSelectorWidgetData(this._$CoordinateContainer),this._$TEXTrow.val(this._$TEXTrow.data("old-val")),this.options.dataBinded&&(this._newColor=this.options.dataBinded.getImageColor())):(a=this._history.pop(),a&&this._setData(a.text,a.center,a.color)),this.updateData()},_setData:function(a,b){var c,d;b=this.coordinateToTemplate(b||this.options.dataBinded&&this.options.dataBinded.getLatLng()),a=a||this.options.dataBinded&&this.options.dataBinded.getPopup()||"",c=b.x||"",d=b.y||"",this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d)),this._setValue(this._$TEXTrow,a,a)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageColor()))},_updateType:function(){$(".gis-image-type-list",this._$div).replaceWith(this._HTMLtypeSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageType())),this._repaintIcons($(".gis-image-type-list",this._$div))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),$(".gis-color-button.selected",this._$div).data("color")||(a=!0),a},_updateCoordinatesState:function(){this.isDataEditable()||!this.options.dataBinded||this.options.dataBinded.isDraggable()?(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled")):(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled"))},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$TEXTrow)},updateData:function(){this._setData(),this._updateColor(),this._updateType(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&"text"===a[b[0]].getType()&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.ObjectProperty.CLASS_NAME),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Xrow=$("#object-x",this._$div),this._$Yrow=$("#object-y",this._$div),this._$TEXTrow=$("#object-text",this._$div)},initDataBlock:function(){var a=this.options.dataBinded&&this.options.dataBinded.getLatLng()||"",b=this.options.dataBinded&&this.options.dataBinded.getPopup()||"",c=this.coordinateToTemplate(a),d=c.x||"",e=c.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Объект</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:d,y:e,xID:"object-x",yID:"object-y",yClass:"object-input",xClass:"object-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row data-title'><span>Комментарий:</span></li>\n<li class='data-row'>"+this._HTMLRowInput(b,"object-text","object-input")+"\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Пиктограмма</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"  gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageColor())+this._HTMLtypeSelector(!0,this.options.dataBinded&&this.options.dataBinded.getImageType())+"</div></div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$TEXTrow)||this.options.dataBinded&&(this.options.dataBinded.getImageColor()!==this.getSelectedColor()||this.options.dataBinded.getImageType()!==this.getSelectedType())},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новая",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b),this._$div.tooltip("close")},_initDialogNew:function(){var a,b=this;return a=$("#object-new-dialog"),a.length||(a=$('<div id="object-new-dialog"/>'),a.append("<div><span class='dialog-label'>Пиктограмма</span>"+this._HTMLtypeSelector(!1,this.options.dataBinded&&this.options.dataBinded.getImageType())+"</div>"),a.append("<div><span class='dialog-label'>Цвет объекта</span>"+this._HTMLcolorSelector(!1,this.options.dataBinded&&this.options.dataBinded.getImageColor(),!1)+"</div>"),a.append("<div><span class='dialog-label'>Комментарий</span><input type='text' id='dialog-new-object-text'/></div>"),a.appendTo($(document.body)),this._activateColorPicker(a),$(a).on("click",".gis-param-selector",function(){var a=$(this);a.hasClass("selected")||($(".gis-param-selector.selected",a.parent()).removeClass("selected"),a.addClass("selected"))}),$(a).on("dialogclose",function(){var a=$(this);$("#dialog-new-object-text",a).val("")}),$(a).on("dialogopen",function(){var a=$(this);b._repaintIcons($(".gis-image-type-list",this)),$(".gis-param-selector.selected",a).removeClass("selected"),$($(".gis-param-selector",a)[0]).addClass("selected"),$(".gis-color-button.selected",a).removeClass("selected"),$($(".gis-color-button",a)[0]).addClass("selected")})),a.dialog({dialogClass:"no-title-bar",autoOpen:!1,closeOnEscape:!0,minHeight:10,minWidth:210,draggable:!0,resizable:!1,modal:!0,buttons:[{text:"OK",click:function(){var c,d,e,f;f=$(this),c=$(".gis-color-button.selected",f).data("color"),e=$(".gis-image-type-button.selected",f).data("type"),d=$("#dialog-new-object-text",f).val(),c&&e&&(b._saveData(a.latlng.lng,a.latlng.lat,d,c,e,!0),$(this).dialog("close"))}},{text:"Отменить",click:function(){$(this).dialog("close")}}]}),a},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_opedDialogNewLabel:function(a){this._$dialogNew=this._$dialogNew||this._initDialogNew(),this._$dialogNew.latlng=a,this._$dialogNew.dialog("open")},_saveData:function(a,b,c,d,e,f){var g,h=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||h.x,b=b||h.y,c=c||this._$TEXTrow.val(),d=d||$(".gis-color-button.selected",this._$div).data("color")||this.options.dataBinded.getImageColor(),e=e||$(".gis-image-type-button.selected",this._$div).data("type")||this.options.dataBinded.getImageType(),Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(b)&&d&&e?(!f&&this.options.dataBinded?this.options.dataBinded.setData({icon:Gis.icon({type:e,color:d}),tooltip:c,latitude:b,longitude:a}):(g=Gis.imageLabel({id:Gis.Util.generateGUID(),tooltip:c,latitude:b,longitude:a,icon:Gis.icon({type:e,color:d}),draggable:!0,selectable:!0}),g.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(g)),this._update()):this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions.object.call(this,a)},_mapClicked:function(a){this._opedDialogNewLabel(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_deInitEvents:function(){$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this),this._destroyColorPicker($("#object-new-dialog"))},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b=this;this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b.checkBaseLayer()&&b._saveData()},this._deleteFunction=this._deleteFunction||function(a){b.isButtonEnable(this)&&b._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){b._updateState(),a.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._deselectFunction=this._deselectFunction||function(){b.isButtonEnable(this)&&b._containerController.getUIAttached().getMap().unselectLayer(b.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||a(b._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a!==this.options.dataBinded&&(this._newColor=void 0,this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions.object=function(a,b){var c=this;"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить объект?",callback:function(){c.removeLayerFromMap(b||c.options.dataBinded)},context:this,id:"object-remove-dialog"},b)},Gis.Widget.ObjectProperty.CONFIG_TYPES_KEY="ui.object_types",Gis.setConfig(Gis.Widget.ObjectProperty.CONFIG_TYPES_KEY,"target danger circle storm simple"),Gis.UI.DeleteActions.image=Gis.UI.DeleteActions.object,Gis.Widget.ObjectProperty.CLASS_NAME="gis-widget-propertys-object",Gis.Widget.ObjectProperty.CENTER_CHANGED=1,Gis.Widget.ObjectProperty.TEXT_CHANGED=3,Gis.Widget.ObjectProperty.BOTH_CHANGED=2,Gis.Widget.ObjectProperty.NOT_CHANGED=0,Gis.Widget.objectProperty=function(a){return new Gis.Widget.ObjectProperty(a)},Gis.Widget.OverlayProperty=Gis.Widget.Propertys.extend({_typeSelector:!0,_type:Gis.Objects.Overlay.prototype.options.tacticObjectType,_history:[],_defaultStyle:{color:"#AF2D51",border:"white",thickness:2,selectedBorder:"rgb(75, 84, 255)",angleLineColor:"#272727",angleLineBorder:"white",angleLineThickness:2},options:{types:void 0,colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this._createEventFunctions(),this.options.types=this.options.types||[],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){this.resetOpacityLocal(),this.options.dataBinded.setTempOpacity(void 0),this.options.dataBinded.resetScale(),this.options.dataBinded.resetAngle(),this._isStateChanged()?this.options.dataBinded.setTempLatlng(null):this.options.dataBinded.redraw(),this.updateData()},resetOpacityLocal:function(){this.resetOpacity()},clean:function(){this.isRevertAvailable()&&(this.resetOpacityLocal(),this.options.dataBinded.setTempOpacity(void 0),this.options.dataBinded.resetScale(!0),this.options.dataBinded.resetAngle(!0),this.options.dataBinded.saveTempLatlng(!1)),this.updateData()},_mapClicked:function(){},_setAngle:function(){this._$angleBlock.html(this.options.dataBinded?this.round(this.options.dataBinded.getAngle(),100):0)},round:function(a,b){return Math.round(a*b)/b},_setScale:function(){this._$scaleBlock.html(this.options.dataBinded?this.round(this.options.dataBinded.getScale(),1e3):1)},_setData:function(){this._setPosition(),this._setAngle(),this._setScale(),this.isChangedOpacity()||this.setOpacity(this.options.dataBinded?this.options.dataBinded.getOpacity(!0):0)},_updateColor:function(){},_hilightErrors:function(){return!1},updateData:function(){this._setData(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&a[b[0]].getType()===Gis.Objects.Overlay.prototype.options.tacticObjectType&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.OverlayProperty.CLASS_NAME),this._$dataBlock=$(".gis-color-container."+Gis.Widget.Propertys.DATA_BLOCK_CLASS,this._$div),this._$angleBlock=$(".gis-angle-container."+Gis.Widget.Propertys.DATA_BLOCK_CLASS,this._$div),this._$scaleBlock=$(".gis-scale-container."+Gis.Widget.Propertys.DATA_BLOCK_CLASS,this._$div),this.initSlider(this._$div)},initDataBlock:function(){return"<div class='scroller'><div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Горячие клавиши</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-help-container'><p><span style='font-style: italic'>[W],[A],[S],[D]</span> - перемещение</p><p><span style='font-style: italic'>[Q],[E]</span> - вращение</p><p><span style='font-style: italic'>[Z],[X]</span> - масштабирование</p><p><span style='font-style: italic'>[R],[F]</span> - изменение прозрачности</p><p>При зажатой [Shift] увеличивается шаг операции</p></div></div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Позиция</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'></div></div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Угол</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-angle-container'></div></div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Масштаб</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-scale-container'></div></div>\n"+this._HTMLSlider()+"</div></div>\n"},_setPosition:function(){var a,b,c,d,e,f,g,h='<li class="gis-widget-info">Выберите объект</li>';this.options.dataBinded&&(h='<li class="gis-widget-info">В исходной позиции</li>',this.options.dataBinded.isMoved()&&(a=this.coordinateToTemplate(this.options.dataBinded.getOldCenter()),e=this.options.dataBinded.getNewCenter(),e&&(b=this.coordinateToTemplate(e)),f=this.options.dataBinded.getUpdatedCenter(),f&&(c=this.coordinateToTemplate(f)),d=this._containerController.getUIAttached().getGeoConverter(),g=d.isMetric(d.getSelectedSystem()),g?(h='<li class="gis-widget-info">Исходная:</li>',h+='<li class="gis-widget-info">'+this._HTMLRowName()+': <span class="value-x">'+a.x+" </span></span><span>"+this._HTMLRowName(!0)+': <span class="value-y">'+a.y+"</span></li>",c&&(h+='<li class="gis-widget-info">Текущая:</li>',h+='<li class="gis-widget-info">'+this._HTMLRowName()+': <span class="value-x">'+c.x+" </span></span><span>"+this._HTMLRowName(!0)+': <span class="value-y">'+c.y+"</span></li>"),b&&(h+='<li class="gis-widget-info">Новая:</li>',h+='<li class="gis-widget-info">'+this._HTMLRowName()+': <span class="value-x">'+b.x+" </span></span><span>"+this._HTMLRowName(!0)+': <span class="value-y">'+b.y+"</span></li>")):(h='<li class="gis-widget-info">Исходная:</li>',h+='<li class="gis-widget-info">'+this._HTMLRowName(!0)+': <span class="value-y">'+a.y+" </span></span><span>"+this._HTMLRowName()+': <span class="value-x">'+a.x+"</span></li>",c&&(h+='<li class="gis-widget-info">Текущая:</li>',h+='<li class="gis-widget-info">'+this._HTMLRowName(!0)+': <span class="value-y">'+c.y+" </span></span><span>"+this._HTMLRowName()+': <span class="value-x">'+c.x+"</span></li>"),b&&(h+='<li class="gis-widget-info">Новая:</li>',h+='<li class="gis-widget-info">'+this._HTMLRowName(!0)+': <span class="value-y">'+b.y+" </span></span><span>"+this._HTMLRowName()+': <span class="value-x">'+b.x+"</span></li>")))),this._$dataBlock.html('<ul class="gis-widget-info">'+h+"</ul>")},_skChanged:function(){this.updateData(),Gis.Widget.Propertys.prototype._skChanged.call(this)},_onMouseDown:function(){},_onMouseMove:function(){},_onMouseOut:function(){},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Подтвердить",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.OverlayProperty.BUTTON_CLEAN_CLASS,"Сброс",!this.options.dataBinded,"Вернуть к исходным координатам",!0)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"
},setBounds:function(){var a,b,c,d;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$(".scroller",this._$div),d=c.parent(),$(".gis-widget-propertys-buttons-wraper",this._$div).each(function(){a-=$(this).outerHeight(!0)}),c.css({maxHeight:a})},_isStateChanged:function(){var a=this.options.dataBinded;return a&&a.getTempLatlng()},_isAngleAndScaleChanged:function(){var a=this.options.dataBinded;return a&&(a.isAngleChanged()||a.isScaleChanged())},_isOpacityChanged:function(){return this.options.dataBinded&&this.options.dataBinded&&this.options.dataBinded.getOpacity()!==this.getOpacity()},isRevertAvailable:function(){return this.options.dataBinded&&(this.options.dataBinded.isMoved()||this.options.dataBinded.isDeformed())},_updateButtonState:function(){var a,b=this._isStateChanged()||this._isOpacityChanged()||this._isAngleAndScaleChanged(),c=this.isRevertAvailable();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonClean=this._$buttonClean||$("."+Gis.Widget.OverlayProperty.BUTTON_CLEAN_CLASS,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a="Подтвердить",$(".gis-button-text",this._$buttonNew).html(a);this.isDataEditable();this.switchButtonState(this._$buttonNew,this.options.dataBinded&&b&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonClean,this.options.dataBinded&&c),this.switchButtonState(this._$buttonDelete,this.options.dataBinded),this.switchButtonState(this._$buttonRevert,this.options.dataBinded&&b)},_sliding:function(a){this.options.dataBinded&&this.options.dataBinded.setTempOpacity(a)},_saveData:function(){if(this.options.dataBinded){var a=this.getOpacity(),b=this._isOpacityChanged(),c=this._isAngleAndScaleChanged();this.options.dataBinded.saveScale(),this.options.dataBinded.saveAngle();var d=this._isStateChanged();(d||c)&&this.options.dataBinded.fullSave(!0,b),b&&this.options.dataBinded.setOpacity(a),this._updateState()}this.resetOpacity()},_deleteKeyFire:function(a){Gis.UI.DeleteActions[Gis.Objects.Overlay.prototype.options.tacticObjectType].call(this,{srcEvent:a,srcElement:this.options.dataBinded},this.options.dataBinded)},_deInitEvents:function(){this.resetOpacityLocal();var a=this._containerController.getUIAttached().getMap();this._$div.off({click:this._returnFunction,keyup:this._KeyUpReturnFunction},"."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME),this._$div.off({click:this._cleanFuncion,keyup:this._KeyUpCleanFunction},"."+Gis.Widget.OverlayProperty.BUTTON_CLEAN_CLASS),this._$div.off({click:this._revertFunction,keyup:this._KeyUpRevertFunction},"."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME),this._$div.off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction},"."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME),this._$div.off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction},"."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME),$(document.body).off("keyup",this._KeyUpEscFunction),$(document.body).on("keydown",this._bodyKeyUpFunction),a.off("mousedown",this._onMouseDown,this),a.off("mousemove",this._onMouseMove,this),a.off("mouseout",this._onMouseOut,this),this._deinitDataEvents(),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_createEventFunctions:function(){var a=this;this._returnFunction=this._returnFunction||function(b){a.isButtonEnable(this)&&a._saveData(b)},this._escFunction=this._escFunction||function(b){a._finish(b)},this._deleteFunction=this._deleteFunction||function(b){a.isButtonEnable(this)&&a._deleteKeyFire(b)},this._textRowChange=this._textRowChange||function(b){a._updateState(),b.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){a._updateState()},this._revertFunction=this._revertFunction||function(){a.isButtonEnable(this)&&a.back()},this._cleanFuncion=this._cleanFuncion||function(){a.isButtonEnable(this)&&a.clean()},this._deselectFunction=this._deselectFunction||function(){a.isButtonEnable(this)&&a._containerController.getUIAttached().getMap().unselectLayer(a.options.dataBinded)},this._bodyKeyUpFunction=this._bodyKeyUpFunction||function(b){var c=b.shiftKey?.1:.01;switch(b.keyCode){case 82:c=-c;case 70:Gis.requestAnimationFrame(50)(function(){a._changeOpacity(c)}),b.stopPropagation(),b.preventDefault()}},this._KeyUpReturnFunction=this._KeyUpReturnFunction||this.generateEnteredFunction(a._deleteFunction),this._KeyUpEscFunction=this._KeyUpEscFunction||this.generateEskeyFunction(a._escFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||this.generateEnteredFunction(a._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||this.generateEnteredFunction(a._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||this.generateEnteredFunction(a._revertFunction),this._KeyUpCleanFunction=this._KeyUpCleanFunction||this.generateEnteredFunction(a._cleanFuncion)},_changeOpacity:function(a){if(this.options.dataBinded){var b=this.options.dataBinded.getOpacity(!0);b+=a,b=b>1?1:0>b?0:b,this._slided=!0,this._sliding(b),this.setOpacity(this.options.dataBinded.getOpacity(!0)),this._updateState()}},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();$(document.body).on("keyup",this._KeyUpEscFunction),$(document.body).on("keydown",this._bodyKeyUpFunction),this._$div.on({click:this._returnFunction,keyup:this._KeyUpReturnFunction},"."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME),this._$div.on({click:this._cleanFuncion,keyup:this._KeyUpCleanFunction},"."+Gis.Widget.OverlayProperty.BUTTON_CLEAN_CLASS),this._$div.on({click:this._revertFunction,keyup:this._KeyUpRevertFunction},"."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME),this._$div.on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction},"."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME),this._$div.on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction},"."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME),a.on("mousedown",this._onMouseDown,this),a.on("mousemove",this._onMouseMove,this),a.on("mouseout",this._onMouseOut,this),this._initDataEvents(),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},_deinitDataEvents:function(){this.options.dataBinded&&this.options.dataBinded.off("change localchange",this.updateData,this)},_initDataEvents:function(){this.options.dataBinded&&this.options.dataBinded.on("change localchange",this.updateData,this)},bindData:function(a){$(":focus").blur(),a||this._cleared||(this._cleared=!0),a!==this.options.dataBinded&&(this.resetOpacityLocal(),this._deinitDataEvents(),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData(),this._initDataEvents())}}),Gis.UI.DeleteActions[Gis.Objects.Overlay.prototype.options.tacticObjectType]=function(a,b){(b||this.options.dataBinded).getType()===Gis.Objects.Overlay.prototype.options.tacticObjectType&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить оверлей?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"overlay-remove-dialog"},b)},Gis.Widget.OverlayProperty.CLASS_NAME="gis-widget-propertys-overlay",Gis.Widget.OverlayProperty.BUTTON_CLEAN_CLASS="gis-propertys-button-clean-overlay",Gis.Widget.OverlayProperty.include(Gis.opacityWidget),Gis.Widget.overlayProperty=function(a){return new Gis.Widget.OverlayProperty(a)},Gis.Widget.PolylineProperty=Gis.Widget.Propertys.extend({_type:null,_typeSelector:!1,includes:Gis.Widget.PointBehavior,_history:[],_historyValues:[],_minimalPoints:2,options:{colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this.options.dataBinded&&this._initPolylineEvents()},setBounds:function(){var a,b,c,d;b=this._containerController.getUIAttached().getAvailableContainerBounds(this.options.position).height,a=b-Gis.Widget.Scheme.needHeight(b),c=$("#points-selector",this._$div),d=c.parent(),$(".gis-widget-propertys-wraper, .gis-widget-propertys-buttons-wraper",this._$div).not(d).each(function(){a-=$(this).outerHeight(!0)}),a-=c.outerHeight(!0)-c.height()+d.outerHeight(!0)-d.height()+$(".gis-widget-propertys-title",d).outerHeight(!0)-this._$div.outerHeight(!0)+this._$div.height(),c.css({maxHeight:Math.max(a,40)})},_updateHistory:function(){var a,b=this;this._history=[],this._historyValues=[],a=$("#points-selector li",this._$div),a.each(function(){b._history.push(this),b._historyValues.push({x:b.getPointValue($(".marker-x",$(this))),y:b.getPointValue($(".marker-y",$(this)))})})},_skChanged:Gis.Widget.ListPoints._skChanged,_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0)))},back:function(){var a,b,c=this;this._isStateChanged()&&($("#points-selector li",this._$div).not(this._history).remove(),this._history.forEach(function(d,e){$("#points-selector ol",c._$div).append($(d)),a=void 0!=c._historyValues[e].x?c._historyValues[e].x:"",b=void 0!=c._historyValues[e].y?c._historyValues[e].y:"",c.setHtmlPointSelectorWidgetData($(d),Gis.UI.coordinate(a,b),Gis.UI.coordinate(a,b))}),this._updateColor(),this._updateStyle()),this._updateState()},_clearInfo:function(){this._$infoContainer&&(this._$infoContainer.remove(),this._$infoContainer=void 0)},_clearPolyline:function(){this._deleteLayerConfirm({title:"Вы действительно хотите удалить маршрут?",callback:function(){this.removeLayerFromMap(this.options.dataBinded)},context:this,id:"polyline-remove-dialog"})},_setData:function(){this._updateDataFromPolyline()},_hilightErrors:function(){var a,b,c,d=!1,e=this;return a=$("#points-selector li",this._$div),a.each(function(){b=$(".marker-x",$(this)),c=$(".marker-y",$(this)),d=d||e.checkPoint($(this))}),d=d||!this.getSelectedColor()},_updateCoordinatesState:function(){var a,b;b=this.getValueFromData("isDraggable",!0)?function(){$(".marker-x",$(this)).removeAttr("disabled"),$(".marker-y",$(this)).removeAttr("disabled")}:function(){$(".marker-x",$(this)).attr("disabled","disabled"),$(".marker-y",$(this)).attr("disabled","disabled")},this.isDataEditable()?$(".gis-widget-ico",this._$div).show():$(".gis-widget-ico",this._$div).hide(),a=$("#points-selector li",this._$div),a.each(b)},updateData:function(){this._setData(),this._updateColor(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this),this.options.dataBinded&&this._initPolylineEvents(),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.PolylineProperty.CLASS_NAME),this._updateStyleList()},_xyRowHTML:function(){return"<li class='data-row'>\n<div class=\"gis-point-in-list inline-points\">"+this._HTMLPointSelectorWidget({tag:"span",tagClass:"point-tag",yClass:"marker-input marker-y",xClass:"marker-input marker-x"})+"</div><span class='gis-widget-ico gis-widget-ico-up'></span><span class='gis-widget-ico gis-widget-ico-down'></span><span class='gis-widget-ico gis-widget-ico-remove'></span><span class='gis-widget-ico gis-widget-ico-add'></span>\n</li>\n"},initDataBlock:function(){var a="",b=0;for(b;b<this._minimalPoints;b+=1)a+=this._xyRowHTML();return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='points-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>ППМ</div>\n<div id='points-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ol>\n"+a+"</ol>\n<div class='gis-widget-add-to-end'><span class='gis-widget-ico gis-widget-ico-add'></span></div></div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Цвет</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector()+"</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this.options.dataBinded?"Подтвердить":"Новый")+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_isStateChanged:function(){var a,b=!1,c=this;if(a=$("#points-selector li",this._$div),c._history.length!==a.length)return!0;a.each(function(a){var d=$(this),e=$(".marker-x",d),f=$(".marker-y",d);c.options.dataBinded||(b=b||""!==c.getPointValue(e)),b=b||c._rowChanged(e)||c._rowChanged(f)||c._history[a]&&this!==c._history[a]}),this._typeSelector&&(b=b||this.isStyleChanged());var d=this.getValueFromData("getColor",null,!0);return b=b||this.options.dataBinded&&d!=this.getSelectedColor()},_updateButtonState:function(){var a=this._isStateChanged(),b=this.isDataEditable(),c=this.getValueFromData("isDraggable",!1);this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),$(".gis-button-text",this._$buttonNew).html(this.options.dataBinded&&a?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый"),this.switchButtonState(this._$buttonNew,(c||b)&&a&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,b&&this.options.dataBinded&&this._containerController.getUIAttached().getMap().getLayer(this.options.dataBinded.getId())),this.switchButtonState(this._$buttonRevert,(c||b)&&a)},_newRowXY:function(){var a=$(this._xyRowHTML());return $("#points-selector ol",this._$div).append(a),this._maskInput(),a},_getLastClearPoint:function(){var a,b,c,d,e,f=this._getSelectedRow();if(f)return(e=this.checkRowForClean(f.next()))?e:this.insertRowAfter(f,!0);for(a=$("#points-selector li",this._$div),b=a.length-1;b>=0;b-=1){var g=a[b];if(c=$(".marker-x",g),d=$(".marker-y",g),""!==c.val()||""!==d.val())break;""===c.val()&&""===d.val()&&(e=g)}return e||(e=this._newRowXY()),e},checkRowForClean:function(a){var b,c,d,e=$(a);return e.length>0&&(b=$(".marker-x",e),c=$(".marker-y",e),""===b.val()&&""===c.val()&&(d=e)),d},_insertNewPoint:function(a,b){var c,d,e=this.coordinateToTemplate(a);this._lastRow=this._getLastClearPoint(),b&&this._selectRowInList($(this._lastRow)),c=e.x||"",d=e.y||"",this.setHtmlPointSelectorWidgetData(this._lastRow,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d))},_mapClicked:function(a){(!this.options.dataBinded||this.options.dataBinded.isDraggable()&&this.isDataEditable())&&(this._insertNewPoint(Gis.latLng(a.latLng.latitude,a.latLng.longitude),!0),this.options.dataBinded&&this.options.dataBinded.getColor(!0)===this.getSelectedColor()?(this._calculatePolyline(this._history.length===$("#points-selector li",this._$div).length&&this._containerController.getUIAttached().getMap().hasLayer(this.options.dataBinded)),this.options.dataBinded.setSelectedPoint($("#points-selector li",this._$div).index(this._lastRow),!0)):this._updateState())},_calculatePointData:function(a){var b,c;a&&(c=this.templateToCoordinate(this.getPointValue($(".marker-x",$(a))),this.getPointValue($(".marker-y",$(a)))),b=Gis.latLng(c.y,c.x),this._pointsLatlng.push(b))},_informationHTML:function(){var a;return this._distanceCalculated=this._distanceCalculated||0,this._moving=this._moving||0,a="<li class='gis-widget-info-row gis-widget-polyline-info-row'><span class='title'>Путь :</span><span class='value'>"+this._distanceCalculated.toFixed(2)+"</span></li><li class='gis-widget-info-row gis-widget-polyline-info-row'><span class='title'>Перемещение:</span><span class='value'>"+this._moving.toFixed(2)+"</span></li>",a&&"<ul class='gis-widget-info  gis-widget-polyline-info'>"+a+"</ul>"},_infoContainerHTML:function(a){return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='info-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Информация</div>\n<div id='info-data' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>"+a+"</div>\n</div>\n"},_drawResultCalculation:function(){var a,b;b=this._informationHTML(),b&&(a=$(".gis-widget-polyline-info",this._$div),a.length?a.replaceWith($(b)):(this._$infoContainer=$(this._infoContainerHTML(b)),this._$infoContainer.insertAfter($("."+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS,this._$div))))},_updateDataFromPolyline:function(){var a,b,c,d,e=this.options.dataBinded&&this.options.dataBinded.getPoints(),f=this,g=0;if(b=$("#points-selector li",this._$div),e){if(a=function(a,c){var d,e,h=$(b[c]),i=f.coordinateToTemplate(a.getLatLng());h.length||(h=f._newRowXY()),e=i.y||"",d=i.x||"",f.setHtmlPointSelectorWidgetData(h,Gis.UI.coordinate(d,e),Gis.UI.coordinate(d,e)),f._attachPointDataToRow(h,a,!0),g=c},e.forEach(a),b[g+1])for(c=g+1,d=b.length;d>c;c+=1)this._removeRow($(b[c]));this._calculatePolyline(!0)}else b.each(function(a){a<f._minimalPoints?(f.setHtmlPointSelectorWidgetData($(this),Gis.UI.coordinate("",""),Gis.UI.coordinate("","")),f._detachPointDataFromRow($(this))):f._removeRow($(this))});this._updateHistory()},_initPolylineEvents:function(){this.options.dataBinded&&!this.options.dataBindedEventsInitialized&&(this.options.dataBindedEventsInitialized=!0,this.options.dataBinded.on("change",this._updateDataFromPolyline,this),this.options.dataBinded.on("selected",this._layerSelected,this),this.options.dataBinded.on("unselected",this._layerUnSelected,this))},_deInitPolylineEvents:function(){this.options.dataBinded&&this.options.dataBindedEventsInitialized&&(this.options.dataBindedEventsInitialized=!1,this.options.dataBinded.off("change",this._updateDataFromPolyline,this),this.options.dataBinded.off("selected",this._layerSelected,this),this.options.dataBinded.off("unselected",this._layerUnSelected,this))},_getPathPoints:function(){return this.options.dataBindedPoints.points},_drawPolyline:function(){Gis.extendError()},_calculatePolyline:function(a){var b,c,d,e;c=this,this._hilightErrors()?(c._distanceCalculated=0,c._moving=0):(b=$("#points-selector li",this._$div),this._distanceCalculated=0,this._pointsLatlng=[],this.options.dataBindedPoints={points:[]},b.each(function(f){var g,h,i,j,k=$(this);h=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,k),i=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,k),g=b[f+1],e=c.getPointValue(h),d=c.getPointValue(i),""!==d&&""!==e&&(j=c.templateToCoordinate(d,e),c.setHtmlPointSelectorWidgetData(k,Gis.UI.coordinate(d,e),Gis.UI.coordinate(d,e)),a||c._attachPointDataToRow(k,{latitude:j.y,longitude:j.x}),c.options.dataBindedPoints.points.push(Gis.Util.extend(c._getPoint(k).objectData(),{latitude:j.y,longitude:j.x})),c._calculatePointData(k,g))}),c._moving=c._calculatePointData($(b[0]),$(b[b.length-1]),!0),a||this._drawPolyline(),this._updateHistory()),this._updateState()},_selectRowInList:function(a){var b;return b=$("#points-selector .data-row",this._$div),b.not(a).removeClass("selected"),a&&$(a).addClass("selected"),b},_getSelectedRow:function(){var a=$("#points-selector .data-row.selected",this._$div);return a.length>0?a:void 0},_layerSelected:function(a){var b,c,d=a.additional&&a.additional.markerKey;void 0!==d&&(c=$("#points-selector .data-row",this._$div),b=c[d],$(":focus").blur(),this._selectRowInList(b))},_layerUnSelected:function(){var a;a=$("#points-selector .data-row",this._$div),a.removeClass("selected")},_deInitEvents:function(){this._deInitPolylineEvents();var a=this._containerController.getUIAttached().getMap();a.off("layerselected",this._layerSelected,this),a.off("layerunselected",this._layerUnSelected,this),a.off("stylechanged",this._updateStyleList,this),this._$div.off("click",".gis-widget-ico-up",this._icoUpClick),this._$div.off("click",".gis-widget-ico-down",this._icoDownClick),this._$div.off("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.off("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.off("change",".data-row input, .data-row input",this._textRowChange),this._$div.off("keyup",".data-row input, .data-row input",this._textRowChange),this._$div.off("focus",".data-row input, .data-row input",this._textRowFocus),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_removeRow:function(a){var b=a.parent();$(".data-row",b).length>this._minimalPoints&&a.remove()},_deleteKeyFire:function(a){return $("#points-selector .data-row.selected",this._$div).length&&"text"!==(a.srcElement||a.target).type?(this._removeRow($("#points-selector .data-row.selected",this._$div)),this._updateState(),a.preventDefault(),!1):!0},_initEvents:function(){var a,b=this;this._initPolylineEvents(),a=this._containerController.getUIAttached().getMap(),a.on("layerselected",this._layerSelected,this),a.on("layerunselected",this._layerUnSelected,this),a.on("stylechanged",this._updateStyleList,this),this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b.checkBaseLayer()&&b._calculatePolyline()},this._icoUpClick=this._icoUpClick||function(){if(b.isDataEditable()){var a,c=$(this).parent();a=c.prev(),a.length&&c.insertBefore(a),b._updateState()}},this._icoDownClick=this._icoDownClick||function(){if(b.isDataEditable()){var a,c=$(this).parent();a=c.next(),a.length&&a.insertBefore(c),b._updateState()}},this._icoDeleteClick=this._icoDeleteClick||function(){if(b.isDataEditable()){var a=$(this).parent();b._removeRow(a),b._updateState()}},this.insertRowAfter=function(a,c){var d=$(b._xyRowHTML());return"li"===a[0].tagName.toLowerCase()?c?d.insertAfter(a):d.insertBefore(a):d.appendTo($("ol",a.parent())),b._maskInput(),b._updateState(),d},this._icoPlusClick=this._icoPlusClick||function(){if(b.isDataEditable()){var a=$(this).parent();b.insertRowAfter(a)}},this._deleteFunction=this._deleteFunction||function(){b.isButtonEnable(this)&&b._clearPolyline()},this._textRowChange=this._textRowChange||function(){b._updateState()},this._textRowFocus=this._textRowFocus||function(){if(b.options.dataBinded){var a=$(this).parent();b._selectRowInList(a),b.options.dataBinded.setSelectedPoint($("#points-selector li",this._$div).index(a),!0)}},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._deselectFunction=this._deselectFunction||function(){b.isButtonEnable(this)&&b._containerController.getUIAttached().getMap().clearSelected()},this._KeyUpReturnFunction=this._KeyUpReturnFunction||this.generateEnteredFunction(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||this.generateEnteredFunction(b._returnFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||this.generateEnteredFunction(b._revertFunction),this._$div.on("click",".gis-widget-ico-up",this._icoUpClick),this._$div.on("click",".gis-widget-ico-down",this._icoDownClick),this._$div.on("click",".gis-widget-ico-remove",this._icoDeleteClick),this._$div.on("click",".gis-widget-ico-add",this._icoPlusClick),this._$div.on("change",".data-row input, .data-row input",this._textRowChange),this._$div.on("focus",".data-row input, .data-row input",this._textRowFocus),this._$div.on("keyup",".data-row input, .data-row input",this._textRowChange),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},_initPolyline:function(){this._initPolylineEvents()},_deInitPolyline:function(){this._detachPointDataFromAllRows(),this._deInitPolylineEvents(),this._clearInfo()},bindData:function(a){a!==this.options.dataBinded&&(this.options.dataBinded&&this._deInitPolyline(),Gis.Widget.Propertys.prototype.bindData.call(this,a),this._initPolyline(),this._updateStyleList(),this.updateData())}}),Gis.Widget.PolylineProperty.CLASS_NAME="gis-widget-propertys-polyline",Gis.Widget.PolylineProperty.CENTER_CHANGED=1,Gis.Widget.PolylineProperty.TEXT_CHANGED=3,Gis.Widget.PolylineProperty.BOTH_CHANGED=2,Gis.Widget.PolylineProperty.NOT_CHANGED=0,function(){function a(a,b,c){return a.distanceTo(b,c)}function b(a){return isNaN(x)?isNaN(a):a===x}function c(a){var c=d()+500;if(s&&s.heights)for(var e=0,f=s.heights.length;f>e;e+=1)b(s.heights[e])||(c=Math.max(c,s.heights[e]));return c===-1/0&&(c=1e3),a?c:Math.max(c,E[0],E[1])}function d(){var a=1/0;if(s&&s.heights)for(var c=0,d=s.heights.length;d>c;c+=1)b(s.heights[c])||(a=Math.min(a,s.heights[c]));return 1/0===a&&(a=0),Math.min(0,Math.round(a))}function e(a,b){j=c();var e=.8*b*D/a;z=e/(j-d())}function f(a,b){var c,d=s.heights.length-1;return c=Math.round(d*(a/2+b)/a),s.heights[c]}function g(a,b){var c,d=s.coords.length-1;return c=Math.round(d*(a/2+b)/a),Gis.latLng(s.coords[c])}function h(){-.5>J&&(J=-.5),J>.5&&(J=.5)}function i(a){var b=Math.floor(Math.log(a*(D/n)/z)/Math.log(10)),e=Math.pow(10,b);e=Math.round((c()-d())/e)*Math.pow(10,b-1);var f=e*z*n/D;f>30&&!(e%2)&&(e/=2,f=e*z*n/D),15>f&&(e*=2,f=e*z*n/D);var g=Math.round(d()/e);return e=f,g*=e,{delta:e,start:g}}var j,k,l,m,n,o,p,q,r,s,t,u,v,w=70,x=Gis.config("relief.no-data",0/0),y=0,z=1,A=.5,B=50,C=100,D=6378137,E=[0,0],F=!1,G="rgba(229, 169, 62, 0.8)",H="white",I=5e5,J=0,K=2,L=4,M="blue",N="red",O="green",P=5,Q=document.createElement("canvas"),R="Укажите точки на карте",S=2;Q.width=40,Q.height=40,v=Q.getContext("2d"),v.fillStyle="rgba(60, 60, 60, 0.51)",v.fillRect(0,0,20,20),v.fillRect(20,20,20,20),u=new Image,u.onload=function(){},u.src=Q.toDataURL();var T=function(){document.body.style.cursor="pointer"},U=function(){document.body.style.cursor="default"},V=function(){document.body.style.cursor="n-resize"},W=function(){F=!0};Gis.Widget.ReliefProperty=Gis.Widget.Propertys.extend({options:{position:"bottom",needCheckLayers:!1},_defaultStyle:{color:"black",border:"white",thickness:2,icon:{width:10,type:"circle"}},_type:"relief",getAllHeight:function(){return $(document).height()},resetContainerHeight:function(a){a._$container.parent().css("height",this.getAllHeight()*A)},onAdd:function(a){t=void 0,this._oldHeight=a._$container.parent().css("height"),this.resetContainerHeight(a),Gis.Widget.Propertys.prototype.onAdd.apply(this,arguments),q&&r&&(q.distanceTo(r)<=Gis.config("relief.maxLength",I)?this.doRequest():this.showMessage(this.getMessageLength())),this._updateButtonState(),this.fillPoints()},onRemove:function(){Gis.Widget.Propertys.prototype.onRemove.call(this),this._path&&(this._containerController.getUIAttached().getMap().removeLayer(this._path),this._path.off("dragend",this._dragEnd,this)),this._midleIcon&&this._containerController.getUIAttached().getMap().removeLayer(this._midleIcon),this._containerController._$container.parent().css({height:this._oldHeight})},fillPoints:function(){var a;a=q?this.coordinateToTemplate(q):Gis.UI.coordinate("","",""),this.setHtmlPointSelectorWidgetData(this._$firstPoint,a,a),Gis.Util.isDefine(E[0])&&$(".height input",this._$firstPoint).val(Math.round(E[0])),a=r?this.coordinateToTemplate(r):Gis.UI.coordinate("","",""),this.setHtmlPointSelectorWidgetData(this._$secondPoint,a,a),Gis.Util.isDefine(E[1])&&$(".height input",this._$secondPoint).val(Math.round(E[1])),this._maskInput()},doRequest:function(){if(q&&r){var a=this;this._shodLoader(!0),this._containerController.getUIAttached().getMap().getHeights(q,r,this._$div.width(),function(b){s=b,E[0]=a.wrapHeight(E[0]),E[1]=a.wrapHeight(E[1]),a._shodLoader(!1),window.Kinetic&&a.paint(window.Kinetic)},function(){a._shodLoader(!1),a.showMessage("Данные не получены")})}},_dragEnd:function(a){if(window.Kinetic&&(F||a.rows&&a.rows.indexOf("points")>-1)){this._drawMiddleIcon(),this._timeout&&clearTimeout(this._timeout);var b=this._path.getPoints(),c=this;q=Gis.latLng(b[0].getLatLng()).wrap(),r=Gis.latLng(b[1].getLatLng()).wrap(),this.fillPoints(),this.getPointsFromInput(),p=void 0;var d=q.distanceTo(r)<=Gis.config("relief.maxLength",I);this._shodLoader(d),d?(this.showMessage(!1),this._timeout=setTimeout(function(){c.doRequest(),c._timeout=null},F?0:1e3)):this.showMessage(this.getMessageLength())}F=!1},_drawMiddleIcon:function(){var a;Gis.Util.isDefine(t)&&this._path&&(a=this.getCurrentPosAndDataFromPath(t)),a&&q&&r?(this._midleIcon?this._midleIcon.setData({latitude:a.lat,longitude:a.lng}):(this._midleIcon=Gis.imageLabel({forcePaint:!0,selectable:!1,draggable:!1,id:Gis.Util.generateGUID(),latitude:a.lat,longitude:a.lng,caption:"C",icon:this.getIcon(M),angle:45}),this._midleIcon.setControllableByServer(!1)),this._midleIcon&&!this._containerController.getUIAttached().getMap().hasLayer(this._midleIcon)&&this._containerController.getUIAttached().getMap().addLayer(this._midleIcon),this._paintLengths()):this._midleIcon&&this._containerController.getUIAttached().getMap().hasLayer(this._midleIcon)&&this._containerController.getUIAttached().getMap().removeLayer(this._midleIcon)},getIcon:function(a){var b=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("relief"));return Gis.Util.extend({},b.icon,{color:a,width:3*P})},getPoints:function(){return this._pathPoint1?this._pathPoint1.setData({latitude:q.lat,longitude:q.lng}):(this._pathPoint1=Gis.pathPoint({id:Gis.Util.generateGUID(),forcePaint:!0,selectable:!1,latitude:q.lat,longitude:q.lng,caption:"A",icon:this.getIcon(N)}),this._pathPoint1.on("dragend",W,this)),this._pathPoint2?this._pathPoint2.setData({latitude:r.lat,longitude:r.lng}):(this._pathPoint2=Gis.pathPoint({id:Gis.Util.generateGUID(),forcePaint:!0,selectable:!1,latitude:r.lat,longitude:r.lng,caption:"B",icon:this.getIcon(O)}),this._pathPoint2.on("dragend",W,this)),[this._pathPoint1,this._pathPoint2]},_drawPath:function(){if(q&&r){var a,b,c=this.getPoints();this._path?this._path.setData({points:c}):(b=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("relief")),a={color:b.color,border:b.border,thickness:b.thickness},this._path=Gis.path(Gis.Util.extend({id:Gis.Util.generateGUID(),forcePaint:!0,tacticObjectType:"relief",orthodrome:!0,line:a,draggable:!0,selectable:!1,className:"gis-relief-marker",icon:b.icon,points:c})),this._path.setControllableByServer(!0),this._path.setSelectedStyle(void 0),this._path.on("change",this._dragEnd,this)),this._containerController.getUIAttached().getMap().hasLayer(this._path)||(this._containerController.getUIAttached().getMap().addLayer(this._path),this._pathPoint1.off("dragend"),this._pathPoint1=null,this._pathPoint2.off("dragend"),this._pathPoint2=null)
}else this._path&&this._containerController.getUIAttached().getMap().hasLayer(this._path)&&this._containerController.getUIAttached().getMap().removeLayer(this._path);this._drawMiddleIcon()},_setData:function(){},deactivate:function(){},activate:function(){},updateData:function(){},rotate:function(a,b){var c=-b*Math.PI/180;return{x:a.x*Math.cos(c)-a.y*Math.sin(c),y:a.x*Math.sin(c)+a.y*Math.cos(c)}},initDragPoint:function(a,b,d,e){var f=this,g=d*Math.PI/360;a.dragBoundFunc(function(a){var c=this;this._startPos.y-a.y>b-2*B&&(a.y=this._startPos.y-b+2*B),this._startPos.y-a.y<0&&(a.y=this._startPos.y);var d={x:this._startPos.x-Math.tan(g)*(this._startPos.y-a.y),y:a.y};return e&&setTimeout(function(){e(d,c)},50),d}),a.on("mouseover",T),a.on("mouseout",U),a.on("dragstart",V),a.on("dragend",function(){U(),j!==c()&&Gis.requestAnimationFrame(50)(function(){f.paint(Kinetic)})}),e&&a.on("drag",function(){e(null,this)});var h=function(){this.off("mouseleave.mouseOut mouseout.mouseOut mouseup.mouseOut"),this.on("mousedown.mouseOut",i)},i=function(){this.on("mouseleave.mouseOut mouseout.mouseOut mouseup.mouseOut",h),this.off("mousedown.mouseOut")};a.on("mousedown.mouseOut",i)},_drawGraph:function(a,d){var e,f,g,h,i,j,k,l,m,o=this;if(s&&s.heights){f=s.heights.length,i=[],j=[],k=void 0,g=a/(f-1);var p=z*n/D;for(e=0;f>e;e+=1)l=s.heights[e],b(l)?(l=-D,k=k||{from:e-1}):k&&(k.to=e,j.push(k),k=void 0),h=this.rotate({x:0,y:-n-l*p},-g*e),i.push(h.x),i.push(h.y);if(k&&(k.to=f-1,j.push(k)),m=j.length){var q,r=a/f;for(e=0;m>e;e+=1)q=j[e],this._textLayer.add(new Kinetic.Arc({outerRadius:n,x:0,y:0,fillPatternImage:u,strokeWidth:1,angle:r*(q.to-Math.max(0,q.from)),draggable:!1,rotationDeg:-90+r*Math.max(0,q.from)}))}this._textLayer.add(new Kinetic.Shape({sceneFunc:function(b){b.beginPath();var c={x:0,y:-d},e=o.rotate({x:0,y:-d},-a);b.moveTo(0,0),b.lineTo(c.x,c.y),b.lineTo(i[0],i[1]);for(var f=2,g=i.length;g>f;f+=2)b.lineTo(i[f],i[f+1]);b.lineTo(e.x,e.y),b.closePath(),b.fillStrokeShape(this)},x:0,y:0,points:i,stroke:"#52441A",fillRadialGradientStartRadius:d,fillRadialGradientEndRadius:n+c(!0)*p,fillRadialGradientColorStops:[0,G,.2,"rgba(18, 153, 0, 0.8)",.6,"rgba(223, 223, 0, 0.8)",1,"rgba(223, 0, 0, 0.8)"],strokeWidth:2,width:6}))}},getCurrentPosAndData:function(a){var b=f(a,t*J),c=g(a,t*J),e=z*o/(D-d()),h=this.rotate({x:0,y:-o-(b-d())*e},-t*J);return{currentHeight:Math.round(b),pointPosition:h,coord:c}},getCurrentPosAndDataFromPath:function(a){if(q&&r){p=p||this._path.getOrthodromeArray(q.distanceTo(r)/this._$div.width());var b,c=p.length-1;return b=Math.round(c*(a/2+t*J)/a),Gis.latLng(p[b])}},_drawBottomControl:function(){function a(a){if(a){var b={x:a.x-m,y:a.y-l};J=180*-Math.atan(b.x/b.y)/Math.PI/t}}function b(b){a(b),h(t);var c=e.rotate({x:0,y:d+k},J*t),f=e.rotate({x:0,y:o},J*t);w.points([c.x,l-c.y,f.x,l-f.y]);var g=e.getCurrentPosAndData(t);if(j.text(g.currentHeight+" м"),j.position({x:g.pointPosition.x+K+L,y:g.pointPosition.y+K+l}),q.position({x:g.pointPosition.x+L,y:g.pointPosition.y+l}),q.width(j.width()+2*K),g.coord){var i=e.coordinateToTemplate(g.coord);e.setHtmlPointSelectorWidgetData(e._$middlePoint,i,i)}setTimeout(function(){Gis.requestAnimationFrame(50)(function(){e._drawMiddleIcon()})},50)}h(t);var c,d=n,e=this,f=this.getCurrentPosAndData(t),g=f.currentHeight,i=f.pointPosition,j=new Kinetic.Text({x:i.x+K+L,y:i.y+K+l,text:g+" м",strokeWidth:1,fontSize:14,fontFamily:"Arial",fill:"black"}),p=j.height()+2*K+2*S;j.offsetY(p);var q=new Kinetic.Rect({x:i.x+L,y:i.y+l,width:j.width()+2*K,height:j.height()+2*K,fill:"rgba(255, 255, 255, 0.7)",stroke:"black",strokeWidth:S,cornerRadius:2});if(f.coord){var r=e.coordinateToTemplate(f.coord);e.setHtmlPointSelectorWidgetData(e._$middlePoint,r,r)}q.offsetY(p),J>.5&&(J=.5),c=this.rotate({x:0,y:-d},-J*t);var s=new Kinetic.Circle({x:c.x,y:c.y+l,radius:P,fill:M,stroke:H,strokeWidth:2,draggable:!0});this._drawMiddleIcon(),s.dragBoundFunc(function(a){b(a);var c=e.rotate({x:0,y:d},-t*J);return a={x:m-c.x,y:l-c.y}}),s.on("mouseover",T),s.on("mouseout",U),s.on("dragstart",function(){document.body.style.cursor="e-resize"}),s.on("dragend",function(){U()});var u=this.rotate({x:0,y:d+k},J*t),v=this.rotate({x:0,y:o},J*t),w=new Kinetic.Line({x:0,y:0,points:[u.x,l-u.y,v.x,l-v.y],stroke:"black",fill:"white",dash:[10,2],strokeWidth:1,width:6,draggable:!1});this._layerControlsDraggable.add(w),this._layerControlsDraggable.add(q),this._layerControlsDraggable.add(j),this._layerControlsDraggable.add(s)},showMessage:function(a){var b=$(".help",this._$div);a&&$(" > div",b).html(a),b[a?"removeClass":"addClass"]("hide")},getMessageLength:function(){return"Расстояние между точками не должно превышать "+Gis.config("relief.maxLength",I)/1e3+" километров"},_paintLengths:function(){var a;Gis.Util.isDefine(t)&&this._path&&(a=this.getCurrentPosAndDataFromPath(t)),a&&(this._textLeft=this.setTextLength(this._textLeft,.5-J,Math.round(a.distanceTo(q))+" м",-1),this._textRight=this.setTextLength(this._textRight,-.5-J,Math.round(a.distanceTo(r))+" м",-1))},setTextLength:function(a,b,c,d){var e=b*t/2,f=this.rotate({x:0,y:-n},e);if(f.y+=l,a)a.y(f.y),a.x(f.x),a.text(c),a.wrapper.y(f.y),a.wrapper.x(f.x);else{a=new Kinetic.Text({x:f.x,y:f.y,text:c,fontSize:14,fontFamily:"Arial",fill:"black"});var g=-10;a.offsetY(g),a.wrapper=new Kinetic.Rect({x:f.x,y:f.y,width:a.width()+2*K,height:a.height()+2*K,fill:"rgba(255, 255, 255, 0.9)",stroke:"black",strokeWidth:S,cornerRadius:2}),a.wrapper.offsetY(g+K)}return a.offsetX(-a.width()/2*(d||1)),a.wrapper.width(a.width()+2*K),a.wrapper.offsetX(-a.width()/2*(d||1)+K),a.rotation(-e),a.wrapper.rotation(-e),this._layerControlsDraggable.add(a.wrapper),this._layerControlsDraggable.add(a),a},_doRealPaint:function(b){try{if(this.fillPoints(),!s||!q||!r)return void this._needPoints();if(q.distanceTo(r)>Gis.config("relief.maxLength",I))return void this.showMessage(this.getMessageLength());this.showMessage(!1);var c=this._$div.width(),f=this._$div.height()-w-y,g=this;this._stage?(this._stage.removeChildren(),this._stage.width(c),this._stage.height(f)):this._stage=new b.Stage({container:"container-visibility",width:c,height:f}),this._layer=new b.Layer({height:f});var h=new b.Rect({x:y,y:y,cornerRadius:2,width:c-2*y,height:f,fill:"#F0F0F0",draggable:!1});this._layer.add(h);var j=D-d(),p=a(q,r,j);t=180*p/(Math.PI*j);var u=c-2*C;o=u/Math.sqrt(2-2*Math.cos(Math.PI*t/180)),k=f-2*B,e(o,k);var v=Math.sqrt(o*o-u*u/4);l=f+v-B,m=c/2,n=o-d()*z*o/(D-d()),this._arc=new b.Arc({outerRadius:n,stroke:"black",x:0,y:0,strokeWidth:2,angle:t,dash:[10,10],draggable:!1,rotationDeg:-90-t/2}),this._line1=new b.Line({x:m,y:l,points:[0,-o-k,0,0],stroke:"black",fill:"white",strokeWidth:2,width:6}),this._line2=new b.Line({x:m,y:l,points:[0,-o-k,0,0],stroke:"black",strokeWidth:2,width:6});var x,A=g.rotate({x:0,y:-n-E[0]*z*n/D},t/2),F=g.rotate({x:0,y:-n-E[1]*z*n/D},-t/2),G=new b.Circle({x:A.x,y:A.y+l,radius:P,fill:N,stroke:H,strokeWidth:2,draggable:!0}),J=new b.Circle({x:F.x,y:F.y+l,radius:P,fill:O,stroke:H,strokeWidth:2,draggable:!0}),K=function(a,c){var d=c&&c===G,e=c&&c===J,f={x:G.x(),y:G.y()},h=g.rotate({x:f.x,y:f.y-l},-t/2),i={x:J.x(),y:J.y()},j=g.rotate({x:i.x,y:i.y-l},t/2),k=[f.x,f.y-G.offsetY(),i.x,i.y-J.offsetY()];d?E[0]=Math.round(-(h.y+n)*(D/n)/z):e&&(E[1]=Math.round(-(j.y+n)*(D/n)/z)),x?x.points(k):(x=new b.Line({x:0,y:0,points:k,stroke:"black",strokeWidth:2,tension:1}),g._layerControlsDraggable.add(x)),g.fillPoints()};this.initDragPoint(G,f,t,K),this.initDragPoint(J,f,-t,K),this._layerControls=new b.Layer({height:f,x:m,y:l}),this._layerControlsDraggable=new b.Layer({height:f,x:m,y:0}),this._layerControls.add(this._arc),this._line1.rotateDeg(-t/2),this._line2.rotateDeg(t/2);var L,M,Q=i(f),R=Q.delta,S=Q.start;for(this._textLayer=new b.Layer({height:f,x:m,y:l}),this._textLayer2=new b.Layer({height:f,x:m,y:l});k+(o-n)>S;)L=n+S,this._layer.add(new b.Arc({outerRadius:L,stroke:"#000000",opacity:.5,x:m,y:l,strokeWidth:1,angle:t,draggable:!1,rotationDeg:-90-t/2})),M=new b.Text({x:0,y:-L,text:Math.round(S/z*(D/n)),fontSize:14,fontFamily:"Arial",fill:"black"}),M.offsetX(M.getWidth()+4),M.offsetY(M.getHeight()/2),this._textLayer.add(M),M=new b.Text({x:0,y:-L,text:Math.round(S/z*(D/n)),fontSize:14,fontFamily:"Arial",fill:"black"}),M.offsetX(-4),M.offsetY(M.getHeight()/2),this._textLayer2.add(M),S+=R;this._textLayer.rotate(-t/2),this._textLayer2.rotate(t/2),this._layer.add(this._line1),this._layer.add(this._line2),K(),s&&this._drawGraph(t,o),this._drawBottomControl(),this._paintLengths(),this._layerControlsDraggable.add(G),this._layerControlsDraggable.add(J),this._stage.add(this._layer),this._stage.add(this._textLayer),this._stage.add(this._textLayer2),this._stage.add(this._layerControls),this._stage.add(this._layerControlsDraggable),A=g.rotate({x:0,y:-o},t/2),F=g.rotate({x:0,y:-o},-t/2),J._startPos={x:m+F.x,y:l+F.y},G._startPos={x:m+A.x,y:l+A.y}}catch(T){Gis.Logger.log("Ошибка отрисовки кадра",T)}},paint:function(a){var b=this;setTimeout(function(){Gis.requestAnimationFrame(50)(function(){b._doRealPaint(a)})},40)},_rowPointHtml:function(a){return this._HTMLPointSelectorWidget({tag:"div",yClass:"relief-input relief-y",xClass:"relief-input relief-x"})+(a?"":'<div class="height"><span class="gis-row-name h-name">H</span><input type="number"></div>')},_shodLoader:function(a){this._$loader&&this._$loader[a?"addClass":"removeClass"]("show")},updateWrapperHeight:function(){this._needWithtForPoints>.34*this._$config.width()?(this._$config.addClass("large"),w=this._needHeightForPointsVertical):(w=this._needHeightForPointsHorusontal,this._$config.removeClass("large")),$(".a-wrapper",this._$div).css("height",this._$div.height()-w-y)},draw:function(){var a=this;Gis.Widget.Base.prototype.draw.call(this),this._$div.append('<div class="a-wrapper"><div id="container-visibility"></div><div class="help"><div>'+R+"</div></div>"+Gis.HTML.LOADER_HTML+"</div>"),this._$div.addClass(Gis.Widget.Propertys.CLASS_NAME),this._$loader=$(".windows8",this._$div),this._$config=$('<div id="config"><div class="a-points"><div class="left">'+this._rowPointHtml()+'</div><div class="center">'+this._rowPointHtml(!0)+'</div><div class="right">'+this._rowPointHtml()+"</div></div></div>"),this._$div.append(this._$config),this._$firstPoint=$(".a-points .left",this._$config),this._$secondPoint=$(".a-points .right",this._$config),this._$middlePoint=$(".a-points .center",this._$config),this._needWithtForPoints=0;var b=$(">div",this._$firstPoint),c=6;this._needHeightForPointsVertical=3*b.outerHeight(!0)+c,this._needHeightForPointsHorusontal=b.outerHeight(!0)+c,b.each(function(){a._needWithtForPoints+=$(this).outerWidth(!0)}),$("input",this._$middlePoint).attr("disabled","disabled"),$(".point-direction",this._$middlePoint).addClass("disabled"),this._shodLoader(!window.Kinetic),this.updateData(),this.setBounds(),this._drawPath(),Gis.Util.loadKinetic(function(b){Gis.requestAnimationFrame(100)(function(){a._shodLoader(!1),a.paint(b)})},function(){a.showMessage('Не удалось загрузить kinetic.js. Убедитесь что файл "scripts/kinetic.min.js" существует'),a._shodLoader(!1)})},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.ReliefProperty.CLASS_NAME)},getNeedSize:function(){return[this._$div.outerWidth(!0),200]},preCalculateSize:function(){var a=0;this.resetContainerHeight(this._containerController),$(">div",this._containerController._$container).not(this._$div).each(function(){a+=$(this).outerHeight(!0)}),this._$div.css({height:this._containerController._$container.parent().height()-a-8}),this.updateWrapperHeight()},setBounds:function(){var a=this;this.preCalculateSize(),window.Kinetic&&this._$div.parent().length&&(this._drawTimeout&&clearTimeout(this._drawTimeout),this._drawTimeout=setTimeout(function(){Gis.requestAnimationFrame(100)(function(){a.paint(window.Kinetic)})},100)),$(".dragger",this._containerController._$container.parent()).draggable("option","containment",[0,200,this._$div.width(),this.getAllHeight()-300])},_mapClicked:function(a){var b=!1;q?r||(r=Gis.latLng(a.latLng.latitude,a.latLng.longitude).wrap(),b=!0):(q=Gis.latLng(a.latLng.latitude,a.latLng.longitude).wrap(),b=!0),this.fillPoints(),this.getPointsFromInput(),b&&(p=void 0,F=!0,this._updateButtonState(),this._drawPath())},_isDataCorrect:function(){var a=this.templateToCoordinate(this.getPointValue($(".relief-x",this._$firstPoint)),this.getPointValue($(".relief-y",this._$firstPoint))),b=this.templateToCoordinate(this.getPointValue($(".relief-x",this._$secondPoint)),this.getPointValue($(".relief-y",this._$secondPoint)));return a=""!==a.y&&""!==a.x&&Gis.latLng(a.y,a.x),b=""!==b.y&&""!==b.x&&Gis.latLng(b.y,b.x),a&&b&&a.lat&&b.lat&&a.lng&&b.lng},_isBigDistance:function(a,b){return a&&b&&(Math.abs(a.lat-b.lat)>1e-8||Math.abs(a.lng-b.lng)>1e-8)},_isStateChanged:function(){var a=this.templateToCoordinate(this.getPointValue($(".relief-x",this._$firstPoint)),this.getPointValue($(".relief-y",this._$firstPoint))),b=this.templateToCoordinate(this.getPointValue($(".relief-x",this._$secondPoint)),this.getPointValue($(".relief-y",this._$secondPoint))),c=Gis.latLng(q),d=Gis.latLng(r);return a=""!==a.y&&""!==a.x&&Gis.latLng(a.y,a.x),b=""!==b.y&&""!==b.x&&Gis.latLng(b.y,b.x),q&&r&&(this._isBigDistance(c,a)||this._isBigDistance(d,b)||this.wrapHeight(parseInt($(".height input",this._$firstPoint).val(),10),!0)!==E[0]||this.wrapHeight(parseInt($(".height input",this._$secondPoint).val(),10),!0)!==E[1])||(!q||!r)&&a&&b},_updateButtonState:function(){this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.ReliefProperty.CLEAN_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),this.switchButtonState(this._$buttonRevert,q||r)},initButtonsBlock:function(){return"<ul class='gis-property-buttons-list'>\n<li class='revert'>"+this._buttonHTML(Gis.Widget.ReliefProperty.CLEAN_CLASS_NAME,"Очистить",!0,null,!0)+"</li>\n<li class='delete'>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,void 0,!0,"Закрыть")+"</li>\n</ul>\n"},_deInitEvents:function(){Gis.Widget.Propertys.prototype._deInitEvents.call(this),this._$div.off("change","input",this._returnFunction2),this._$div.off("blur","input",this._returnFunction),this._$div.off("click",".point-direction",this._returnFunction),this._$div.off("keyup","input",this._KeyUpReturnFunction),$("."+Gis.Widget.ReliefProperty.CLEAN_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction});var a=$(".dragger",this._containerController._$container.parent());a.removeClass("show"),a.draggable("destroy"),this._containerController.getUIAttached().off("presizerecalculated",this.preCalculateSize,this)},wrapHeight:function(a,b){return b||a>c()&&(a=c()),a<d()&&(a=d()),a},getPointsFromInput:function(){var a,b,c;return a=this.templateToCoordinate(this.getPointValue($(".relief-x",this._$firstPoint)),this.getPointValue($(".relief-y",this._$firstPoint))),b=this.templateToCoordinate(this.getPointValue($(".relief-x",this._$secondPoint)),this.getPointValue($(".relief-y",this._$secondPoint))),""!==a.x&&""!==a.y&&(c=!q||q.distanceTo(Gis.latLng(a.y,a.x))>1e-8,q=Gis.latLng(a.y,a.x).wrap()),""!==b.x&&""!==b.y&&(c=c||!r||r.distanceTo(Gis.latLng(b.y,b.x))>1e-8,r=Gis.latLng(b.y,b.x).wrap()),p=void 0,c},_needPoints:function(){this._stage&&this._stage.removeChildren(),this.showMessage(R)},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a(),b.stopPropagation()}}var b=this;Gis.Widget.Propertys.prototype._initEvents.call(this),this._returnFunction=this._returnFunction||function(a){if(!a||b.isButtonEnable(this)){var c=b.getPointsFromInput();E[0]=b.wrapHeight(parseInt($(".height input",b._$firstPoint).val(),10),!0),E[1]=b.wrapHeight(parseInt($(".height input",b._$secondPoint).val(),10),!0),F=!0,c?b._drawPath():b.paint(Kinetic),b._updateButtonState()}},this._returnFunction2=function(){b._saveTimeout&&clearTimeout(b._saveTimeout),b._saveTimeout=setTimeout(function(){b._returnFunction()},300)},this._deleteFunction=this._deleteFunction||function(a){(!a||b.isButtonEnable(this))&&(Gis.UI.ActionController.getAction("relief").closeAction(),Gis.UI.ActionController.getAction("select").execute())},this._revertFunction=this._revertFunction||function(a){(!a||b.isButtonEnable(this))&&(q=void 0,r=void 0,p=void 0,b._needPoints(),b.fillPoints(),b._drawPath(),b._updateButtonState())};var c=$(".dragger",this._containerController._$container.parent());c.addClass("show"),c.draggable({handle:"div",cursor:"n-resize",axis:"y",containment:[0,200,this._$div.width(),this.getAllHeight()-300],start:function(a,c){b._dragStarted=c},stop:function(a,c){var d=b._containerController._$container.parent().height();A*=(d+(b._dragStarted.offset.top-c.offset.top))/d,b._dragStarted=void 0,$(this).css("top",0),b._containerController.getUIAttached()._recalculateContainerStyles()}}),this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._returnFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._deleteFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),this._$div.on("change","input",this._returnFunction2),this._$div.on("blur","input",this._returnFunction),this._$div.on("click",".point-direction",this._returnFunction),this._$div.on("keyup","input",this._KeyUpReturnFunction),$("."+Gis.Widget.ReliefProperty.CLEAN_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),this._$div.on("click","."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._deleteFunction),this._$div.on("keyup","."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._KeyUpDeleteFunction),this._containerController.getUIAttached().on("presizerecalculated",this.preCalculateSize,this)},_update:function(){this.updateData(),$($("button",this._$div).not("[disabled=disabled]")[0]).focus()},bindData:function(){},_skChanged:function(){this.fillPoints();var a=this.getCurrentPosAndData(t);if(a&&a.coord){var b=this.coordinateToTemplate(a.coord);this.setHtmlPointSelectorWidgetData(this._$middlePoint,b,b)}Gis.Widget.Propertys.prototype._skChanged.call(this)}}),Gis.Widget.ReliefProperty.CLASS_NAME="gis-widget-propertys-relief",Gis.Widget.ReliefProperty.CLEAN_CLASS_NAME="clean",Gis.Widget.reliefProperty=function(a){return new Gis.Widget.ReliefProperty(a)}}(),Gis.Widget.SectorProperty=Gis.Widget.Propertys.extend({_typeSelector:!0,_type:"sector",_history:[],_defaultStyle:{color:"#AF2D51",border:"white",thickness:2,selectedBorder:"rgb(75, 84, 255)",angleLineColor:"#272727",angleLineBorder:"white",angleLineThickness:2},options:{types:void 0,colors:void 0},initialize:function(a){Gis.Widget.Propertys.prototype.initialize.call(this,a),this._createEventFunctions(),this.options.types=this.options.types||[],this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){this._isStateChanged()&&(this._revertTextData(this._$Xrow),this._revertTextData(this._$Yrow),this._revertTextData(this._$RInnerRow),this._revertTextData(this._$ROutterRow),this._revertTextData(this._$Angle1Row),this._revertTextData(this._$Angle2Row),this._revertTextData(this._$DirectionRow),this._revertTextData(this._$SolutionRow),this._updateStyle()),this.updateData()},_getFinishAngle:function(){var a=this.options.dataBinded&&360-(this.options.dataBinded.getStartAngle()||360)||359;return(a>=0?a:360+a)%360},_getStartAngle:function(){var a=this.options.dataBinded&&this.options.dataBinded.getFinishAngle()||0;return a>=0?a:360+a},_setData:function(a,b){var c,d,e,f,g=this.options.dataBinded&&this.options.dataBinded.getRadius()||0,h=this.options.dataBinded&&this.options.dataBinded.getInnerRadius()||0,i=this._getStartAngle()||0,j=this._getFinishAngle();b=this.options.dataBinded&&this.coordinateToTemplate(b||this.options.dataBinded&&this.options.dataBinded.getLatLng()),e=b&&b.x||"",f=b&&b.y||"",c=this._calculateDirection(this.options.dataBinded),d=this._calculateSolution(this.options.dataBinded),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(e,f),Gis.UI.coordinate(e,f)),this._setValue(this._$RInnerRow,h,h),this._setValue(this._$ROutterRow,g,g),this._setValue(this._$Angle1Row,i,i),this._setValue(this._$Angle2Row,j,j),this._setValue(this._$DirectionRow,c,c),this._setValue(this._$SolutionRow,d,d)},_updateColor:function(){Gis.Widget.Propertys.prototype._updateColor.call(this,this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0)))},_hilightErrors:function(){var a=!1;return a=a||this.checkPoint(this._$CoordinateContainer),a=a||this.checkNumeric(this._$RInnerRow),a=a||this.checkNumeric(this._$Angle2Row),a=a||this.checkNumeric(this._$DirectionRow),a=a||this.checkNumeric(this._$SolutionRow),a=a||this.checkNumeric(this._$ROutterRow),a=a||this.checkNumeric(this._$Angle1Row),$(".gis-color-button.selected",this._$div).data("color")||(a=!0),a},_updateCoordinatesState:function(){this.options.dataBinded&&!this.options.dataBinded.isDraggable()?(this._$Xrow.attr("disabled","disabled"),this._$Yrow.attr("disabled","disabled")):(this._$Xrow.removeAttr("disabled"),this._$Yrow.removeAttr("disabled"))},updateData:function(){this._setData(),this._pressed||this._updateColor(),this._updateState()},_updateParamsState:function(){this.switchInputState(this.isDataEditable(),this._$ROutterRow,this._$RInnerRow,this._$Angle1Row,this._$Angle2Row,this._$DirectionRow,this._$SolutionRow)},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=this._containerController.getUIAttached().getMap().getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&"sector"===a[b[0]].getType()&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.SectorProperty.CLASS_NAME),this._$Xrow=$("#sector-x",this._$div),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Yrow=$("#sector-y",this._$div),this._$ROutterRow=$("#sector-r1",this._$div),this._$RInnerRow=$("#sector-r2",this._$div),this._$Angle1Row=$("#sector-angle1",this._$div),this._$Angle2Row=$("#sector-angle2",this._$div),this._$DirectionRow=$("#sector-direction",this._$div),this._$SolutionRow=$("#sector-solution",this._$div),this._updateStyleList()},_getSolution:function(){return parseFloat(this._$SolutionRow.val())%360},_getDirection:function(){return parseFloat(this._$DirectionRow.val())%360},_anglesByDirection:function(){var a,b;return a=this._getDirection(),b=this._getSolution(),[(a-b/2)%360,a+b/2%360]},_calculateDirection:function(a){var b;return b=a?a.getStartAngle():parseFloat(this._$Angle1Row&&this._$Angle1Row.val())||0,(parseFloat(b)+parseFloat(this._calculateSolution(a))/2)%360},_calculateSolution:function(a){var b,c,d;return b=a?a.getStartAngle():360-(parseFloat(this._$Angle2Row&&this._$Angle2Row.val())||360),c=a?a.getFinishAngle():parseFloat(this._$Angle1Row&&this._$Angle1Row.val())||359,d=(c-b)%360,d>=0?d:360+d},initDataBlock:function(){var a=this.coordinateToTemplate(this.options.dataBinded&&this.options.dataBinded.getLatLng()||null),b=this.options.dataBinded&&this.options.dataBinded.getRadius()||"",c=this.options.dataBinded&&this.options.dataBinded.getInnerRadius()||"",d=this._getStartAngle()||"",e=this._getFinishAngle()||"",f=this._calculateDirection(this.options.dataBinded),g=this._calculateSolution(this.options.dataBinded),h=a.x||"",i=a.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Параметры</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:h,y:i,xID:"sector-x",yID:"sector-y",yClass:"sector-input",xClass:"sector-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row'><span>R внешний:</span>"+this._HTMLRowInput(b,"sector-r1","sector-input")+"</li>\n<li class='data-row'><span>R внутренний:</span>"+this._HTMLRowInput(c,"sector-r2","sector-input")+"</li>\n<li class='data-row'><span>Угол 1:</span>"+this._HTMLRowInput(d,"sector-angle1","sector-input")+"</li>\n<li class='data-row'><span>Угол 2:</span>"+this._HTMLRowInput(e,"sector-angle2","sector-input")+"</li>\n<li class='data-row'><span>Направление:</span>"+this._HTMLRowInput(f,"sector-direction","sector-input")+"</li>\n<li class='data-row'><span>Угол раствора:</span>"+this._HTMLRowInput(g,"sector-solution","sector-input")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='view-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Вид</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+" gis-color-container'>"+this._HTMLcolorSelector(!0,this.options.dataBinded&&this.options.dataBinded.getColor(!0))+this._HTMLstyleSelector("Предустановки")+"</div></div>\n</div>\n"},_onMouseDown:function(a){!this._anglePath&&this.checkBaseLayer()&&(this._cleared=!0,this._pressed=!0,this.options.dataBinded&&(this._cleared=!1,this._containerController.getUIAttached().getMap().unselectLayer(this.options.dataBinded)),this._startPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_cancelDrag:function(){this._anglePath||(this._cleared=!1,this._pressed=!1,this._startPoint=null)},_drawFromDrag:function(){var a,b;this._cleared&&this._currentPoint&&this._startPoint&&(a=this._startPoint.distanceTo(Gis.latLng(this._startPoint.lat,this._currentPoint.lng)),b=this._startPoint.distanceTo(Gis.latLng(this._currentPoint.lat,this._startPoint.lng)),a=Math.max(a,b),this._saveData({x:this._startPoint.lng,y:this._startPoint.lat,r1:a,r2:0,angle:this._$Angle1Row.val(),angle2:this._$Angle2Row.val(),notFireServerEvent:!0}))},_updatePathAngle:function(a){if(this._anglePath){var b,c,d={},e=this._containerController.getUIAttached().getMap();c=this.options.dataBinded.getLatLng(),b=Gis.Widget.SectorProperty._calculatePointAngle(e.latLngToLayerPoint(Gis.latLng(c[0],c[1])),e.latLngToLayerPoint(a)),d[this._firstAngle?"finishAngle":"startAngle"]=b%360,this.options.dataBinded.setData(d,null,!0),this._anglePath.setData({points:[{latitude:c[0],longitude:c[1]},{latitude:a.lat,longitude:a.lng}]})}},_onMouseMove:function(a){this._pressed&&this._cleared&&!this._anglePath?(this._moved=!0,this._currentPoint=Gis.latLng(a.latLng.latitude,a.latLng.longitude),this._drawFromDrag()):this._updatePathAngle(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_finish:function(){this._deactivateAnglePath()},_deactivateAnglePath:function(){this._anglePath&&(this.fireServerEvent(this._firstAngle?"finishAngle":"startAngle"),this._containerController.getUIAttached().getMap().removeLayer(this._anglePath),this._anglePath=void 0)},fireServerEvent:function(a){this.options.dataBinded&&this.options.dataBinded.fire("change",{target:this.options.dataBinded,rows:this.options.dataBinded._getRowsChanged(a)||["innerRadius","radius","startAngle","finishAngle","latitude","longitude","fill"]})},_startAngleMove:function(a){var b,c;this.options.dataBinded&&(this._firstAngle=!0,this._deactivateAnglePath(),b=this.options.dataBinded.getLatLng(),c=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("sector")),this._anglePath=Gis.path({id:Gis.Util.generateGUID(),points:[{latitude:b[0],longitude:b[1]},{latitude:a.lat,longitude:a.lng}],draggable:!1,line:{color:c.angleLineColor,border:c.angleLineBorder,thickness:c.angleLineThickness},selectable:!1}),this._anglePath.setControllableByServer(!1),this._anglePath.addTo(this._containerController.getUIAttached().getMap()))},_finishDrawFromDrag:function(a){this._cleared=!1,this._startPoint=void 0,this._currentPoint=void 0,this.fireServerEvent(),this._anglePath||this._startAngleMove(a)},_onMouseUp:function(a){var b=this._moved&&this._pressed;this._moved=!1,this._pressed=!1,this._anglePath?this._firstAngle?(this._firstAngle=!1,this.fireServerEvent("finishAngle")):this._deactivateAnglePath():b&&this._finishDrawFromDrag(Gis.latLng(a.latLng.latitude,a.latLng.longitude))},_onMouseOut:function(){this._moved&&this._pressed&&this._finishDrawFromDrag(),this._moved=!1,this._pressed=!1},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новый",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,"",this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$RInnerRow)||this._rowChanged(this._$ROutterRow)||this._rowChanged(this._$Angle1Row)||this._rowChanged(this._$Angle2Row)||this._rowChanged(this._$DirectionRow)||this._rowChanged(this._$SolutionRow)||this.options.dataBinded&&this.options.dataBinded.getColor(!0)!==this.getSelectedColor(),a=a||this.options.dataBinded&&this.getSelectedStyle()!==this.options.dataBinded.getTag("style")},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonDeselect=this._$buttonDeselect||$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новый",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&(!this.options.dataBinded||b)&&!this._hilightErrors()),this.switchButtonState(this._$buttonDeselect,this.options.dataBinded),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b)},_deinitDialogs:function(){this._$dialogRemove.dialog("destroy"),$(document.body).remove(this._$dialogRemove),this._$dialogRemove=void 0},_saveData:function(a){function b(a){return 0>a&&(a=360+a%360),a}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;a=a||{},q=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow)),i=a.x||parseFloat(q.x),j=a.y||parseFloat(q.y),l=a.r2||parseFloat(this._$RInnerRow.val()),k=a.r1||parseFloat(this._$ROutterRow.val()),m=a.color||$(".gis-color-button.selected",this._$div).data("color")||this.options.dataBinded&&this.options.dataBinded.getColor(!0),a.angle||a.angle2||this._rowChanged(this._$Angle1Row)||this._rowChanged(this._$Angle2Row)||!this._rowChanged(this._$DirectionRow)&&!this._rowChanged(this._$SolutionRow)||(g=this._anglesByDirection(),a.angle=g[1],a.angle2=-g[0]),n=void 0!==a.angle&&$.isNumeric(a.angle)?a.angle:parseFloat(this._$Angle1Row.val()),o=-(void 0!==a.angle2&&$.isNumeric(a.angle2)?a.angle2:parseFloat(this._$Angle2Row.val())),o=b(o),n=b(n),e={color:this.getSelectedColor()},Gis.Util.isNumeric(i)&&Gis.Util.isNumeric(j)&&m&&void 0!==n&&k?(d={innerRadius:l,radius:k,startAngle:o,finishAngle:n,latitude:j,longitude:i,fill:e,tags:{style:this.getSelectedStyle()}},!a.forceNew&&this.options.dataBinded?this.options.dataBinded.setData(d,null,a.notFireServerEvent):(p=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("sector")),f={color:p.color,border:p.border,thickness:p.thickness},c=Gis.sector(Gis.Util.extend({id:Gis.Util.generateGUID()},d,{draggable:!0,selectable:!0,line:f})),c.setSelectedStyle(Gis.Util.extend({},f,{border:p.selectedBorder})),h=this._containerController.getUIAttached().getMap(),c.addTo(h),h.selectLayer(c)),this._update()):this._updateState()
},_deleteKeyFire:function(a){Gis.UI.DeleteActions.sector.call(this,a)},_mapClicked:function(){},activate:function(){Gis.Widget.Propertys.prototype.activate.call(this)},deactivate:function(){Gis.Widget.Propertys.prototype.deactivate.call(this),this._cancelDrag()},_deInitEvents:function(){var a=this._containerController.getUIAttached().getMap();$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).off({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),$(document.body).off("keyup",this._KeyUpEscFunction),a.off("mouseup",this._onMouseUp,this),a.off("mousedown",this._onMouseDown,this),a.off("mousemove",this._onMouseMove,this),a.off("mouseout",this._onMouseOut,this),a.off("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._deInitEvents.call(this)},_createEventFunctions:function(){var a=this;this._returnFunction=this._returnFunction||function(b){a.isButtonEnable(this)&&a.checkBaseLayer()&&a._saveData(b)},this._escFunction=this._escFunction||function(b){a._finish(b)},this._deleteFunction=this._deleteFunction||function(b){a.isButtonEnable(this)&&a._deleteKeyFire(b)},this._textRowChange=this._textRowChange||function(b){a._updateState(),b.stopPropagation()},this._textRowKeyPress=this._textRowKeyPress||function(){a._updateState()},this._revertFunction=this._revertFunction||function(){a.isButtonEnable(this)&&a.back()},this._deselectFunction=this._deselectFunction||function(){a.isButtonEnable(this)&&a._containerController.getUIAttached().getMap().unselectLayer(a.options.dataBinded)},this._KeyUpReturnFunction=this._KeyUpReturnFunction||this.generateEnteredFunction(a._deleteFunction),this._KeyUpEscFunction=this._KeyUpEscFunction||this.generateEskeyFunction(a._escFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||this.generateEnteredFunction(a._returnFunction),this._KeyUpDeselectFunction=this._KeyUpDeselectFunction||this.generateEnteredFunction(a._deselectFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||this.generateEnteredFunction(a._revertFunction)},_initEvents:function(){var a=this._containerController.getUIAttached().getMap();$(document.body).on("keyup",this._KeyUpEscFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DESELECT_CLASS_NAME,this._$div).on({click:this._deselectFunction,keyup:this._KeyUpDeselectFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction}),a.on("mouseup",this._onMouseUp,this),a.on("mousedown",this._onMouseDown,this),a.on("mousemove",this._onMouseMove,this),a.on("mouseout",this._onMouseOut,this),a.on("stylechanged",this._updateStyleList,this),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a||this._cleared||(this._cleared=!0),a!==this.options.dataBinded&&(this._deactivateAnglePath(),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a&&a.on("change",this.updateData,this),Gis.Widget.Propertys.prototype.bindData.call(this,a),this._updateStyleList(),this.updateData())}}),Gis.UI.DeleteActions.sector=function(a,b){"text"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить сектор?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"sector-remove-dialog"},b)},Gis.Widget.SectorProperty.CLASS_NAME="gis-widget-propertys-sector",Gis.Widget.SectorProperty._calculatePointAngle=function(a,b){var c=a.x,d=a.y,e=b.x,f=b.y,g=Math.atan2(d-f,c-e)/Math.PI*180;return(0>g?g+360:g)-90},Gis.Widget.sectorProperty=function(a){return new Gis.Widget.SectorProperty(a)},function(){"use strict";function a(a,b){return b=b||0,'<div class="additional-row visibility-'+l[b]+'"><label>'+a+"</label>"+e._HTMLRowInput(k.ktr[a],"visibility-"+a,"visibility-input",j[a])+"</div>"}var b,c,d,e,f={relative:"Относительная",absolute:"Абсолютная"},g={visibility:"Прямая видимость",ktr:"Радиодоступность КТР",spk:"Радиодоступность ШПК",custom:"Радиодоступность настройка"},h="visibility-type",i=["Pt","Pr","A","B","freq","gTr","gRec","h_a","d_k"],j={Pt:"Мощность передатчика",Pr:"Чувствительность приемника",A:"Порог тени",B:"Порог полутени",freq:"Частота, МГц",gTr:"КУ передающей антенны",gRec:"КУ приемной антенны",h_a:"Параметры близлежащей местности",d_k:"Параметры близлежащей местности"},k={ktr:{Pt:31,Pr:-180,A:10,B:5,freq:900,gTr:2,gRec:7,h_a:15,d_k:.07},spk:{Pt:35,Pr:-90,A:8,B:5,freq:2350,gTr:2,gRec:20.5,h_a:9,d_k:.09}},l=["left","center","right"];Gis.Widget.VisilibityProperty=Gis.Widget.Propertys.extend({_history:[],options:{types:void 0,colors:void 0},_type:"object",initialize:function(a){e=this,Gis.Widget.Propertys.prototype.initialize.call(this,a),d=Gis.config("gis.ui.areal-accuracy-list")||{0:"Низкая",2:"Средняя",4:"Высокая"},this.options.dataBinded&&this.options.dataBinded.on("change",this.updateData,this)},_updateHistory:function(){this._updateState()},back:function(){!this._isStateChanged(),this.options.dataBinded||this.removeCircle(),this._revertTextData(this._$ALEAL_HEIGHTrow),this._revertTextData(this._$HEIGHTrow),this._revertTextData(this._$radiusRow),this._center=null,this.updateData(),this.options.dataBinded&&this._updateCircleFromWidget()},getCenter:function(){return this._center||this.options.dataBinded&&this.options.dataBinded.getCenter()},_setData:function(a,b,c,d){var f,g,j,k;!d&&this.options.dataBinded&&(this._list.setValueSelected(this.options.dataBinded.getOption("alt-type")),this._list2.setValueSelected(this.options.dataBinded.getOption("areal-alt-type")),this._list3.setValueSelected(this.options.dataBinded.getOption("accuracy")),this._list4.setValueSelected(this.options.dataBinded.getOption(h)),this.isUiDrawed()||this.drawCircle()),b=this.coordinateToTemplate(this.getCenter()),k=this.options.dataBinded&&this.options.dataBinded.getCenter(),k=k&&this.coordinateToTemplate(k)||b,f=b.x||"",g=b.y||"",c=c||this.options.dataBinded&&this.options.dataBinded.getRadius()||L.ReliefControlCircle.getInstance().getRadius(),a=a||this.options.dataBinded&&this.options.dataBinded.getHeight()||this._$HEIGHTrow.val(),j=this.options.dataBinded&&this.options.dataBinded.getArealHeight()||this._$ALEAL_HEIGHTrow.val(),(this.isUiDrawed()||this.options.dataBinded)&&(this._setValue(this._$HEIGHTrow,a,d?this.options.dataBinded&&this.options.dataBinded.getHeight():a),this._setValue(this._$ALEAL_HEIGHTrow,j,d?this.options.dataBinded&&this.options.dataBinded.getArealHeight():j),this._setValue(this._$radiusRow,c,d?this.options.dataBinded&&this.options.dataBinded.getRadius():c)),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(f,g),d?Gis.UI.coordinate(k.x,k.y):Gis.UI.coordinate(f,g)),i.forEach(function(a){var b=$("#visibility-"+a,e._$additionalData),c=e.options.dataBinded&&e.options.dataBinded.getOption(a)||b.val();e._setValue(b,c,c)})},_hilightErrors:function(){return this.checkPoint(this._$CoordinateContainer)||this.checkNumeric(this._$HEIGHTrow)||this.checkNumeric(this._$ALEAL_HEIGHTrow)||this.checkNumeric(this._$radiusRow)||this.checkAdditionalOk()},updateData:function(){this._setData(),this._updateState()},draw:function(){Gis.Widget.Propertys.prototype.draw.call(this);var a=Gis.Map.CURRENT_MAP.getSelected(),b=Object.keys(a);b.length>1?this.options.dataBinded=void 0:b.length&&"text"===a[b[0]].getType()&&(this.options.dataBinded=a[b[0]]),this.updateData()},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.VisilibityProperty.CLASS_NAME),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Xrow=$("#visibility-x",this._$div),this._$Yrow=$("#visibility-y",this._$div),this._$HEIGHTrow=$("#visibility-height",this._$div),this._$ALEAL_HEIGHTrow=$("#visibility-areal-height",this._$div),this._$radiusRow=$("#visibility-radius",this._$div),this._$additionalData=$(".visibility-additional-data",this._$div),this._initLists()},_updateTypeState:function(){this._$additionalData[this.isCustomType()?"addClass":"removeClass"]("show"),Gis.Widget.Propertys.prototype._updateTypeState.call(this)},_getRadioParams:function(){var a=k[this._list4.getValueSelected()],b={},c=this._$additionalData;return a?Gis.Util.extend(b,a):(i.forEach(function(a){b[a]=$("#visibility-"+a,c).val()}),b)},_getTypeName:function(a){return f[a]},_getListValues:function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push({val:b,name:a[b]});return c},_getTypeValues:function(){return this._getListValues(f)},_getVisibilityTypeValues:function(){return this._getListValues(g)},_getAccuracyValues:function(){return this._getListValues(d)},_initLists:function(){var a=this,b=this.options.dataBinded&&this.options.dataBinded.getOption("alt-type")||a._altType||"relative",c=this.options.dataBinded&&this.options.dataBinded.getOption("areal-alt-type")||a._arealType||"relative",e=this.options.dataBinded&&this.options.dataBinded.getOption(h)||a._visibilityType||"visibility",f=this.options.dataBinded&&this.options.dataBinded.getOption("accuracy")||a._accuracy||0;this._list=Gis.HTML.listView({data:this._getTypeValues(),container:$("#type-alt-selector",this._$div)[0],callback:function(b){a._altType=b,a._updateState()},context:this,defaultValue:{val:b,name:this._getTypeName(b)}}),this._list2=Gis.HTML.listView({data:this._getTypeValues(),container:$("#type-areal-alt-selector",this._$div)[0],callback:function(b){a._arealType=b,a._updateState()},context:this,defaultValue:{val:c,name:this._getTypeName(c)}}),this._list3=Gis.HTML.listView({data:this._getAccuracyValues(),container:$("#accuracy-selector",this._$div)[0],callback:function(b){a._accuracy=b,a._updateState()},context:this,defaultValue:{val:f,name:d[f]}}),this._list4=Gis.HTML.listView({data:this._getVisibilityTypeValues(),container:$("#type-selector",this._$div)[0],callback:function(b){a._visibilityType=b,a._updateState()},context:this,defaultValue:{val:e,name:g[e]}})},setBounds:function(){},initDataBlock:function(){var b=this.options.dataBinded&&this.options.dataBinded.getLatLng()||"",c=this.coordinateToTemplate(b),d=c.x||"",e=c.y||"";return"<div class='vis-wrapper'><div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Область</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul id='center-selector' class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:d,y:e,xID:"visibility-x",yID:"visibility-y",yClass:"visibility-input",xClass:"visibility-input"})+"</ul>\n<div>\n<ul>\n<li class='data-row'><span>Радиус:</span>"+this._HTMLRowInput("","visibility-radius","visibility-radius")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Тип</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div>\n<ul>\n<li class='data-row'><span id='type-selector'></span></li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Высота в центральной точке</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div>\n<ul>\n<li class='data-row visibility-h'><span id='type-alt-selector'></span>"+this._HTMLRowInput("0","visibility-height","visibility-input visibility-right")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Высота в расчетных точках</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div>\n<ul>\n<li class='data-row visibility-h'><span id='type-areal-alt-selector'></span>"+this._HTMLRowInput("0","visibility-areal-height","visibility-input")+"</li>\n</ul>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Детальность</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div>\n<ul>\n<li class='data-row visibility-accuracy'><span id='accuracy-selector'></span></li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+" visibility-additional-data'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Параметры радиовидимости</div>\n<div class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><div>\n<ul>\n<li class='data-row visibility-data'>"+a("Pt",0)+a("Pr",1)+a("A",2)+"</li>\n<li class='data-row visibility-data'>"+a("freq",0)+a("gTr",1)+a("B",2)+"</li>\n<li class='data-row visibility-data'>"+a("h_a",0)+a("gRec",1)+a("d_k",2)+"</li>\n</ul>\n</div>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Новая",!this.options.dataBinded)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,"",this.options.dataBinded)+"</li>\n</ul>\n</div>\n"},getSelectedType:function(){return $(".gis-image-type-button.selected",this._$div).data("type")},typeChanged:function(){return this.options.dataBinded&&(this.options.dataBinded.getOption("alt-type")!==this._list.getValueSelected()||this.options.dataBinded.getOption("areal-alt-type")!==this._list2.getValueSelected())},accuracyChanged:function(){return this.options.dataBinded&&this.options.dataBinded.getOption("accuracy")!==this._list3.getValueSelected()},visibilityTypeChanged:function(){var a=this.options.dataBinded;if(a){var b=a.getVisibilityType()!==this._list4.getValueSelected();if(b)return!0;if(this.isCustomType())for(var c=0,d=i.length;d>c;c+=1)if($("#visibility-"+i[c],this._$additionalData).val()!==a.getOption(i[c]))return!0}return!1},isCustomType:function(){return"custom"===this._list4.getValueSelected()},_isStateChanged:function(){var a;return a=this._rowChanged(this._$Xrow)||this._rowChanged(this._$Yrow)||this._rowChanged(this._$HEIGHTrow)||this._rowChanged(this._$radiusRow)||this._rowChanged(this._$ALEAL_HEIGHTrow)||this.typeChanged()||this.accuracyChanged()||this.visibilityTypeChanged()},checkAdditionalOk:function(){var a=this.options.dataBinded;if(a&&this.isCustomType())for(var b=0,c=i.length;c>b;b+=1)if(!Gis.Util.isNumeric($("#visibility-"+i[b],this._$additionalData).val()))return!0;return!1},_updateButtonState:function(){var a,b=this._isStateChanged();this._$buttonNew=this._$buttonNew||$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),this._$buttonRevert=this._$buttonRevert||$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._$buttonDelete=this._$buttonDelete||$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div),a=this.options.dataBinded&&b?"Подтвердить":this.options.dataBinded?"Подтвердить":"Новая",$(".gis-button-text",this._$buttonNew).html(a);var c=this.isDataEditable();this.switchButtonState(this._$buttonNew,c&&!this._hilightErrors()),this.switchButtonState(this._$buttonDelete,c&&this.options.dataBinded&&this.options.dataBinded.isEditableByUser()),this.switchButtonState(this._$buttonRevert,c&&b),this._$div.tooltip("close")},_mouseDown:function(a){e.checkBaseLayer()&&!e.isUiDrawed()&&(this.setDraggableEnabled(!1),c=a,e.drawCircle(a),this.on("mousemove",e._mouseMove,this))},_mouseMove:function(a){c&&(e.drawCircle(c,a),this.on("mouseup",e._mouseUp,this))},_mouseUp:function(a){e.drawCircle(c,a),c=null,this.setDraggableEnabled(!0),this.off("mouseup",e._mouseUp,this),this.off("mousemove",e._mouseMove,this)},_saveData:function(a,c,d,e){var f,g,i=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=a||i.x,c=c||i.y,e=e||this._$radiusRow.val(),d=d||this._$HEIGHTrow.val(),f=this._$ALEAL_HEIGHTrow.val(),Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(c)&&Gis.Util.isNumeric(d)&&Gis.Util.isNumeric(e)?(this.drawCircle(),g={alt:d,"areal-alt":f,"alt-type":this._list.getValueSelected(),"areal-alt-type":this._list2.getValueSelected(),accuracy:this._list3.getValueSelected(),radius:e,center:Gis.latLng(c,a)},Gis.Util.extend(g,this._getRadioParams()),g[h]=this._list4.getValueSelected(),b?b.setData(g):b=Gis.visibilitymap(Gis.extend({id:Gis.Util.generateGUID(),selectable:!0},g)),Gis.Map.CURRENT_MAP.hasLayer(b)||b.addTo(Gis.Map.CURRENT_MAP),Gis.Map.CURRENT_MAP.selectLayer(b),this._updateState()):this._updateState()},dragend:function(){this._center=L.ReliefControlCircle.getInstance().getCenter(),this._radius=Math.round(L.ReliefControlCircle.getInstance().getRadius()),this._setData(null,this._center,this._radius,!0),this._updateState()},_deleteKeyFire:function(a){Gis.UI.DeleteActions.visibility.call(this,a)},removeCircle:function(){Gis.Map.CURRENT_MAP.options.provider.map.removeLayer(L.ReliefControlCircle.getInstance())},onRemove:function(){this.removeCircle(),Gis.Widget.Propertys.prototype.onRemove.call(this)},drawCircle:function(a,b){var c=this;b=b||a,Gis.Util.loadKinetic(function(){L.ReliefControlCircle.getInstance(!c.options.dataBinded&&a&&a.latLng&&{center:L.latLng(a.latLng.latitude,a.latLng.longitude),draggedPoint:L.latLng(b.latLng.latitude,b.latLng.longitude)}).addTo(Gis.Map.CURRENT_MAP.options.provider.map)})},_mapClicked:function(a){this.isUiDrawed()||this.drawCircle(a)},isUiDrawed:function(){return Gis.Map.CURRENT_MAP.options.provider.map.hasLayer(L.ReliefControlCircle.getInstance())},_deInitEvents:function(){L.ReliefControlCircle.getInstance().off("add",this.dragend,this),L.ReliefControlCircle.getInstance().off("dragend",this.dragend,this),this._$div.off("click",".point-direction",this.updateCircleFromWidget),$(".data-row input",this._$div).off({change:this._textRowChange,keyup:this._textRowChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).off({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction});var a=this._containerController.getUIAttached().getMap();a.off("mousedown",this._mouseDown,a),Gis.Widget.Propertys.prototype._deInitEvents.call(this),this._destroyColorPicker($("#object-new-dialog"))},_updateCircleFromWidget:function(){if(!this._hilightErrors()){var a=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));L.ReliefControlCircle.getInstance().setOptions({center:L.latLng(a.y,a.x),radius:this._$radiusRow.val()},!0)}},_initEvents:function(){function a(a){return function(b){var c=13;(b.keyCode===c||b.charCode===c+"")&&a()}}var b=this;this.updateCircleFromWidget=function(){b._updateCircleFromWidget()},L.ReliefControlCircle.getInstance().on("add",this.dragend,this),L.ReliefControlCircle.getInstance().on("dragend",this.dragend,this),this._returnFunction=this._returnFunction||function(){b.isButtonEnable(this)&&b.checkBaseLayer()&&b._saveData()},this._deleteFunction=this._deleteFunction||function(a){b.isButtonEnable(this)&&b._deleteKeyFire(a)},this._textRowChange=this._textRowChange||function(a){b._updateState(),a.stopPropagation(),b.updateCircleFromWidget()},this._textRowKeyPress=this._textRowKeyPress||function(){b._updateState()},this._revertFunction=this._revertFunction||function(){b.isButtonEnable(this)&&b.back()},this._KeyUpReturnFunction=this._KeyUpReturnFunction||a(b._deleteFunction),this._KeyUpDeleteFunction=this._KeyUpDeleteFunction||a(b._returnFunction),this._KeyUpRevertFunction=this._KeyUpRevertFunction||a(b._revertFunction),$(".data-coll input, .data-row input",this._$div).on({change:this._textRowChange,keyup:this._textRowChange,keydown:this.keyPressPreventDefault}),this._$div.on("click",".point-direction",this.updateCircleFromWidget),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._returnFunction,keyup:this._KeyUpReturnFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunction,keyup:this._KeyUpRevertFunction}),$("."+Gis.Widget.Propertys.BUTTON_DELETE_CLASS_NAME,this._$div).on({click:this._deleteFunction,keyup:this._KeyUpDeleteFunction});var c=this._containerController.getUIAttached().getMap();c.on("mousedown",this._mouseDown,c),Gis.Widget.Propertys.prototype._initEvents.call(this)},_update:function(){this.updateData()},bindData:function(a){$(":focus").blur(),a!==this.options.dataBinded&&(this.options.dataBinded&&this.options.dataBinded.off("change",this.updateData,this),a?a.on("change",this.updateData,this):this.removeCircle(),Gis.Widget.Propertys.prototype.bindData.call(this,a),this.updateData())}}),Gis.UI.DeleteActions.visibility=function(a,b){var c=this;"visibility"!==(a.srcElement||a.target).type&&this._deleteLayerConfirm({title:"Вы действительно хотите удалить область видимости?",callback:function(){c.removeLayerFromMap(b||c.options.dataBinded)},context:this,id:"visibility-remove-dialog"},b)},Gis.Widget.VisilibityProperty.CLASS_NAME="gis-widget-propertys-visibility",Gis.Widget.visilibityProperty=function(a){return e||new Gis.Widget.VisilibityProperty(a)}}(),Gis.Widget.ZoomProperty=Gis.Widget.Propertys.extend({_type:"zoom",includes:Gis.Widget.ZoomBehavior,options:{needCheckLayers:!1},_history:[],_updateHistory:function(){this._updateButtonState()},back:function(){var a,b=this._containerController.getUIAttached().getMap();this._isStateChanged()?(this.revertHtmlPointSelectorWidgetData(this._$CoordinateContainer),this._list.setValueSelected(b.getZoom()),this._newZoom=b.getZoom()):(a=this._history.pop(),a&&(this.setZoomAndCenter(a.zoom,a.center),this._setData(a.zoom,a.center))),this._updateButtonState()},setZoomAndCenter:function(a,b){var c=this._containerController.getUIAttached().getMap();Gis.Util.isNumeric(a)&&a!==c.getZoom()?(c.setZoom(a),this._centerToSet=b):(this._centerToSet=null,c.setCenter(b,!0))},_updateCenter:function(){var a,b,c,d,e=this.templateToCoordinate(this.getPointValue(this._$Xrow),this.getPointValue(this._$Yrow));a=e.x,b=e.y,Gis.Util.isNumeric(a)&&Gis.Util.isNumeric(b)?(c=Gis.latLng(b,a),d=this._containerController.getUIAttached().getMap(),this._updateHistory({center:d.getCenter(),zoom:d.getZoom()}),this.setZoomAndCenter(this._newZoom,c)):Gis.Logger.log("ERROR UPDATE CENTER","x = "+a+" | y = "+b)},_setNewZoom:function(a){this._updateHistory({zoom:this._containerController.getUIAttached().getMap().getZoom()}),this._containerController.getUIAttached().getMap().setZoom(a)},zoomSelected:function(a){this._newZoom=parseFloat(a),this._updateButtonState()},_setData:function(a,b){var c,d;b=this.coordinateToTemplate(b||this._containerController.getUIAttached().getMap().getCenter()),a=a||this._containerController.getUIAttached().getMap().getZoom(),c=b.x||"",d=b.y||"",this._newZoom=a,this._list.setValueSelected(a),this.setHtmlPointSelectorWidgetData(this._$CoordinateContainer,Gis.UI.coordinate(c,d),Gis.UI.coordinate(c,d))},updateData:function(a){a&&"zoomend"===a.type&&this._centerToSet&&this.setZoomAndCenter(null,this._centerToSet),this._setData(),this._updateButtonState()},_initZoomList:function(){var a=this.getConvertedZoom();this._list=Gis.HTML.listView({data:this._getZoomValues(),container:$("#zoom-selector",this._$div)[0],callback:this.zoomSelected,context:this,defaultValue:{val:this._containerController.getUIAttached().getMap().getZoom(),name:a}})},initHTML:function(){Gis.Widget.Propertys.prototype.initHTML.call(this),this._$div.addClass(Gis.Widget.ZoomProperty.CLASS_NAME),this._$Xrow=$("#zoom-x",this._$div),this._$CoordinateContainer=$("#center-selector",this._$div),this._$Yrow=$("#zoom-y",this._$div),this._initZoomList(),this._setData()},initDataBlock:function(){var a=this.coordinateToTemplate(this._containerController.getUIAttached().getMap().getCenter()),b=a.x||"",c=a.y||"";return"<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='center-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Текущие координаты центра</div>\n<div id='center-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'><ul class='inline-points'>\n"+this._HTMLPointSelectorWidget({tag:"li",tagClass:"data-coll",x:b,y:c,xID:"zoom-x",yID:"zoom-y",yClass:"zoom-input",xClass:"zoom-input"})+"</ul>\n</div>\n</div>\n<div class='"+Gis.Widget.Propertys.DATA_WRAPER_CLASS+"'>\n<div id='zoom-title' class='"+Gis.Widget.Propertys.DATA_TITLE_CLASS+"'>Текущий масштаб</div>\n<div id='zoom-selector' class='"+Gis.Widget.Propertys.DATA_BLOCK_CLASS+"'>\n</div>\n</div>\n"},initButtonsBlock:function(){return"<div class='"+Gis.Widget.Propertys.BUTTONS_WRAPER_CLASS+"'>\n<ul class='gis-property-buttons-list'>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,"Перейти")+"</li>\n<li>"+this._buttonHTML(Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME)+"</li>\n</ul>\n</div>\n"},_mapClicked:function(){},_isStateChanged:function(){var a,b,c;return a=this._rowChanged(this._$Xrow),b=this._rowChanged(this._$Yrow),c=a||b?Gis.Widget.ZoomProperty.CENTER_CHANGED:Gis.Widget.ZoomProperty.NOT_CHANGED,c=this._containerController.getUIAttached().getMap().getZoom()!==this._newZoom?c?Gis.Widget.ZoomProperty.BOTH_CHANGED:Gis.Widget.ZoomProperty.ZOOM_CHANGED:c},_updateButtonState:function(){var a=this._isStateChanged();this.switchButtonState($("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div),this._history.length||a),this.switchButtonState($("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div),a),$("#center-title",this._$div).html(a===Gis.Widget.ZoomProperty.BOTH_CHANGED||a===Gis.Widget.ZoomProperty.CENTER_CHANGED?"Новые координаты центра":"Текущие координаты центра"),$("#zoom-title",this._$div).html(a===Gis.Widget.ZoomProperty.BOTH_CHANGED||a===Gis.Widget.ZoomProperty.ZOOM_CHANGED?"Новый масштаб":"Текущий масштаб")},_deInitEvents:function(){Gis.Widget.Propertys.prototype._deInitEvents.call(this);var a=this._containerController.getUIAttached().getMap();a.off("zoomend moveend",this.updateData,this),a.off("tilelayerchanged",this._initZoomList,this),$(".data-row input",this._$div).off({keypress:this._keyupUpdateFunction,change:this._inputChange}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).off({click:this._updateStateFunc,keypress:this._keyupUpdateFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).off({click:this._revertFunc,keypress:this._keyupRevertFunction})},_initEvents:function(){var a,b=this;Gis.Widget.Propertys.prototype._initEvents.call(this),this._updateStateFunc=this._updateStateFunc||function(){b.isButtonEnable(this)&&b._updateCenter()},this._inputChange=this._inputChange||function(){b._updateButtonState()},this._revertFunc=this._revertFunc||function(){b.isButtonEnable(this)&&b.back()},this._keyupUpdateFunction=this._keyupUpdateFunction||function(a){if(b.isButtonEnable(this)){var c=13;a.keyCode===c||a.charCode===c+""?b._updateStateFunc():b._updateButtonState(),a.stopPropagation()}},this._keyupRevertFunction=this._keyupRevertFunction||function(a){var c=13;!b.isButtonEnable(this)||a.keyCode!==c&&a.charCode!==c+""||b.back()},a=this._containerController.getUIAttached().getMap(),a.on("zoomend moveend",this.updateData,this),a.on("tilelayerchanged",this._initZoomList,this),$(".data-row input",this._$div).on({change:this._inputChange,keyup:this._keyupUpdateFunction,keydown:this.keyPressPreventDefault}),$("."+Gis.Widget.Propertys.BUTTON_RETURN_CLASS_NAME,this._$div).on({click:this._updateStateFunc,keyup:this._keyupUpdateFunction}),$("."+Gis.Widget.Propertys.BUTTON_REVERT_CLASS_NAME,this._$div).on({click:this._revertFunc,keyup:this._keyupRevertFunction})}}),Gis.Widget.ZoomProperty.CLASS_NAME="gis-widget-propertys-zoom",Gis.Widget.ZoomProperty.CENTER_CHANGED=1,Gis.Widget.ZoomProperty.ZOOM_CHANGED=3,Gis.Widget.ZoomProperty.BOTH_CHANGED=2,Gis.Widget.ZoomProperty.NOT_CHANGED=0,Gis.Widget.zoomProperty=function(a){return new Gis.Widget.ZoomProperty(a)},Gis.Widget.MoveProperty=Gis.Widget.ZoomProperty.extend({_type:"move"}),Gis.Widget.moveProperty=function(a){return new Gis.Widget.MoveProperty(a)},Gis.Widget.PathProperty=Gis.Widget.PolylineProperty.extend({_type:"path",_removePolyline:function(a){var b=a.target;b.off("remove",this._removePolyline,this)},_clearPolyline:function(){Gis.UI.DeleteActions.path.call(this,{srcElement:{}},this.options.dataBinded)},_calculatePointData:function(a,b){var c,d,e,f,g=0;return a&&(e=this.templateToCoordinate(this.getPointValue($(".marker-x",$(a))),this.getPointValue($(".marker-y",$(a)))),c=Gis.latLng(e.y,e.x),this._pointsLatlng.push(c),b&&(f=this.templateToCoordinate(this.getPointValue($(".marker-x",$(b))),this.getPointValue($(".marker-y",$(b)))),d=Gis.latLng(f.y,f.x),g=c.distanceTo(d))),g},_drawPolyline:function(){var a,b;b=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("path")),a={color:this.getSelectedColor()},b.icon.color=this.getSelectedColor(),this.options.dataBinded?(a=Gis.Util.extend({},this.options.dataBinded.getOption("line").options,a),this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},a,{border:b.selectedBorder})),this.options.dataBinded.setData(Gis.Util.extend({},{line:a,icon:b.icon,points:this._getPathPoints()}))):(a.thickness=b.thickness,a.border=b.border,this.options.dataBinded=Gis.path(Gis.Util.extend({id:Gis.Util.generateGUID(),line:a,draggable:!0,selectable:!0,icon:b.icon,points:this._getPathPoints()})),this.options.dataBinded.setCourseEnable(!0),this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},a,{border:b.selectedBorder}))),this._containerController.getUIAttached().getMap().hasLayer(this.options.dataBinded)||(this.options.dataBinded.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(this.options.dataBinded)),this._initPolylineEvents()},_calculatePolyline:function(a){var b,c,d,e,f,g,h,i;c=this,this._hilightErrors()?(c._distanceCalculated=0,c._moving=0):(b=$("#points-selector li",this._$div),this._distanceCalculated=0,this._pointsLatlng=[],this.options.dataBindedPoints={points:[]},b.each(function(a){e=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_Y_SEPARATED,$(this)),f=$("."+Gis.Widget.Base.POSITION_VALUE_CLASS_X_SEPARATED,$(this)),h=c.getPointValue(f),i=c.getPointValue(e),g=c.templateToCoordinate(h,i),d=b[a+1],c._attachPointDataToRow($(this),{latitude:g.y,longitude:g.x}),c.options.dataBindedPoints.points.push(Gis.Util.extend(c._getPoint($(this)).objectData(),{latitude:g.y,longitude:g.x})),c._distanceCalculated+=c._calculatePointData($(this),d)}),c._moving=c._calculatePointData($(b[0]),$(b[b.length-1]),!0),a||this._drawPolyline(),this._updateHistory()),this._drawResultCalculation(),this._updateState()},_updateDataFromPolyline:function(){var a,b,c,d,e=this.options.dataBinded&&this.options.dataBinded.getPoints(),f=this,g=0;if(b=$("#points-selector li",this._$div),e&&e.length){if(a=function(a,c){var d,e,h=$(b[c]),i=f.coordinateToTemplate(a.getLatLng());
h.length||(h=f._newRowXY()),e=i.y||"",d=i.x||"",f.setHtmlPointSelectorWidgetData(h,Gis.UI.coordinate(d,e),Gis.UI.coordinate(d,e)),f._attachPointDataToRow(h,a,!0),g=c},e.forEach(a),b[g+1])for(c=g+1,d=b.length;d>c;c+=1)this._removeRow($(b[c]));this._calculatePolyline(!0)}else b.each(function(a){a<f._minimalPoints?(f.setHtmlPointSelectorWidgetData($(this),Gis.UI.coordinate("",""),Gis.UI.coordinate("","")),f._detachPointDataFromRow($(this))):f._removeRow($(this))});this._updateHistory()},_deInitEvents:function(){Gis.Widget.PolylineProperty.prototype._deInitEvents.call(this),this.options.dataBinded&&this.options.dataBinded.on("remove",this._removePolyline,this)},_initEvents:function(){this.options.dataBinded&&this.options.dataBinded.off("remove",this._removePolyline,this),Gis.Widget.PolylineProperty.prototype._initEvents.call(this)}}),Gis.UI.DeleteActions.path=function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить маршрут?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded,b||this.options.dataBinded)},context:this,id:"path-remove-dialog"},b)},Gis.Widget.pathProperty=function(a){return new Gis.Widget.PathProperty(a)},Gis.Widget.PolygonProperty=Gis.Widget.PolylineProperty.extend({_typeSelector:!0,_type:"polygon",_minimalPoints:3,_clearPolyline:function(){Gis.UI.DeleteActions.polygon.call(this)},_drawPolyline:function(){var a,b,c;c=Gis.Util.extend(this._defaultStyle,this._containerController.getUIAttached().getStyle("polygon")),a={color:c.color,border:c.border,thickness:c.thickness},b={color:this.getSelectedColor()},c.icon.color=this.getSelectedColor(),this.options.dataBinded?(this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},{color:this.options.dataBinded.getLineColor(),border:c.selectedBorder,thickness:a.thickness})),this.options.dataBinded.setData(Gis.Util.extend({},{fill:b,icon:c.icon,points:this._getPathPoints(),tags:{style:this.getSelectedStyle()}}))):(this.options.dataBinded=Gis.polygon(Gis.Util.extend({id:Gis.Util.generateGUID(),fill:b,line:a,draggable:!0,selectable:!0,icon:c.icon,points:this._getPathPoints(),tags:{style:this.getSelectedStyle()}})),this.options.dataBinded.setSelectedStyle(Gis.Util.extend({},a,{border:c.selectedBorder}))),this._containerController.getUIAttached().getMap().hasLayer(this.options.dataBinded)||(this.options.dataBinded.addTo(this._containerController.getUIAttached().getMap()),this._containerController.getUIAttached().getMap().selectLayer(this.options.dataBinded)),this._initPolylineEvents()}}),Gis.UI.DeleteActions.polygon=function(a,b){this._deleteLayerConfirm({title:"Вы действительно хотите удалить полигон?",callback:function(){this.removeLayerFromMap(b||this.options.dataBinded)},context:this,id:"polygon-remove-dialog"},b)},Gis.Widget.polygonProperty=function(a){return new Gis.Widget.PolygonProperty(a)},L.LabelMarker=L.Marker.extend({options:{clickable:!0},changeIcon:function(a){this.options.icon=a,this._map&&this._changeIcon()},setLabel:function(a){this._icon&&(this._icon.lastChild.innerHTML=a,this._icon.lastChild.style.display="block")},setTitle:function(a){this.options.title=a,this._icon.title=a},_changeIcon:function(){var a=this.options,b=this._map,c=b.options.zoomAnimation&&b.options.markerZoomAnimation,d=c?"leaflet-zoom-animated":"leaflet-zoom-hide";this._icon&&(this._icon=a.icon.changeIcon(this._icon),L.DomUtil.addClass(this._icon,d),L.DomUtil.addClass(this._icon,"leaflet-clickable"))}}),L.LabelMarkerIcon=L.Icon.extend({_createImg:function(a){var b;if(L.Browser.ie6)b=document.createElement("div"),b.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+a+'")';else{b=document.createElement("div");var c=document.createElement("img"),d=document.createElement("div");c.src=a,d.className="via-counter",d.innerHTML="",b.appendChild(c),b.appendChild(d)}return b},changeIcon:function(a){return this._changeIcon("icon",a)},changeShadow:function(a){return this.options.shadowUrl?this._changeIcon("shadow",a):null},_changeIcon:function(a,b){var c=this._getIconUrl(a);if(!c){if("icon"===a)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var d=this._changeImg(c,b);return this._setIconStyles(d,a),d},_changeImg:function(a,b){return L.Browser.ie6?b.style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+a+'")':b.firstChild.src=a,b}});var OSRM={};OSRM.VERSION="0.1.11",OSRM.DATE="131122",OSRM.CONSTANTS={},OSRM.DEFAULTS={},OSRM.GLOBALS={},OSRM.Control={},OSRM.G=OSRM.GLOBALS,OSRM.C=OSRM.CONSTANTS,OSRM.DEFAULTS={ROUTING_ENGINES:[{url:Gis.config(Gis.GEO_ROUTING_URL,"http://router.project-osrm.org/viaroute"),timestamp:Gis.config(Gis.GEO_TIMESTAMP_URL,"http://router.project-osrm.org/timestamp"),metric:0,label:"ENGINE_0"}],WEBSITE_URL:document.URL.replace(/#*(\?.*|$)/i,""),HOST_GEOCODER_URL:Gis.config(Gis.GEO_FORWARD_SEARCH_URL,"http://nominatim.openstreetmap.org/search"),HOST_REVERSE_GEOCODER_URL:Gis.config(Gis.GEO_REVERSE_SEARCH_URL,"http://nominatim.openstreetmap.org/reverse"),HOST_SHORTENER_URL:Gis.config(Gis.GEO_SHORTEN_URL,"http://map.project-osrm.org/shorten/"),SHORTENER_PARAMETERS:"%url&jsonp=%jsonp",SHORTENER_REPLY_PARAMETER:"ShortURL",ROUTING_ENGINE:0,DISTANCE_FORMAT:0,GEOCODER_BOUNDS:"",ZOOM_LEVEL:14,HIGHLIGHT_ZOOM_LEVEL:16,JSONP_TIMEOUT:1e4,EDITOR_MIN_ZOOM_LEVEL:16,JOSM_MIN_ZOOM_LEVEL:16,NOTES_MIN_ZOOM_LEVEL:8,ONLOAD_ZOOM_LEVEL:5,ONLOAD_LATITUDE:48.84,ONLOAD_LONGITUDE:10.1,ONLOAD_SOURCE:"",ONLOAD_TARGET:"",LANGUAGE:"ru",LANGUAGE_USE_BROWSER_SETTING:!0,LANUGAGE_ONDEMAND_RELOADING:!0,LANGUAGE_SUPPORTED:[{encoding:"en",name:"English"},{encoding:"bg",name:"Български"},{encoding:"ca",name:"Català"},{encoding:"cs",name:"Česky"},{encoding:"de",name:"Deutsch"},{encoding:"da",name:"Dansk"},{encoding:"el",name:"Ελληνικά"},{encoding:"eo",name:"Esperanto"},{encoding:"es",name:"Español"},{encoding:"fi",name:"Suomi"},{encoding:"fr",name:"Français"},{encoding:"it",name:"Italiano"},{encoding:"ja",name:"日本人"},{encoding:"ka",name:"ქართული"},{encoding:"lv",name:"Latviešu"},{encoding:"nb",name:"Bokmål"},{encoding:"pl",name:"Polski"},{encoding:"pt",name:"Portugues"},{encoding:"ro",name:"Română"},{encoding:"ru",name:"Русский"},{encoding:"sk",name:"Slovensky"},{encoding:"sv",name:"Svenska"},{encoding:"ta",name:"தமிழ்"},{encoding:"tr",name:"Türkçe"},{encoding:"uk",name:"Українська"}],TILE_SERVERS:[{display_name:"Mapbox Terrain",url:"http://{s}.tiles.mapbox.com/v3/dennisl.map-dfbkqsr2/{z}/{x}/{y}.png",attribution:'Data © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (ODbL), Imagery © <a href="http://mapbox.com/">MapBox</a>',options:{maxZoom:18}},{display_name:"Mapbox Labelled Satellite",url:"http://{s}.tiles.mapbox.com/v3/dennisl.map-6g3jtnzm/{z}/{x}/{y}.png",attribution:'Data © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (ODbL), Imagery © <a href="http://mapbox.com/">MapBox</a>',options:{maxZoom:18}},{display_name:"Mapbox Satellite",url:"http://{s}.tiles.mapbox.com/v3/dennisl.map-inp5al1s/{z}/{x}/{y}.png",attribution:'Data © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (ODbL), Imagery © <a href="http://mapbox.com/">MapBox</a>',options:{maxZoom:18}},{display_name:"osm.org",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Data © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (ODbL), Imagery © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (CC-BY-SA)',options:{maxZoom:18}},{display_name:"osm.de",url:"http://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",attribution:'Data © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (ODbL), Imagery © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (CC-BY-SA)',options:{maxZoom:18}},{display_name:"MapQuest",url:"http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",attribution:'Data © <a href="http://www.openstreetmap.org/copyright/en">OpenStreetMap</a> contributors (ODbL), Imagery © <a href="http://www.mapquest.de/">MapQuest</a>',options:{maxZoom:18,subdomains:"1234"}}],OVERLAY_SERVERS:[{display_name:"Small Components",url:"http://tools.geofabrik.de/osmi/tiles/routing_i/{z}/{x}/{y}.png",attribution:"",options:{}}],NOTIFICATIONS:{LOCALIZATION:18e5,CLICKING:6e4,DRAGGING:12e4,MAINTENANCE:!1},OVERRIDE_MAINTENANCE_NOTIFICATION_HEADER:void 0,OVERRIDE_MAINTENANCE_NOTIFICATION_BODY:void 0},function(){var a=navigator.userAgent;OSRM.Browser={FF3:a.search(/Firefox\/3/),IE6_7:a.search(/MSIE (6|7)/),IE6_8:a.search(/MSIE (6|7|8)/),IE6_9:a.search(/MSIE (6|7|8|9)/)}}(),document.head=document.head||document.getElementsByTagName("head")[0],OSRM.Browser.getElementsByClassName=function(a,b){for(var c=[],d=new RegExp("(^| )"+b+"( |$)"),e=a.getElementsByTagName("*"),f=0,g=e.length;g>f;f++)d.test(e[f].className)&&c.push(e[f]);return c},OSRM.Browser.onLoadHandler=function(a,b){b=b||window;var c=b.document;if(b.addEventListener){var d=function(){b.removeEventListener("DOMContentLoaded",arguments.callee,!1),a.call()};b.addEventListener("DOMContentLoaded",d,!1)}else if(c.attachEvent){var d=function(){("interactive"===c.readyState||"complete"===c.readyState)&&(c.detachEvent("onreadystatechange",arguments.callee),a.call())};c.attachEvent("onreadystatechange",d)}},OSRM.Browser.onUnloadHandler=function(a,b){b=b||window;var c=b.document;b.addEventListener?b.addEventListener("unload",a,!1):c.attachEvent&&c.attachEvent("onunload",a)},function(){var a=function(){};OSRM.inheritFrom=function(b,c){a.prototype=c.prototype,b.prototype=new a,b.prototype.constructor=b,b.prototype.base=c.prototype}}(),OSRM.extend=function(a,b){for(property in b)a.prototype[property]=b[property]},OSRM.bind=function(a,b){return function(){b.apply(a,arguments)}},OSRM.concat=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}},OSRM.init=function(){this._inited?OSRM.Map.initEvents():(OSRM.showHTML(),OSRM.prefetchImages(),OSRM.prefetchIcons(),OSRM.GUI.init(),OSRM.Map.init(),OSRM.Routing.init(),OSRM.RoutingAlternatives.init(),OSRM.Localization.init(),OSRM.parseParameters(),0==OSRM.G.initial_position_override&&OSRM.Map.initPosition(),OSRM.Map.initFinally(),this._inited=!0)},OSRM.deinit=function(){OSRM.Map.deinit()},OSRM.GLOBALS.images={},OSRM.prefetchImages=function(){for(var a=Gis.config("relativePath"),b=[{id:"marker-shadow",url:a+"images/marker-shadow.png"},{id:"marker-source",url:a+"images/marker-source.png"},{id:"marker-target",url:a+"images/marker-target.png"},{id:"marker-via",url:a+"images/marker-via.png"},{id:"marker-highlight",url:a+"images/marker-highlight.png"},{id:"marker-source-drag",url:a+"images/marker-source-drag.png"},{id:"marker-target-drag",url:a+"images/marker-target-drag.png"},{id:"marker-via-drag",url:a+"images/marker-via-drag.png"},{id:"marker-highlight-drag",url:a+"images/marker-highlight-drag.png"},{id:"marker-drag",url:a+"images/marker-drag.png"},{id:"cancel",url:a+"images/cancel.png"},{id:"cancel_active",url:a+"images/cancel_active.png"},{id:"cancel_hover",url:a+"images/cancel_hover.png"},{id:"restore",url:a+"images/restore.png"},{id:"restore_active",url:a+"images/restore_active.png"},{id:"restore_hover",url:a+"images/restore_hover.png"},{id:"up",url:a+"images/up.png"},{id:"up_active",url:a+"images/up_active.png"},{id:"up_hover",url:a+"images/up_hover.png"},{id:"down",url:a+"images/down.png"},{id:"down_active",url:a+"images/down_active.png"},{id:"down_hover",url:a+"images/down_hover.png"},{id:"config",url:a+"images/config.png"},{id:"config_active",url:a+"images/config_active.png"},{id:"config_hover",url:a+"images/config_hover.png"},{id:"mapping",url:a+"images/mapping.png"},{id:"mapping_active",url:a+"images/mapping_active.png"},{id:"mapping_hover",url:a+"images/mapping_hover.png"},{id:"printer",url:a+"images/printer.png"},{id:"printer_active",url:a+"images/printer_active.png"},{id:"printer_hover",url:a+"images/printer_hover.png"},{id:"printer_inactive",url:a+"images/printer_inactive.png"},{id:"zoom_in",url:a+"images/zoom_in.png"},{id:"zoom_in_active",url:a+"images/zoom_in_active.png"},{id:"zoom_in_hover",url:a+"images/zoom_in_hover.png"},{id:"zoom_in_inactive",url:a+"images/zoom_in_inactive.png"},{id:"zoom_out",url:a+"images/zoom_out.png"},{id:"zoom_out_active",url:a+"images/zoom_out_active.png"},{id:"zoom_out_hover",url:a+"images/zoom_out_hover.png"},{id:"zoom_out_inactive",url:a+"images/zoom_out_inactive.png"},{id:"locations_user",url:a+"images/locations_user.png"},{id:"locations_user_active",url:a+"images/locations_user_active.png"},{id:"locations_user_hover",url:a+"images/locations_user_hover.png"},{id:"locations_user_inactive",url:a+"images/locations_user_inactive.png"},{id:"locations_route",url:a+"images/locations_route.png"},{id:"locations_route_active",url:a+"images/locations_route_active.png"},{id:"locations_route_hover",url:a+"images/locations_route_hover.png"},{id:"locations_route_inactive",url:a+"images/locations_route_inactive.png"},{id:"layers",url:a+"images/layers.png"},{id:"direction_0",url:a+"images/default.png"},{id:"direction_1",url:a+"images/continue.png"},{id:"direction_2",url:a+"images/slight-right.png"},{id:"direction_3",url:a+"images/turn-right.png"},{id:"direction_4",url:a+"images/sharp-right.png"},{id:"direction_5",url:a+"images/u-turn.png"},{id:"direction_6",url:a+"images/sharp-left.png"},{id:"direction_7",url:a+"images/turn-left.png"},{id:"direction_8",url:a+"images/slight-left.png"},{id:"direction_10",url:a+"images/head.png"},{id:"direction_11",url:a+"images/round-about.png"},{id:"direction_15",url:a+"images/target.png"},{id:"osrm-logo",url:a+"images/osrm-logo.png"},{id:"selector",url:a+"images/selector.png"}],c=0;c<b.length;c++)OSRM.G.images[b[c].id]=new Image,OSRM.G.images[b[c].id].src=b[c].url},OSRM.GLOBALS.icons={},OSRM.prefetchIcons=function(){for(var a=[{id:"marker-source",image_id:"marker-source"},{id:"marker-target",image_id:"marker-target"},{id:"marker-via",image_id:"marker-via"},{id:"marker-highlight",image_id:"marker-highlight"},{id:"marker-source-drag",image_id:"marker-source-drag"},{id:"marker-target-drag",image_id:"marker-target-drag"},{id:"marker-via-drag",image_id:"marker-via-drag"},{id:"marker-highlight-drag",image_id:"marker-highlight-drag"}],b=L.LabelMarkerIcon.extend({options:{shadowUrl:OSRM.G.images["marker-shadow"].getAttribute("src"),iconSize:[25,41],shadowSize:[41,41],iconAnchor:[13,41],shadowAnchor:[13,41],popupAnchor:[0,-33]}}),c=0;c<a.length;c++)OSRM.G.icons[a[c].id]=new b({iconUrl:OSRM.G.images[a[c].image_id].getAttribute("src")});OSRM.G.icons["marker-drag"]=new L.LabelMarkerIcon({iconUrl:OSRM.G.images["marker-drag"].getAttribute("src"),iconSize:new L.Point(18,18)})},OSRM.prefetchCSSIcons=function(){for(var a=[{id:"#gui-printer-inactive",image_id:"printer_inactive"},{id:"#gui-printer",image_id:"printer"},{id:"#gui-printer:hover",image_id:"printer_hover"},{id:"#gui-printer:active",image_id:"printer_active"},{id:".gui-zoom-in-inactive",image_id:"zoom_in_inactive"},{id:".gui-zoom-in",image_id:"zoom_in"},{id:".gui-zoom-in:hover",image_id:"zoom_in_hover"},{id:".gui-zoom-in:active",image_id:"zoom_in_active"},{id:".gui-zoom-out-inactive",image_id:"zoom_out_inactive"},{id:".gui-zoom-out",image_id:"zoom_out"},{id:".gui-zoom-out:hover",image_id:"zoom_out_hover"},{id:".gui-zoom-out:active",image_id:"zoom_out_active"},{id:".gui-locations-user-inactive",image_id:"locations_user_inactive"},{id:".gui-locations-user",image_id:"locations_user"},{id:".gui-locations-user:hover",image_id:"locations_user_hover"},{id:".gui-locations-user:active",image_id:"locations_user_active"},{id:".gui-locations-route-inactive",image_id:"locations_route_inactive"},{id:".gui-locations-route",image_id:"locations_route"},{id:".gui-locations-route:hover",image_id:"locations_route_hover"},{id:".gui-locations-route:active",image_id:"locations_route_active"},{id:".gui-layers",image_id:"layers"},{id:".cancel-marker",image_id:"cancel"},{id:".cancel-marker:hover",image_id:"cancel_hover"},{id:".cancel-marker:active",image_id:"cancel_active"},{id:".up-marker",image_id:"up"},{id:".up-marker:hover",image_id:"up_hover"},{id:".up-marker:active",image_id:"up_active"},{id:".down-marker",image_id:"down"},{id:".down-marker:hover",image_id:"down_hover"},{id:".down-marker:active",image_id:"down_active"},{id:"#input-mask-header",image_id:"osrm-logo"},{id:".styled-select",image_id:"selector"},{id:"#config-handle-icon",image_id:"config"},{id:"#config-handle-icon:hover",image_id:"config_hover"},{id:"#config-handle-icon:active",image_id:"config_active"},{id:"#mapping-handle-icon",image_id:"mapping"},{id:"#mapping-handle-icon:hover",image_id:"mapping_hover"},{id:"#mapping-handle-icon:active",image_id:"mapping_active"},{id:"#main-handle-icon",image_id:"restore"},{id:"#main-handle-icon:hover",image_id:"restore_hover"},{id:"#main-handle-icon:active",image_id:"restore_active"}],b=OSRM.CSS.getStylesheet("main.css"),c=0;c<a.length;c++)OSRM.CSS.insert(b,a[c].id,"background-image:url("+OSRM.G.images[a[c].image_id].getAttribute("src")+");")},OSRM.showHTML=function(){document.getElementById("gui").style.display="block"},OSRM.parseParameters=function(){var a=document.location.search.substr(1,document.location.search.length);if(OSRM.G.initial_position_override=!1,!(a.length>1e3||0==a.length)){var b={};b.active_routing_engine=OSRM.DEFAULTS.ROUTING_ENGINE;for(var c=a.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(2==e.length)if("hl"==e[0])OSRM.Localization.setLanguage(e[1]);else if("df"==e[0]){var f=parseInt(e[1]);if(0!=f&&1!=f)return;OSRM.GUI.setDistanceFormat(f)}else if("loc"==e[0])b.locations=b.locations||[],b.locations.push(decodeURI(e[1]).replace(/<\/?[^>]+(>|$)/g,""));else if("dest"==e[0])b.destinations=b.dlocations||[],b.destinations.push(decodeURI(e[1]).replace(/<\/?[^>]+(>|$)/g,""));else if("destname"==e[0])b.destination_name=decodeURI(e[1]).replace(/<\/?[^>]+(>|$)/g,"");else if("z"==e[0]){var g=Number(e[1]);if(0>g||g>18)return;b.zoom=g}else if("center"==e[0]){var h=unescape(e[1]).split(",");if(2!=h.length||!OSRM.Utils.isLatitude(h[0])||!OSRM.Utils.isLongitude(h[1]))return;b.center=new L.LatLng(h[0],h[1])}else if("alt"==e[0]){var i=Number(e[1]);if(0>i||i>OSRM.RoutingAlternatives>10)return;b.active_alternative=i}else if("re"==e[0]){var j=Number(e[1]);if(0>j||j>=OSRM.DEFAULTS.ROUTING_ENGINES.length)return;b.active_routing_engine=j}else if("ly"==e[0]){for(var k=Number(e[1]),l=0;l<OSRM.DEFAULTS.TILE_SERVERS.length;l++)if(OSRM.Utils.getHash(OSRM.DEFAULTS.TILE_SERVERS[l].display_name)==k){OSRM.G.map.layerControl.setActiveLayerByName(OSRM.DEFAULTS.TILE_SERVERS[l].display_name);break}}else"mainbox"==e[0]&&"hide"==e[1]&&OSRM.G.map.zoomControl.show()}if(OSRM.GUI.setRoutingEngine(b.active_routing_engine),b.locations||b.destinations){var m=b.destinations?b.destinations:b.locations,n=b.destinations?"_showInitResults_Destinations":"_showInitResults_Locations";OSRM.G.initial_positions={};var o=OSRM.G.initial_positions;o.positions=[],o.done=0,o.fail=!1,o.zoom=b.zoom,o.center=b.center,o.active_alternative=b.active_alternative,o.name=b.destination_name;for(var p=0;p<m.length;p++)o.positions.push(new L.LatLng(0,0));for(var p=0;p<m.length;p++){var q=m[p];if(q.match(/^\s*[-+]?[0-9]*\.?[0-9]+\s*[,;]\s*[-+]?[0-9]*\.?[0-9]+\s*$/)){var r=q.split(/[,;]/);OSRM.Geocoder._showInitResults([{lat:r[0],lon:r[1]}],{id:p,callback:n})}else{OSRM.GUI.exclusiveNotify(OSRM.loc("NOTIFICATION_GEOCODERWAIT_HEADER"),OSRM.loc("NOTIFICATION_GEOCODERWAIT_BODY"),!1);var s=Gis.config(Gis.GEO_FORWARD_SEARCH_URL,OSRM.DEFAULTS.HOST_GEOCODER_URL)+"?format=json&json_callback=%jsonp"+OSRM.DEFAULTS.GEOCODER_BOUNDS+"&accept-language="+OSRM.Localization.current_language+"&limit=1&q="+q;OSRM.JSONP.call(s,OSRM.Geocoder._showInitResults,OSRM.Geocoder._showInitResults,OSRM.DEFAULTS.JSONP_TIMEOUT,"init_geocoder_"+p,{id:p,callback:n})}}}else;}},OSRM.Control.Locations=L.Control.extend({options:{position:"topright"},onAdd:function(a){var b=L.DomUtil.create("div","box-wrapper gui-control-wrapper");return L.DomEvent.disableClickPropagation(b),this._userButton=this._createButton("gui-locations-user",b,OSRM.GUI.zoomOnUser,a,!!navigator.geolocation),this._routeButton=this._createButton("gui-locations-route",b,OSRM.GUI.zoomOnRoute,a,!1),this._container=b,b},_createButton:function(a,b,c,d,e){var f=0==e?"-inactive":"",g="box-content gui-control"+f+" "+a+f,h=L.DomUtil.create("a",g,b);return h.title=a,L.DomEvent.on(h,"click",L.DomEvent.stopPropagation).on(h,"click",L.DomEvent.preventDefault).on(h,"click",c,d).on(h,"dblclick",L.DomEvent.stopPropagation),h},activateRoute:function(){this._routeButton.className="box-content gui-control gui-locations-route"},deactivateRoute:function(){this._routeButton.className="box-content gui-control-inactive gui-locations-route-inactive"},setTooltips:function(a,b){this._userButton.title=a,this._routeButton.title=b}}),L.Map=L.Map.extend({_boundsInsideView:function(a){var b=this.getBounds(),c=this.project(b.getSouthWest()),d=this.project(b.getNorthEast()),e=this.project(a.getSouthWest()),f=this.project(a.getNorthEast());return d.y>f.y?!1:d.x<f.x?!1:c.y<e.y?!1:c.x>e.x?!1:!0},setViewBounds:function(a){var b=this.getBoundsZoom(a);this._zoom>b?this.setView(a.getCenter(),b):this._boundsInsideView(a)||this.setView(a.getCenter(),this._zoom)},setViewUI:function(a,b,c){this.setView(a,b,c)},setViewBoundsUI:function(a){var b=a.getSouthWest(),c=a.getNorthEast(),d=this.getBoundsZoom(a),e=this.project(b,d);e.x-=20,e.y+=20;var f=this.project(c,d);f.y-=20,f.x+=20,a.extend(this.unproject(e,d)),a.extend(this.unproject(f,d)),this.setViewBounds(a)},fitBoundsUI:function(a){var b=a.getSouthWest(),c=a.getNorthEast(),d=this.getBoundsZoom(a),e=this.project(b,d);e.x-=20,e.y+=20;var f=this.project(c,d);f.y-=20,f.x+=20,a.extend(this.unproject(e,d)),a.extend(this.unproject(f,d)),this.fitBounds(a)},getBoundsUI:function(){var a=this.getPixelBounds(),b=this.unproject(new L.Point(a.min.x,a.max.y),this._zoom,!0),c=this.unproject(new L.Point(a.max.x,a.min.y),this._zoom,!0);return new L.LatLngBounds(b,c)},getCenterUI:function(a){var b=this.getSize(),c=this._getTopLeftPoint().add(b.divideBy(2));return this.unproject(c,this._zoom,a)}}),OSRM.Marker=function(a,b,c){this.label=a?a:"marker",this.position=c?c:new L.LatLng(0,0),this.description=null,this.marker=new L.LabelMarker(this.position,b),this.marker.parent=this,this.shown=!1,this.hint=null},OSRM.extend(OSRM.Marker,{show:function(){OSRM.G.map.addLayer(this.marker),this.shown=!0},hide:function(){if(OSRM.G.map.removeLayer(this.marker),this.shown=!1,"highlight"==this.label&&this.description){var a=document.getElementById("description-"+this.description);a&&(a.className="description-body-item"),this.description=null}},setPosition:function(a){this.position=a,this.marker.setLatLng(a),this.hint=null},getPosition:function(){return this.position},getLat:function(){return this.position.lat},getLng:function(){return this.position.lng},isShown:function(){return this.shown},centerView:function(a){void 0==a&&(a=OSRM.DEFAULTS.ZOOM_LEVEL),OSRM.G.map.setViewUI(this.position,a)},toString:function(){return'OSRM.Marker: "'+this.label+'", '+this.position+")"}}),OSRM.RouteMarker=function(a,b){b.baseicon=b.icon,OSRM.RouteMarker.prototype.base.constructor.apply(this,arguments),this.label=a?a:"route_marker",this.marker.on("click",this.onClick),this.marker.on("drag",this.onDrag),this.marker.on("dragstart",this.onDragStart),this.marker.on("dragend",this.onDragEnd)},OSRM.inheritFrom(OSRM.RouteMarker,OSRM.Marker),OSRM.extend(OSRM.RouteMarker,{onClick:function(a){if(1!=a.originalEvent.shiftKey&&1!=a.originalEvent.metaKey&&1!=a.originalEvent.altKey){for(var b=0;b<OSRM.G.markers.route.length;b++)if(OSRM.G.markers.route[b].marker===this){OSRM.G.markers.removeMarker(b);break}OSRM.Routing.getRoute(),OSRM.G.markers.highlight.hide(),OSRM.G.markers.dragger.hide()}},onDrag:function(a){this.parent.setPosition(a.target.getLatLng()),OSRM.G.markers.route.length>1&&OSRM.Routing.getRoute_Dragging(),OSRM.Geocoder.updateLocation(this.parent.label)},onDragStart:function(){OSRM.G.dragging=!0,this.changeIcon(this.options.dragicon),this.parent.description=null;for(var a=0;a<OSRM.G.markers.route.length;a++)if(OSRM.G.markers.route[a].marker===this){OSRM.G.dragid=a;break}this.parent!=OSRM.G.markers.highlight&&OSRM.G.markers.highlight.hide(),this.parent!=OSRM.G.markers.dragger&&OSRM.G.markers.dragger.hide(),OSRM.G.route.isShown()&&OSRM.G.route.showOldRoute()},onDragEnd:function(a){OSRM.G.dragging=!1,this.changeIcon(this.options.baseicon),this.parent.setPosition(a.target.getLatLng()),OSRM.G.route.isShown()?(OSRM.Routing.getRoute(),OSRM.G.route.hideOldRoute(),OSRM.G.route.hideUnnamedRoute()):(OSRM.Geocoder.updateAddress(this.parent.label),OSRM.GUI.clearResults())},toString:function(){return'OSRM.RouteMarker: "'+this.label+'", '+this.position+")"}}),OSRM.DragMarker=function(a){OSRM.DragMarker.prototype.base.constructor.apply(this,arguments),this.label=a?a:"drag_marker"},OSRM.inheritFrom(OSRM.DragMarker,OSRM.RouteMarker),OSRM.extend(OSRM.DragMarker,{onClick:function(a){if(this.parent!=OSRM.G.markers.dragger)this.parent.hide();else{var b=OSRM.Via.findViaIndex(a.target.getLatLng());OSRM.G.markers.route.splice(b+1,0,this.parent),OSRM.RouteMarker.prototype.onDragStart.call(this,a),OSRM.G.markers.route[OSRM.G.dragid]=new OSRM.RouteMarker(OSRM.C.VIA_LABEL,{draggable:!0,icon:OSRM.G.icons["marker-via"],dragicon:OSRM.G.icons["marker-via-drag"]},a.target.getLatLng()),OSRM.G.markers.route[OSRM.G.dragid].show(),OSRM.RouteMarker.prototype.onDragEnd.call(this,a),this.parent.hide()}},onDragStart:function(a){var b=OSRM.Via.findViaIndex(a.target.getLatLng());OSRM.G.markers.route.splice(b+1,0,this.parent),OSRM.RouteMarker.prototype.onDragStart.call(this,a)},onDragEnd:function(a){OSRM.G.markers.route[OSRM.G.dragid]=new OSRM.RouteMarker(OSRM.C.VIA_LABEL,{draggable:!0,icon:OSRM.G.icons["marker-via"],dragicon:OSRM.G.icons["marker-via-drag"]},a.target.getLatLng()),OSRM.G.markers.route[OSRM.G.dragid].show(),OSRM.RouteMarker.prototype.onDragEnd.call(this,a),this.parent.hide()},toString:function(){return'OSRM.DragMarker: "'+this.label+'", '+this.position+")"}}),OSRM.SimpleRoute=function(a,b){this.label=a?a:"route",this.route=new L.Polyline([],b),this.shown=!1,this.route.on("click",this.onClick,this)},OSRM.extend(OSRM.SimpleRoute,{show:function(){OSRM.G.map.addLayer(this.route),this.shown=!0},hide:function(){OSRM.G.map.removeLayer(this.route),this.shown=!1},isShown:function(){return this.shown},getPoints:function(){return this.route._originalPoints},getPositions:function(){return this.route.getLatLngs()},setPositions:function(a){this.route.setLatLngs(a)},setStyle:function(a){this.route.setStyle(a)},centerView:function(){var a=new L.LatLngBounds(this.getPositions());OSRM.g.map.fitBoundsUI(a)},onClick:function(a){if(this==OSRM.G.route){if(1==a.originalEvent.shiftKey||1==a.originalEvent.metaKey||1==a.originalEvent.altKey)return;var b=Math.max(0,OSRM.Via.findViaIndex(a.latlng)),c=OSRM.G.markers.setVia(b,a.latlng);OSRM.G.markers.route[c].show(),OSRM.Routing.getRoute()}},toString:function(){return"OSRM.Route("+this.label+", "+this.route.getLatLngs().length+" points)"}}),OSRM.MultiRoute=function(a){this.label=a?a:"multiroute",this.route=new L.LayerGroup,this.shown=!1},OSRM.extend(OSRM.MultiRoute,{show:function(){OSRM.G.map.addLayer(this.route),this.shown=!0},hide:function(){OSRM.G.map.removeLayer(this.route),this.shown=!1},isShown:function(){return this.shown},addRoute:function(a){var b=new L.Polyline(a);b.on("click",function(a){OSRM.G.route.fire("click",a)}),this.route.addLayer(b)},clearRoutes:function(){this.route.clearLayers()},setStyle:function(a){this.route.invoke("setStyle",a)},toString:function(){return"OSRM.MultiRoute("+this.label+")"}}),OSRM.GLOBALS.map=null,OSRM.GLOBALS.localizable_maps=[],OSRM.Map={init:function(){null==OSRM.G.main_handle&&OSRM.GUI.init();for(var a=OSRM.DEFAULTS.TILE_SERVERS,b={},c=0,d=a.length;d>c;c++)a[c].options.attribution=a[c].attribution,b[a[c].display_name]=new L.TileLayer(a[c].url,a[c].options),L.Util.stamp(b[a[c].display_name]);for(var e=OSRM.DEFAULTS.OVERLAY_SERVERS,f={},c=0,d=e.length;d>c;c++)e[c].options.attribution=e[c].attribution,f[e[c].display_name]=new L.TileLayer(e[c].url,e[c].options),L.Util.stamp(f[e[c].display_name]);OSRM.G.map=Gis.Map.CURRENT_MAP.options.provider.map,this.initEvents()},initEvents:function(){OSRM.G.map.on("zoomend",OSRM.Map.zoomed),OSRM.G.map.on("click",OSRM.Map.click),OSRM.G.map.on("mousemove",OSRM.Map.mousemove),OSRM.GUI.showRouting()},deinit:function(){OSRM.G.map.off("zoomend",OSRM.Map.zoomed),OSRM.G.map.off("click",OSRM.Map.click),OSRM.G.map.off("mousemove",OSRM.Map.mousemove),OSRM.GUI.hideRouting()},initFinally:function(){},initPosition:function(){},zoomed:function(){var a=OSRM.G.route.getZoomLevel()-OSRM.G.map.getZoom();a>=0&&3>=a||(OSRM.G.dragging?OSRM.Routing.getRoute_Dragging():OSRM.Routing.getRoute_Redraw({keepAlternative:!0}))},contextmenu:function(){},mousemove:function(a){OSRM.Via.drawDragMarker(a)},click:function(a){if(1!=a.originalEvent.shiftKey&&1!=a.originalEvent.metaKey&&1!=a.originalEvent.altKey)if(OSRM.G.markers.hasSource()){if(!OSRM.G.markers.hasTarget()){var b=OSRM.G.markers.setTarget(a.latlng);OSRM.Geocoder.updateAddress(OSRM.C.TARGET_LABEL,OSRM.C.DO_FALLBACK_TO_LAT_LNG),OSRM.G.markers.route[b].show(),OSRM.Routing.getRoute({recenter:2==OSRM.G.markers.route.length})}}else{var b=OSRM.G.markers.setSource(a.latlng);OSRM.Geocoder.updateAddress(OSRM.C.SOURCE_LABEL,OSRM.C.DO_FALLBACK_TO_LAT_LNG),OSRM.G.markers.route[b].show(),OSRM.Routing.getRoute({recenter:2==OSRM.G.markers.route.length})}},geolocationResponse:function(a){var b=new L.LatLng(a.coords.latitude,a.coords.longitude);OSRM.G.map.setViewUI(b,OSRM.DEFAULTS.ZOOM_LEVEL)}},OSRM.Markers=function(){this.route=new Array,this.highlight=new OSRM.DragMarker("highlight",{zIndexOffset:-1,draggable:!0,icon:OSRM.G.icons["marker-highlight"],dragicon:OSRM.G.icons["marker-highlight-drag"]}),this.hover=new OSRM.Marker("hover",{zIndexOffset:-1,draggable:!1,icon:OSRM.G.icons["marker-highlight"]}),this.dragger=new OSRM.DragMarker("drag",{draggable:!0,icon:OSRM.G.icons["marker-drag"],dragicon:OSRM.G.icons["marker-drag"]}),this.initial_vias=new Array},OSRM.extend(OSRM.Markers,{reset:function(){for(var a=0;a<this.route.length;a++)this.route[a].hide();this.route.splice(0,this.route.length),this.highlight.hide(),this.dragger.hide(),this.initial_vias.length=0},hide:function(){for(var a=0;a<this.route.length;a++)this.route[a].hide();this.highlight.hide(),this.dragger.hide()},show:function(){for(var a=0;a<this.route.length;a++)this.route[a].show()},removeVias:function(){for(var a=1;a<this.route.length-1;a++)this.route[a].hide();this.route.splice(1,this.route.length-2)},setSource:function(a){if(this.route[0]&&this.route[0].label==OSRM.C.SOURCE_LABEL?this.route[0].setPosition(a):this.route.splice(0,0,new OSRM.RouteMarker(OSRM.C.SOURCE_LABEL,{draggable:!0,icon:OSRM.G.icons["marker-source"],dragicon:OSRM.G.icons["marker-source-drag"]},a)),this.initial_vias.length>0){for(var b=0;b<this.initial_vias.length;b++)OSRM.G.markers.setVia(b,this.initial_vias[b]);for(var b=1;b<OSRM.G.markers.route.length-1;b++)OSRM.G.markers.route[b].show()}return 0},setTarget:function(a){if(this.route[this.route.length-1]&&this.route[this.route.length-1].label==OSRM.C.TARGET_LABEL?this.route[this.route.length-1].setPosition(a):this.route.splice(this.route.length,0,new OSRM.RouteMarker(OSRM.C.TARGET_LABEL,{draggable:!0,icon:OSRM.G.icons["marker-target"],dragicon:OSRM.G.icons["marker-target-drag"]},a)),this.initial_vias.length>0){for(var b=0;b<this.initial_vias.length;b++)OSRM.G.markers.setVia(b,this.initial_vias[b]);for(var b=1;b<OSRM.G.markers.route.length-1;b++)OSRM.G.markers.route[b].show()}return this.route.length-1},setVia:function(a,b){return this.route.length<2||a>this.route.length-2?-1:(this.route.splice(a+1,0,new OSRM.RouteMarker(OSRM.C.VIA_LABEL,{draggable:!0,icon:OSRM.G.icons["marker-via"],dragicon:OSRM.G.icons["marker-via-drag"]},b)),a+1)
},removeMarker:function(a){a>=this.route.length||(0==a&&this.route[0].label==OSRM.C.SOURCE_LABEL?(this.removeVias(),document.getElementById("gui-input-source").value="",OSRM.GUI.clearResults()):a==this.route.length-1&&this.route[this.route.length-1].label==OSRM.C.TARGET_LABEL&&(this.removeVias(),a=this.route.length-1,document.getElementById("gui-input-target").value="",OSRM.GUI.clearResults()),this.route[a].hide(),this.route.splice(a,1),this.initial_vias.length=0)},reverseDescriptions:function(){for(var a=this.route.length-1,b=this.route.length/2,c=0;b>c;++c){var d=this.route[c].description;this.route[c].description=this.route[a-c].description,this.route[a-c].description=d}},reverseMarkers:function(){var a=this.route.length,b=this.route[0].getPosition();this.route[0].setPosition(this.route[a-1].getPosition()),this.route[a-1].setPosition(b);var c=this.route[0];this.route[0]=this.route[a-1],this.route[a-1]=c,this.route.reverse(),OSRM.GUI.clearResults(),this.reverseInitialVias()},hasSource:function(){return this.route[0]&&this.route[0].label==OSRM.C.SOURCE_LABEL?!0:!1},hasTarget:function(){return this.route[this.route.length-1]&&this.route[this.route.length-1].label==OSRM.C.TARGET_LABEL?!0:!1},addInitialVia:function(a){this.initial_vias.push(a)},reverseInitialVias:function(){this.initial_vias.reverse()},relabelViaMarkers:function(){for(var a=1,b=this.route.length-1;b>a;a++)this.route[a].marker.setLabel(a)}}),function(){function a(){var a=this.getZoomLevel()-OSRM.G.map.getZoom();a>=0&&3>=a||OSRM.G.dragging||OSRM.Routing.getRoute_Redraw({keepAlternative:!0},this)}function b(){OSRM.G.map.on("zoomend",a,this)}function c(){this._current_route.route.off("add",b,this),this._current_route.route.off("remove",c,this),OSRM.G.map.off("zoomend",a,this)}var d=1;OSRM.Route=function(){this.ID=d++,this._current_route=new OSRM.SimpleRoute("current",{dashArray:"",color:"blue",weight:5,opacity:1,clickable:!0}),this._alternative_route=new OSRM.SimpleRoute("alternative",{dashArray:"",color:"blue",weight:5,opacity:.5}),this._old_route=new OSRM.SimpleRoute("old",{color:"#123",dashArray:"",weight:5,opacity:.5}),this._unnamed_route=new OSRM.MultiRoute("unnamed"),this._current_route.route.on("add",b,this),this._current_route.route.on("remove",c,this),this._current_route_style={color:Gis.Widget.geoPathProperty().getSelectedColor(),weight:5,dashArray:"",stroke:!0},this._current_noroute_style={color:"#222222",weight:2,dashArray:"8,6",stroke:!0},this._old_route_style={color:"#112233",weight:5,dashArray:"",stroke:!0},this._old_noroute_style={color:"#000000",weight:2,dashArray:"8,6",stroke:!0},this._unnamed_route_style={color:"#FF00FF",weight:10,dashArray:"",stroke:!0},this._old_unnamed_route_style={color:"#990099",weight:10,dashArray:"",stroke:!0},this._alternative_route_style={color:"#770033",weight:5,opacity:.6,dashArray:"",stroke:!0},this._noroute=OSRM.Route.ROUTE,this._history=new OSRM.HistoryRoute,this._zoomlevel=0},OSRM.Route.NOROUTE=!0,OSRM.Route.ROUTE=!1,OSRM.extend(OSRM.Route,{updateCurrentRouteStyle:function(a){this._current_route_style.color=a,this._current_route.setStyle(this._current_route_style)},showRoute:function(a,b){this._noroute=b,this._current_route.setPositions(a),this._current_route.setStyle(this._noroute==OSRM.Route.NOROUTE?this._current_noroute_style:this._current_route_style),this._current_route.show(),this._history.fetchHistoryRoute(),this._history.showHistoryRoutes(),this._history.storeHistoryRoute(),this._zoomlevel=OSRM.G.map.getZoom()},hideRoute:function(){this._current_route.hide(),this._unnamed_route.hide(),this._history.fetchHistoryRoute(),this._history.showHistoryRoutes(),this._zoomlevel=0,OSRM.GUI.deactivateRouteFeatures()},show:function(){this._current_route.show(),this._zoomlevel=OSRM.G.map.getZoom()},hide:function(){this._current_route.hide(),this._unnamed_route.hide()},showAdditional:function(){this._current_route.show(),this._zoomlevel=OSRM.G.map.getZoom()},hideAdditional:function(){this._unnamed_route.hide(),this._history.fetchHistoryRoute(),this._history.showHistoryRoutes()},showUnnamedRoute:function(a){this._unnamed_route.clearRoutes();for(var b=0;b<a.length;b++)this._unnamed_route.addRoute(a[b]);this._unnamed_route.setStyle(this._unnamed_route_style),this._unnamed_route.show()},hideUnnamedRoute:function(){this._unnamed_route.hide()},_raiseUnnamedRoute:function(){this._unnamed_route.isShown()&&(this._unnamed_route.hide(),this._unnamed_route.show())},showOldRoute:function(){this._old_route.setPositions(this._current_route.getPositions()),this._old_route.setStyle(this._noroute==OSRM.Route.NOROUTE?this._old_noroute_style:this._old_route_style),this._old_route.show(),this._raiseUnnamedRoute(),this._unnamed_route.setStyle(this._old_unnamed_route_style)},hideOldRoute:function(){this._old_route.hide()},showAlternativeRoute:function(a){this._alternative_route.setPositions(a),this._alternative_route.setStyle(this._alternative_route_style),this._alternative_route.show()},hideAlternativeRoute:function(){this._alternative_route.hide()},isShown:function(){return this._current_route.isShown()},isRoute:function(){return!this._noroute},getPositions:function(){return this._current_route.getPositions()},getPoints:function(){return this._current_route.getPoints()},getZoomLevel:function(){return this._zoomlevel},reset:function(){this.hideRoute(),this._old_route.hide(),this._noroute=OSRM.Route.ROUTE,this._history.clearHistoryRoutes()},fire:function(a,b){this._current_route.route.fire(a,b)},centerView:function(){this._current_route.centerView()},activateHistoryRoutes:function(){this._history.activate()},deactivateHistoryRoutes:function(){this._history.deactivate()}})}(),OSRM.HistoryRoute=function(){this._history_styles=[{color:"#FFFFFF",opacity:.5,weight:5,dashArray:""},{color:"#0000DD",opacity:.45,weight:5,dashArray:""},{color:"#0000BB",opacity:.4,weight:5,dashArray:""},{color:"#000099",opacity:.35,weight:5,dashArray:""},{color:"#000077",opacity:.3,weight:5,dashArray:""},{color:"#000055",opacity:.25,weight:5,dashArray:""},{color:"#000033",opacity:.2,weight:5,dashArray:""},{color:"#000011",opacity:.15,weight:5,dashArray:""},{color:"#000000",opacity:.1,weight:5,dashArray:""}],this._history_length=this._history_styles.length,this._history=[];for(var a=0,b=this._history_length;b>a;a++){var c={};c.route=new OSRM.SimpleRoute("current",{dashArray:""}),c.markers=[],c.checksum=null,this._history.push(c)}this._initiate_redrawHistory=OSRM.bind(this,this._getRoute_RedrawHistory),this._callback_redrawHistory=OSRM.bind(this,this._showRoute_RedrawHistory)},OSRM.extend(OSRM.HistoryRoute,{activate:function(){this.storeHistoryRoute=this._storeHistoryRoute,this.fetchHistoryRoute=this._fetchHistoryRoute,this.showHistoryRoutes=this._showHistoryRoutes,this.clearHistoryRoutes=this._clearHistoryRoutes,OSRM.G.map.on("zoomend",this._initiate_redrawHistory),this.storeHistoryRoute()},deactivate:function(){this.clearHistoryRoutes(),this.storeHistoryRoute=this.empty,this.fetchHistoryRoute=this.empty,this.showHistoryRoutes=this.empty,this.clearHistoryRoutes=this.empty,OSRM.G.map.off("zoomend",this._initiate_redrawHistory)},empty:function(){},storeHistoryRoute:function(){},fetchHistoryRoute:function(){},showHistoryRoutes:function(){},clearHistoryRoutes:function(){},_storeHistoryRoute:function(){var a=OSRM.G.route;if(a.isShown()&&a.isRoute()){var b=OSRM.G.response.hint_data;this._history[0].route.setPositions(a.getPositions()),this._history[0].checksum=b.checksum,this._history[0].markers=[];for(var c=this._getCurrentMarkers(),d=0,e=c.length;e>d;d++){var f={lat:c[d].lat,lng:c[d].lng,hint:b.locations[d]};this._history[0].markers.push(f)}}},_fetchHistoryRoute:function(){if(0!=this._history[0].markers.length&&!(OSRM.G.route.isShown()&&this._equalMarkers(this._history[0].markers,this._getCurrentMarkers())||this._equalMarkers(this._history[0].markers,this._history[1].markers))){for(var a=this._history_length-1;a>0;a--)this._history[a].route.setPositions(this._history[a-1].route.getPositions()),this._history[a].markers=this._history[a-1].markers,this._history[a].checksum=this._history[a-1].checksum;this._history[0].route.setPositions([]),this._history[0].markers=[],this._history[0].checksum=null}},_showHistoryRoutes:function(){for(var a=1,b=this._history_length;b>a;a++)this._history[a].route.setStyle(this._history_styles[a]),this._history[a].route.show(),OSRM.G.route.hideOldRoute()},_clearHistoryRoutes:function(){for(var a=0,b=this._history_length;b>a;a++)this._history[a].route.hide(),this._history[a].route.setPositions([]),this._history[a].markers=[],this._history[a].checksum=null},_getCurrentMarkers:function(){var a=[],b=OSRM.G.route.getPositions();if(0==b.length)return a;for(var c=0;c<OSRM.G.response.via_points.length;c++)a.push({lat:OSRM.G.response.via_points[c][0],lng:OSRM.G.response.via_points[c][1]});return a},_equalMarkers:function(a,b){if(a.length!=b.length)return!1;for(var c=OSRM.C.PRECISION,d=0,e=a.length;e>d;d++)if(a[d].lat.toFixed(c)!=b[d].lat.toFixed(c)||a[d].lng.toFixed(c)!=b[d].lng.toFixed(c))return!1;return!0},_showRoute_RedrawHistory:function(a,b){if(a){var c=OSRM.RoutingGeometry._decode(a.route_geometry,OSRM.C.PRECISION);this._history[b].route.setPositions(c),this._updateHints(a,b)}},_getRoute_RedrawHistory:function(){for(var a=0,b=this._history_length;b>a;a++)this._history[a].markers.length>0&&(OSRM.JSONP.clear("history"+a),OSRM.JSONP.call(this._buildCall(a)+"&instructions=false",this._callback_redrawHistory,OSRM.JSONP.empty,OSRM.DEFAULTS.JSONP_TIMEOUT,"history"+a,a))},_buildCall:function(a){var b=OSRM.G.active_routing_server_url;b+="?z="+Gis.OSRM.getMapZoom()+"&output=json&jsonp=%jsonp",this._history[a].checksum&&(b+="&checksum="+this._history[a].checksum);for(var c=this._history[a].markers,d=OSRM.C.PRECISION,e=0,f=c.length;f>e;e++)b+="&loc="+c[e].lat.toFixed(d)+","+c[e].lng.toFixed(d),c[e].hint&&(b+="&hint="+c[e].hint);return b},_updateHints:function(a,b){if(a.hint_data){this._history[b].checksum=a.hint_data.checksum;for(var c=a.hint_data.locations,d=0;d<c.length;d++)this._history[b].markers[d].hint=c[d]}}}),OSRM.GUI={init_functions:[],init:function(){for(var a=0,b=OSRM.GUI.init_functions.length;b>a;a++)OSRM.GUI.init_functions[a]()},extend:function(a){for(property in a)"init"==property?OSRM.GUI.init_functions.push(a[property]):OSRM.GUI[property]=a[property]}},OSRM.GUIBoxGroup=function(){this._handles=[]},OSRM.extend(OSRM.GUIBoxGroup,{add:function(a){this._handles.push(a),a.$addToGroup(this)},select:function(a){for(var b=0;b<this._handles.length;b++)this._handles[b]!=a?this._handles[b].$hideBox():this._handles[b].$showBox()},$hide:function(){for(var a=0;a<this._handles.length;a++)this._handles[a].$hide()},$show:function(){for(var a=0;a<this._handles.length;a++)this._handles[a].$show()}}),OSRM.GUIBoxHandle=function(a,b,c,d,e){var f=document.getElementById(a+"-toggle");if(null==f)return void console.log("[error] No toggle button for "+a);var g=document.createElement("div");g.id=a+"-handle-wrapper",g.className="box-wrapper box-handle-wrapper-"+b,g.style.cssText+=c;var h=document.createElement("div");h.id=a+"-handle-content",h.className="box-content box-handle-content-"+b;var i=document.createElement("div");i.id=a+"-handle-icon",i.className="iconic-button",i.title=a,h.appendChild(i),g.appendChild(h),document.body.appendChild(g),this._box=document.getElementById(a+"-wrapper"),this._class=this._box.className,this._width=this._box.clientWidth,this._side=b,this._handle=g,this._box_group=null,this._transitionEndFct=e,this._box.style[this._side]=-this._width+"px",this._box_visible=!1,this._box.style.visibility="hidden",this._handle.style.visibility="visible";var j=d?OSRM.concat(this._toggle,d):this._toggle,k=OSRM.bind(this,j);f.onclick=k,i.onclick=k;var j=e?OSRM.concat(this._onTransitionEnd,e):this._onTransitionEnd,k=OSRM.bind(this,j);if(-1==OSRM.Browser.FF3&&-1==OSRM.Browser.IE6_9){var l=document.getElementById(a+"-wrapper");l.addEventListener("transitionend",k,!1),l.addEventListener("webkitTransitionEnd",k,!1),l.addEventListener("oTransitionEnd",k,!1),l.addEventListener("MSTransitionEnd",k,!1)}else this._legacyTransitionEndFct=OSRM.bind(this,function(){k({target:this._box})})},OSRM.extend(OSRM.GUIBoxHandle,{boxVisible:function(){return this._box_visible},boxWidth:function(){return this._width},$addToGroup:function(a){this._box_group=a},$show:function(){this._handle.style.visibility="visible"},$hide:function(){this._handle.style.visibility="hidden"},$showBox:function(){this._box_visible=!0,this._box.style.visibility="visible",this._handle.style.visibility="hidden",this._box.style[this._side]="5px"},$hideBox:function(){this._box_visible=!1,this._box.style.visibility="hidden",this._handle.style.visibility="visible",this._box.style[this._side]=-this._width+"px"},_toggle:function(){this._box.className+=" box-animated",0==this._box_visible?(this._box_group.$hide(),this._box.style[this._side]="5px",this._box.style.visibility="visible"):this._box.style[this._side]=-this._width+"px",(-1!=OSRM.Browser.FF3||-1!=OSRM.Browser.IE6_9)&&setTimeout(this._legacyTransitionEndFct,0)},_onTransitionEnd:function(a){a.target==this._box&&(this._box.className=this._class,1==this._box_visible?(this._box_group.$show(),this._box_visible=!1,this._box.style.visibility="hidden"):(this._box_visible=!0,this._box.style.visibility="visible"))}}),OSRM.GUI.extend({selectorInit:function(a,b,c,d){var e=document.getElementById(a);e.className+=" styled-select-helper base-font",e.onchange=function(){OSRM.GUI._selectorOnChange(this),d(this.value)};for(var f=0,g=b.length;g>f;f++){var h=document.createElement("option");h.innerHTML=b[f].display,h.value=b[f].value,e.appendChild(h)}e.value=b[c].value;var i=document.createTextNode(b[c].display),j=document.createElement("span");j.className="styled-select base-font",j.id="styled-select-"+e.id,j.appendChild(i),e.parentNode.insertBefore(j,e),j.style.width=e.offsetWidth-2+"px",j.style.height=e.offsetHeight+"px"},_selectorOnChange:function(a){for(var b=a.getElementsByTagName("option"),c=0;c<b.length;c++)if(1==b[c].selected){document.getElementById("styled-select-"+a.id).childNodes[0].nodeValue=b[c].childNodes[0].nodeValue;break}},selectorChange:function(a,b){var c=document.getElementById(a);c.value=b,OSRM.GUI._selectorOnChange(c)},selectorRenameOptions:function(a,b){var c=document.getElementById(a),d=document.getElementById("styled-select-"+a),e=document.createElement("select");e.id=a,e.className=c.className,e.onchange=c.onchange;for(var f="",g=0,h=b.length;h>g;g++){var i=document.createElement("option");i.innerHTML=b[g].display,i.value=b[g].value,e.appendChild(i),b[g].value==c.value&&(f=b[g].display)}e.value=c.value,c.parentNode.insertBefore(e,c),c.parentNode.removeChild(c),d.childNodes[0].nodeValue=f,d.style.width=e.offsetWidth-2+"px",d.style.height=e.offsetHeight+"px"}}),OSRM.GUI.extend({init:function(){OSRM.G.main_handle=1;var a=new OSRM.GUIBoxGroup;a.select(null),document.getElementById("gui-input-source").value=OSRM.DEFAULTS.ONLOAD_SOURCE,document.getElementById("gui-input-target").value=OSRM.DEFAULTS.ONLOAD_TARGET},setLabels:function(){document.getElementById("gui-reverse").innerHTML=OSRM.loc("GUI_REVERSE"),document.getElementById("gui-search-source-label").innerHTML=OSRM.loc("GUI_START")+":",document.getElementById("gui-search-target-label").innerHTML=OSRM.loc("GUI_END")+":",document.getElementById("gui-input-source").title=OSRM.loc("GUI_START_TOOLTIP"),document.getElementById("gui-input-target").title=OSRM.loc("GUI_END_TOOLTIP"),OSRM.GUI.setDistanceFormatsLanguage(),OSRM.GUI.setRoutingEnginesLanguage()},clearResults:function(){document.getElementById("information-box").className="information-box-with-normal-header",document.getElementById("information-box").innerHTML="",document.getElementById("information-box-header").innerHTML="",Gis.EventBus.fire("route-changed")},beforeMainTransition:function(){OSRM.G.map.zoomControl.hide()},afterMainTransition:function(){OSRM.G.map.zoomControl.show()},initDistanceFormatsSelector:function(){var a=OSRM.GUI.getDistanceFormats();OSRM.GUI.selectorInit("gui-units-toggle",a,OSRM.DEFAULTS.DISTANCE_FORMAT,OSRM.GUI._onDistanceFormatChanged)},setDistanceFormat:function(a){OSRM.G.active_distance_format!=a&&(OSRM.G.active_distance_format=a,OSRM.G.map&&(OSRM.G.map.scaleControl.removeFrom(OSRM.G.map),OSRM.G.map.scaleControl.options.metric=1!=a,OSRM.G.map.scaleControl.options.imperial=1==a,OSRM.G.map.scaleControl.addTo(OSRM.G.map)),OSRM.Utils.toHumanDistance=1==a?OSRM.Utils.toHumanDistanceMiles:OSRM.Utils.toHumanDistanceMeters)},_onDistanceFormatChanged:function(a){OSRM.GUI.setDistanceFormat(a),OSRM.Routing.getRoute({keepAlternative:!0})},setDistanceFormatsLanguage:function(){OSRM.GUI.getDistanceFormats()},getDistanceFormats:function(){return[{display:OSRM.loc("GUI_KILOMETERS"),value:0},{display:OSRM.loc("GUI_MILES"),value:1}]},queryDataTimestamp:function(){OSRM.G.data_timestamp="n/a",OSRM.JSONP.call(OSRM.G.active_routing_timestamp_url+"?jsonp=%jsonp",OSRM.GUI.setDataTimestamp,OSRM.JSONP.empty,OSRM.DEFAULTS.JSONP_TIMEOUT,"data_timestamp")},setDataTimestamp:function(a){a&&(OSRM.G.data_timestamp=a.timestamp.slice(0,25).replace(/<\/?[^>]+(>|$)/g,""))}}),OSRM.GLOBALS.route=null,OSRM.GLOBALS.markers=null,OSRM.GLOBALS.dragging=null,OSRM.GLOBALS.dragid=null,OSRM.GLOBALS.pending=!1,OSRM.Routing={init:function(){OSRM.GUI.setRoutingEngine(OSRM.DEFAULTS.ROUTING_ENGINE),OSRM.G.markers=new OSRM.Markers,OSRM.G.route=new OSRM.Route,OSRM.G.response={via_points:[]},OSRM.RoutingDescription.init()},timeoutRoute:function(){OSRM.G.response={via_points:[]},OSRM.RoutingGeometry.showNA(),OSRM.RoutingNoNames.showNA(),OSRM.RoutingDescription.showNA(OSRM.loc("TIMED_OUT")),OSRM.Routing._snapRoute()},timeoutRoute_Dragging:function(){OSRM.RoutingGeometry.showNA(),OSRM.RoutingDescription.showNA(OSRM.loc("TIMED_OUT"))},timeoutRoute_Reversed:function(){OSRM.G.markers.reverseMarkers(),OSRM.Routing.timeoutRoute()},showRoute:function(a,b){if(a&&(1!=b.keepAlternative&&(OSRM.G.active_alternative=0),OSRM.G.response=a,OSRM.Routing._snapRoute(),207==a.status?(OSRM.RoutingGeometry.showNA(),OSRM.RoutingNoNames.showNA(),OSRM.RoutingDescription.showNA(OSRM.loc("NO_ROUTE_FOUND"))):(OSRM.RoutingAlternatives.prepare(OSRM.G.response),OSRM.RoutingGeometry.show(OSRM.G.response),OSRM.RoutingNoNames.show(OSRM.G.response),OSRM.RoutingDescription.show(OSRM.G.response)),OSRM.Routing._updateHints(a),1==b.recenter)){var c=new L.LatLngBounds(OSRM.G.route._current_route.getPositions());OSRM.G.map.setViewBoundsUI(c)}},showRoute_Dragging:function(a){a&&OSRM.G.dragging&&(OSRM.G.response=a,207==a.status?(OSRM.RoutingGeometry.showNA(),OSRM.RoutingDescription.showNA(OSRM.loc("YOUR_ROUTE_IS_BEING_COMPUTED"))):(OSRM.RoutingGeometry.show(a),OSRM.RoutingDescription.showSimple(a)),OSRM.Routing._updateHints(a),OSRM.G.pending&&setTimeout(OSRM.Routing.draggingTimeout,1))},showRoute_Redraw:function(a,b){if(a){var c=b.route||OSRM.G.route,d=!b.route||b.route===OSRM.G.route;d&&0==b.keepAlternative&&(OSRM.G.active_alternative=0),d&&(OSRM.G.response=a),207!=a.status&&(d&&OSRM.RoutingAlternatives.prepare(a),OSRM.RoutingGeometry.show(a,c),d&&OSRM.RoutingNoNames.show(a)),d&&OSRM.Routing._updateHints(a)}},getNearest:function(a){var b=OSRM.G.markers.route;$.ajax({url:getRequestUrl(b[0]),dataType:"json",success:function(c){c&&c.mapped_coordinate&&(b[0].setPosition(L.latLng(c.mapped_coordinate[0],c.mapped_coordinate[1])),$.ajax({url:getRequestUrl(b[b.length-1]),dataType:"json",success:function(c){c&&c.mapped_coordinate&&(b[b.length-1].setPosition(L.latLng(c.mapped_coordinate[0],c.mapped_coordinate[1])),a())}}))}})},getRoute:function(a){return OSRM.G.markers.route.length<2?void OSRM.G.route.hideRoute():(a=a||{},OSRM.JSONP.clear("dragging"),OSRM.JSONP.clear("redraw"),OSRM.JSONP.clear("route"),void OSRM.JSONP.call(OSRM.Routing._buildCall()+"&instructions=true",OSRM.Routing.showRoute,OSRM.Routing.timeoutRoute,OSRM.DEFAULTS.JSONP_TIMEOUT,"route",a))},getRoute_Reversed:function(){OSRM.G.markers.route.length<2||(OSRM.JSONP.clear("dragging"),OSRM.JSONP.clear("redraw"),OSRM.JSONP.clear("route"),OSRM.JSONP.call(OSRM.Routing._buildCall()+"&instructions=true",OSRM.Routing.showRoute,OSRM.Routing.timeoutRoute_Reversed,OSRM.DEFAULTS.JSONP_TIMEOUT,"route",{}))},getRoute_Redraw:function(a,b){OSRM.G.markers.route.length<2&&(!b||!b.route||b.route.length<2)||(a=a||{},a.route=b||OSRM.G.route,OSRM.JSONP.clear("dragging"),OSRM.JSONP.clear("redraw"),OSRM.JSONP.call(OSRM.Routing._buildCall(b&&b.route)+"&instructions=true",OSRM.Routing.showRoute_Redraw,OSRM.Routing.timeoutRoute,OSRM.DEFAULTS.JSONP_TIMEOUT,"redraw"+a.route.ID,a))},getRoute_Dragging:function(){OSRM.G.pending=!OSRM.JSONP.call(OSRM.Routing._buildCall()+"&alt=false&instructions=false",OSRM.Routing.showRoute_Dragging,OSRM.Routing.timeoutRoute_Dragging,OSRM.DEFAULTS.JSONP_TIMEOUT,"dragging")},draggingTimeout:function(){OSRM.G.markers.route[OSRM.G.dragid].hint=null,OSRM.Routing.getRoute_Dragging()},_buildCall:function(a){var b,c=OSRM.G.active_routing_server_url;c+="?z="+Gis.OSRM.getMapZoom()+"&output=json&jsonp=%jsonp",OSRM.G.markers.checksum&&(c+="&checksum="+OSRM.G.markers.checksum),a=a||OSRM.G.markers.route;for(var d=OSRM.C.PRECISION,e=0,f=a.length;f>e;e++)b=this._getLatLng(a[e]),c+="&loc="+b.lat.toFixed(d)+","+b.lng.toFixed(d),a[e].hint&&(c+="&hint="+a[e].hint);return c},_getLatLng:function(a){return a.getLat?L.latLng(a.getLat(),a.getLng()):L.latLng(a.lat,a.lng)},_updateHints:function(a){if(a.hint_data){var b=a.hint_data.locations;OSRM.G.markers.checksum=a.hint_data.checksum;for(var c=0;c<b.length;c++)OSRM.G.markers.route[c].hint=b[c]}},_snapRoute:function(){var a=OSRM.G.markers.route,b=OSRM.G.response.via_points;if(b)for(var c=0;c<b.length;c++)a[c].setPosition(new L.LatLng(b[c][0],b[c][1]));OSRM.Geocoder.updateAddress(OSRM.C.SOURCE_LABEL),OSRM.Geocoder.updateAddress(OSRM.C.TARGET_LABEL),OSRM.G.markers.relabelViaMarkers()}},OSRM.RoutingAlternatives={_buttons:[{id:"gui-a",label:"A"},{id:"gui-b",label:"B"}],init:function(){OSRM.G.active_alternative=0,OSRM.G.alternative_count=0},prepare:function(a){var b=OSRM.G.response;b.route_name=b.route_name||[],b.alternative_names=b.alternative_names||[[]],b.alternative_geometries&&(b.alternative_geometries.unshift(a.route_geometry),b.alternative_instructions.unshift(a.route_instructions),b.alternative_summaries.unshift(a.route_summary),b.alternative_names.unshift(a.route_name),OSRM.G.alternative_count=a.alternative_geometries.length,OSRM.G.active_alternative>=OSRM.G.alternative_count&&(OSRM.G.active_alternative=0),b.route_geometry=b.alternative_geometries[OSRM.G.active_alternative],b.route_instructions=b.alternative_instructions[OSRM.G.active_alternative],b.route_summary=b.alternative_summaries[OSRM.G.active_alternative],b.route_name=b.alternative_names[OSRM.G.active_alternative])},setActive:function(a){OSRM.G.active_alternative=a;for(var b=OSRM.RoutingAlternatives._buttons,c=0,d=OSRM.G.alternative_count;d>c;c++)document.getElementById(b[c].id).className=a==c?"selected top-right-button widget-control gis-propertys-button":"widget-control gis-propertys-button  top-right-button"},show:function(){for(var a=OSRM.RoutingAlternatives._buttons,b="",c=0,d=OSRM.G.alternative_count;d>c&&OSRM.G.response.alternative_summaries;c++){for(var e=OSRM.Utils.toHumanDistance(OSRM.G.response.alternative_summaries[c].total_distance),f=OSRM.Utils.toHumanTime(OSRM.G.response.alternative_summaries[c].total_time),g=" &#10;(",h=0,i=OSRM.G.response.alternative_names[c].length;i>h;h++)g+=(h>0&&""!=OSRM.G.response.alternative_names[c][h]&&""!=OSRM.G.response.alternative_names[c][h-1]?" - ":"")+OSRM.G.response.alternative_names[c][h];g+=")";var j=OSRM.loc("DISTANCE")+": "+e+" &#10;"+OSRM.loc("DURATION")+": "+f+g,k=c==OSRM.G.active_alternative?"selected":"";b='<button class="'+k+' widget-control gis-propertys-button top-right-button" id="'+a[c].id+'" title="'+j+'">'+a[c].label+"</button>"+b}for(var c=OSRM.G.alternative_count,d=a.length;d>c;++c)b='<button class="disabled widget-control gis-propertys-button  top-right-button" id="'+a[c].id+'">'+a[c].label+"</button>"+b;document.getElementById("information-box-header").innerHTML=b+document.getElementById("information-box-header").innerHTML,Gis.EventBus.fire("route-changed");for(var c=0,d=OSRM.G.alternative_count;d>c;c++){var l=document.getElementById(a[c].id);l&&(l.onclick=function(a){return function(){OSRM.RoutingAlternatives._click(a)}}(c),l.onmouseover=function(a){return function(){OSRM.RoutingAlternatives._mouseover(a)}}(c),l.onmouseout=function(a){return function(){OSRM.RoutingAlternatives._mouseout(a)}}(c))}},_click:function(a){if(OSRM.G.active_alternative!=a){OSRM.RoutingAlternatives.setActive(a),OSRM.G.route.hideAlternativeRoute();var b=OSRM.G.response;b.route_geometry=b.alternative_geometries[a],b.route_instructions=b.alternative_instructions[a],b.route_summary=b.alternative_summaries[a],b.route_name=b.alternative_names[a],OSRM.RoutingGeometry.show(b),OSRM.RoutingNoNames.show(b),OSRM.RoutingDescription.show(b),OSRM.G.markers.highlight.hide()}},_mouseover:function(a){if(OSRM.G.active_alternative!=a){var b=OSRM.RoutingGeometry._decode(OSRM.G.response.alternative_geometries[a],OSRM.C.PRECISION);OSRM.G.route.showAlternativeRoute(b)}},_mouseout:function(a){OSRM.G.active_alternative!=a&&OSRM.G.route.hideAlternativeRoute()}},OSRM.RoutingDescription={QR_DIRECTORY:"qrcodes/",init:function(){OSRM.G.active_shortlink=null,OSRM.Browser.onUnloadHandler(OSRM.RoutingDescription.uninit)},uninit:function(){OSRM.G.qrcodewindow&&OSRM.G.qrcodewindow.close()},onMouseOverRouteDescription:function(a,b){OSRM.G.markers.hover.setPosition(new L.LatLng(a,b)),OSRM.G.markers.hover.show()},onMouseOutRouteDescription:function(){OSRM.G.markers.hover.hide()},onClickRouteDescription:function(a,b,c){OSRM.G.markers.highlight.setPosition(new L.LatLng(a,b)),OSRM.G.markers.highlight.show(),OSRM.G.markers.highlight.centerView(OSRM.DEFAULTS.HIGHLIGHT_ZOOM_LEVEL),null!=OSRM.G.markers.highlight.description&&document.getElementById("description-"+OSRM.G.markers.highlight.description)&&(document.getElementById("description-"+OSRM.G.markers.highlight.description).className="description-body-item"),OSRM.G.markers.highlight.description=c,document.getElementById("description-"+c).className="description-body-item description-body-item-selected"},show:function(a){var b=OSRM.C.PRECISION;OSRM.GUI.activateRouteFeatures();for(var c="?hl="+OSRM.Localization.current_language,d=0;d<OSRM.G.markers.route.length;d++)c+="&loc="+OSRM.G.markers.route[d].getLat().toFixed(b)+","+OSRM.G.markers.route[d].getLng().toFixed(b);var e=null;OSRM.G.markers.highlight.isShown()&&(e=OSRM.G.markers.highlight.description);var f=OSRM.G.route.getPositions(),g="";g+='<table class="description data-list element-hover medium-font">';for(var d=0;d<a.route_instructions.length;d++){var h="description-body-odd";d%2==0&&(h="description-body-even"),g+='<tr class="'+h+'">',g+='<td class="description-body-directions">',g+='<img class="description-body-direction" src="'+OSRM.RoutingDescription._getDrivingInstructionIcon(a.route_instructions[d][0])+'" alt=""/>',g+="</td>",g+='<td class="description-body-items">';var i=f[a.route_instructions[d][3]];g+='<div id="description-'+d+'" class="description-body-item '+(e==d?"description-body-item-selected":"")+'" onclick="OSRM.RoutingDescription.onClickRouteDescription('+i.lat.toFixed(b)+","+i.lng.toFixed(b)+","+d+')" onmouseover="OSRM.RoutingDescription.onMouseOverRouteDescription('+i.lat.toFixed(b)+","+i.lng.toFixed(b)+')" onmouseout="OSRM.RoutingDescription.onMouseOutRouteDescription('+i.lat.toFixed(b)+","+i.lng.toFixed(b)+')">',g+=""!=a.route_instructions[d][1]?OSRM.loc(OSRM.RoutingDescription._getDrivingInstruction(a.route_instructions[d][0])).replace(/\[(.*)\]/,"$1").replace(/%s/,OSRM.RoutingDescription._getStreetName(a.route_instructions[d][1])).replace(/%d/,OSRM.loc(a.route_instructions[d][6])):OSRM.loc(OSRM.RoutingDescription._getDrivingInstruction(a.route_instructions[d][0])).replace(/\[(.*)\]/,"").replace(/%d/,OSRM.loc(a.route_instructions[d][6])),g+="</div>",g+="</td>",g+='<td class="description-body-distance">',d!=a.route_instructions.length-1&&(g+="<b>"+OSRM.Utils.toHumanDistance(a.route_instructions[d][2])+"</b>"),g+="</td>",g+="</tr>"}g+="</table>";for(var j="",k="",l=0,m=a.route_name.length;m>l;l++)j+=(l>0&&""!=a.route_name[l]&&""!=a.route_name[l-1]?" - ":"")+"<span style='white-space:nowrap;'>"+OSRM.RoutingDescription._getStreetName(a.route_name[l])+"</span>",k+=(l>0&&""!=a.route_name[l]&&""!=a.route_name[l-1]?" - ":"")+OSRM.RoutingDescription._getStreetName(a.route_name[l]);Gis.EventBus.fire("route-name-changed",{name:k}),j="("+j+")",header=OSRM.RoutingDescription._buildHeader(OSRM.Utils.toHumanDistance(a.route_summary.total_distance),OSRM.Utils.toHumanTime(a.route_summary.total_time),j);var n=document.createElement("tempDiv");document.body.appendChild(n),n.className="base-font absolute-hidden",n.innerHTML=j;var o=n.clientWidth,p=370;document.body.removeChild(n),document.getElementById("information-box").className=o>p?"information-box-with-larger-header":"information-box-with-large-header",document.getElementById("information-box-header").innerHTML=header,document.getElementById("information-box").innerHTML=g,OSRM.RoutingAlternatives.show(),Gis.EventBus.fire("route-changed")},showSimple:function(a){header=OSRM.RoutingDescription._buildHeader(OSRM.Utils.toHumanDistance(a.route_summary.total_distance),OSRM.Utils.toHumanTime(a.route_summary.total_time),"",""),document.getElementById("information-box").className="information-box-with-normal-header",document.getElementById("information-box-header").innerHTML=header,document.getElementById("information-box").innerHTML="<div class='no-results big-font'>"+OSRM.loc("YOUR_ROUTE_IS_BEING_COMPUTED")+"</div>",Gis.EventBus.fire("route-changed")},showNA:function(a){OSRM.GUI.activateRouteFeatures();for(var b="?hl="+OSRM.Localization.current_language,c=OSRM.C.PRECISION,d=0;d<OSRM.G.markers.route.length;d++)b+="&loc="+OSRM.G.markers.route[d].getLat().toFixed(c)+","+OSRM.G.markers.route[d].getLng().toFixed(c);header=OSRM.RoutingDescription._buildHeader("N/A","N/A",""),document.getElementById("information-box").className="information-box-with-normal-header",document.getElementById("information-box-header").innerHTML=header,document.getElementById("information-box").innerHTML="<div class='no-results big-font'>"+a+"</div>",Gis.EventBus.fire("route-changed")},_buildHeader:function(a,b,c){var d='<div class="header-title">'+OSRM.loc("ROUTE_DESCRIPTION")+(c?'<br/><div class="header-subtitle">'+c+"</div>":"")+'</div><div class="full"><div class="row"><div class="left"><div class="full"><div class="row"><div class="left header-label nowrap">'+OSRM.loc("DISTANCE")+':</div><div class="left header-content stretch">'+a+'</div></div><div class="row"><div class="left header-label nowrap">'+OSRM.loc("DURATION")+':</div><div class="left header-content stretch">'+b+"</div></div></div></div></div></div></div>";return d},_getDrivingInstructionIcon:function(a){var b="direction_";return a=a.replace(/^11-\d{1,}$/,"11"),b+=a,OSRM.G.images[b]?OSRM.G.images[b].getAttribute("src"):OSRM.G.images.direction_0.getAttribute("src")},_getDrivingInstruction:function(a){var b="DIRECTION_";a=a.replace(/^11-\d{2,}$/,"11-x"),b+=a;var c=OSRM.loc(b);return c==b?OSRM.loc("DIRECTION_0"):c},_getStreetName:function(a){var b=a.match(/\{highway:(.*)\}/);return b=b?OSRM.loc("HIGHWAY_"+b[1].toUpperCase(),"HIGHWAY_DEFAULT"):a}},OSRM.CONSTANTS.PRECISION=6,OSRM.RoutingGeometry={show:function(a,b){var c=OSRM.RoutingGeometry._decode(a.route_geometry,OSRM.C.PRECISION);b=b||OSRM.G.route,b.showRoute(c,OSRM.Route.ROUTE)},showNA:function(){for(var a=[],b=0,c=OSRM.G.markers.route.length;c>b;b++)a.push(OSRM.G.markers.route[b].getPosition());OSRM.G.route.showRoute(a,OSRM.Route.NOROUTE)},_decode:function(a,b){b=Math.pow(10,-b);for(var c=a.length,d=0,e=0,f=0,g=[];c>d;){var h,i=0,j=0;do h=a.charCodeAt(d++)-63,j|=(31&h)<<i,i+=5;while(h>=32);var k=1&j?~(j>>1):j>>1;
e+=k,i=0,j=0;do h=a.charCodeAt(d++)-63,j|=(31&h)<<i,i+=5;while(h>=32);var l=1&j?~(j>>1):j>>1;f+=l,g.push([e*b,f*b])}return g}},OSRM.GUI.extend({init:function(){OSRM.GUI.setDistanceFormat(OSRM.DEFAULTS.DISTANCE_FORMAT),document.getElementById("gui-input-source").onchange=function(){OSRM.GUI.inputChanged(OSRM.C.SOURCE_LABEL)},document.getElementById("gui-search-source").onclick=function(){OSRM.GUI.showMarker(OSRM.C.SOURCE_LABEL)},document.getElementById("gui-input-target").onchange=function(){OSRM.GUI.inputChanged(OSRM.C.TARGET_LABEL)},document.getElementById("gui-search-target").onclick=function(){OSRM.GUI.showMarker(OSRM.C.TARGET_LABEL)},document.getElementById("gui-reverse").onclick=OSRM.GUI.reverseRouting},activateRouteFeatures:function(){OSRM.G.active_shortlink=null},deactivateRouteFeatures:function(){OSRM.G.active_shortlink=null},resetRouting:function(){document.getElementById("gui-input-source").value="",document.getElementById("gui-input-target").value="",OSRM.G.route.reset(),OSRM.G.markers.reset(),OSRM.GUI.clearResults(),OSRM.JSONP.reset()},hideRouting:function(){OSRM.G.route&&OSRM.G.route.hide(),OSRM.G.markers&&OSRM.G.markers.hide()},showRouting:function(){OSRM.G.route&&OSRM.G.route.show(),OSRM.G.markers&&OSRM.G.markers.show()},reverseRouting:function(){var a=document.getElementById("gui-input-source").value;document.getElementById("gui-input-source").value=document.getElementById("gui-input-target").value,document.getElementById("gui-input-target").value=a,OSRM.G.route.isShown()?(OSRM.G.markers.route.reverse(),OSRM.Routing.getRoute_Reversed(),OSRM.G.markers.route.reverse(),OSRM.G.markers.highlight.hide(),OSRM.RoutingDescription.showSimple(OSRM.G.response)):OSRM.G.markers.reverseMarkers(),OSRM.G.markers.reverseDescriptions()},showMarker:function(a){OSRM.JSONP.fences.geocoder_source||OSRM.JSONP.fences.geocoder_target||(a==OSRM.C.SOURCE_LABEL&&OSRM.G.markers.hasSource()?OSRM.G.markers.route[0].centerView():a==OSRM.C.TARGET_LABEL&&OSRM.G.markers.hasTarget()&&OSRM.G.markers.route[OSRM.G.markers.route.length-1].centerView())},inputChanged:function(a){a==OSRM.C.SOURCE_LABEL?OSRM.Geocoder.call(OSRM.C.SOURCE_LABEL,document.getElementById("gui-input-source").value):a==OSRM.C.TARGET_LABEL&&OSRM.Geocoder.call(OSRM.C.TARGET_LABEL,document.getElementById("gui-input-target").value)},openJOSM:function(){var a=OSRM.G.map.getZoom();if(a<OSRM.DEFAULTS.JOSM_MIN_ZOOM_LEVEL)window.alert(OSRM.loc("OPEN_JOSM_FAILED"));else{var b=OSRM.G.map.getCenterUI(),c=OSRM.G.map.getBoundsUI(),d=Math.min(.02,Math.abs(c.getSouthWest().lng-b.lng)),e=Math.min(.01,Math.abs(c.getSouthWest().lat-b.lat)),f=["left="+(b.lng-d).toFixed(6),"bottom="+(b.lat-e).toFixed(6),"right="+(b.lng+d).toFixed(6),"top="+(b.lat+e).toFixed(6)],g="http://127.0.0.1:8111/load_and_zoom?"+f.join("&"),h=document.getElementById("josm-frame");h||(h=L.DomUtil.create("iframe",null,document.body),h.style.display="none",h.id="josm-frame"),h.src=g}},openEditor:function(){var a=OSRM.G.map.getZoom();if(a<OSRM.DEFAULTS.EDITOR_MIN_ZOOM_LEVEL)window.alert(OSRM.loc("OPEN_EDITOR_FAILED"));else{var b=OSRM.G.map.getCenterUI(),c=OSRM.C.PRECISION;window.open("http://www.openstreetmap.org/edit?lat="+b.lat.toFixed(c)+"&lon="+b.lng.toFixed(c)+"&zoom="+a)}},openOSMBugs:function(){var a=OSRM.G.map.getZoom();if(a<OSRM.DEFAULTS.NOTES_MIN_ZOOM_LEVEL)window.alert(OSRM.loc("OPEN_OSMBUGS_FAILED"));else{var b=OSRM.G.map.getCenterUI(),c=OSRM.C.PRECISION;window.open("http://www.openstreetmap.org/?lat="+b.lat.toFixed(c)+"&lon="+b.lng.toFixed(c)+"&zoom="+a+"&notes=yes")}},deleteMarker:function(a){var b=null;"source"==a&&OSRM.G.markers.hasSource()?b=0:"target"==a&&OSRM.G.markers.hasTarget()&&(b=OSRM.G.markers.route.length-1),null!=b&&(OSRM.G.markers.removeMarker(b),OSRM.Routing.getRoute(),OSRM.G.markers.highlight.hide())},showPreviousRoutes:function(){0==document.getElementById("option-show-previous-routes").checked?OSRM.G.route.deactivateHistoryRoutes():OSRM.G.route.activateHistoryRoutes()},zoomOnRoute:function(){if(0!=OSRM.G.route.isShown()){var a=new L.LatLngBounds(OSRM.G.route._current_route.getPositions());OSRM.G.map.fitBoundsUI(a)}},zoomOnUser:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(OSRM.Map.geolocationResponse)},hightlightNonames:function(){OSRM.Routing.getRoute_Redraw({keepAlternative:!0})}}),OSRM.GUI.extend({init:function(){var a=OSRM.GUI.getRoutingEngines();OSRM.GUI.selectorInit("gui-engine-toggle",a,OSRM.DEFAULTS.ROUTING_ENGINE,OSRM.GUI._onRoutingEngineChanged)},setRoutingEngine:function(a){a!=OSRM.G.active_routing_engine&&(OSRM.GUI.selectorChange("gui-engine-toggle",a),OSRM.G.active_routing_engine=a,OSRM.G.active_routing_metric=OSRM.DEFAULTS.ROUTING_ENGINES[OSRM.G.active_routing_engine].metric,OSRM.G.active_routing_server_url=Gis.config(Gis.GEO_ROUTING_URL,OSRM.DEFAULTS.ROUTING_ENGINES[OSRM.G.active_routing_engine].url),OSRM.G.active_routing_timestamp_url=Gis.config(Gis.GEO_TIMESTAMP_URL,OSRM.DEFAULTS.ROUTING_ENGINES[OSRM.G.active_routing_engine].timestamp),OSRM.GUI.queryDataTimestamp())},_onRoutingEngineChanged:function(a){a!=OSRM.G.active_routing_engine&&(OSRM.GUI.setRoutingEngine(a),OSRM.G.markers.route.length>1&&OSRM.Routing.getRoute())},setRoutingEnginesLanguage:function(){var a=OSRM.GUI.getRoutingEngines();OSRM.GUI.selectorRenameOptions("gui-engine-toggle",a)},getRoutingEngines:function(){for(var a=OSRM.DEFAULTS.ROUTING_ENGINES,b=[],c=0,d=a.length;d>c;c++)b.push({display:OSRM.loc(a[c].label),value:c});return b}}),OSRM.RoutingNoNames={show:function(a){return void OSRM.G.route.hideUnnamedRoute()},showNA:function(){OSRM.G.route.hideUnnamedRoute()}},OSRM.Via={_findNearestRouteSegment:function(a){for(var b=Number.MAX_VALUE,c=void 0,d=OSRM.G.map.latLngToLayerPoint(a),e=OSRM.G.route.getPoints(),f=1;f<e.length;f++){var g=L.LineUtil._sqClosestPointOnSegment(d,e[f-1],e[f],!0);b>g&&(b=g,c=f)}return c},findViaIndex:function(a){for(var b=OSRM.Via._findNearestRouteSegment(a),c=OSRM.G.response.via_points,d=c.length-2,e=Array(),f=1;f<c.length-1;f++)if(e[f-1]=OSRM.Via._findNearestRouteSegment(new L.LatLng(c[f][0],c[f][1])),e[f-1]>b){d=f-1;break}return d},dragTimer:new Date,drawDragMarker:function(a){if(0!=OSRM.G.route.isShown()&&1!=OSRM.G.dragging&&!(new Date-OSRM.Via.dragTimer<25)){OSRM.Via.dragTimer=new Date;for(var b=OSRM.G.route._current_route.route.closestLayerPoint(a.layerPoint),c=b?b.distance:1e3,d=a.latlng,e=0,f=OSRM.G.markers.route.length;f>e;e++)if("drag"!=OSRM.G.markers.route[e].label){var g=OSRM.G.markers.route[e].getPosition(),h=OSRM.G.map.project(d).distanceTo(OSRM.G.map.project(g));20>h&&(c=1e3)}for(var i=OSRM.G.map.layerPointToContainerPoint(a.layerPoint),j=document.elementFromPoint(i.x,i.y),e=0,f=OSRM.G.markers.route.length;f>e;e++)"drag"!=OSRM.G.markers.route[e].label&&j==OSRM.G.markers.route[e].marker._icon&&(c=1e3);OSRM.G.markers.highlight.isShown()&&(OSRM.G.map.project(d).distanceTo(OSRM.G.map.project(OSRM.G.markers.highlight.getPosition()))<20?c=1e3:j==OSRM.G.markers.highlight.marker._icon&&(c=1e3)),20>c?(OSRM.G.markers.dragger.setPosition(OSRM.G.map.layerPointToLatLng(b)),OSRM.G.markers.dragger.show()):OSRM.G.markers.dragger.hide()}}},OSRM.CONSTANTS.SOURCE_LABEL="source",OSRM.CONSTANTS.TARGET_LABEL="target",OSRM.CONSTANTS.VIA_LABEL="via",OSRM.CONSTANTS.DO_FALLBACK_TO_LAT_LNG=!0,OSRM.Geocoder={call:function(a,b){if(""!=b){if(b.match(/^\s*[-+]?[0-9]*\.?[0-9]+\s*[,;]\s*[-+]?[0-9]*\.?[0-9]+\s*$/)){var c=b.split(/[,;]/);return OSRM.Geocoder._onclickResult(a,c[0],c[1]),void OSRM.Geocoder.updateAddress(a)}var d=Gis.config(Gis.GEO_FORWARD_SEARCH_URL,OSRM.DEFAULTS.HOST_GEOCODER_URL)+"?format=json&json_callback=%jsonp"+OSRM.DEFAULTS.GEOCODER_BOUNDS+"&accept-language="+OSRM.Localization.current_language+"&limit=30&q="+b,e=OSRM.G.map.getBounds();d+="&viewbox="+e._southWest.lng+","+e._northEast.lat+","+e._northEast.lng+","+e._southWest.lat,OSRM.JSONP.call(d,OSRM.Geocoder._showResults,OSRM.Geocoder._showResults_Timeout,OSRM.DEFAULTS.JSONP_TIMEOUT,"geocoder_"+a,{marker_id:a,query:b})}},_onclickResult:function(a,b,c,d){var e;if(a==OSRM.C.SOURCE_LABEL)e=OSRM.G.markers.setSource(new L.LatLng(b,c));else{if(a!=OSRM.C.TARGET_LABEL)return;e=OSRM.G.markers.setTarget(new L.LatLng(b,c))}OSRM.G.markers.route[e].show(),OSRM.G.markers.route[e].centerView(d),OSRM.G.markers.route.length>1&&OSRM.Routing.getRoute()},_showResults:function(a,b){if(!a)return void OSRM.Geocoder._showResults_Empty(b);if(0==a.length)return void OSRM.Geocoder._showResults_Empty(b);var c=a,d=null;if(null!=c[0].boundingbox&&(d=OSRM.G.map.getBoundsZoom([[c[0].boundingbox[0],c[0].boundingbox[2]],[c[0].boundingbox[1],c[0].boundingbox[3]]],!0)),OSRM.Geocoder._onclickResult(b.marker_id,c[0].lat,c[0].lon,d),!(OSRM.G.markers.route.length>1)){var e="";e+='<table class="results medium-font">';for(var f=0;f<c.length;f++){var g=c[f],h="results-body-odd";if(f%2==0&&(h="results-body-even"),e+='<tr class="'+h+'">',g.icon||(g.icon="http://nominatim.openstreetmap.org/images/mapicons/poi_point_of_interest.glow.12.png"),e+='<td class="results-body-counter"><img src="'+g.icon+'" alt=""/></td>',e+='<td class="results-body-items">',g.display_name){var d="null";null!=g.boundingbox&&(d=OSRM.G.map.getBoundsZoom([[g.boundingbox[0],g.boundingbox[2]],[g.boundingbox[1],g.boundingbox[3]]],!0)),e+='<div class="results-body-item" onclick="OSRM.Geocoder._onclickResult(\''+b.marker_id+"', "+g.lat+", "+g.lon+", "+d+');">'+g.display_name,e+="</div>"}e+="</td></tr>"}e+="</table>",document.getElementById("information-box-header").innerHTML="<div class='header-title'>"+OSRM.loc("SEARCH_RESULTS")+"</div><div class='header-content'>("+OSRM.loc("FOUND_X_RESULTS").replace(/%i/,c.length)+")</div>","<div class='header-content'>(found "+c.length+" results)</div>",document.getElementById("information-box").className="information-box-with-normal-header",document.getElementById("information-box").innerHTML=e,Gis.EventBus.fire("route-changed")}},_showResults_Empty:function(a){document.getElementById("information-box-header").innerHTML="<div class='header-title'>"+OSRM.loc("SEARCH_RESULTS")+"</div><div class='header-content'>("+OSRM.loc("FOUND_X_RESULTS").replace(/%i/,0)+")</div>",document.getElementById("information-box").className="information-box-with-normal-header",document.getElementById("information-box").innerHTML=a.marker_id==OSRM.C.SOURCE_LABEL?"<div class='no-results big-font'>"+OSRM.loc("NO_RESULTS_FOUND_SOURCE")+": "+a.query+"</div>":a.marker_id==OSRM.C.TARGET_LABEL?"<div class='no-results big-font'>"+OSRM.loc("NO_RESULTS_FOUND_TARGET")+": "+a.query+"</div>":"<div class='no-results big-font'>"+OSRM.loc("NO_RESULTS_FOUND")+": "+a.query+"</div>",Gis.EventBus.fire("route-changed")},_showResults_Timeout:function(){document.getElementById("information-box-header").innerHTML="<div class='header-title'>"+OSRM.loc("SEARCH_RESULTS")+"</div><div class='header-content'>("+OSRM.loc("FOUND_X_RESULTS").replace(/%i/,0)+")</div>",document.getElementById("information-box").className="information-box-with-normal-header",document.getElementById("information-box").innerHTML="<div class='no-results big-font'>"+OSRM.loc("TIMED_OUT")+"</div>",Gis.EventBus.fire("route-changed")},updateLocation:function(a){var b=OSRM.C.PRECISION;a==OSRM.C.SOURCE_LABEL&&OSRM.G.markers.hasSource()?document.getElementById("gui-input-source").value=OSRM.G.markers.route[0].getLat().toFixed(b)+", "+OSRM.G.markers.route[0].getLng().toFixed(b):a==OSRM.C.TARGET_LABEL&&OSRM.G.markers.hasTarget()&&(document.getElementById("gui-input-target").value=OSRM.G.markers.route[OSRM.G.markers.route.length-1].getLat().toFixed(b)+", "+OSRM.G.markers.route[OSRM.G.markers.route.length-1].getLng().toFixed(b))},updateAddress:function(a,b){var c=null,d=null,e=null;if(a==OSRM.C.SOURCE_LABEL&&OSRM.G.markers.hasSource())c=OSRM.G.markers.route[0].getLat(),d=OSRM.G.markers.route[0].getLng(),e=OSRM.G.markers.route[0].description;else{if(a!=OSRM.C.TARGET_LABEL||!OSRM.G.markers.hasTarget())return;c=OSRM.G.markers.route[OSRM.G.markers.route.length-1].getLat(),d=OSRM.G.markers.route[OSRM.G.markers.route.length-1].getLng(),e=OSRM.G.markers.route[OSRM.G.markers.route.length-1].description}if(null!=e)return void OSRM.Geocoder._showReverseResults({address:{road:e}},{marker_id:a});var f=OSRM.C.PRECISION,g=Gis.config(Gis.GEO_REVERSE_SEARCH_URL,OSRM.DEFAULTS.HOST_REVERSE_GEOCODER_URL)+"?format=json&json_callback=%jsonp&accept-language="+OSRM.Localization.current_language+"&lat="+c.toFixed(f)+"&lon="+d.toFixed(f);OSRM.JSONP.call(g,OSRM.Geocoder._showReverseResults,OSRM.Geocoder._showReverseResults_Timeout,OSRM.DEFAULTS.JSONP_TIMEOUT,"reverse_geocoder_"+a,{marker_id:a,do_fallback:b})},_showReverseResults:function(a,b){if(!a)return void OSRM.Geocoder._showReverseResults_Timeout(a,b);if(void 0==a.address)return void OSRM.Geocoder._showReverseResults_Timeout(a,b);var c=0,d="";return a.address.road&&(d+=a.address.road,c++),a.address.city?(c>0&&(d+=", "),d+=a.address.city,c++):a.address.village&&(c>0&&(d+=", "),d+=a.address.village,c++),2>c&&a.address.country&&(c>0&&(d+=", "),d+=a.address.country,c++),0==c?void OSRM.Geocoder._showReverseResults_Timeout(a,b):void(b.marker_id==OSRM.C.SOURCE_LABEL&&OSRM.G.markers.hasSource()?document.getElementById("gui-input-source").value=d:b.marker_id==OSRM.C.TARGET_LABEL&&OSRM.G.markers.hasTarget()&&(document.getElementById("gui-input-target").value=d))},_showReverseResults_Timeout:function(a,b){b.do_fallback&&OSRM.Geocoder.updateLocation(b.marker_id)},_showInitResults:function(a,b){var c=OSRM.G.initial_positions;if(c.done++,a&&0!=a.length?(c.positions[b.id]=new L.LatLng(a[0].lat,a[0].lon),null==c.zoom&&null!=a[0].boundingbox&&(c.zoom=OSRM.G.map.getBoundsZoom([[a[0].boundingbox[0],a[0].boundingbox[2]],[a[0].boundingbox[1],a[0].boundingbox[3]]],!0))):c.fail=!0,c.done==c.positions.length){if(1==c.fail)return void OSRM.GUI.exclusiveNotify(OSRM.loc("NOTIFICATION_GEOCODERFAIL_HEADER"),OSRM.loc("NOTIFICATION_GEOCODERFAIL_BODY"),!0);OSRM.GUI.exclusiveDenotify(),OSRM.Geocoder[b.callback]()}},_showInitResults_Destinations:function(){var a=OSRM.G.initial_positions,b=a.positions,c=OSRM.G.markers.setTarget(b[b.length-1]);OSRM.G.markers.route[c].description=a.name,OSRM.Geocoder.updateAddress(OSRM.C.TARGET_LABEL,OSRM.C.DO_FALLBACK_TO_LAT_LNG),OSRM.G.markers.route[c].show(),OSRM.G.markers.route[c].centerView(a.zoom);for(var d=0;d<b.length-1;d++)OSRM.G.markers.addInitialVia(b[d]);OSRM.G.initial_position_override=!0},_showInitResults_Locations:function(){var a=OSRM.G.initial_positions,b=a.positions;b.length>0&&(OSRM.G.markers.setSource(b[0]),OSRM.Geocoder.updateAddress(OSRM.C.SOURCE_LABEL,OSRM.C.DO_FALLBACK_TO_LAT_LNG)),b.length>1&&(OSRM.G.markers.setTarget(b[b.length-1]),OSRM.Geocoder.updateAddress(OSRM.C.TARGET_LABEL,OSRM.C.DO_FALLBACK_TO_LAT_LNG));for(var c=1;c<b.length-1;c++)OSRM.G.markers.setVia(c-1,b[c]);for(var c=0;c<OSRM.G.markers.route.length;c++)OSRM.G.markers.route[c].show();if(null==a.zoom||null==a.center){var d=new L.LatLngBounds(b);OSRM.G.map.fitBoundsUI(d)}else OSRM.G.map.setView(a.center,a.zoom);OSRM.G.active_alternative=a.active_alternative||0,OSRM.Routing.getRoute({keepAlternative:!0}),OSRM.G.initial_position_override=!0}},OSRM.CSS={getStylesheet:function(a,b){b=b||document;for(var c=b.styleSheets,d=0,e=c.length;e>d;d++)if(c[d].href&&c[d].href.indexOf(a)>=0)return c[d];return null},insert:function(a,b,c){a.addRule?a.addRule(b,c):a.insertRule&&a.insertRule(b+" { "+c+" }",a.cssRules.length)}},OSRM.JSONP={fences:{},callbacks:{},timeouts:{},timers:{},late:function(){},empty:function(){},call:function(a,b,c,d,e,f){if(1==OSRM.JSONP.fences[e])return!1;OSRM.JSONP.fences[e]=!0,OSRM.JSONP.timeouts[e]=function(a){try{c(a,f)}finally{OSRM.JSONP.callbacks[e]=OSRM.JSONP.late,OSRM.JSONP.timeouts[e]=OSRM.JSONP.empty,OSRM.JSONP.fences[e]=void 0}},OSRM.JSONP.callbacks[e]=function(a){clearTimeout(OSRM.JSONP.timers[e]),OSRM.JSONP.timers[e]=void 0;try{b(a,f)}finally{OSRM.JSONP.callbacks[e]=OSRM.JSONP.empty,OSRM.JSONP.timeouts[e]=OSRM.JSONP.late,OSRM.JSONP.fences[e]=void 0}};var g=document.getElementById("jsonp_"+e);g&&g.parentNode.removeChild(g);var h=document.createElement("script");return h.type="text/javascript",h.id="jsonp_"+e,h.src=a.replace(/%jsonp/,"OSRM.JSONP.callbacks."+e),document.head.appendChild(h),OSRM.JSONP.timers[e]=setTimeout(OSRM.JSONP.timeouts[e],d),!0},clear:function(a){clearTimeout(OSRM.JSONP.timers[a]),OSRM.JSONP.callbacks[a]=OSRM.JSONP.empty,OSRM.JSONP.timeouts[a]=OSRM.JSONP.empty,OSRM.JSONP.fences[a]=void 0;var b=document.getElementById("jsonp_"+a);b&&b.parentNode.removeChild(b)},reset:function(){OSRM.JSONP.fences={},OSRM.JSONP.callbacks={},OSRM.JSONP.timeouts={},OSRM.JSONP.timers={}}},OSRM.Localization={DIRECTORY:"localization/",current_language:OSRM.DEFAULTS.LANGUAGE,fallback_language:"ru",load_on_demand_language:null,init:function(){var a=OSRM.DEFAULTS.LANGUAGE_SUPPORTED;if(1==OSRM.DEFAULTS.LANGUAGE_USE_BROWSER_SETTING)for(var b=(navigator.language||navigator.userLanguage||"").substring(0,2),c=0;c<a.length;++c)a[c].encoding==b&&(OSRM.Localization.current_language=b);for(var d=[],e=[],f=0,c=0,g=a.length;g>c;c++)d.push({display:a[c].encoding,value:a[c].encoding}),e.push({display:a[c].name,value:a[c].encoding}),a[c].encoding==OSRM.Localization.current_language&&(f=c);OSRM.Localization.setLanguage(OSRM.Localization.fallback_language),OSRM.Localization.setLanguage(OSRM.Localization.current_language)},setLanguageWrapper:function(a){OSRM.Localization.setLanguage(a)},setLanguage:function(a,b){if(b){var c=OSRM.Localization[OSRM.Localization.fallback_language];if(null==c||null!=c.loading)return;var d=OSRM.Localization[OSRM.Localization.load_on_demand_language];if(null!=d&&null==d.loading&&(a=OSRM.Localization.load_on_demand_language),a!=OSRM.Localization.load_on_demand_language)return}if(OSRM.Localization[a]){if(OSRM.Localization[a].loading)return;OSRM.Localization.current_language=a,OSRM.Localization.load_on_demand_language=null,OSRM.GUI.setLabels(),OSRM.Utils.updateAbbreviationCache();for(var e=0,f=OSRM.G.localizable_maps.length;f>e;e++)OSRM.G.localizable_maps[e].options.culture=OSRM.loc("CULTURE");if(null==OSRM.G.markers)return;OSRM.G.markers.route.length>1?OSRM.Routing.getRoute({keepAlternative:!0}):OSRM.G.markers.route.length>0&&""!=document.getElementById("information-box").innerHTML?(OSRM.Geocoder.call(OSRM.C.SOURCE_LABEL,document.getElementById("gui-input-source").value),OSRM.Geocoder.call(OSRM.C.TARGET_LABEL,document.getElementById("gui-input-target").value)):(OSRM.Geocoder.updateAddress(OSRM.C.SOURCE_LABEL,!1),OSRM.Geocoder.updateAddress(OSRM.C.TARGET_LABEL,!1),OSRM.GUI.clearResults())}else if(1==OSRM.DEFAULTS.LANUGAGE_ONDEMAND_RELOADING)for(var g=OSRM.DEFAULTS.LANGUAGE_SUPPORTED,e=0,f=g.length;f>e;e++)if(g[e].encoding==a){OSRM.Localization.load_on_demand_language=a,OSRM.Localization[a]={loading:!0};var h=document.createElement("script");h.type="text/javascript",h.src=OSRM.Localization.DIRECTORY+"OSRM.Locale."+a+".js",document.head.appendChild(h);break}},translate:function(a,b){return OSRM.Localization[OSRM.Localization.current_language]&&OSRM.Localization[OSRM.Localization.current_language][a]?OSRM.Localization[OSRM.Localization.current_language][a]:OSRM.Localization[OSRM.Localization.fallback_language]&&OSRM.Localization[OSRM.Localization.fallback_language][a]?OSRM.Localization[OSRM.Localization.fallback_language][a]:b?OSRM.loc(b):a}},OSRM.loc=OSRM.Localization.translate,OSRM.Localization.ru={CULTURE:"ru-RU",LANGUAGE:"Русский",GUI_START:"Начало",GUI_END:"Конец",GUI_RESET:"Сбросить",GUI_ZOOM_ON_ROUTE:"Показать маршрут",GUI_ZOOM_ON_USER:"Показать пользователя",GUI_SEARCH:"Показать",GUI_REVERSE:"Обратно",GUI_START_TOOLTIP:"Укажите начальную точку",GUI_END_TOOLTIP:"Укажите пункт назначения",GUI_MAIN_WINDOW:"Главное окно",GUI_ZOOM_IN:"Увеличить",GUI_ZOOM_OUT:"Масштаб",GUI_CONFIGURATION:"Настройки",GUI_LANGUAGE:"Язык",GUI_UNITS:"Единицы",GUI_KILOMETERS:"Километры",GUI_MILES:"Мили",GUI_M:"м",GUI_KM:"км",GUI_MI:"миль",GUI_FT:"футов",GUI_H:"ч",GUI_MIN:"мин",GUI_S:"с",GUI_MAPPING_TOOLS:"Настройки карты",GUI_HIGHLIGHT_UNNAMED_ROADS:"Выделить безымянные улицы",GUI_SHOW_PREVIOUS_ROUTES:"Отображать предыдущий маршрут",GUI_EXTERNAL_TOOLS:"Внешние инструменты:",OPEN_EDITOR:"Редактор",OPEN_OSMBUGS:"Заметки",OPEN_JOSM_FAILED:"Приблизьте карту, чтобы открыть редактор OSM.",OPEN_OSMBUGS_FAILED:"Приблизьте карту, чтобы оставить заметку.",SEARCH_RESULTS:"Результаты поиска",FOUND_X_RESULTS:"найдено %i результатов",TIMED_OUT:"Превышен интервал ожидания",NO_RESULTS_FOUND:"Ничего не найдено",NO_RESULTS_FOUND_SOURCE:"Начальная точка не найдена",NO_RESULTS_FOUND_TARGET:"Пункт назначения не найден",ROUTE_DESCRIPTION:"Описание маршрута",GET_LINK_TO_ROUTE:"Постоянная ссылка",ROUTE_LINK:"Ссылка на маршрут",GENERATE_LINK_TO_ROUTE:"создание ссылки",LINK_TO_ROUTE_TIMEOUT:"недоступно",GPX_FILE:"GPX Файл",DISTANCE:"Расстояние",DURATION:"Время",YOUR_ROUTE_IS_BEING_COMPUTED:"Вычисление маршрута",NO_ROUTE_FOUND:"Маршрут не найден",OVERVIEW_MAP:"Обзорная карта",NO_ROUTE_SELECTED:"Маршрут не выбран",ENGINE_0:"Автомобиль",N:"север",E:"восток",S:"юг",W:"запад",NE:"северо-восток",SE:"юго-восток",SW:"юго-запад",NW:"северо-запад",DIRECTION_0:"Неизвестная инструкция[ по <b>%s</b>]",DIRECTION_1:"Продолжайте движение[ по <b>%s</b>]",DIRECTION_2:"Примите вправо[ на <b>%s</b>]",DIRECTION_3:"Поверните направо[ на <b>%s</b>]",DIRECTION_4:"Поверните резко направо[ на <b>%s</b>]",DIRECTION_5:"U-образный разворот[ на <b>%s</b>]",DIRECTION_6:"Поверните резко налево[ на <b>%s</b>]",DIRECTION_7:"Поверните налево[ на <b>%s</b>]",DIRECTION_8:"Примите влево[ на <b>%s</b>]",DIRECTION_10:"Направляйтесь на <b>%d</b>[ по <b>%s</b>]","DIRECTION_11-1":"На кольцевой дороге выполните 1-ый съезд[ на <b>%s</b>]","DIRECTION_11-2":"На кольцевой дороге выполните 2-ой съезд[ на <b>%s</b>]","DIRECTION_11-3":"На кольцевой дороге выполните 3-ий съезд[ на <b>%s</b>]","DIRECTION_11-4":"На кольцевой дороге выполните 4-ый съезд[ на <b>%s</b>]","DIRECTION_11-5":"На кольцевой дороге выполните 5-ый съезд[ на <b>%s</b>]","DIRECTION_11-6":"На кольцевой дороге выполните 6-ой съезд[ на <b>%s</b>]","DIRECTION_11-7":"На кольцевой дороге выполните 7-ой съезд[ на <b>%s</b>]","DIRECTION_11-8":"На кольцевой дороге выполните 8-ой съезд[ на <b>%s</b>]","DIRECTION_11-9":"На кольцевой дороге выполните 9-ый съезд[ на <b>%s</b>]","DIRECTION_11-x":"На кольцевой дороге выполните съезд[ на <b>%s</b>]",DIRECTION_15:"Вы прибыли в пункт назначения",NOTIFICATION_MAINTENANCE_HEADER:"Плановое техническое обслуживание",NOTIFICATION_MAINTENANCE_BODY:"Сайт OSRM остановлен для технического обслуживания.Пожалуйста, подождите пока не будут установлены необходимые обновления. В ближайшее время сайт снова заработает.<br/><br/>Пока вы можете прогуляться по знакомым окрестностям...<br/><br/><br/>[OSRM]",NOTIFICATION_LOCALIZATION_HEADER:"Знаете ли вы? Вы можете сменить отображаемый язык.",NOTIFICATION_LOCALIZATION_BODY:"Используйте выпадающее меню в левом верхнем углу чтобы выбрать предпочитаемый вами язык. <br/><br/>Не отчаивайтесь, если вы не можете выбрать свой язык. Если захотите, вы можете помочь нам добавив свой новый перевод! Заходите <a href='https://github.com/DennisSchiefer/Project-OSRM-Web'>сюда</a> за дополнительной информацией.",NOTIFICATION_CLICKING_HEADER:"Знаете ли вы? Вы можете щёлкать мышью на карте, чтобы устанавливать метки.",NOTIFICATION_CLICKING_BODY:"Вы можете щёлкнуть на карте левой кнопкой мыши чтобы установить зелёную метку начала маршрута или красную метку конца маршрута, если начало маршрута уже определено. Адрес указанного вами места отобразится слева. <br/><br/>Вы можете удалить метку ещё раз щёлкнув по ней левой кнопкой мыши.",NOTIFICATION_DRAGGING_HEADER:"Знаете ли вы? Вы можете перемещать по карте любую метку маршрута.",NOTIFICATION_DRAGGING_BODY:"Щёлкните по метке левой кнопкой мыши и удерживайте кнопку нажатой. Затем двигайте метку по карте. Маршрут будет мгновенно обновляться. <br/><br/>Также вы можете добавлять к маршруту промежуточные метки вытягивая их из основного маршрута! "},1==OSRM.DEFAULTS.LANUGAGE_ONDEMAND_RELOADING&&OSRM.Localization.setLanguage("ru",!0),OSRM.Utils={seconds:"s",minutes:"min",hours:"h",miles:"mi",feet:"ft",kilometers:"km",meters:"m",updateAbbreviationCache:function(){OSRM.Utils.seconds=OSRM.loc("GUI_S"),OSRM.Utils.minutes=OSRM.loc("GUI_MIN"),OSRM.Utils.hours=OSRM.loc("GUI_H"),OSRM.Utils.miles=OSRM.loc("GUI_MI"),OSRM.Utils.feet=OSRM.loc("GUI_FT"),OSRM.Utils.kilometers=OSRM.loc("GUI_KM"),OSRM.Utils.meters=OSRM.loc("GUI_M")},toHumanTime:function(a){return a=parseInt(a),minutes=parseInt(a/60),a%=60,hours=parseInt(minutes/60),minutes%=60,0==hours&&0==minutes?a+"&nbsp;s":0==hours?minutes+"&nbsp;min":hours>0?hours+"&nbsp;h&nbsp;"+minutes+"&nbsp;min":"N/A"},toHumanDistanceMeters:function(a){var b=parseInt(a);return b/=1e3,b>=100?b.toFixed(0)+"&nbsp;"+OSRM.Utils.kilometers:b>=10?b.toFixed(1)+"&nbsp;"+OSRM.Utils.kilometers:b>=.1?b.toFixed(2)+"&nbsp;"+OSRM.Utils.kilometers:b>=0?(1e3*b).toFixed(0)+"&nbsp;"+OSRM.Utils.meters:"N/A"},toHumanDistanceMiles:function(a){var b=parseInt(a);return b/=1609.344,b>=100?b.toFixed(0)+"&nbsp;"+OSRM.Utils.miles:b>=10?b.toFixed(1)+"&nbsp;"+OSRM.Utils.miles:b>=.1?b.toFixed(2)+"&nbsp;"+OSRM.Utils.miles:b>=0?(5280*b).toFixed(0)+"&nbsp;"+OSRM.Utils.feet:"N/A"},toHumanDistance:null,isLatitude:function(a){return a>=-90&&90>=a?!0:!1},isLongitude:function(a){return a>=-180&&180>=a?!0:!1},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},getHash:function(a){return a.split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0)}};